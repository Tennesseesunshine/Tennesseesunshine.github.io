<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å‰ç«¯æ‰¹é‡å¯¼å‡ºæ¥å£æ•°æ®æ–¹æ¡ˆ</title>
    <link href="/2021/06/25/webBrowserExportFile/"/>
    <url>/2021/06/25/webBrowserExportFile/</url>
    
    <content type="html"><![CDATA[<p>ä¸­åå°å¯¼å‡ºæ•°æ®çš„éœ€æ±‚åœºæ™¯ç›®å‰å·²ç»æ˜¯éå¸¸å¸¸è§çš„ï¼Œæ‰€ä»¥åœ¨ä¸ªäººé‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå°è¯•å‰ç«¯è§£å†³å¹¶ä¸”ä½¿ç”¨çš„ä¸€äº›æ–¹æ¡ˆã€‚</p><p>ç›®å‰æ€»ç»“äº†ä¸‹ï¼Œå¤§è‡´ä¸¤ä¸ªæ–¹æ¡ˆï¼šè¦ä¹ˆå¯¼å‡º <code>excel</code>ï¼Œè¦ä¹ˆå¯¼å‡º <code>csv</code>ï¼Œå…·ä½“åœ¨å“ª <code>node</code> å±‚è¿˜æ˜¯æµè§ˆå™¨å¯ä»¥çœ‹éœ€æ±‚ä»¥åŠæ€§èƒ½æ¥è°ƒæ•´ã€‚</p><h2 id="æ–¹æ¡ˆä¸€ï¼šnode-å±‚å°†-json-æ•°æ®è½¬æ¢ä¸ºæµï¼Œå‰ç«¯ç›´æ¥ä¸‹è½½"><a href="#æ–¹æ¡ˆä¸€ï¼šnode-å±‚å°†-json-æ•°æ®è½¬æ¢ä¸ºæµï¼Œå‰ç«¯ç›´æ¥ä¸‹è½½" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šnode å±‚å°† json æ•°æ®è½¬æ¢ä¸ºæµï¼Œå‰ç«¯ç›´æ¥ä¸‹è½½"></a>æ–¹æ¡ˆä¸€ï¼š<code>node</code> å±‚å°† <code>json</code> æ•°æ®è½¬æ¢ä¸ºæµï¼Œå‰ç«¯ç›´æ¥ä¸‹è½½</h2><p>è¿™ä¸ªå‰ææ˜¯æœ‰ <code>node</code> ä½œä¸ºä¸­é—´å±‚ï¼Œå¯ä»¥æŠŠä¸€äº›æ•°æ®åœ¨è¿™ä¸€å±‚é€‚é…ï¼Œæ‰€ä»¥ä¸€äº›æ•°æ®çš„æ˜ å°„ã€ä»£ç çš„å¤ç”¨ä¹Ÿéƒ½å¯ä»¥åœ¨è¿™ä¸€å±‚ï¼Œåœ¨è¿™ä¸€å±‚å°† <code>json</code> è½¬ä¸ºæµ <code>excel</code>ã€‚</p><p>æ€è·¯å°±æ˜¯å‰ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå°†è¯·æ±‚å‚æ•°ç»™ <code>node</code> ï¼Œ<code>node</code> åˆ©ç”¨ <code>axios</code> å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œè¯·æ±‚çš„å°±æ˜¯å¯¼å‡ºæ•°æ®çš„æ¥å£ï¼Œä½†æ˜¯æ¥å£è¿”å›çš„æ˜¯ <code>json</code> æ•°æ®ï¼Œæ‰€ä»¥åœ¨ç”¨ <code>Promise.all</code> è¯·æ±‚å®Œæˆæ•°æ®ä¹‹åï¼Œåœ¨æœåŠ¡ç«¯åˆ©ç”¨ <code>xlsx</code> çš„åŒ…å°† <code>json</code> æ•°æ®è½¬ä¸ºæµï¼Œå‰ç«¯åˆ©ç”¨ <code>blob</code> æ¥å¤„ç†ä¸‹è½½ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼š</p><ul><li><code>xlsx</code> è½¬ä¸ºè¡¨æ ¼çš„æ—¶å€™æ•°æ®çš„æ ¼å¼åº”è¯¥æ˜¯ <code>[[&#39;æ ‡é¢˜&#39;, &#39;ç”Ÿæ—¥&#39;, &#39;å¹´é¾„&#39;],[&#39;title&#39;, &#39;birthday&#39;, &#39;age&#39;],[&#39;title&#39;, &#39;birthday&#39;, &#39;age&#39;]...]</code>ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯ <code>excel</code> çš„è¡¨æ ¼è¡¨å¤´ï¼Œå‰©ä¸‹çš„é¡¹ç›®æ˜¯è¯·æ±‚å›æ¥ <code>json</code> æ•°æ®çš„æ¯ä¸€ä¸ªéœ€è¦å¯¼å‡ºçš„é¡¹ã€‚</li></ul><p>æˆ‘ä»¬ä¼ªä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š</p><h3 id="node-å±‚"><a href="#node-å±‚" class="headerlink" title="node å±‚"></a><code>node</code> å±‚</h3><ul><li>ä¸»é€»è¾‘ï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯ <code>thinkjs</code>ï¼Œæ‰€ä»¥æŒ‰ç…§ <code>think</code> çš„æ–¹å¼å¤„ç†å‚æ•°ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> XLSX = <span class="hljs-built_in">require</span>(<span class="hljs-string">"xlsx"</span>);<br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">downloadExcelAction</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> EXCEL_TITLE = [<span class="hljs-string">"æ ‡é¢˜"</span>, <span class="hljs-string">"ç”Ÿæ—¥"</span>, <span class="hljs-string">"å¹´é¾„"</span>];<br><br>  <span class="hljs-comment">// å®é™…æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å°±åº”è¯¥æ˜¯è¿™æ ·è·å–æ•°æ®</span><br>  <span class="hljs-comment">// const params = this.post() // è·å–bodyå‚æ•°</span><br>  <span class="hljs-comment">// const serviceUrl = this.get('serviceUrl') // è·å–getè¯·æ±‚å‚æ•°çš„å®é™…æœåŠ¡ç«¯åœ°å€</span><br>  <span class="hljs-comment">// const data = await Promise.all(mapRequestList(serviceUrl, params))</span><br><br>  <span class="hljs-comment">// è¿™é‡Œå¯èƒ½éœ€è¦é¢å¤–åšä¸€ä¸ªå¤„ç†ï¼Œdataè¿”å›çš„æ•°æ®æ ¼å¼æˆ–è®¸æ˜¯[[],[],[]]</span><br>  <span class="hljs-comment">// æˆ‘ä»¬éœ€è¦å¤„ç†æ¯ä¸€é¡¹ï¼Œpromise.allæ¥å—çš„æ•°æ®åº”è¯¥è¢«æ‰“å¹³</span><br>  <span class="hljs-comment">// å³data.flat(2) æˆ–è€… flatten(data)</span><br><br><br>  <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬å…ˆå‡†å¤‡çš„å‡æ•°æ®</span><br>  <span class="hljs-keyword">const</span> data = [<br>    &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">"ç¬¬ä¸€ä¸ª"</span>,<br>      <span class="hljs-attr">birthday</span>: <span class="hljs-string">"1999/01/03"</span>,<br>      <span class="hljs-attr">age</span>: <span class="hljs-string">"23"</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">"ç¬¬äºŒä¸ª"</span>,<br>      <span class="hljs-attr">birthday</span>: <span class="hljs-string">"2000/12/03"</span>,<br>      <span class="hljs-attr">age</span>: <span class="hljs-string">"20"</span>,<br>    &#125;,<br>  ];<br><br>  <span class="hljs-keyword">let</span> xlsxData = [];<br>  data.forEach(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> d = [element.title, element.birthday, element.age];<br><br>    <span class="hljs-comment">// è¿™é‡Œä¸ä½¿ç”¨pushæ˜¯ä¸ºäº†é¿å…æ•°æ®é¡ºåºé—®é¢˜</span><br>    xlsxData[index] = d;<br>  &#125;);<br>  xlsxData = [EXCEL_TITLE, ...xlsxData];<br><br>  <span class="hljs-comment">// æœ€åæˆ‘ä»¬è¦ç”Ÿæˆçš„è¡¨æ ¼è‚¯å®šæ˜¯è¿™æ ·çš„ä¸€ä¸ªæ•°æ®ç»“æ„ xlsxData å†è°ƒç”¨xlsxçš„api</span><br>  <span class="hljs-keyword">const</span> sheet = XLSX.utils.aoa_to_sheet(xlsxData);<br><br>  <span class="hljs-comment">// è·å–ä¸Šä¸‹æ–‡</span><br>  <span class="hljs-keyword">const</span> ctx = <span class="hljs-keyword">this</span>.ctx;<br><br>  <span class="hljs-comment">// excel è½¬ node æ–‡ä»¶æµ</span><br>  <span class="hljs-keyword">const</span> result = sheetToBuffer(sheet);<br><br>  <span class="hljs-comment">// è®¾ç½® excel ä¸‹è½½çš„å“åº” Content-Type</span><br>  <span class="hljs-keyword">const</span> mimeType =<br>    <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>;<br>  ctx.set(<span class="hljs-string">"Content-Type"</span>, mimeType);<br>  ctx.body = result;<br>  ctx.status = <span class="hljs-number">200</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿçš„æ•°æ®ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„æ•°ç»„ <code>data</code>ï¼Œä½†æ˜¯ç°å®æƒ…å†µè‚¯å®šæ˜¯éœ€è¦å‘æœåŠ¡ç«¯å‘è¯·æ±‚è·å–æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥åˆ©ç”¨ <code>Promise.all</code> å¤„ç†ã€‚å‡è®¾åˆ—è¡¨é¡µä¸­éœ€è¦å¯¼å‡ºæ•°æ® <code>10000</code> æ¡ï¼Œæ¯æ¬¡è¯·æ±‚ <code>500</code> æ¡ï¼Œéœ€è¦è¯·æ±‚ <code>20</code> æ¬¡ï¼Œæ¯æ¬¡åˆ†é¡µåç§»é‡å¢åŠ  <code>1</code>ï¼Œæ‰€ä»¥å…·ä½“çš„å®ç°ä¼ªä»£ç ï¼š</p><ul><li><code>baseAxiosRequest</code> æœ€åŸºæœ¬çš„å•å…ƒæ¥å£è¯·æ±‚æ•°æ®çš„æ–¹æ³•ï¼š</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">"axios"</span>);<br><br><span class="hljs-comment">// è¿™é‡Œæ¥å—ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªè¯·æ±‚åœ°å€ä¸€ä¸ªè¯·æ±‚å‚æ•°ï¼Œè¯·æ±‚å°±æ˜¯ä¸€äº›åˆ†é¡µã€åç§»é‡ä»¥åŠåˆ«çš„å‚æ•°ç­‰ã€‚</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">baseAxiosRequest</span>(<span class="hljs-params">serviceUrl, params</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> axios<br>      .get(serviceUrl, &#123;<br>        params,<br>      &#125;)<br>      .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// è¿™é‡Œæ ¹æ®è‡ªå·±æœåŠ¡ç«¯å“åº”æ ¼å¼ï¼Œå°†è·å–çš„list[]æ•°æ®ä»å½“å‰å‡½æ•°è¿”å›å‡ºå»</span><br>        <span class="hljs-keyword">const</span> &#123; desc, errorno, data &#125; = result;<br>        <span class="hljs-keyword">if</span> (errorno === <span class="hljs-number">0</span>) &#123;<br>          <span class="hljs-comment">// è¿™é‡Œ return æˆ–è€… resolve çš„åŒºåˆ«å¯ä»¥çœ‹ä¸Šä¸€ç¯‡æ•´ç†</span><br>          <span class="hljs-comment">// [Promise ä¸­çš„ resolve å’Œ return çš„ç–‘æƒ‘](https://tennesseesunshine.github.io/2021/06/13/promiseResolveReturn/)</span><br>          <span class="hljs-keyword">return</span> resolve(data);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> reject(desc);<br>        &#125;<br>      &#125;)<br>      .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> reject(err);<br>      &#125;);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>sheetToBuffer</code> å°†æ•°æ®è½¬ä¸º <code>buffer</code> æµæ•°æ®</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sheetToBuffer</span>(<span class="hljs-params">sheetData, sheetName</span>) </span>&#123;<br>  sheetName = sheetName || <span class="hljs-string">"sheet1"</span>;<br>  <span class="hljs-keyword">let</span> workbook = &#123;<br>    <span class="hljs-attr">SheetNames</span>: [sheetName],<br>    <span class="hljs-attr">Sheets</span>: &#123;&#125;,<br>  &#125;;<br>  workbook.Sheets[sheetName] = sheetData;<br><br>  <span class="hljs-comment">// excelçš„é…ç½®é¡¹</span><br>  <span class="hljs-keyword">let</span> wopts = &#123;<br>    <span class="hljs-attr">bookType</span>: <span class="hljs-string">"xlsx"</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">"buffer"</span>,<br>  &#125;;<br>  <span class="hljs-keyword">return</span> XLSX.write(workbook, wopts);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>flatten</code> æ‰“å¹³æ•°ç»„</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flatten</span>(<span class="hljs-params">arr</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> [...pre, ...(<span class="hljs-built_in">Array</span>.isArray(cur) ? <span class="hljs-keyword">this</span>.flatten(cur) : [cur])], [])<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºè¦ä½¿ç”¨ <code>Promise.all</code> æ‰€ä»¥éœ€è¦ä¸€ä¸ª <code>map</code> æ–¹æ³•å°†æ‰€æœ‰çš„è¯·æ±‚éƒ½è½¬ä¸ºå…¶å¯ä»¥æ¥å—çš„å‚æ•°å½¢å¼ï¼Œå¦‚ä¸‹ <code>mapRequestList</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mapRequestList</span>(<span class="hljs-params">serviceUrl, params</span>) </span>&#123;<br>  <span class="hljs-comment">// æ¯é¡µè¯·æ±‚æ•°é‡</span><br>  <span class="hljs-keyword">const</span> pageSize = <span class="hljs-number">500</span>;<br>  <span class="hljs-comment">// æ€»åˆ†é¡µé‡ï¼Œä¹Ÿå°±æ˜¯ä¸€å…±å‘èµ·çš„è¯·æ±‚æ•°</span><br>  <span class="hljs-keyword">const</span> pageNumber = <span class="hljs-number">20</span>;<br>  <span class="hljs-comment">// ç”¨äºå­˜å‚¨promiseçš„æ•°ç»„</span><br>  <span class="hljs-keyword">let</span> requestArr = [];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; pageNumber; i++) &#123;<br>    requestArr[i] = i + <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">const</span> att = requestArr.map(<span class="hljs-function">(<span class="hljs-params">pageNumber</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> opts = &#123; ...params, pageSize, pageNumber &#125;;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"å‘èµ·ç¬¬"</span> + pageNumber + <span class="hljs-string">"ä¸ªè¯·æ±‚"</span>);<br>    <span class="hljs-keyword">return</span> baseAxiosRequest(serviceUrl, opts);<br>  &#125;);<br>  <span class="hljs-keyword">return</span> att;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯çš„åŠŸèƒ½åŸºæœ¬ä¸Šç®—æ˜¯å®Œæˆäº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®¢æˆ·ç«¯æ€ä¹ˆç”¨ã€‚</p><h3 id="web-è¯·æ±‚"><a href="#web-è¯·æ±‚" class="headerlink" title="web è¯·æ±‚"></a><code>web</code> è¯·æ±‚</h3><p>è¿™é‡Œå› ä¸ºæˆ‘ä»¬ç”¨çš„ <code>umi-requestï¼Œaxios</code> ç¨å¾®æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼Œä¸‹æ–‡ä¼šæœ‰è¯´æ˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">"umi-request"</span>;<br><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleExcelExport</span>(<span class="hljs-params">data, fileName</span>) </span>&#123;<br>  <span class="hljs-comment">// è¿™é‡Œçš„urlæ‹¼æ¥ï¼Œéœ€è¦è¯·æ±‚åˆ°nodeçš„controller</span><br>  <span class="hljs-keyword">const</span> url = <span class="hljs-string">`/api/app/toolName/downloadExcel/downloadExcel?serviceUrl=http://yourExportListHost.com/list`</span>;<br><br>  request(url, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,<br>    data,<br>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">300000</span>, <span class="hljs-comment">// è®¾ç½®è¶…æ—¶è™½ç„¶5åˆ†é’Ÿä½†æ˜¯åæ¥è¿˜æ˜¯è¶…æ—¶</span><br>    responseType: <span class="hljs-string">"blob"</span>,<br>  &#125;)<br>    .then(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> Blob([response]);<br>      <span class="hljs-keyword">const</span> elink = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"a"</span>);<br>      elink.download = <span class="hljs-string">`<span class="hljs-subst">$&#123;fileName&#125;</span>.xlsx`</span>;<br>      elink.style.display = <span class="hljs-string">"none"</span>;<br><br>      <span class="hljs-comment">// åˆ›å»ºblob urlä¸‹è½½</span><br>      elink.href = URL.createObjectURL(blob);<br>      <span class="hljs-built_in">document</span>.body.appendChild(elink);<br>      elink.click();<br>      <span class="hljs-comment">// å¿…é¡»é‡Šæ”¾ URL å¯¹è±¡</span><br>      URL.revokeObjectURL(elink.href);<br>      <span class="hljs-built_in">document</span>.body.removeChild(elink);<br>    &#125;)<br>    .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"err"</span>, err);<br>    &#125;);<br><br>  <span class="hljs-comment">// axiosè¿™é‡Œçš„è¯æœ‰ä¸€ç‚¹ç»†å¾®çš„åŒºåˆ«ï¼Œæ˜¯åœ¨æ¥å£è¿”å›å“åº”ä¹‹åï¼Œè·å–æ•°æ®è½¬ä¸ºblobçš„æ—¶å€™</span><br>  axios(&#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">"post"</span>,<br>    url,<br>    data,<br>    <span class="hljs-attr">responseType</span>: <span class="hljs-string">"blob"</span>,<br>  &#125;).then(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// åŒºåˆ«åœ¨è¿™é‡Œ</span><br>    <span class="hljs-keyword">const</span> &#123; data &#125; = response;<br>    <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> Blob([data]);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æˆ‘å¯¼å‡ºçš„æ—¶å€™å‘ç°å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>ç¬¬ä¸€ï¼šæ¥å£å“åº”æ—¶é—´<code>æ¯”è¾ƒæ…¢</code>ã€‚å•æ¬¡æŸ¥è¯¢å¯èƒ½ä¼šåˆ° <code>4-7s</code>ï¼Œè¿™æ˜¯å› ä¸ºæ¥å£æœ¬èº«é—®é¢˜ï¼Œæ•°æ®ä½“é‡å¤ªå¤§ï¼ŒæŸ¥è¯¢è€—æ—¶é•¿ã€‚</li><li>ç¬¬äºŒï¼šæ•°æ®åœ¨ <code>node</code> å±‚å°† <code>json</code> è½¬ä¸ºæµçš„æ—¶å€™å¯èƒ½ä¼šæ¯”è¾ƒè€—ç®—åŠ›å’Œå†…å­˜ï¼Œæˆ‘ä»¬ç°åœ¨æ‰€æœ‰çš„å‰ç«¯éƒ½ç”¨åŒä¸€ä¸ª <code>node</code> æœåŠ¡ï¼Œä¸€æ—¦è¿™é‡Œå•çº¿ç¨‹è€—æ—¶æ¯”è¾ƒä¹…çš„è¯ï¼Œå¯èƒ½ä¼šå› ä¸ºä¸€ç³»åˆ—é—®é¢˜å½±å“åˆ°åç»­çš„å…¶ä»–å·¥å…·çš„æ¥å£è½¬å‘ï¼Œå½±å“åˆ°å…¶ä»–å·¥å…·çš„ç¨³å®šã€‚</li><li>ç¬¬ä¸‰ï¼šè¶…æ—¶ä¸¥é‡ï¼ŒåŸºæœ¬æ— æ³•åœ¨è¶…æ—¶ä¹‹å‰æˆåŠŸå¯¼å‡º <code>10000</code> æ¡æ•°æ®ã€‚</li></ul><p>åæ¥åœ¨æƒè¡¡åˆ©å¼Šä¹‹åï¼Œå› ä¸ºæ•°æ®åªæ˜¯ç”¨æ¥çœ‹ï¼Œä¸ä¼šè®¡ç®—ä»¥åŠåˆ«çš„æ“ä½œï¼Œé‡‡ç”¨åœ¨å®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯æµè§ˆå™¨ä¸­å¯¼å‡º <code>csv</code> æ ¼å¼çš„æ•°æ®ï¼Œåˆ©ç”¨ <code>excel</code> æ‰“å¼€æ˜¯å¯ä»¥æ»¡è¶³çš„ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†ç¬¬äºŒä¸­æ–¹æ¡ˆã€‚</p><h2 id="æ–¹æ¡ˆäºŒï¼šçº¯å‰ç«¯æ–¹æ¡ˆï¼Œæµè§ˆå™¨åˆ†ç‰‡è¯·æ±‚æ¥å£ï¼Œå°†æ•°æ®ç»„è£…ä¸º-csv-å¯¼å‡º"><a href="#æ–¹æ¡ˆäºŒï¼šçº¯å‰ç«¯æ–¹æ¡ˆï¼Œæµè§ˆå™¨åˆ†ç‰‡è¯·æ±‚æ¥å£ï¼Œå°†æ•°æ®ç»„è£…ä¸º-csv-å¯¼å‡º" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šçº¯å‰ç«¯æ–¹æ¡ˆï¼Œæµè§ˆå™¨åˆ†ç‰‡è¯·æ±‚æ¥å£ï¼Œå°†æ•°æ®ç»„è£…ä¸º csv å¯¼å‡º"></a>æ–¹æ¡ˆäºŒï¼šçº¯å‰ç«¯æ–¹æ¡ˆï¼Œæµè§ˆå™¨åˆ†ç‰‡è¯·æ±‚æ¥å£ï¼Œå°†æ•°æ®ç»„è£…ä¸º <code>csv</code> å¯¼å‡º</h2><p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨æ–¹æ¡ˆä¸€ä¸­çš„å‡æ•°æ®ä½œä¸ºæ¼”ç¤º</p><ul><li><code>exportJsonToCSV</code> æ–‡ä»¶ï¼Œä¸»ä½“å¯¼å‡ºæ–¹æ³•ï¼š</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// åœ¨æ¥å£å“åº”å®Œæˆä¹‹åï¼Œå°†ç¬¬iä¸ªç´¢å¼•å­˜è¿›å»ï¼Œè®¡ç®—å¯¼å‡ºè¿›åº¦</span><br><span class="hljs-keyword">let</span> percentArr = [];<br><span class="hljs-keyword">const</span> pageSize = <span class="hljs-number">250</span>;<br><span class="hljs-keyword">const</span> maxReqCount = <span class="hljs-number">40</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> exportCsv = <span class="hljs-function">(<span class="hljs-params">total, queryParams, filename, callback</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!total) <span class="hljs-keyword">throw</span> <span class="hljs-string">"æ— æ•°æ®"</span>;<br><br>    <span class="hljs-keyword">const</span> maxLen = <span class="hljs-built_in">Math</span>.ceil(total / pageSize);<br><br>    <span class="hljs-comment">// åšæœ€å¤§åˆ†ç‰‡å¤„ç†</span><br>    <span class="hljs-comment">// æ­£å¸¸æƒ…å†µä¸‹çš„ åˆ†ç‰‡è¯·æ±‚éƒ½æ˜¯å¯é¢„çŸ¥çš„ï¼Œå¦‚æœ ä½ çš„promise.all æ¥å—çš„æ•°ç»„</span><br>    <span class="hljs-comment">// æ˜¯ä½ æ— æ³•é¢„æ–™çš„é•¿åº¦ï¼Œä¸€å®šæ˜¯éœ€è¦limitæœ€å¤§å¹¶å‘é‡çš„ï¼Œä¸ç„¶å¯èƒ½ä¼šé€ æˆè°ƒç”¨æ ˆæº¢å‡º</span><br>    <span class="hljs-comment">// é™åˆ¶æœ€å¤§å¹¶å‘è¯·æ±‚æ•° å¯ä»¥åˆ©ç”¨p-limitç­‰ä¸‰æ–¹åº“</span><br>    <span class="hljs-keyword">const</span> pageNumber = maxLen &gt;= maxReqCount ? maxReqCount : maxLen;<br><br>    <span class="hljs-comment">// å­˜å‚¨ CSV æ•°æ®</span><br>    <span class="hljs-comment">// æ³¨æ„ csvçš„å­˜å‚¨æ˜¯ä»¥è‹±æ–‡,åˆ†å‰²çš„ï¼Œæ‰€ä»¥é›†åˆç±»çš„æ•°æ®ä¸è¦ç”¨è‹±æ–‡é€—å·åˆ†å‰²</span><br>    <span class="hljs-comment">// æ¯ä¸€ä¸ª,ä¹‹å‰çš„æ•°æ®åœ¨excelé‡Œæ‰“å¼€å°±æ˜¯ä¸€ä¸ªå•å…ƒæ ¼</span><br>    <span class="hljs-comment">// æ‰€ä»¥ä¸€æ—¦è¯†åˆ«å‡ºæ¥è‹±æ–‡é€—å·ï¼Œå°±ä¼šåœ¨excelé‡Œæ‰“å¼€å¤šä¸€ä¸ªè¡¨æ ¼ï¼Œæ‰€ä»¥æœ€å¥½è½¬ä¸ºã€</span><br>    <span class="hljs-keyword">let</span> cvsArray = [];<br><br>    <span class="hljs-keyword">const</span> task = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæŒ‡å®šä¸ªæ•°çš„æ¥å£æ•°æ®</span><br>        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all(<br>          requestMapList(queryParams, pageNumber, callback)<br>        );<br><br>        <span class="hljs-comment">// dataæ˜¯ä¸€ä¸ª[[],[],[]]æ ¼å¼çš„æ•°æ®ï¼Œæ‹å¹³ä¸€ä¸‹å¤„ç†</span><br>        <span class="hljs-comment">// æ ¼å¼åŒ–ä¸º CSV å­—ç¬¦ä¸²</span><br>        <span class="hljs-comment">// csvæ¥å—çš„æ ¼å¼æ˜¯ [0:'a,b,c', 1: 'a1,b1,c1', 2: 'a2,b2,c2']</span><br>        data?.flat(<span class="hljs-number">2</span>)?.forEach(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> newRow = [element.title, element.birthday, element.age];<br><br>          <span class="hljs-comment">// å°†ä¸Šä¸€æ­¥æ•°æ®å­˜èµ·æ¥</span><br>          cvsArray[index] = newRow.join() + <span class="hljs-string">"\n"</span>;<br>        &#125;);<br><br>        <span class="hljs-comment">// åˆ›å»ºè¡¨å¤´ è¿™é‡Œé€‰æ‹©åœ¨æœ€åå†åŠ è¡¨å¤´æ˜¯ä¸ºäº†é¿å… percentArr å­˜æ•°æ®çš„æ—¶å€™å¹²æ‰°</span><br>        cvsArray.unshift(EXCEL_TITLE.join() + <span class="hljs-string">"\n"</span>);<br><br>        <span class="hljs-comment">// é€‚å½“æš‚åœï¼Œé¿å…é¡µé¢æ— æ³•æ‰§è¡Œæ¸²æŸ“</span><br>        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_resolve</span>) =&gt;</span> &#123;<br>          setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> _resolve(<span class="hljs-literal">true</span>), <span class="hljs-number">50</span>);<br>        &#125;);<br><br>        resolve(<span class="hljs-literal">true</span>);<br>      &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>        reject(<span class="hljs-literal">false</span>);<br>      &#125;<br>    &#125;);<br><br>    task<br>      .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (res) &#123;<br>          <span class="hljs-comment">// åˆ›å»ºblob</span><br>          <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> Blob([<span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-number">0xfeff</span>), ...cvsArray], &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">"text/plain;charset=utf-8"</span>,<br>          &#125;);<br><br>          createATagTodownload(blob, filename);<br>          <span class="hljs-comment">// å®Œæˆåå°†è¿›åº¦æ•°æ®åˆå§‹åŒ–</span><br>          percentArr = [];<br>          resolve(<span class="hljs-literal">true</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          reject(<span class="hljs-literal">false</span>);<br>        &#125;<br>      &#125;)<br>      .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>        reject(<span class="hljs-literal">false</span>);<br>      &#125;);<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li><code>baseRequestData</code> åŸºç¡€å•å…ƒè¯·æ±‚æ¥å£çš„æ–¹æ³•ï¼š</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">baseRequestData</span>(<span class="hljs-params">params, index, pageNumber, callback</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> request(SERVICEURL, &#123; params &#125;)<br>      .then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// æ ¹æ®æ¥å£å“åº”æ ¼å¼æ¥å¤„ç†</span><br>        <span class="hljs-keyword">const</span> &#123; desc, errorno, data &#125; = result;<br>        <span class="hljs-keyword">if</span> (errorno === <span class="hljs-number">0</span>) &#123;<br>          <span class="hljs-comment">// è¯·æ±‚å®Œæˆä¸€æ¬¡å­˜å‚¨ä¸€ä¸ª</span><br>          percentArr[index] = index;<br>          <span class="hljs-keyword">const</span> percentLen = percentArr.length - <span class="hljs-number">1</span>;<br><br>          <span class="hljs-comment">// è®¡ç®—å¯¼å‡ºè¿›åº¦</span><br>          <span class="hljs-keyword">const</span> percent = <span class="hljs-built_in">Math</span>.ceil((percentLen / pageNumber) * <span class="hljs-number">100</span>);<br>          <span class="hljs-comment">// console.log('è¿›åº¦', percent, percentArr);</span><br><br>          <span class="hljs-comment">// å°†è®¡ç®—çš„æ•°æ®è¿”å›åˆ°é¡µé¢</span><br>          callback &amp;&amp; callback(percent);<br>          <span class="hljs-keyword">return</span> resolve(data);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> reject(desc);<br>        &#125;<br>      &#125;)<br>      .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> reject(err);<br>      &#125;);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>requestMapList</code> ç»„è£…è¯·æ±‚ä¸º <code>Promise</code> æ•°ç»„</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestMapList</span>(<span class="hljs-params">params, pageNumber, callback</span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> requestMap = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(pageNumber)<br>    .fill(<span class="hljs-string">""</span>)<br>    .map(<span class="hljs-function">(<span class="hljs-params">item, idx</span>) =&gt;</span> idx + <span class="hljs-number">1</span>)<br>    .map(<span class="hljs-function">(<span class="hljs-params">pn, index</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> opts = &#123; ...params, pageSize, <span class="hljs-attr">pageNumber</span>: pn &#125;;<br>      <span class="hljs-comment">// console.log('å‘èµ·ç¬¬' + pn + 'ä¸ªè¯·æ±‚');</span><br>      <span class="hljs-keyword">return</span> baseRequestData(opts, index + <span class="hljs-number">1</span>, pageNumber, callback);<br>    &#125;);<br>  <span class="hljs-keyword">return</span> requestMap;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>createATagTodownload</code> åˆ›å»º <code>a</code> æ ‡ç­¾åˆ©ç”¨ <code>blob</code> æ¥å¯¼å‡º</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createATagTodownload</span>(<span class="hljs-params">blob, filename</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> elink = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"a"</span>);<br>    elink.download = <span class="hljs-string">`<span class="hljs-subst">$&#123;filename || <span class="hljs-string">"æ–‡ä»¶å¯¼å‡º"</span>&#125;</span>.csv`</span>;<br>    elink.style.display = <span class="hljs-string">"none"</span>;<br>    elink.href = URL.createObjectURL(blob);<br>    <span class="hljs-built_in">document</span>.body.appendChild(elink);<br>    elink.click();<br>    URL.revokeObjectURL(elink.href); <span class="hljs-comment">// å¿…é¡»é‡Šæ”¾ URL å¯¹è±¡</span><br>    <span class="hljs-built_in">document</span>.body.removeChild(elink);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é¡µé¢ä½¿ç”¨ï¼Œå±•ç¤ºå®æ—¶è¿›åº¦</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [loadingPercent, setLoadingPercent] = useState(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">const</span> [loadingMask, setLoadingMask] = useState(<span class="hljs-literal">false</span>);<br><br><span class="hljs-keyword">const</span> handleExportFile = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// å¯¼å‡ºæŒ‰é’®ä½¿ç”¨</span><br>  setLoadingMask(<span class="hljs-literal">true</span>);<br>  exportCsv(pagination?.total, queryParams, filename, (percent) =&gt; &#123;<br>    setLoadingPercent(percent);<br>  &#125;)<br>    .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (res) &#123;<br>        setLoadingMask(<span class="hljs-literal">false</span>);<br>        setLoadingPercent(<span class="hljs-number">0</span>);<br>      &#125;<br>    &#125;)<br>    .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"err"</span>, err);<br>    &#125;);<br>&#125;;<br><br>&lt;Modal<br>  title="æ•°æ®å¯¼å‡º(é»˜è®¤1wæ¡)è¿›åº¦"<br>  visible=&#123;loadingMask&#125;<br>  width=&#123;500&#125;<br>  maskClosable=&#123;false&#125;<br>  keyboard=&#123;false&#125;<br>  destroyOnClose=&#123;true&#125;<br>  footer=&#123;null&#125;<br>  closable=&#123;false&#125;<br>&gt;<br>  &lt;div style=&#123;&#123; display: "flex", justifyContent: "center" &#125;&#125;&gt;<br>    &lt;Progress type="circle" percent=&#123;loadingPercent&#125; /&gt;<br>  &lt;/div&gt;<br>&lt;/Modal&gt;;<br></code></pre></td></tr></table></figure><p>å¯¼å‡º <code>csv</code> çš„æ ¼å¼ä¸ä¼šå‡ºç°è¶…æ—¶çš„é—®é¢˜ï¼Œ<code>10000</code> æ¡æ•°åŸºæœ¬ä¼šåœ¨ <code>40s</code> å·¦å³ï¼Œè¿™å…¶ä¸­æœ‰ä¸€å¤§éƒ¨åˆ†åŸå› æ˜¯å› ä¸ºæ¥å£å“åº”æ…¢ï¼Œå†å°±æ˜¯å› ä¸ºåŒä¸€åŸŸåï¼Œåœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ <code>chrome</code> ä¼šé™åˆ¶ <code>6</code> æ¡ï¼Œæ‰€ä»¥æ–¹æ¡ˆä¸­é‡‡ç”¨çš„å¯¼å‡ºé‡‡ç”¨è¯·æ±‚ <code>40</code> æ¬¡ï¼Œåç»­çš„è¯·æ±‚è‚¯å®šæ˜¯ä¼šè¢«æŒ‚èµ·ç­‰å¾…æ–°çš„å¯ç”¨è¿æ¥ï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œå…·ä½“çš„å°±æ˜¯æµè§ˆå™¨ <code>network</code> ä¸­çš„ <code>Timing</code> çš„ <code>Connection Start</code> çš„ <code>Stalled</code> æ—¶é—´è¶Šå¾€åè¶Šé•¿ã€‚</p><p>æ‰€ä»¥æ–¹æ¡ˆäºŒçš„è¯ç›®å‰æ˜¯æ¯”è¾ƒå¯è¡Œçš„ä¸€ç§è§£å†³é—®é¢˜çš„å¥—è·¯ã€‚</p><p>å¯¹äº <code>Stalled</code>æ—¶é—´é—®é¢˜ï¼Œè¯·æ±‚é™æ€èµ„æºï¼Œå¯ä»¥é€šè¿‡åŸŸååˆ†ç‰‡æ¥æ‹†åšåˆ°å¤šè¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºæ¥å£æ–¹é¢çš„è¿™ç§æƒ…å†µç›®å‰è¿˜ä¸çŸ¥é“æ€ä¹ˆè§£å†³ã€‚</p><p>ä¸€äº›å…³äº <code>stalled</code> æ—¶é—´è¿‡é•¿çš„æ–‡ç« </p><ul><li><a href="https://blog.csdn.net/tianhouquan/article/details/78803601" target="_blank" rel="noopener">å…³äºè¯·æ±‚è¢«æŒ‚èµ·é¡µé¢åŠ è½½ç¼“æ…¢é—®é¢˜çš„è¿½æŸ¥ï¼ˆstalled æ—¶é—´è¿‡é•¿ï¼‰</a></li><li><a href="https://blog.csdn.net/WGH100817/article/details/101723517?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.baidujs&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.baidujs" target="_blank" rel="noopener">å…³äºå¿ƒè·³ ajax è¯·æ±‚ pending çŠ¶æ€ï¼ˆè¢«æŒ‚èµ·ï¼‰ï¼Œstalled æ—¶é—´è¿‡é•¿çš„é—®é¢˜</a></li><li><a href="https://kb.cnblogs.com/page/513237/" target="_blank" rel="noopener">å…³äºè¯·æ±‚è¢«æŒ‚èµ·é¡µé¢åŠ è½½ç¼“æ…¢é—®é¢˜çš„è¿½æŸ¥</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æµè§ˆå™¨</tag>
      
      <tag>æ–‡ä»¶å¯¼å‡º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Promise ä¸­çš„ resolve å’Œ return çš„ç–‘æƒ‘</title>
    <link href="/2021/06/13/promiseResolveReturn/"/>
    <url>/2021/06/13/promiseResolveReturn/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå…·ä½“çš„åœºæ™¯æ˜¯ï¼Œæ¥å£ <code>A</code> è¿”å›ä¸€æ®µå¯ä»¥è®©å‰ç«¯æ¸²æŸ“çš„ <code>html</code> å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²é‡ŒåŒ…å«é‡Œä¸€ä¸ªå¯æ’­æ”¾çš„ <code>video</code> çš„åœ°å€ï¼Œä½†æ˜¯åœ°å€æ˜¯ä¸å¯æ’­æ”¾çš„ï¼Œéœ€è¦æ›¿æ¢ä¸ºå¦å¤–ä¸€ä¸ªå¯æ’­æ”¾çš„åŸŸåã€‚</p><p>è§£å†³æ–¹å¼ï¼šå…ˆè¯·æ±‚æ¥å£ <code>A</code> è·å– <code>html</code> å­—ç¬¦ä¸²ï¼Œä»ä¸­æˆªå– <code>video</code> çš„ <code>src</code> å±æ€§ï¼Œå†è°ƒæ¥å£ <code>B</code> å°†æ¥å£è½¬æ¢ä¸ºå¯æ’­æ”¾çš„ <code>url</code>ï¼Œæœ€åæ‹¿åˆ°æ–°çš„ <code>url</code> ä¹‹åå†é€šè¿‡æ­£åˆ™çš„ <code>replace</code> æ–¹æ³•å°†å¯¹åº”çš„ <code>url</code> æ›¿æ¢æˆæ–°çš„ <code>url</code>ï¼Œç„¶åå†å¤„ç†å‰©ä¸‹çš„é€»è¾‘ã€‚</p><p>å…¶å®æ‹ä¸‹æ¥ä¹‹åå‘ç°æ— éå°±æ˜¯ <code>A</code> çš„å›è°ƒç»“æœé‡Œè°ƒ <code>B</code> æ¥å£ï¼Œä½†æ˜¯å³ä¾¿æ˜¯åµŒå¥—ä¸€å±‚ï¼Œä¹Ÿä¸å¤Ÿä¼˜é›…ï¼Œäºæ˜¯åœ¨æƒ³åˆ©ç”¨ <code>Promise</code> çš„ä¸²è¡Œå¤„ç†ï¼Œå°†å›è°ƒæ‰“å¹³ï¼Œ<code>Promise</code> çš„å¤„ç†æ— éä¹Ÿå°±æ˜¯å…ˆå»è°ƒç”¨ <code>A</code> æ¥å£ï¼Œè·å–æ•°æ®ä¹‹åå°†ç»“æœä¼ é€’å‡ºå»å†é€šè¿‡<code>.then</code> æ‹¿åˆ°è¿”å›å€¼æ•°æ®ï¼Œåœ¨<code>.then</code> é‡Œå†è°ƒæ–°æ¥å£ <code>B</code> ä»è€Œè§£å†³é—®é¢˜ã€‚è™½ç„¶åæ¥ç¡®å®é€šè¿‡ <code>Promise</code> çš„é“¾å¼è°ƒç”¨è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€äº›ç–‘æƒ‘ï¼Œå°±æ˜¯å¦‚é¢˜ã€‚</p><p>æ ¹æ® <code>es6</code> çš„ <code>resolve</code> çš„ç†è§£ï¼Œå…¶å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°† <code>Promise</code> å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» <code>pending</code> å˜ä¸º <code>resolved</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼Œå¦‚æœæˆ‘ä»¬ä¸ <code>resolve</code>ï¼Œåˆ™æ•°æ®ä¸€ç›´è¢«ä¿å­˜åœ¨ä¸Šä¸€ä¸ª <code>Promise</code> çš„å‡½æ•°ä¸­ã€‚ç»è¿‡æ•´ç†é‡æ–°å­¦ä¹ åå‘ç°ï¼Œå¦‚æœéœ€è¦å°† <code>Promise</code> çš„è¿”å›çš„ç»“æœåœ¨å½“å‰å‡½æ•°çš„<code>.then</code> é‡Œä¸€ç›´æŒ‰ç…§æ¬¡åºå¾€ä¸‹ä¼ é€’ï¼Œå…¶æ˜¯å¿…é¡»è¦åœ¨ä¸Šä¸€æ­¥çš„ <code>then</code> é‡Œå°†ç»“æœ <code>return</code> æ‰èƒ½åœ¨ä¸‹ä¸€ä¸ª <code>then</code> é‡Œæ¥ä½ï¼Œä¸€æ—¦åœ¨æŸä¸€ä¸ª <code>then</code> é‡Œ <code>resolve</code> äº†ï¼Œåˆ™åœ¨ <code>resolve</code> çš„é‚£ä¸ª <code>then</code> åé¢çš„ <code>then</code> ä¸­è™½ç„¶åé¢çš„é€»è¾‘ä¼šæ‰§è¡Œï¼Œä½†æ˜¯è·å–ä¸åˆ°ä¸Šä¸€æ¬¡è®¡ç®—çš„ç»“æœï¼Œåè€Œæ˜¯ç›´æ¥åœ¨ <code>resolve</code> çš„ <code>then</code> é‡Œå°†ç»“æœä»å½“å‰å‡½æ•°ä¼ é€’å‡ºå»äº†ã€‚</p><p>å…·ä½“ç”¨ä¸€ä¸ª ğŸŒ° æ¥çœ‹ï¼š<br>å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>sleep</code> çš„ <code>Promise</code> çš„æ¨¡æ‹Ÿå¼‚æ­¥æ–¹æ³•ï¼Œä¼ é€’ä¸åŒçš„ <code>ms</code> æ•°ä»£è¡¨åˆ†åˆ«ä»£è¡¨ <code>Aã€B</code> ä¿©æ¥å£ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> sleep = <span class="hljs-function">(<span class="hljs-params">ms</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> setTimeout(resolve, ms));<br><br><span class="hljs-comment">// è¿™æ˜¯è·å–æ–°urlçš„æ¥å£B</span><br><span class="hljs-keyword">var</span> urlConvert = <span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`æˆ‘ä»¬ç°åœ¨è·å–åˆ°äº†æ—§çš„url:<span class="hljs-subst">$&#123;url&#125;</span> è¦å»è¯·æ±‚æ–°çš„`</span>);<br>    sleep(<span class="hljs-number">500</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) &#123;<br>        resolve(<span class="hljs-string">"http//newVideoUrl.com"</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        reject(<span class="hljs-string">"å‘ç”Ÿé”™è¯¯"</span>);<br>      &#125;<br>    &#125;);<br>  &#125;);<br><br><span class="hljs-keyword">var</span> handleData = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// æ¥å£A</span><br>    <span class="hljs-keyword">var</span> initUrl = sleep(<span class="hljs-number">1000</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-string">"http://oldVideoUrl.com"</span>);<br><br>    initUrl.then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> urlConvert(res)).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> resolve(res));<br>  &#125;);<br><br>handleData().then(<span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"url"</span>, url);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬èƒ½å‘ç°åœ¨ <code>handleData</code> å†…éƒ¨ï¼Œæˆ‘æ˜¯éœ€è¦å…ˆå¤„ç†å®Œæ•°æ®ï¼Œåœ¨æœ€åæ‰å°†å¤„ç†å®Œçš„æ•°æ® <code>resolve</code>ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°æ˜¯å‰è¾¹é€šè¿‡ç®­å¤´å‡½æ•°ä¸€æ­¥ä¸€æ­¥å°†ä¸Šä¸€æ¬¡å¤„ç†çš„ç»“æœ <code>return</code> äº†ï¼Œæ‰€ä»¥åœ¨ä¸‹ä¸€ä¸ª <code>then</code> é‡Œæ‰è·å–åˆ°å¤„ç†å®Œæˆçš„æ•°æ®ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨æœ€åä¸€æ­¥é€šè¿‡ <code>resolve</code> å°†ç»“æœè¿”å›ï¼Œå½“æˆ‘ä»¬åœ¨å¤–éƒ¨è°ƒç”¨ <code>handleData</code> ä¹‹åï¼Œé“¾å¼è°ƒç”¨çš„ç»“æœæ˜¯å¯ä»¥è·å–åˆ° <code>url</code> çš„å€¼ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†æœ€åä¸€æ­¥ç»“æœä¾æ—§æ”¹æˆ <code>return</code> çš„å½¢å¼ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ•ˆæœã€‚</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">- initUrl.then((res) =&gt; urlConvert(res)).then((res) =&gt; resolve(res));</span><br><span class="hljs-addition">+ initUrl.then((res) =&gt; urlConvert(res)).then((res) =&gt; res);</span><br><br>handleData().then((url) =&gt; &#123;<br>  console.log("url", url);<br>&#125;);<br></code></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œåï¼Œå‘ç°æ²¡æœ‰æ‰“å°ä¹Ÿå°±æ˜¯æ²¡èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜å¦‚æœç›´æ¥ <code>return</code> çš„è¯æ˜¯æ— æ³•ä»åŸæ¥çš„å‡½æ•°é‡Œå°† <code>Promise</code> çš„ç»“æœä¼ é€’å‡ºå»çš„ï¼Œæ‰€ä»¥åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šæ˜¯æ›´æ¸…æ¥šäº†ï¼Œå¦‚æœä¸éœ€è¦å°†ç»“æœä¼ é€’å‡ºå»ï¼Œåœ¨ <code>then</code> å¤„ç†å®Œæˆä¹‹å <code>return value</code> å°±å¥½äº†ï¼Œå¦‚æœéœ€è¦ä¼ é€’å‡ºå»å°±å°†æ•°æ® <code>resolve(value)</code> å‡ºå»ï¼Œè‡³äº <code>resolve</code> çš„æ—¶å€™è¦ä¸è¦ åŠ  <code>return</code> å°±çœ‹è¿˜è¦ä¸è¦å¤„ç† <code>resolve</code> åé¢çš„é€»è¾‘ï¼Œä¸€èˆ¬æ¥è¯´ç«‹å³ <code>resolved</code> çš„ <code>Promise</code> æ˜¯åœ¨æœ¬è½®äº‹ä»¶å¾ªç¯çš„æœ«å°¾æ‰§è¡Œï¼Œæ€»æ˜¯æ™šäºæœ¬è½®å¾ªç¯çš„åŒæ­¥ä»»åŠ¡ã€‚æ‰€ä»¥å¦‚æœä¸Šè¿°ä¾‹å­æ”¹ä¸º</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">- initUrl.then((res) =&gt; urlConvert(res)).then((res) =&gt; resolve(res));</span><br><span class="hljs-addition">+ initUrl.then((res) =&gt; urlConvert(res)).then((res) =&gt; &#123;</span><br><span class="hljs-addition">+  resolve(res)</span><br><span class="hljs-addition">+  console.log('resolveåï¼Œæ‰“å°urlå‰')</span><br><span class="hljs-addition">+&#125;);</span><br></code></pre></td></tr></table></figure><p>ä¾¿ä¼šåœ¨ <code>resolve</code> çš„é‚£æ¬¡äº‹ä»¶å¾ªç¯åï¼Œå¹¶ä¸”ä¼šåœ¨æ–°çš„ä¸€è½® <code>handleData()</code> å‰æ‰§è¡Œã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Promise</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç†è§£ Promise.all å’Œ Promise.race çš„å®ç°</title>
    <link href="/2021/05/26/myPromiseAllAndRace/"/>
    <url>/2021/05/26/myPromiseAllAndRace/</url>
    
    <content type="html"><![CDATA[<h2 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a><code>Promise.all</code></h2><p>é¦–å…ˆæˆ‘ä»¬ä»ä¸€ä¸ªæ­£å¸¸çš„ä¾‹å­æ¥çœ‹æ‹†è§£ä¸€ä¸‹ <code>Promise.all</code></p><h3 id="æ‹†è§£Promise-all"><a href="#æ‹†è§£Promise-all" class="headerlink" title="æ‹†è§£Promise.all"></a>æ‹†è§£<code>Promise.all</code></h3><ul><li>æˆ‘ä»¬èƒ½çŸ¥é“ <code>all</code> æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå…·ä½“æ¥è¯´åº”è¯¥æ˜¯å…·æœ‰ <code>Iterator</code> æ¥å£çš„æ•°æ®ã€‚</li><li>æ ¹æ® <code>Promise.all</code> çš„ç‰¹æ€§è¿˜èƒ½çŸ¥é“ï¼Œ<code>Promise.all()</code> æ–¹æ³•ç”¨äºå°†å¤šä¸ª <code>Promise</code> å®ä¾‹ï¼Œ<code>åŒ…è£…</code>æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚è¨€å¤–ä¹‹æ„ï¼Œå¦‚æœä¸æ˜¯ Promise å°±ä¼šå…ˆè°ƒç”¨ <code>Promise.resolve</code> æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º <code>Promise</code> å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚</li><li>å¦‚æœå‚æ•°å®ä¾‹çš„çŠ¶æ€<code>å…¨éƒ¨</code>å˜æˆ <code>fulfilled</code>ï¼Œç»“æœçš„çŠ¶æ€æ‰ä¼šå˜æˆ <code>fulfilled</code>ï¼Œæ­¤æ—¶å„ä¸ªå‚æ•°çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™ç»“æœçš„ <code>then</code> çš„å›è°ƒå‡½æ•°ã€‚</li><li>å‚æ•°å®ä¾‹ä¸­æœ‰ä¸€ä¸ªè¢« <code>rejected</code>ï¼Œç»“æœçš„çŠ¶æ€å°±å˜æˆ <code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢« <code>reject</code> çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œç»“æœä¼šä¼ é€’ç»™ <code>catch</code> çš„å›è°ƒå‡½æ•°ã€‚</li></ul><p>æˆ‘ä»¬æ ¹æ®ä¸Šè¿°çš„æ‹†è§£ï¼Œæ¥è¿›è¡Œä¸€ä¸‹ä»£ç çš„å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promiseAll</span>(<span class="hljs-params">arg</span>) </span>&#123;<br>  <span class="hljs-comment">// é¦–å…ˆæˆ‘ä»¬åšä¸ªè¾¹ç•Œå¤„ç†ï¼Œè¿™é‡Œæš‚æ—¶åª åˆ¤æ–­å‚æ•°æ˜¯ä¸æ˜¯æ•°ç»„</span><br>  <span class="hljs-comment">// è§„èŒƒçš„promiseå‚æ•°åº”è¯¥æ˜¯å…·æœ‰Iteratoræ¥å£çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªå¤„ç†æ˜¯æ•°ç»„å’Œä¸æ˜¯æ•°ç»„çš„æƒ…å†µ</span><br>  <span class="hljs-comment">// æ˜¯æ•°ç»„æˆ‘ä»¬æ‰§è¡Œæ–¹æ³•ï¼Œä¸æ˜¯æ•°ç»„åˆ™é€šè¿‡Promise.resolve()å°†åŸæ¥çš„æ•°æ®ç›´æ¥resolveå‡ºå»</span><br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(arg)) &#123;<br>    <span class="hljs-comment">// æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œallæ–¹æ³•ä¼šåœ¨æ‰€æœ‰çš„å®ä¾‹éƒ½å˜æˆfulfilledçš„æ—¶å€™ï¼Œæ‰å›å»fulfilledï¼Œæ‰€ä»¥å¯æƒ³åº”è¯¥æ˜¯æœ‰ä¸€ä¸ªè®¡æ•°å™¨</span><br>    <span class="hljs-comment">// åœ¨æ‰€æœ‰çš„å®ä¾‹æ‰§è¡Œå®Œä¹‹åï¼Œåˆ¤æ–­å®Œæˆçš„é‡ç­‰ä¸ç­‰äºä¼ å…¥çš„æ•°ç»„çš„é•¿åº¦ï¼Œæ‰å°†ç»“æœæŠ›å‡ºï¼Œå¹¶ä¸”è¿™ä¸ªç»“æœæˆ‘ä»¬åº”è¯¥éœ€è¦æœ‰ä¸€ä¸ªæ•°ç»„å»å­˜å‚¨</span><br>    <span class="hljs-comment">// é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œç»“æœé›†å’Œé”™è¯¯éƒ½æ˜¯éœ€è¦ç”¨resolveå’Œrejectä»å‡½æ•°é‡ŒæŠ›å‡ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦ç”¨promiseåŒ…ä¸€ä¸‹</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">let</span> len = arg.length;<br>      <span class="hljs-keyword">let</span> result = [];<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>        <span class="hljs-comment">// åœ¨å¾ªç¯é‡Œæ‰§è¡Œæ¯ä¸€ä¸ªpromiseå®ä¾‹ï¼Œä½†æ˜¯è™½ç„¶æˆ‘ä»¬ä¼ å…¥çš„argæ˜¯æ•°ç»„ï¼Œä½†æ˜¯æ•°ç»„çš„é¡¹ä¸ä¸€å®šæ˜¯ä¸€ä¸ªpromiseçš„å®ä¾‹</span><br>        <span class="hljs-comment">// æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åº”è¯¥ç”¨Promise.resolveæ¥å°†arg[i]åŒ…è£…ä¸€ä¸‹</span><br><br>        <span class="hljs-built_in">Promise</span>.resolve(arg[i])<br>          .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>            <span class="hljs-comment">// æˆ‘ä»¬åº”è¯¥åœ¨æˆåŠŸçš„å›è°ƒå‡½æ•°é‡Œå»å¤„ç†ä¸€äº›äº‹åŠ¡ï¼Œä¾‹å¦‚è®¡æ•°å™¨å¢åŠ ã€æˆåŠŸçš„è¿”å›å€¼å †å…¥ç»“æœé›†</span><br>            <span class="hljs-comment">// å¹¶ä¸”è¿™é‡Œæˆ‘ä»¬åº”è¯¥å¤„ç†ï¼Œå½“è®¡æ•°å™¨ç­‰äºå®ä¾‹å‚æ•°çš„lengthçš„æ—¶å€™ï¼Œå°†ç»“æœresolveå‡ºå»</span><br>            <span class="hljs-comment">// ä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œå®Œäº†æ‰€æœ‰çš„ä¼ å…¥çš„å®ä¾‹</span><br><br>            count++;<br>            <span class="hljs-comment">// ä¸ºäº†ä¿è¯æ¯ä¸€ä¸ªæ¬¡åºæ²¡æœ‰é—®é¢˜ï¼Œéœ€è¦æŒ‰ç…§ç´¢å¼•å°†æ¯ä¸ªå®ä¾‹çš„ç»“æœå­˜åœ¨ç»“æœé›†ä¸­</span><br><br>            result[i] = res;<br><br>            <span class="hljs-comment">// æ‰€æœ‰å®ä¾‹å®Œæˆå°†ç»“æœé›†æŠ›å‡º</span><br>            <span class="hljs-keyword">if</span> (count === len) &#123;<br>              <span class="hljs-keyword">return</span> resolve(result);<br>            &#125;<br>          &#125;)<br>          .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">return</span> reject(err);<br>          &#125;);<br>      &#125;<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// è¿™é‡Œå¤„ç†å½“ä¼ å…¥çš„å‚æ•°ä¸æ˜¯æ•°ç»„ç±»å‹çš„æ—¶å€™ç”¨promiseåŒ…è£…ä¸€ä¸‹è¿”å›ï¼Œä¸throw err</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(arg);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨æµ‹è¯•ç”¨ä¾‹éªŒè¯ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•èƒ½ä¸èƒ½ç”¨ï¼Œé¦–å…ˆæ¨¡æ‹Ÿä¸€ä¸ªå»¶è¿Ÿå‡½æ•°ï¼Œ<code>delay</code>ï¼Œç„¶åå†å®šä¹‰ä¸¤ä¸ªæ–¹æ³• <code>delay1ï¼Œdelay2</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delay</span>(<span class="hljs-params">ms</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    setTimeout(resolve, ms);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> delay1 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> delay(<span class="hljs-number">2000</span>).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">"delay1"</span>);<br><span class="hljs-keyword">const</span> delay2 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> delay(<span class="hljs-number">1000</span>).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">"delay2"</span>);<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ï¼ŒæŒ‰ç…§é¢„æœŸçš„è¯åº”è¯¥æ˜¯æ‰“å°å‡ºæ¥ä¸¤ä¸ªæ•°æ®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">promiseAll([delay1(), delay2()]).then(<span class="hljs-function">(<span class="hljs-params">[dd1, dd2]</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"dd1 dd2"</span>, dd1, dd2); <span class="hljs-comment">// delay1 delay2</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬èƒ½å‘ç°ç¡®å®å·²ç»å¯ä»¥è¿”å›ä¸¤ä¸ªå»¶è¿Ÿå‡½æ•°ä¸­çš„æ•°æ®ã€‚</p><h2 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a><code>Promise.race</code></h2><p>è¿˜æ˜¯æ ¹æ®å…¶ç‰¹æ€§æ¥å®ç°ï¼Œé¦–å…ˆ <code>race</code> çš„æ–¹æ³•å’Œ <code>all</code> çš„åŸºç¡€æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ¥å—çš„å‚æ•°ä»¥åŠç±»åˆ«ç­‰ï¼Œå…¶ç”¨æ³•æ˜¯å¤šä¸ªå®ä¾‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œæ€»ç»“æœçš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ <code>Promise</code> å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™ç»“æœé›†çš„å›è°ƒå‡½æ•°ã€‚</p><h3 id="æ‹†è§£Promise-race"><a href="#æ‹†è§£Promise-race" class="headerlink" title="æ‹†è§£Promise.race"></a>æ‹†è§£<code>Promise.race</code></h3><ul><li>é¦–å…ˆåŸºæœ¬å’Œ <code>all</code> çš„ç±»ä¼¼ï¼Œç„¶åç”±å…¶ç‰¹æ€§å¯çŸ¥ï¼Œå…¶å®å†…éƒ¨å®ç°åº”è¯¥æ˜¯è°å…ˆå®Œæˆå°±è°è¿”å›ï¼Œä¹Ÿå°±æ˜¯å¾ªç¯ä½“å†…éƒ¨åªè¦æœ‰ä¸€ä¸ªæˆåŠŸæ‰§è¡Œå®Œæ¯•å°±å¯ä»¥ <code>resolve</code>ã€‚</li></ul><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promiseRace</span>(<span class="hljs-params">arg</span>) </span>&#123;<br>  <span class="hljs-comment">// ä¾æ—§æ˜¯è¾¹ç•Œåˆ¤æ–­</span><br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(arg)) &#123;<br>    <span class="hljs-keyword">let</span> len = arg.length;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>        <span class="hljs-built_in">Promise</span>.resolve(arg[i])<br>          .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>            <span class="hljs-comment">// æ‰§è¡ŒæˆåŠŸæœ‰ç»“æœç›´æ¥è¿”å›</span><br><br>            <span class="hljs-keyword">return</span> resolve(res);<br>          &#125;)<br>          .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">return</span> reject(err);<br>          &#125;);<br>      &#125;<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(arg);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>race</code> æœ€å¸¸è§çš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯ï¼Œå¦‚æœé¡µé¢é‡Œæœ‰éœ€è¦è¯·æ±‚çš„æ¥å£ï¼Œä½†æ˜¯æ¥å£è€—æ—¶å¦‚æœæ¯”è¾ƒé•¿ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åˆ©ç”¨ <code>race</code> é…åˆ <code>delay</code> å‡½æ•°åšä¸€ä¸ªå…œåº•ï¼Œå‘è¯·æ±‚çš„åŒæ—¶å¼€ä¸€ä¸ªå¤šå°‘ <code>ms</code> çš„å®šæ—¶å™¨ï¼Œå¦‚æœå®šæ—¶å™¨ç»“æŸä¹‹å‰æ¥å£è¿˜æ²¡æœ‰å“åº”çš„è¯åˆ™ä¸­æ–­è¯·æ±‚ç«‹å³è¿”å›ï¼Œè€Œä¸è‡³äºæ¥å£ä¸€ç›´å¤„äº <code>pedding</code> æŒ‚èµ·çŠ¶æ€ã€‚é‚£æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªä¾‹å­éªŒè¯ä¸€ä¸‹ <code>race</code> æ˜¯å¦å¯ä»¥ç”¨ã€‚</p><p>æˆ‘ä»¬è¿™æ¬¡ä¿®æ”¹ä¸€ä¸‹ä¸¤ä¸ªå»¶è¿Ÿå‡½æ•°ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> delay1 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> delay(<span class="hljs-number">5000</span>).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">"æˆ‘è¯·æ±‚éœ€è¦5sæ—¶é—´å¤ªä¹…äº†"</span>);<br><span class="hljs-keyword">const</span> delay2 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> delay(<span class="hljs-number">2000</span>).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">"å¦‚æœæ¥å£å“åº”å¤§äº2sæˆ‘å°±ä¸ç­‰äº†å“ˆ"</span>);<br></code></pre></td></tr></table></figure><p>æŒ‰ç…§é¢„æœŸçš„è¯ï¼Œ<code>data</code> çš„æ‰“å°åº”è¯¥æ˜¯å»¶è¿Ÿæ¯”è¾ƒå°çš„é‚£ä¸ªï¼Œå› ä¸ºå…ˆæ‰§è¡Œå®Œæˆå…ˆè¿”å›äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">promiseRace([delay1(), delay2()]).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"data"</span>, res); <span class="hljs-comment">// data å¦‚æœæ¥å£å“åº”å¤§äº2sæˆ‘å°±ä¸ç­‰äº†å“ˆ</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>ç”±æ­¤å¯è§æˆ‘ä»¬çš„ <code>race</code> é€šè¿‡ç”¨ä¾‹éªŒè¯ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚</p><p>è‡³æ­¤ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ <code>promise</code> çš„æ–¹æ³•æˆ‘ä»¬å°±å®ç°äº†ï¼Œå…¶å®å¾ˆå¤šä¸œè¥¿ä»ä½¿ç”¨çš„è§’åº¦ä¸Šæ¥çœ‹ï¼Œå†…éƒ¨å®ç°åŸç†å¤§æ¦‚éƒ½æ˜¯èƒ½æ¯”è¾ƒæ¸…æ¥šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åº”è¯¥æ³¨æ„æ›´å¤šçš„ç»†èŠ‚ï¼Œä¾‹å¦‚è¾¹ç•Œæ¡ä»¶ã€ç±»å‹åŒ…è£…ã€ä»£ç æ‰§è¡Œçš„ä½ç½®ç­‰ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
      <tag>Promise</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¯»æ­£åˆ™è¿·ä½ ä¹¦æ€»ç»“ ğŸ““</title>
    <link href="/2021/05/15/miniRegExp/"/>
    <url>/2021/05/15/miniRegExp/</url>
    
    <content type="html"><![CDATA[<p>å‰ç«¯å¾ˆå¤šåœºæ™¯å…¶å®éƒ½ä¼šæ¶‰åŠåˆ°æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨ï¼Œå¥ˆä½•ä¹‹å‰ä¸ªäººæ­£åˆ™çš„çŸ¥è¯†éƒ½æ˜¯é›¶æ•£çš„ï¼Œè¯»å®Œæ­£åˆ™è¡¨è¾¾å¼è¿·ä½ ä¹¦ä¹‹åå—ç›Šè‰¯å¤šï¼Œä¸€æ¥æ€»ç»“ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼ŒäºŒæ¥å›é¡¾çš„æ—¶å€™å¯ä»¥æ›´æ–¹ä¾¿ã€‚</p><p>æ ¹æ®ç›®å½•ç²¾ç®€æ•´ç†</p><h1 id="åŒ¹é…æ”»ç•¥"><a href="#åŒ¹é…æ”»ç•¥" class="headerlink" title="åŒ¹é…æ”»ç•¥"></a>åŒ¹é…æ”»ç•¥</h1><h2 id="å­—ç¬¦ç»„"><a href="#å­—ç¬¦ç»„" class="headerlink" title="å­—ç¬¦ç»„"></a>å­—ç¬¦ç»„</h2><p>åŒ¹é…åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦ï¼ŒèŒƒå›´è¡¨ç¤ºåˆ©ç”¨ <code>-</code> çœç•¥å’Œç®€å†™ã€‚</p><h3 id="æ’é™¤å­—ç¬¦ç»„"><a href="#æ’é™¤å­—ç¬¦ç»„" class="headerlink" title="æ’é™¤å­—ç¬¦ç»„"></a>æ’é™¤å­—ç¬¦ç»„</h3><p>åˆ©ç”¨ <code>^</code>ï¼Œå­—ç¬¦ç»„<code>ç¬¬ä¸€ä¸ªæ”¾ç½® ^ è¡¨ç¤ºæ±‚å</code>ã€‚</p><h3 id="å¸¸è§çš„ç®€å†™"><a href="#å¸¸è§çš„ç®€å†™" class="headerlink" title="å¸¸è§çš„ç®€å†™"></a>å¸¸è§çš„ç®€å†™</h3><table><thead><tr><th>å­—ç¬¦ç»„</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>\d</code></td><td>æ•°å­— <code>[0-9]</code>ï¼Œè¡¨ç¤ºä¸€ä½æ•°å­—ã€‚</td></tr><tr><td><code>\D</code></td><td>è¡¨ç¤º <code>[^0-9]</code>ï¼Œè¡¨ç¤ºé™¤äº†æ•°å­—ä¹‹å¤–çš„ä»»æ„å­—ç¬¦ã€‚</td></tr><tr><td><code>\w</code></td><td>è¡¨ç¤º <code>[0-9a-zA-Z]</code>ã€‚</td></tr><tr><td><code>\W</code></td><td><code>[^0-9a-zA-Z]</code>ï¼Œéå•è¯å­—ç¬¦ã€‚</td></tr><tr><td><code>\s</code></td><td><code>[\t\v\n\r\f]</code>ï¼Œè¡¨ç¤ºç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ°´å¹³ã€å‚ç›´åˆ¶è¡¨ç¬¦ã€æ¢è¡Œã€å›è½¦ã€æ¢é¡µç¬¦ã€‚</td></tr><tr><td><code>\S</code></td><td><code>[^\t\v\n\r\f]</code>ï¼Œéç©ºç™½ç¬¦ã€‚</td></tr><tr><td><code>.</code></td><td><code>[^\n\r\u2028\u2029]</code>ï¼Œé€šé…ç¬¦ã€‚è¡¨ç¤ºå‡ ä¹ä»»æ„å­—ç¬¦ã€‚</td></tr></tbody></table><p>åŒ¹é…<code>ä»»æ„å­—ç¬¦</code>ï¼Œ<code>[\d\D]ã€[\w\W]ã€[\s\S]ã€[^]</code></p><h2 id="é‡è¯"><a href="#é‡è¯" class="headerlink" title="é‡è¯"></a>é‡è¯</h2><h3 id="ç®€å†™"><a href="#ç®€å†™" class="headerlink" title="ç®€å†™"></a>ç®€å†™</h3><table><thead><tr><th>é‡è¯</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>{m,}</code></td><td>è‡³å°‘å‡ºç° <code>m</code> æ¬¡ã€‚</td></tr><tr><td><code>{m}</code></td><td>å‡ºç° <code>m</code> æ¬¡ã€‚</td></tr><tr><td><code>?</code></td><td>ç­‰ä»·äº <code>{0,1}</code>ï¼Œå‡ºç°æˆ–è€…ä¸å‡ºç°ã€‚</td></tr><tr><td><code>+</code></td><td>ç­‰ä»· <code>{1,}</code>ï¼Œå‡ºç°<code>è‡³å°‘ä¸€æ¬¡</code>ã€‚</td></tr><tr><td><code>*</code></td><td>ç­‰ä»· <code>{0,}</code>ï¼Œå‡ºç°<code>ä»»æ„æ¬¡</code>ï¼Œæœ‰å¯èƒ½ä¸å‡ºç°ã€‚</td></tr></tbody></table><h3 id="è´ªå©ªä¸æƒ°æ€§"><a href="#è´ªå©ªä¸æƒ°æ€§" class="headerlink" title="è´ªå©ªä¸æƒ°æ€§"></a>è´ªå©ªä¸æƒ°æ€§</h3><ul><li><p><code>è´ªå©ª</code>ä¼šå°½å¯èƒ½<code>å¤šçš„åŒ¹é…</code>ã€‚</p></li><li><p><code>æƒ°æ€§</code>ä¼šå°½å¯èƒ½<code>å°‘çš„åŒ¹é…</code>ã€‚<br>å…·ä½“æƒ°æ€§å®ç°ï¼šé‡è¯åè¾¹<code>åŠ é—®å·</code>å°±èƒ½å®ç°æƒ°æ€§åŒ¹é…ã€‚</p><table><thead><tr><th>æƒ°æ€§é‡è¯</th><th>è´ªå©ªé‡è¯</th></tr></thead><tbody><tr><td><code>{m,n}?</code></td><td><code>{m,n}</code></td></tr><tr><td><code>{m,}?</code></td><td><code>{m,}</code></td></tr><tr><td><code>??</code></td><td><code>?</code></td></tr><tr><td><code>+?</code></td><td><code>+</code></td></tr><tr><td><code>*?</code></td><td><code>*</code></td></tr></tbody></table></li></ul><h3 id="å¤šé€‰åˆ†æ”¯"><a href="#å¤šé€‰åˆ†æ”¯" class="headerlink" title="å¤šé€‰åˆ†æ”¯"></a>å¤šé€‰åˆ†æ”¯</h3><p>ç®¡é“ç¬¦å·ä»£è¡¨åˆ†å‰² <code>|</code>ï¼Œé»˜è®¤æƒ°æ€§åŒ¹é…ï¼Œå‰è¾¹çš„åŒ¹é…æˆåŠŸåé¢ä¸ä¼šå°è¯•åŒ¹é…ã€‚ä¾‹å¦‚åŒ¹é… <code>good</code> å’Œ <code>nice</code>ï¼Œä½¿ç”¨ <code>/good|nice/g</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/good|nice/g</span><br><span class="hljs-keyword">const</span> string = <span class="hljs-string">'good idea, nice day!'</span><br><span class="hljs-built_in">console</span>.log(string.match(reg)) <span class="hljs-comment">// ['good', 'nice']</span><br></code></pre></td></tr></table></figure><h1 id="åŒ¹é…ä½ç½®"><a href="#åŒ¹é…ä½ç½®" class="headerlink" title="åŒ¹é…ä½ç½®"></a>åŒ¹é…<code>ä½ç½®</code></h1><ul><li><code>^</code>ï¼ŒåŒ¹é…<code>å¼€å¤´</code>ï¼Œåœ¨å¤šè¡ŒåŒ¹é…ä¸­åŒ¹é…è¡Œå¼€å¤´ã€‚</li><li><code>$</code>ï¼ŒåŒ¹é…<code>ç»“å°¾</code>ï¼Œåœ¨å¤šè¡ŒåŒ¹é…ä¸­åŒ¹é…è¡Œç»“å°¾ã€‚</li><li><code>\b</code>ï¼Œ<code>å•è¯è¾¹ç•Œ</code>ï¼Œå…·ä½“æ˜¯ <code>\w</code> å’Œ <code>\W</code> ä¹‹é—´çš„ä½ç½®ï¼Œä¹ŸåŒ…æ‹¬ <code>\w</code> å’Œ<code>^</code> ä¹‹é—´çš„ä½ç½®å’Œ <code>\w</code> å’Œ <code>$</code> ä¹‹é—´çš„ä½ç½®ï¼Œçœ‹ä¸ªä¾‹å­ï¼š</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">'[JS] Lesson_01.mp4'</span>.replace(<span class="hljs-regexp">/\b/g</span>, <span class="hljs-string">'#'</span>)<br><span class="hljs-comment">// '[#JS#] #Lesson_01#.#mp4#'</span><br></code></pre></td></tr></table></figure><ul><li><code>\B</code>ï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯ <code>\b çš„å–å</code>ï¼ŒçŸ¥é“äº† <code>\b</code> ï¼Œæ‰€ä»¥</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">'[JS] Lesson_01.mp4'</span>.replace(<span class="hljs-regexp">/\B/g</span>, <span class="hljs-string">'#'</span>)<br><span class="hljs-comment">// "#[J#S]# L#e#s#s#o#n#_#0#1.m#p#4"</span><br></code></pre></td></tr></table></figure><ul><li><code>(?=p)</code>ï¼Œå…¶ä¸­ <code>p</code> æ˜¯ä¸€ä¸ªå­æ¨¡å¼ï¼Œå³ <code>p å‰é¢çš„ä½ç½®</code>ï¼Œæ˜¯ä½ç½®ï¼Œä¹Ÿå°±æ˜¯åœ¨ <code>p</code> å‰é¢åšæ‰‹è„šï¼Œä¸æ˜¯å‰é¢çš„å­—ç¬¦ï¼Œå…¶ä¸­ <code>p</code> å¯ä»¥æ˜¯æƒ³åŒ¹é…çš„ä»»æ„å­—ç¬¦ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">'hello'</span>.replace(<span class="hljs-regexp">/(?=l)/g</span>, <span class="hljs-string">'#'</span>)<br><span class="hljs-comment">// "he#l#lo"</span><br></code></pre></td></tr></table></figure><ul><li><code>(?!p)</code>ï¼Œæ˜¯ <code>(?=p)</code> çš„åæ¨¡å¼ã€‚è®°ä¸€ä¸ªç‰¹æ®Šçš„ï¼Œä¸æ˜¯å¼€å¤´ï¼Œ<code>/(?!^)/</code>ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">'hello'</span>.replace(<span class="hljs-regexp">/(?!l)/g</span>, <span class="hljs-string">'#'</span>)<br><span class="hljs-comment">// "#h#ell#o#"</span><br></code></pre></td></tr></table></figure><ul><li>å¿…é¡»åŒ…å«<code>æ•°å­—</code>ï¼Œ<code>/(?=.*[0-9])/</code>ã€‚</li><li>å¿…é¡»åŒ…å«<code>æ•°å­—å’Œå°å†™å­—æ¯</code>ï¼Œ<code>/(?=.*[0-9])(?=.*[a-z])/</code>ï¼Œè¿™æ ·æ˜¯ä¸ä¼šæŒ‘ä½ç½®çš„ï¼Œæ•°å­—å’Œå­—æ¯çš„é¡ºåºéšæ„éƒ½å¯ä»¥åŒ¹é…ã€‚</li><li>å¿…é¡»åŒ…å«<code>å°å†™å­—æ¯å’Œå¤§å†™å­—æ¯</code>ï¼Œ<code>/(?=.*[a-z])(?=.*[A-Z])/</code>ï¼ŒåŒç†ã€‚</li><li>å¿…é¡»åŒ…å«<code>æ•°å­—ã€å¤§ã€å°å†™å­—æ¯</code>ï¼Œ<code>/(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])/</code>ï¼ŒåŒç†ã€‚</li></ul><h1 id="æ‹¬å·çš„ä½œç”¨"><a href="#æ‹¬å·çš„ä½œç”¨" class="headerlink" title="æ‹¬å·çš„ä½œç”¨"></a>æ‹¬å·çš„ä½œç”¨</h1><p>æ‹¬å·çš„ä¸»è¦ä½œç”¨å°±æ˜¯æä¾›äº†<code>åˆ†ç»„</code>ï¼Œä¾¿äºå¼•ç”¨ã€‚å¼•ç”¨åˆ†ç»„ä¼šæœ‰åœ¨ <code>js</code> é‡Œå¼•ç”¨ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼é‡Œå¼•ç”¨ã€‚æ‹¬å·é‡Œçš„æ­£åˆ™å¼ºè°ƒå…¶æ˜¯ä¸€ä¸ªæ•´ä½“ã€‚</p><h2 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h2><ul><li><p>åˆ†ç»„ï¼šå¦‚æœè¦åŒ¹é…è¿ç»­å‡ºç°çš„å•ä¸ªå­—ç¬¦ç”¨ <code>/x+/</code> å³å¯ï¼Œä½†æ˜¯å¦‚æœéœ€è¦åŒ¹é…è¿ç»­å‡ºç°çš„ <code>&#39;abc&#39;</code>ï¼Œåˆ™éœ€è¦ <code>/(abc)+/</code>ï¼Œå°†é‡è¯ <code>+</code> ä½œç”¨äºæ‹¬å·è¿™ä¸ªæ•´ä½“çš„è¡¨è¾¾å¼ä¸Šã€‚</p></li><li><p>åˆ†ç»„å¼•ç”¨ï¼šæœ‰äº†æ‹¬å·ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œæå–ä»¥åŠæ›´å¼ºå¤§çš„æ›¿æ¢æ“ä½œï¼Œå› ä¸ºåˆ†ç»„å¯ä»¥æ•è·æ•°æ®ï¼Œåˆ©ç”¨æ„é€ å‡½æ•°çš„å…¨å‰§å±æ€§ <code>$1~$9</code> æå–ã€‚</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ä¾‹å¦‚æ›¿æ¢æ—¥æœŸé¡ºåº</span><br><span class="hljs-keyword">const</span> regExp = <span class="hljs-regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span><br><span class="hljs-keyword">var</span> timeString = <span class="hljs-string">'2020-05-15'</span><br>timeString.replace(regExp, <span class="hljs-string">'$2/$3/$1'</span>)<br><span class="hljs-comment">// "05/15/2020"</span><br></code></pre></td></tr></table></figure><h2 id="åå‘å¼•ç”¨"><a href="#åå‘å¼•ç”¨" class="headerlink" title="åå‘å¼•ç”¨"></a>åå‘å¼•ç”¨</h2><p>å‡å¦‚è¦æ±‚åŒ¹é…çš„<code>å‰åä¸€è‡´</code>ï¼Œå¼•ç”¨ä¹‹å‰çš„ç¬¬ <code>n</code> ä¸ªåˆ†ç»„ï¼Œçœ‹ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// åŒ¹é…æ—¥æœŸï¼Œåªæ˜¯åŒ¹é…ä¸‰ç§æ¨¡å¼ï¼Œå¹¶ä¸”å¹´ä»½å’Œæœˆä»½ä¹‹é—´çš„è¿æ¥ç¬¦å¿…é¡»ä¸€è‡´</span><br><span class="hljs-keyword">const</span> regExp = <span class="hljs-regexp">/\d&#123;4&#125;(-|\/|\.)\d&#123;2&#125;\1\d&#123;2&#125;/</span><br>regExp.test(<span class="hljs-string">'2020-05-15'</span>) <span class="hljs-comment">// true</span><br>regExp.test(<span class="hljs-string">'2020/05-15'</span>) <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>\1</code> ä»£è¡¨çš„å°±æ˜¯å¼•ç”¨å‰è¾¹çš„é‚£ä¸ªåˆ†ç»„ <code>(-|\/|\.)</code>ï¼Œ<code>\2 \3</code> ä¹Ÿå°±æ˜¯åˆ†åˆ«æŒ‡ä»£ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªåˆ†ç»„ã€‚åå‘å¼•ç”¨å°±æ˜¯å¼•ç”¨å‰è¾¹çš„åˆ†ç»„ï¼Œå½“å¼•ç”¨åˆ°äº†ä¸å­˜åœ¨çš„åˆ†ç»„æ—¶ï¼Œåªæ˜¯åŒ¹é…åå‘å¼•ç”¨çš„å­—ç¬¦æœ¬èº«ã€‚</p><h2 id="éæ•è·æ‹¬å·"><a href="#éæ•è·æ‹¬å·" class="headerlink" title="éæ•è·æ‹¬å·"></a>éæ•è·æ‹¬å·</h2><p>å¦‚æœä¸ä½¿ç”¨å¼•ç”¨ï¼Œåˆ™å¯ä»¥åˆ©ç”¨éæ•è·æ‹¬å· <code>(?:p)</code> å’Œ <code>(?:p1|p2|p3)</code>ï¼Œå¦‚æœä¸ç”¨åå‘å¼•ç”¨ï¼Œå¯¹äºåŒ¹é… <code>&#39;abc&#39;</code> çš„è¿å­—ç¬¦ï¼Œå¯ä»¥ä¿®æ”¹ä¸º <code>/(?:abc)+/g</code></p><p>ä¸€äº›ä¾‹å­</p><ul><li>å°†æ¯ä¸ªå•è¯é¦–å­—æ¯è½¬ä¸ºå¤§å†™</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> titleize = <span class="hljs-function">(<span class="hljs-params">str</span>) =&gt;</span> str.toLowerCase().replace(<span class="hljs-regexp">/(?:^|\s)\w/g</span>, c =&gt; c.toUpperCase())<br>titleize(<span class="hljs-string">'ni hao a '</span>)<br><span class="hljs-comment">// "Ni Hao A "</span><br></code></pre></td></tr></table></figure><ul><li>_-ç©ºæ ¼ è½¬é©¼å³°</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> camelize = <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.replace(<span class="hljs-regexp">/[-_\s]+(.)?/g</span>, (match, c) =&gt; c ? c.toUpperCase() : <span class="hljs-string">''</span>)<br>camelize(<span class="hljs-string">'_get_name'</span>)<br><span class="hljs-comment">// "GetName"</span><br></code></pre></td></tr></table></figure><ul><li>é©¼å³°è½¬ä¸­åˆ’çº¿</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å…ˆå°†å¤§å†™å­—æ¯åŒ¹é…åˆ°çš„å­—ç¬¦å‰è¾¹åŠ ä¸Š-ï¼Œåˆ©ç”¨äº†åˆ†ç»„çš„ç‰¹æ€§ã€‚å†å°†ä»»æ„å¤šä¸ª _-ç©ºæ ¼ è½¬ä¸º-</span><br><span class="hljs-keyword">const</span> dasherize = <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.replace(<span class="hljs-regexp">/([A-Z])/g</span>, <span class="hljs-string">'-$1'</span>).replace(<span class="hljs-regexp">/[_-\s]+/g</span>, <span class="hljs-string">'-'</span>).toLowerCase()<br>dasherize(GetName)<br><span class="hljs-comment">// "-get-name"</span><br></code></pre></td></tr></table></figure><ul><li>åŒ¹é…æˆå¯¹æ ‡ç­¾ï¼Œ<code>/&lt;([^&gt;]+)&gt;[\d\D]*&lt;\/\1&gt;/</code></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;title&gt;Reg Exp&lt;/title&gt;<br>&lt;p&gt;bye bye&lt;/p&gt;<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒåŒ¹é…ä¸€ä¸ªå¼€æ ‡ç­¾ï¼Œä½¿ç”¨ <code>&lt;[^&gt;]+&gt;</code> ï¼Œä¹Ÿå°±æ˜¯ <code>&lt;&gt;</code> ä¸­é <code>&gt;</code> çš„ä»»æ„å­—ç¬¦ã€‚<br>åŒ¹é…é—­æ ‡ç­¾ï¼Œ<code>&lt;\/[^&gt;]+&gt;</code>ï¼Œé—­æ ‡ç­¾ä¸­åªæ¯”å¼€æ ‡ç­¾å¤šäº†ä¸€ä¸ª <code>/</code> æ‰€ä»¥éœ€è¦åˆ©ç”¨ <code>\</code> è½¬ä¹‰ï¼Œè¿™å…¶ä¸­åˆå› ä¸ºéœ€è¦åŒ¹é…æˆå¯¹çš„æ ‡ç­¾ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å‰è¾¹çš„çŸ¥è¯†ï¼Œåå‘å¼•ç”¨ï¼Œéœ€è¦åå‘å¼•ç”¨æ‰€ä»¥è‚¯å®šéœ€è¦åˆ†ç»„äº†ï¼Œæœ€åæˆ‘ä»¬èƒ½å¤Ÿå†™å‡ºæ¥ï¼Œ<code>/&lt;([^&gt;]+)&gt;[\d\D]*&lt;\/\1&gt;/</code>ï¼Œ<code>[\d\D]</code> åŒ¹é…ä»»æ„å­—ç¬¦ã€‚</p><h1 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h1><table><thead><tr><th align="center">æ“ä½œç¬¦æè¿°</th><th align="center">æ“ä½œç¬¦</th><th align="center">ä¼˜å…ˆçº§</th></tr></thead><tbody><tr><td align="center">è½¬ä¹‰ç¬¦</td><td align="center"><code>\</code></td><td align="center">1</td></tr><tr><td align="center">æ‹¬å·ã€æ–¹æ‹¬å·</td><td align="center"><code>(...)ã€(?:...)ã€(?=...)ã€(?!...)ã€[...]</code></td><td align="center">2</td></tr><tr><td align="center">é‡è¯</td><td align="center"><code>{m}ã€{m, n}ã€{m, }ã€?ã€+ã€*</code></td><td align="center">3</td></tr><tr><td align="center">ä½ç½®ã€åºå·</td><td align="center"><code>^ã€$ã€\å…ƒå­—ç¬¦ã€ä¸€èˆ¬å­—ç¬¦</code></td><td align="center">4</td></tr><tr><td align="center">ç®¡é“ç¬¦</td><td align="center"><code>|</code></td><td align="center">5</td></tr></tbody></table><h2 id="éœ€è¦è½¬ä¹‰çš„å­—ç¬¦"><a href="#éœ€è¦è½¬ä¹‰çš„å­—ç¬¦" class="headerlink" title="éœ€è¦è½¬ä¹‰çš„å­—ç¬¦"></a>éœ€è¦è½¬ä¹‰çš„å­—ç¬¦</h2><p>éœ€è¦è½¬ä¹‰çš„å­—ç¬¦æ˜¯æ­£åˆ™ä¸­æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼Œ<code>^ã€$ã€.ã€*ã€+ã€?ã€!ã€|ã€\ã€/ã€(ã€)ã€[ã€]ã€{ã€}ã€=ã€!ã€:ã€-</code></p><h1 id="ä¼˜åŒ–æ•ˆç‡"><a href="#ä¼˜åŒ–æ•ˆç‡" class="headerlink" title="ä¼˜åŒ–æ•ˆç‡"></a>ä¼˜åŒ–æ•ˆç‡</h1><ul><li>ä½¿ç”¨å…·ä½“å­—ç¬¦ç»„æ¥æ›¿ä»£é€šé…ç¬¦æ¶ˆé™¤å›æº¯ã€‚</li><li>ä¸éœ€è¦åˆ†ç»„å’Œåå‘å¼•ç”¨æ—¶ï¼Œä½¿ç”¨éæ•è·åˆ†ç»„ã€‚</li><li>ç‹¬ç«‹å‡ºç¡®å®šå­—ç¬¦ï¼Œ<code>/a+/ =&gt; /aa*/</code>ã€‚</li><li>æå–åˆ†æ”¯çš„å…¬å…±éƒ¨åˆ†ï¼Œ<code>/this|that/ =&gt; /th(?:is|at)/</code>ã€‚</li><li>å‡å°‘åˆ†æ”¯æ•°é‡ï¼Œç¼©å°èŒƒå›´ï¼Œ<code>/red|read/ =&gt; /rea?d/</code>ã€‚</li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>JavaScriptæ­£åˆ™è¡¨è¾¾å¼è¿·ä½ ä¹¦ï¼ˆè€å§šï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ç°ç”µè¯ç°¿æˆ–è€…æ˜µç§°åˆ†ç±»åŠŸèƒ½ â˜ï¸</title>
    <link href="/2021/05/14/sortByASCII/"/>
    <url>/2021/05/14/sortByASCII/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ä¸€ä¸ªæŒºæœ‰æ„æ€çš„å°éœ€æ±‚ï¼Œæœ‰ä¸€ç»„è¯çš„åˆ†ç±»éœ€è¦æŒ‰ç…§æ‹¼éŸ³å½’ç±»ä¸”æ’åºï¼ŒåŸºæœ¬ç±»ä¼¼äºç”µè¯è–„æŒ‰ç…§è‹±æ–‡å­—æ¯æ’åºçš„åŠŸèƒ½ã€‚</p><p>å‡å¦‚åç«¯ç»™å‡ºçš„æ•°æ®æ˜¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json">[<br>  &#123;<br>    <span class="hljs-attr">"tag"</span>: <span class="hljs-string">"æ„ŸåŠ¨"</span>,<br>    <span class="hljs-attr">"pinyin"</span>: <span class="hljs-string">"gan dong"</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">"tag"</span>: <span class="hljs-string">"çˆ±å›½"</span>,<br>    <span class="hljs-attr">"pinyin"</span>: <span class="hljs-string">"ai guo"</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">"tag"</span>: <span class="hljs-string">"æ„ŸåŠ¨ä¸­å›½"</span>,<br>    <span class="hljs-attr">"pinyin"</span>: <span class="hljs-string">"gan dong zhong guo"</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">"tag"</span>: <span class="hljs-string">"å¯Œå¼º"</span>,<br>    <span class="hljs-attr">"pinyin"</span>: <span class="hljs-string">"fu qiang"</span><br>  &#125;<br>]<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆéœ€è¦å°†æ•°æ®è½¬ä¸º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json">[<br>  &#123;<br>    <span class="hljs-attr">"letter"</span>: <span class="hljs-string">"a"</span>,<br>    <span class="hljs-attr">"data"</span>: [<span class="hljs-string">"çˆ±å›½"</span>]<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">"letter"</span>: <span class="hljs-string">"f"</span>,<br>    <span class="hljs-attr">"data"</span>: [<span class="hljs-string">"å¯Œå¼º"</span>]<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">"letter"</span>: <span class="hljs-string">"g"</span>,<br>    <span class="hljs-attr">"data"</span>: [<span class="hljs-string">"æ„ŸåŠ¨"</span>, <span class="hljs-string">"æ„ŸåŠ¨ä¸­å›½"</span>]<br>  &#125;<br>]<br></code></pre></td></tr></table></figure><p>å®ç°æ€è·¯ï¼Œå¯ä»¥å€ŸåŠ© <code>Map</code> çš„å±æ€§ï¼Œå…ˆæŸ¥çœ‹å½“å‰çš„æ•°æ®æ˜¯å¦å·²ç»è¢«æ¨å…¥ <code>data</code> ä¸­ï¼Œå¦‚æœå·²ç»è¢«æ¨å…¥åˆ™éœ€è¦æ›´æ–°ï¼Œå¦åˆ™ç›´æ¥ <code>push</code> åˆ° <code>data</code> ä¸­ï¼Œå¹¶ä¸”è·Ÿæ–° <code>Map</code> çš„çŠ¶æ€ã€‚</p><p>ä»£ç å®ç°ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> tagsTypes = <span class="hljs-string">'tag'</span> | <span class="hljs-string">'pinyin'</span><br><br><span class="hljs-keyword">interface</span> IResult &#123;<br>  letter: <span class="hljs-built_in">string</span>;<br>  data: <span class="hljs-built_in">string</span>[];<br>&#125;<br><br><span class="hljs-keyword">const</span> pySegSort = <span class="hljs-function">(<span class="hljs-params">arr: Record&lt;tagsTypes, <span class="hljs-built_in">string</span>&gt;[]</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> wordsMap: Map&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">boolean</span>&gt; = <span class="hljs-keyword">new</span> Map();<br>  <span class="hljs-keyword">let</span> moreWords: IResult[] = [];<br>  arr.forEach(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// å–é¦–å­—æ¯</span><br>    <span class="hljs-keyword">const</span> initials = item.pinyin.charAt(<span class="hljs-number">0</span>).toLowerCase();<br>    <span class="hljs-comment">// è‹¥Mapä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥pushï¼Œå¹¶ä¸”æ›´æ–°çŠ¶æ€</span><br>    <span class="hljs-keyword">if</span> (!wordsMap.has(initials)) &#123;<br>      moreWords.push(&#123;<br>        letter: initials,<br>        data: [item.tag],<br>      &#125;);<br>      wordsMap.set(initials, <span class="hljs-literal">true</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// å¦åˆ™å°±å¯»æ‰¾å»æ‹¼æ¥</span><br>      moreWords.forEach(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (e.letter === initials) &#123;<br>          e.data = [...new Set([...e.data, item.tag])];<br>        &#125;<br>      &#125;);<br>    &#125;<br>  &#125;);<br>  <span class="hljs-comment">// æœ€ç»ˆå–æ•°æ®çš„é¦–å­—æ¯çš„ASCIIç æ’åº</span><br>  <span class="hljs-keyword">return</span> moreWords.sort(<br>    <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.letter.charCodeAt(<span class="hljs-number">0</span>) - b.letter.charCodeAt(<span class="hljs-number">0</span>)<br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éƒ¨åˆ† web æ€§èƒ½ä¼˜åŒ–æ¸…å• ğŸ§¾</title>
    <link href="/2021/04/26/webPerformance/"/>
    <url>/2021/04/26/webPerformance/</url>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€åç ”å‘ï¼Œåˆ°äº†ä¸€å®šç¨‹åº¦ä¹‹åå¯¹æ€§èƒ½çš„ä¼˜åŒ–æ˜¯ä¸å¯é¿å…çš„ï¼Œç°æ€»ç»“ä¸€ä¸‹åœ¨æ—¥å¸¸ç ”å‘ä¸­ï¼Œæ€è€ƒä»¥åŠæœ‰è¿‡å®è·µçš„ä¸€äº›æ€§èƒ½ä¼˜åŒ–ç‚¹ã€‚</p><h2 id="å‡å°‘è¯·æ±‚æ•°"><a href="#å‡å°‘è¯·æ±‚æ•°" class="headerlink" title="å‡å°‘è¯·æ±‚æ•°"></a>å‡å°‘è¯·æ±‚æ•°</h2><ul><li>å‡å°‘ <code>DNS</code> æŸ¥è¯¢æ—¶é—´ã€‚</li><li>åˆ©ç”¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨æˆ–è€… <code>reduxã€dva</code> å°†è¯·æ±‚æ•°æ®ç¼“å­˜åœ¨æœ¬æ¬¡ä¼šè¯ä¸­ï¼Œé¿å…å¤šæ¬¡è¯·æ±‚ã€‚</li><li>åˆ©ç”¨ <code>url-loader</code> å¯¹å°å›¾ç‰‡è¿›è¡Œ <code>base64</code> è½¬ç é€šè¿‡å¢åŠ ä½“ç§¯æ¢è¯·æ±‚ æˆ–è€… åˆ©ç”¨ <code>webpack5 - assets modules</code>ã€‚</li><li>é…åˆ <code>webpack chunkhash</code> åˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ã€‚</li></ul><h2 id="è¾ƒå°è¯·æ±‚èµ„æºä½“ç§¯"><a href="#è¾ƒå°è¯·æ±‚èµ„æºä½“ç§¯" class="headerlink" title="è¾ƒå°è¯·æ±‚èµ„æºä½“ç§¯"></a>è¾ƒå°è¯·æ±‚èµ„æºä½“ç§¯</h2><ul><li><code>webpack</code> è‡ªå¸¦ <code>new TerserPlugin</code> æ’ä»¶å¼€å¯å¤šçº¿ç¨‹ <code>js</code> å‹ç¼©ã€‚</li><li>ç”Ÿäº§ç¯å¢ƒçœ‹æƒ…å†µè¦ä¸è¦è¿›è¡Œ <code>mini-css-extract-plugin</code> æŠ½ç¦» <code>css</code> æ ·å¼ï¼Œåˆ©ç”¨ <code>optimize-css-assets-webpack-plugin</code> å‹ç¼© <code>css</code>ã€‚</li><li><code>externals</code> æ‹†åˆ†ä¸å¸¸å˜æ›´çš„ä¸‰æ–¹åº“ï¼Œåˆ©ç”¨ <code>cdn</code> åŠ è½½ã€‚</li><li>å¼€å¯ <code>tree sharking</code> å‡å°‘æ— ç”¨ä»£ç çš„å¼•å…¥ã€‚</li><li><code>IgnorePlugin</code> å¿½ç•¥ä¸éœ€è¦çš„æ–‡ä»¶ã€‚</li><li>åˆ©ç”¨ <code>iconfont</code> æ›¿æ¢å›¾æ ‡ã€å›¾ç‰‡ã€‚</li></ul><h2 id="æå‡ç½‘ç»œä¼ è¾“é€Ÿç‡"><a href="#æå‡ç½‘ç»œä¼ è¾“é€Ÿç‡" class="headerlink" title="æå‡ç½‘ç»œä¼ è¾“é€Ÿç‡"></a>æå‡ç½‘ç»œä¼ è¾“é€Ÿç‡</h2><ul><li>åˆç†ä½¿ç”¨ <code>å›¾ç‰‡å¤§å°</code> ä»¥åŠè¿›è¡Œå›¾ç‰‡ <code>å‹ç¼©</code>ã€‚</li><li><code>gzip</code> å‹ç¼©ã€‚</li><li><code>nginx</code> ä»£ç†ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚</li><li><code>http2</code> å¤´éƒ¨å‹ç¼©ï¼ˆå‡å°‘æ¯æ¬¡è¯·æ±‚é™„å¸¦å¼€é”€ï¼‰ã€å¤šè·¯å¤ç”¨ï¼ˆä¿æŒä¸€ä¸ªé“¾æ¥å¯ä»¥ç”¨ï¼Œå‡å°‘æ¡æ‰‹æ¬¡æ•°å¸¦æ¥æ€§èƒ½æŸè€—ï¼‰ã€æœåŠ¡ç«¯æ¨é€ï¼ˆä¸»åŠ¨æå‰æ¨é€æµè§ˆå™¨éœ€è¦è¯·æ±‚çš„èµ„æºï¼‰ã€è¯·æ±‚ä¼˜å…ˆçº§ï¼ˆé‡è¦çš„æ•°æ®å…ˆè¯·æ±‚æˆ–è€…å…ˆæ¨é€ï¼‰ã€‚</li></ul><h2 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h2><ul><li><code>babel</code> å¼€å¯ç¼“å­˜ï¼Œ<code>babel-loader?cacheDirectory</code>ã€‚</li><li><code>loader</code> æŒ‡å®š <code>include</code> æˆ–è€… <code>exclude</code>æŒ‡å®šç›®å½•ï¼Œç¼©å°æ„å»ºèŒƒå›´ã€‚</li><li><code>loader</code> çš„è€—æ—¶å¦‚æœæ¯”è¾ƒå¤šçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>thread-loader</code> å¼€å¯å¤šçº¿ç¨‹æ± ï¼Œå……åˆ†åˆ©ç”¨æœºå™¨èµ„æºã€‚</li><li><code>HardSourceWebpackPlugin</code> ä¸ºæ¨¡å—æä¾›ä¸­é—´ç¼“å­˜ï¼Œé¦–æ¬¡æ„å»ºæ—¶é—´æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡å¼€å§‹ï¼Œæ„å»ºæ—¶é—´æå¤§å‡å°‘ã€‚</li><li><code>pm2</code> å¯ä»¥å¼€å¯ <code>node cluster</code> é›†ç¾¤æ¨¡å¼ã€‚</li><li><code>js</code> è®¾ç½® <code>chunkhashï¼Œcss</code> åˆ©ç”¨ <code>new extractTextPlugin(&#39;../css/bundle.[name].[contenthash].css&#39;)</code> è®¾ç½® <code>contenthash</code>ï¼ˆæš‚æœªå°è¯•ï¼‰ï¼Œç›®çš„ï¼š<code>js</code> æ¨¡å—æ”¹å˜ä¹‹åï¼Œå› ä¸ºå¼•ç”¨äº† <code>css</code>ï¼Œå¦‚æœä¾ç„¶ä½¿ç”¨ <code>chunkhash</code> ä¼šå¯¼è‡´ <code>css</code> é‡å¤æ„å»ºï¼Œæ‰€ä»¥åˆ©ç”¨æ’ä»¶è®¾ç½®åªæœ‰ <code>css</code> å†…å®¹å‘ç”Ÿå˜åŒ–çš„æ‰æ„å»ºï¼Œæå‡æ•ˆç‡ã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æ€§èƒ½ä¼˜åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>http2.0 å­¦ä¹ ç¬”è®°</title>
    <link href="/2021/04/05/http2Notes/"/>
    <url>/2021/04/05/http2Notes/</url>
    
    <content type="html"><![CDATA[<p><code>web</code> æ€§èƒ½æƒå¨æŒ‡å—çš„è¯»ä¹¦ç¬”è®°ï¼ŒåŠ æ·±ä¸€äº›ç†è§£å’Œè®°å¿†ã€‚</p><h2 id="http2-çš„ç›®çš„"><a href="#http2-çš„ç›®çš„" class="headerlink" title="http2 çš„ç›®çš„"></a><code>http2</code> çš„ç›®çš„</h2><ul><li><p>æ”¯æŒè¯·æ±‚å’Œå“åº”çš„ <code>å¤šè·¯å¤ç”¨</code> æ¥å‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚</p></li><li><p>é€šè¿‡å‹ç¼© <code>http</code> é¦–éƒ¨å­—æ®µå°†åè®®å¼€é”€é™è‡³æœ€ä½ã€‚</p></li><li><p>æ”¯æŒè¯·æ±‚ <code>ä¼˜å…ˆçº§</code>ã€‚</p></li><li><p><code>æœåŠ¡ç«¯æ¨é€</code> èƒ½åŠ›ã€‚</p></li></ul><h2 id="å¢å¼ºæ€§èƒ½çš„åŸå› "><a href="#å¢å¼ºæ€§èƒ½çš„åŸå› " class="headerlink" title="å¢å¼ºæ€§èƒ½çš„åŸå› "></a>å¢å¼ºæ€§èƒ½çš„åŸå› </h2><ul><li><h3 id="äºŒè¿›åˆ¶åˆ†å¸§å±‚"><a href="#äºŒè¿›åˆ¶åˆ†å¸§å±‚" class="headerlink" title="äºŒè¿›åˆ¶åˆ†å¸§å±‚"></a>äºŒè¿›åˆ¶åˆ†å¸§å±‚</h3></li></ul><p>åè®®å®šä¹‰äº†å¦‚ä½•å°è£… <code>http</code> çš„æ¶ˆæ¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ä¼ è¾“ã€‚<code>http1.x</code> æ˜¯ä»¥æ¢è¡Œç¬¦ä½œä¸ºçº¯ä¸ºæœ¬çš„åˆ†éš”ç¬¦ï¼Œè€Œ <code>http2.0</code> æ˜¯å°†ä¼ è¾“ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶ä¸”å¯¹å®ƒä»¬è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ã€‚æ‰€ä»¥åªæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶ç†è§£ <code>http2.0</code> çš„ä¸¤è€…æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚</p><p>  è¯´ä¸€ä¸‹ æµã€æ¶ˆæ¯ã€å¸§ä¹‹é—´çš„å…³ç³»ã€‚</p><ul><li><code>æµ</code>ï¼šåœ¨å·²ç»å»ºç«‹çš„è¿æ¥ä¸Šçš„åŒå‘å­—èŠ‚æµã€‚</li><li><code>æ¶ˆæ¯</code>ï¼šå®Œæ•´çš„ä¸€ç³»åˆ—çš„æ•°æ®å¸§ã€‚</li><li><code>å¸§</code>ï¼š <code>http2.0</code> ä¸­é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§åŒ…å«é¦–éƒ¨ï¼Œè‡³å°‘ä¼šæ ‡è¯†å‡ºå½“å‰çš„å¸§æ˜¯å±äºå“ªä¸ªæµã€‚</li></ul><p>ä¸²èµ·æ¥çš„ä¸€ä¸ªæµç¨‹å¤§æ¦‚å°±æ˜¯ï¼š <code>http2.0</code> åè®®è¿æ¥ä¹‹åï¼Œå¼€å§‹é€šä¿¡ï¼Œå…¶æ ¹æœ¬æ˜¯åœ¨ä¸€ä¸ª <code>tcp</code> çš„è¿æ¥ä¸Šå®Œæˆçš„æ•°æ®ä¼ è¾“ï¼Œåœ¨è¿™ä¸ªè¿æ¥ä¸Šï¼Œæ‰¿è½½ç€ä»»æ„æ•°é‡çš„<code>åŒå‘æ•°æ®æµ</code>ã€‚å…¶ä¸­æ¯ä¸€ä¸ªæ•°æ®æµéƒ½æ˜¯ä»¥æ¶ˆæ¯ã€æ¶ˆæ¯æŒ‡ä»£ <code>http</code> çš„ä¸€äº›åŠ¨ä½œï¼Œè¯·æ±‚ã€å“åº”ç­‰ã€‘çš„æ–¹å¼å‘é€çš„ï¼Œè€Œæ¶ˆæ¯å´æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§æ„æˆï¼Œå…¶ä¸­è¿™äº›å¸§éƒ½æ˜¯ä»¥<code>ä¹±åºå‘é€</code>çš„ï¼Œåœ¨æ¥å—å®Œæ•°æ®ä¹‹åï¼Œä¼šæ ¹æ®å¸§çš„é¦–éƒ¨æ ‡è¯†ç¬¦æ¥<code>é‡æ–°ç»„è£…</code>ã€‚</p><p>åˆ†æä¸€ä¸‹äºŒè¿›åˆ¶åˆ†å¸§ä¸­æœ€å¸¸è§çš„ä¸¤ç§å·¥ä½œæµï¼š</p><ul><li><h4 id="å‘èµ·æ–°æµ"><a href="#å‘èµ·æ–°æµ" class="headerlink" title="å‘èµ·æ–°æµ"></a>å‘èµ·æ–°æµ</h4><p>å»ºç«‹å®Œ <code>http2.0</code> çš„è¿æ¥ä¹‹åï¼Œåœ¨å‘èµ·æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æµæ¥æ‰¿è½½æ¶ˆæ¯ï¼Œæµä¸­éœ€è¦åŒ…å«èµ„æºçš„ä¼˜å…ˆçº§ã€ <code>http</code> é¦–éƒ¨ç­‰ä¿¡æ¯ã€‚ <code>http2.0</code> çš„è§„å®šï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥å‘èµ·æ–°æµï¼Œåªæ˜¯ä¸¤è€…çš„æ–¹å¼ä¸åŒã€‚</p><ul><li>å®¢æˆ·ç«¯å‘é€ <code>HEADERS</code> å¸§æ¥å‘èµ·æ–°æµï¼Œå…¶å‘èµ·çš„æµæ˜¯å…·æœ‰<code>å¥‡æ•°</code>çš„ <code>ID</code> ã€‚</li><li>æœåŠ¡ç«¯å‘é€ <code>PUSH_PROMISE</code> å¸§æ¥å‘èµ·æ¨æµï¼Œå…¶å‘èµ·çš„æµæ˜¯å…·æœ‰<code>å¶æ•°</code>çš„ <code>ID</code> ã€‚</li></ul><p>è¿™æ ·å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¯æ¬¡å‘é€æµæ—¶å€™éƒ½ä¼šé€’å¢ <code>ID</code> ï¼Œä¸¤ç«¯çš„æµå¹¶ä¸ä¼šå†²çªã€‚</p></li><li><h4 id="äº¤æ¢åº”ç”¨æ•°æ®"><a href="#äº¤æ¢åº”ç”¨æ•°æ®" class="headerlink" title="äº¤æ¢åº”ç”¨æ•°æ®"></a>äº¤æ¢åº”ç”¨æ•°æ®</h4><p>åˆ›å»ºå®Œæ–°æµå¹¶ä¸”å‘é€å®Œ <code>http</code> é¦–éƒ¨ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯å‘é€åº”ç”¨æ•°æ®ï¼Œæ•°æ®ä¸ä¼šè¢«å¦è¡Œç¼–ç æˆ–è€…å‹ç¼©ï¼Œç¼–ç æ–¹å¼å–å†³äºåº”ç”¨æˆ–è€…æœåŠ¡å™¨ï¼Œåœ¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæ¯å¸§çš„å¤§å°æœ€å¤šå¯ä»¥è¾¾åˆ° <code>2^16 - 1</code> å­—èŠ‚ï¼Œä½†æ˜¯ä¸ºäº†å‡å°‘é˜Ÿé¦–é˜»å¡ï¼Œ<code>http2.0</code> è¦æ±‚æ•°æ®ä¸èƒ½è¶…è¿‡ <code>2^14 - 1</code> ï¼Œå¦‚æœæ•°æ®è¶…å‡ºï¼Œå°±éœ€è¦åˆ†ä¸ºå¤šå¸§ä¼ è¾“ã€‚</p></li><li><h3 id="å¤šå‘è¯·æ±‚å’Œå“åº”"><a href="#å¤šå‘è¯·æ±‚å’Œå“åº”" class="headerlink" title="å¤šå‘è¯·æ±‚å’Œå“åº”"></a>å¤šå‘è¯·æ±‚å’Œå“åº”</h3></li></ul><p>åœ¨ <code>http1.x</code> ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯æƒ³å‘èµ·å¤šä¸ªå¹¶è¡Œçš„è¯·æ±‚ï¼Œé‚£å¿…é¡»æ‰“å¼€å¤šä¸ª <code>tcp</code> çš„è¿æ¥ï¼Œä½†æ˜¯å…¶ä¸­å¤šä¸ªå“åº”çš„å¯¼è‡´çš„æœ€ç›´æ¥çš„é—®é¢˜å°±æ˜¯æ’é˜Ÿï¼Œå¹¶ä¸”ä¼šå¯¼è‡´<code>é˜Ÿé¦–é˜»å¡</code>ï¼Œç»“æœå°±æ˜¯å¯¼è‡´ <code>tcp</code> çš„è¿æ¥æ•ˆç‡åº•ä¸‹ã€‚</p><p><code>http2.0</code> ä¸­äºŒè¿›åˆ¶åˆ†å¸§çªç ´äº†è¿™ä¸€äº›é™åˆ¶ï¼Œå…¶å®ç°äº†å¤šå‘è¯·æ±‚å’Œå“åº”ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥å°† <code>http</code> æ¶ˆæ¯åˆ†è§£ä¸ºäº’ä¸ä¾èµ–çš„å¸§ï¼Œç„¶åä¹±åºåœ¨è¿æ¥ä¸Šå‘é€ï¼Œæœ€åé‡æ–°ç»„åˆã€‚è¿™ä¸€å¢å¼ºå¸¦æ¥çš„æ˜¯å·¨å¤§çš„æ€§èƒ½æå‡ï¼Œå› ä¸ºå¤šä¸ªè¯·æ±‚å¹¶è¡Œä¸”äº’ä¸å½±å“ã€äº’ä¸å¹²æ‰°ã€åªéœ€è¦ä¸€ä¸ªè¿æ¥å°±å¯ä»¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€æ¶ˆé™¤äº† <code>http1.x</code> ä¸­ä¸å¿…è¦çš„å»¶è¿Ÿã€é˜Ÿé¦–é˜»å¡ä»¥åŠå¤šä¸ª <code>tcp</code> è¿æ¥æŠµæ•ˆçš„é—®é¢˜ã€‚åœ¨åŒç­‰çš„æƒ…å†µä¸‹ï¼Œ<code>http2.0</code> åªéœ€è¦ä¸€ä¸ª <code>tcp</code> è¿æ¥å°±å¯ä»¥å®ç°å¹¶è¡Œç­‰ï¼Œçœ‹ä¼¼å‡å°‘äº† <code>tcp</code> çš„è¿æ¥æ•°ï¼Œå…¶å®æœ€ç›´æ¥çš„æ˜¯å‡å°‘äº†æœåŠ¡ç«¯çš„ <code>cpu</code> å’Œå†…å­˜çš„æ¶ˆè€—ã€‚</p><ul><li><h3 id="è¯·æ±‚ä¼˜å…ˆçº§"><a href="#è¯·æ±‚ä¼˜å…ˆçº§" class="headerlink" title="è¯·æ±‚ä¼˜å…ˆçº§"></a>è¯·æ±‚ä¼˜å…ˆçº§</h3></li></ul><p>æ¯ä¸€ä¸ªåœ¨è¿æ¥ä¸Šä¼ è¾“çš„æµéƒ½å¸¦æœ‰ä¸€ä¸ª <code>31</code> æ¯”ç‰¹çš„ä¼˜å…ˆå€¼ï¼Œå…¶ä¸­ <code>0</code> æœ€å¤§ï¼Œ<code>2^31 - 1</code> æœ€å°ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ ¹æ®å®¢æˆ·ç«¯èµ„æºè¯·æ±‚çš„ä¼˜å…ˆçº§æ¥<code>æ§åˆ¶èµ„æºçš„åˆ†é…</code>ï¼ˆ<code>cpu</code>ã€å†…å­˜ã€å¸¦å®½ï¼‰ï¼Œåœ¨æ•°æ®å‡†å¤‡å¥½ä¹‹åï¼Œå°†ä¼˜å…ˆçº§æœ€é«˜çš„æ•°æ®å…ˆå‘é€ç»™å®¢æˆ·ç«¯ã€‚åœ¨å®¢æˆ·ç«¯æ˜ç¡®è®¾ç½®å¥½å„ç§èµ„æºçš„ä¼˜å…ˆçº§ä¹‹åï¼ŒæœåŠ¡ç«¯åº”è¯¥æŒ‰ç…§ä¼˜å…ˆçº§è¦æ±‚å°†èµ„æºä¾æ¬¡è¿”å›ï¼Œè¿™æ ·æ’é˜Ÿçš„é—®é¢˜åŸºæœ¬ä¸Šå°±ä¼šè§£å†³æ‰ã€‚</p><ul><li><h3 id="ä¸€ä¸ªè¿æ¥"><a href="#ä¸€ä¸ªè¿æ¥" class="headerlink" title="ä¸€ä¸ªè¿æ¥"></a>ä¸€ä¸ªè¿æ¥</h3></li></ul><p><code>http2.0</code> çš„æ‰€æœ‰ä¼ è¾“éƒ½æ˜¯åœ¨ä¸€ä¸ª <code>tcp</code> çš„è¿æ¥ä¸Šå®Œæˆï¼Œå¤§å¤šæ•°çš„ <code>http</code> è¿æ¥éƒ½æ˜¯çªå‘å¹¶ä¸”çŸ­æš‚ï¼Œä½†æ˜¯å› ä¸º <code>tcp</code> çš„<code>æ…¢å¯åŠ¨</code>ä»¥åŠ<code>æµé‡æ‹¥å¡çª—å£</code>å¯¼è‡´åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´ä¹‹åæ‰ä¼šå¾ˆå¥½çš„åˆ©ç”¨å¸¦å®½ï¼Œæ•ˆç‡å˜é«˜ã€‚è€Œ <code>http2.0</code> ä»å¤´åˆ°å°¾çš„ä¸€ä¸ªè¿æ¥å¯ä»¥æœ€å¤§åŒ–å’Œæ›´æœ‰æ•ˆçš„ä½¿ç”¨ <code>tcp</code> çš„è¿æ¥ã€å‡å°‘ç½‘ç»œå»¶è¿Ÿã€æé«˜ååé‡ç­‰ã€‚</p><ul><li><h3 id="æµé‡æ§åˆ¶"><a href="#æµé‡æ§åˆ¶" class="headerlink" title="æµé‡æ§åˆ¶"></a>æµé‡æ§åˆ¶</h3></li></ul><p>åœ¨ <code>http2.0</code> è¿æ¥å»ºç«‹ä¹‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼š<code>äº¤æ¢å¸§</code>ï¼Œå…¶ç›®çš„æ˜¯è®¾ç½®åŒå‘çš„æµé‡<code>æ§åˆ¶çª—å£çš„å¤§å°</code>ï¼Œä»è€Œæ§åˆ¶æµå ç”¨çš„èµ„æºï¼Œæ¥æ”¶æ–¹é’ˆå¯¹ç‰¹å®šçš„æµåŠ¨æ€è°ƒæ•´çª—å£å¤§å°æ¥é™åˆ¶æˆ–è€…æé«˜ä¼ è¾“é€Ÿåº¦ã€‚</p><ul><li><h3 id="æœåŠ¡ç«¯æ¨é€"><a href="#æœåŠ¡ç«¯æ¨é€" class="headerlink" title="æœåŠ¡ç«¯æ¨é€"></a>æœåŠ¡ç«¯æ¨é€</h3></li></ul><p>é¡¾åæ€ä¹‰ï¼ŒæœåŠ¡ç«¯å¯ä»¥ç›´æ¥å‘å®¢æˆ·ç«¯å‘é€å“åº”ï¼Œåœ¨ä¸Šè¾¹çš„æµé‡æ§åˆ¶ä¸­ï¼Œäº¤æ¢å¸§ä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ° <code>PUSH_PROMISE</code> çš„å¸§ï¼Œå®¢æˆ·ç«¯å¯ä»¥è§†è‡ªå·±éœ€æ±‚æ¥å¤„ç†ï¼Œé™å®šæ¨é€æµçš„æ•°é‡æˆ–è€…è®¾ç½® <code>0</code> ç¦æ­¢æœåŠ¡ç«¯æ¨é€ã€‚å¦‚æœæœåŠ¡ç«¯å·²ç»é¢„å…ˆçŸ¥é“äº†å®¢æˆ·ç«¯å³å°†éœ€æ±‚è¯·æ±‚ä»€ä¹ˆèµ„æºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥æ¨é€ç»™å®¢æˆ·ç«¯èµ„æºæå‰åŠ è½½ï¼Œå‡å°‘åœ¨éœ€æ±‚çš„æ—¶å€™è¯·æ±‚å¸¦æ¥çš„å»¶è¿Ÿã€‚å¹¶ä¸”æœåŠ¡ç«¯æ¨é€è¿‡æ¥çš„æ•°æ®æ˜¯å¯ä»¥<code>ç›´æ¥è¿›è¡Œç¼“å­˜</code>çš„ã€‚ä½†æ˜¯æœåŠ¡ç«¯æ¨é€çš„ç¼ºç‚¹ï¼Œå…¶è¦éµå®ˆ <code>è¯·æ±‚-å“åº”</code> çš„é¡ºåºï¼Œä¸èƒ½éšæ„çš„å‘èµ·æ¨é€ï¼Œå¹¶ä¸” <code>PUSH_PROMISE</code> çš„å¸§å¿…é¡»åœ¨è¿”å›å“åº”ä¹‹å‰å‘é€ï¼Œé¿å…å‡ºç°ç«æ€æ¡ä»¶å‡ºç°æµªè´¹èµ„æºçš„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ç¡®ä¿å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸æ­£å¥½æ˜¯æœåŠ¡ç«¯æ¨é€çš„å°±è¡Œã€‚</p><ul><li><h3 id="é¦–éƒ¨å‹ç¼©"><a href="#é¦–éƒ¨å‹ç¼©" class="headerlink" title="é¦–éƒ¨å‹ç¼©"></a>é¦–éƒ¨å‹ç¼©</h3></li></ul><p><code>http1.x</code> æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦æºå¸¦å¤´éƒ¨çš„å…ƒæ•°æ®ï¼Œå†åŠ ä¸Šä¸€ä¸ª <code>cookie</code> ä¿¡æ¯ï¼Œä»…ä¸€æ¬¡è¯·æ±‚ä¸æºå¸¦åˆ«çš„æ•°æ®ï¼Œå›ºå®šè·è½½å°±å¯èƒ½ä¼šæ¥è¿‘ä¸Šåƒå­—èŠ‚ï¼Œä¸ºäº†å‡å°‘è¿™ä¸ªå¼€é”€ï¼Œ<code>http2.0</code> è¿›è¡Œäº†é¦–éƒ¨å…ƒæ•°æ®çš„å‹ç¼©ã€‚å…·ä½“çš„å°±æ˜¯ï¼Œæ¯æ¬¡çš„å‘é€ï¼Œå¯¹äºç›¸åŒçš„æ•°æ®ä¸å†å‘é€ï¼Œ<code>http2.0</code> çš„é¦–éƒ¨åœ¨ä¸€ä¸ªè¿æ¥å†…æŒç»­å­˜åœ¨ï¼Œå¹¶ä¸”ä¿¡æ¯æ˜¯ç”±åŒç«¯å…±åŒæ›´æ–°ã€‚å¦‚æœæœ‰æ–°çš„é¦–éƒ¨é”®å€¼å¯¹ï¼Œè¦ä¹ˆåœ¨å°¾éƒ¨è¿½åŠ ï¼Œè¦ä¹ˆå°±æ˜¯æ›¿æ¢ä¹‹å‰çš„ã€‚æ‰€ä»¥ä¸‹ä¸€æ¬¡çš„è¯·æ±‚å‘èµ·ä¹‹å‰ï¼Œå¦‚æœå‘ç°é¦–éƒ¨æ²¡å˜åŒ–ï¼Œå°±ä¸ä¼šå†å‘é€é¦–éƒ¨ï¼Œè¿™ä¼šæå¤§å‡å°‘è¯·æ±‚æºå¸¦æ•°æ®çš„å¼€é”€ã€‚ä¸¾ä¾‹ï¼š <code>http1.x</code> çš„è½®è®­ï¼Œæ¯æ¬¡è¯·æ±‚å›ºå®šçš„å¤´éƒ¨å¼€é”€å¯èƒ½å›åˆ° <code>800k</code> ï¼Œè€Œ <code>http2.0</code> ä¹‹åï¼Œå¯èƒ½ç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶å€™ä¼šå‘é€å¤´éƒ¨æ•°æ®ï¼Œä¹‹åçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šå†å‘é€ï¼Œå› ä¸ºåè¾¹çš„é¦–éƒ¨éƒ½æ˜¯è‡ªåŠ¨ä½¿ç”¨ä¹‹å‰è¯·æ±‚å‘é€çš„é¦–éƒ¨ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>http2.0</tag>
      
      <tag>webæ€§èƒ½æƒå¨æŒ‡å—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ç° JavaScript ä¸­çš„ new å’Œ instanceof</title>
    <link href="/2021/03/06/showMeCode-1/"/>
    <url>/2021/03/06/showMeCode-1/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹è‡ªå·±ç†è§£çš„ <code>new</code> å’Œ <code>instanceof</code>ï¼Œå®ç°ä¸€éåŠ æ·±ç†è§£å’Œè®°å¿†ã€‚</p><h2 id="new-æ“ä½œç¬¦"><a href="#new-æ“ä½œç¬¦" class="headerlink" title="new æ“ä½œç¬¦"></a><code>new</code> æ“ä½œç¬¦</h2><p>å…ˆä»ä¸€ä¸ªä¾‹å­ä¸­çœ‹ <code>new</code> æ“ä½œç¬¦åšäº†ä»€ä¹ˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name</span>) </span>&#123;<br>  <span class="hljs-keyword">this</span>.name = name<br>&#125;<br><br><span class="hljs-comment">// ä¸ºæ„é€ å‡½æ•°åŸå‹ä¸Šå¢åŠ ä¸€ä¸ªæ–¹æ³•</span><br>Person.prototype.say = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-keyword">this</span>.name&#125;</span>å·²ç»åƒäº†æ™šé¥­ğŸ¥£`</span>)<br>&#125;<br><br><span class="hljs-keyword">const</span> personName = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">'å¼ ä¸‰'</span>)<br><br>personName.name <span class="hljs-comment">// å¼ ä¸‰</span><br>personName.say() <span class="hljs-comment">// å¼ ä¸‰å·²ç»åƒäº†æ™šé¥­ğŸ¥£</span><br><br>personName.__proto__ === Person.prototype <span class="hljs-comment">// true</span><br><span class="hljs-built_in">Object</span>.getPrototypeOf(personName) === Person.prototype <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><p>åˆ†æï¼šé¦–å…ˆå®ä¾‹çš„ <code>.</code> è®¿é—®çš„ç‰¹æ€§å¯ä»¥çŸ¥é“ <code>new</code> æœ€ç»ˆ <code>return</code> çš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œå› æ­¤éœ€è¦åšä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœåŸæ¥æ„é€ å‡½æ•°æœ‰ <code>Object</code> ç±»å‹çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬æ˜¯ä¸å¯ä»¥åŠ¨çš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸æ˜¯ <code>Object</code> ç±»å‹çš„ç±»å‹çš„è¯å°±è¦è¿”å›æˆ‘ä»¬æ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡ï¼Œä½œä¸ºåœ¨åŸæ¥æ„é€ å‡½æ•°æ²¡æœ‰ <code>Object</code> ç±»å‹çš„æƒ…å†µä¸‹çš„è¿”å›å€¼ã€‚ç„¶åå‘ç°å®ä¾‹å…·æœ‰ä¸€äº›å¯ä»¥è®¿é—®æ„é€ å‡½æ•°çš„ <code>prototype</code> çš„èƒ½åŠ›ï¼Œè€Œä¸”æ˜¯å…·æœ‰å‚æ•°çš„ç»‘å®šï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“å®ä¾‹çš„ <code>__proto__</code> ç­‰äºæ„é€ å‡½æ•°çš„ <code>prototype</code>ã€‚</p><p>å¤§æ¦‚å®ç°åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myNew</span>(<span class="hljs-params">Fn, ...args</span>) </span>&#123;<br>  <span class="hljs-comment">// åˆ›å»ºä»¥å¤‡è¿”å›çš„ç©ºå¯¹è±¡</span><br>  <span class="hljs-keyword">const</span> obj = &#123;&#125;<br>  <span class="hljs-comment">// è¿›è¡ŒåŸå‹å…³ç³»ä»¥åŠå‚æ•°çš„ç»‘å®š</span><br>  obj.__proto__ = Fn.prototype<br>  <span class="hljs-comment">// æˆ–è€… Object.getPrototypeOf(obj) = Fn.prototype</span><br><br>  <span class="hljs-keyword">const</span> result = Fn.apply(obj, args)<br><br>  <span class="hljs-keyword">const</span> isObject = <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span> &amp;&amp; result !== <span class="hljs-string">'null'</span><br><br>  <span class="hljs-keyword">return</span> isObject ? result : obj <br>&#125;<br></code></pre></td></tr></table></figure><p>éªŒè¯ä¸€ä¸‹æ­£ç¡®æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name</span>) </span>&#123;<br>  <span class="hljs-keyword">this</span>.name = name<br>&#125;<br><br>Person.prototype.say = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-keyword">this</span>.name&#125;</span>å·²ç»åƒäº†æ™šé¥­ğŸ¥£`</span>)<br>&#125;<br><br><span class="hljs-keyword">const</span> personName = myNew(Person, <span class="hljs-string">'è‰è‰ä¸'</span>)<br>personName.name <span class="hljs-comment">// è‰è‰ä¸</span><br>personName.say() <span class="hljs-comment">// è‰è‰ä¸å·²ç»åƒäº†æ™šé¥­ğŸ¥£</span><br><br>personName.__proto__ === Person.prototype <span class="hljs-comment">// true</span><br><span class="hljs-built_in">Object</span>.getPrototypeOf(personName) === Person.prototype <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><h2 id="instanceof-æ“ä½œç¬¦"><a href="#instanceof-æ“ä½œç¬¦" class="headerlink" title="instanceof æ“ä½œç¬¦"></a><code>instanceof</code> æ“ä½œç¬¦</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ <code>instanceof</code> æ“ä½œç¬¦æ˜¯å¯ä»¥åˆ¤æ–­ä¸€ä¸ªæ•°æ®çš„ç±»å‹ï¼Œä½†æ˜¯åªèƒ½åˆ¤æ–­éç®€å•çš„æ•°æ®ç±»å‹ï¼Œç»§ç»­ä»¥ä¸€ä¸ªä¾‹å­æ¥çœ‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> obj = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span><br>&#125; <span class="hljs-comment">// new Object</span><br><span class="hljs-keyword">const</span> arr = [<span class="hljs-string">'å¼ ä¸‰'</span>] <span class="hljs-comment">// new Array</span><br><span class="hljs-keyword">const</span> time = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()<br><br>obj <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span> <span class="hljs-comment">// true</span><br>obj <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span> <span class="hljs-comment">// false</span><br>arr <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> <span class="hljs-comment">// true</span><br>time <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span> <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><p>åˆ†æï¼šå¯ä»¥ä»ä¸Šé¢çš„ä¾‹å­å‘ç°ï¼Œæ“ä½œç¬¦å³è¾¹çš„å°±æ˜¯æ„é€ å‡½æ•°ï¼Œå·¦è¾¹å°±æ˜¯æ„é€ å‡½æ•°çš„å®ä¾‹ï¼Œè€Œæ„é€ å‡½æ•°å’Œå®ä¾‹ä¹‹é—´çš„å…³ç³»å³å°±æ˜¯ <code>instance.__proto__ === Fn.prototype</code>ï¼Œä½†æ˜¯æ ¹æ®ä½œç”¨åŸŸé“¾çš„å°±è¿‘åŸåˆ™ä¸èƒ½ä¿è¯å°±è¿‘èƒ½æ‰¾åˆ°å¯¹åº”çš„å…³ç³»é“¾æ‰€ä»¥å¿…é¡»è¦ä¸€æ­¥ä¸€æ­¥å¾€åŸå‹é“¾ä¸Šæ‰¾ï¼Œæ‰¾åˆ°çš„è¯å°±å¯ä»¥è¿”å› <code>true</code>ï¼Œæˆ‘ä»¬çŸ¥é“åŸå‹é“¾çš„é¡¶ç«¯ä¸º <code>null</code>ï¼Œå½“ä¸º <code>null</code> çš„æ—¶å€™å³æ²¡æ‰¾åˆ°åº”è¯¥è¿”å› <code>false</code>ã€‚</p><p>å…·ä½“å®ç°ï¼š</p><ul><li>è¿­ä»£ç‰ˆ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myInstanceof</span>(<span class="hljs-params">left, right</span>) </span>&#123;<br>  <br>  <span class="hljs-comment">// æ ¹æ® instanceof çš„ç‰¹æ€§å¯ä»¥çŸ¥é“ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹åº”è¯¥ç›´æ¥è¿”å›false</span><br>  <span class="hljs-keyword">const</span> isObject = <span class="hljs-keyword">typeof</span> left === <span class="hljs-string">'object'</span> &amp;&amp; left !== <span class="hljs-string">'null'</span><br>  <span class="hljs-keyword">if</span>(!isObject) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br><br>  <span class="hljs-keyword">let</span> proto = <span class="hljs-built_in">Object</span>.getPrototypeOf(left)<br>  <span class="hljs-comment">// æˆ–è€… let proto = left.__proto__</span><br><br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-comment">// ä¸€ç›´æŸ¥æ‰¾åˆ°åŸå‹é“¾çš„é¡¶ç«¯</span><br>    <span class="hljs-keyword">if</span>(proto == <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br><br>    <span class="hljs-comment">// å³ instance.__proto__ === Fn.prototype</span><br>    <span class="hljs-keyword">if</span>(proto == right.prototype) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br><br>    <span class="hljs-comment">// æ¯æ¬¡å¾ªç¯éƒ½å°†å€¼é‡æ–°è®¾ç½®</span><br>    proto = <span class="hljs-built_in">Object</span>.getPrototypeOf(proto)<br>    <span class="hljs-comment">// æˆ–è€… proto = proto.__proto__;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é€’å½’ç‰ˆ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myInstanceof</span>(<span class="hljs-params">left, right</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> left !== <span class="hljs-literal">null</span> &amp;&amp; (<span class="hljs-built_in">Object</span>.getPrototypeOf(left) === right.prototype || myInstanceof(left, right))<br>&#125;<br></code></pre></td></tr></table></figure><p>éªŒè¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> obj1 = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span><br>&#125; <span class="hljs-comment">// new Object</span><br><span class="hljs-keyword">var</span> arr1 = [<span class="hljs-string">'å¼ ä¸‰'</span>] <span class="hljs-comment">// new Array</span><br><span class="hljs-keyword">var</span> time1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()<br><br><span class="hljs-built_in">console</span>.log(obj1 <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span>, arr1 <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>, time1 <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span>)<br><span class="hljs-comment">// false true true</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTP ç¼“å­˜æ¢ç©¶</title>
    <link href="/2021/03/01/httpCache/"/>
    <url>/2021/03/01/httpCache/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å›é¡¾ç¼“å­˜çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œå…ˆåˆ—å‡ºæµè§ˆå™¨è¯»å–ç¼“å­˜è¿‡ç¨‹ä¼šæ¶‰åŠåˆ°åˆ°çš„ä¸€äº›ä¸œè¥¿ã€‚</p><h2 id="DNS-ç¼“å­˜æŸ¥è¯¢è¿‡ç¨‹"><a href="#DNS-ç¼“å­˜æŸ¥è¯¢è¿‡ç¨‹" class="headerlink" title="DNS ç¼“å­˜æŸ¥è¯¢è¿‡ç¨‹"></a><code>DNS</code> ç¼“å­˜æŸ¥è¯¢è¿‡ç¨‹</h2><p><code>DNS</code> ç¼“å­˜çš„ç›®çš„ä¸»è¦æ˜¯é™ä½åŸŸåè§£æçš„æ—¶é—´å»¶è¿Ÿï¼Œæœ€ç»ˆè§£ææˆåŠŸä¹‹åï¼Œå°†æ‰€æ˜ å°„çš„ <code>IP</code> è¿”å›ç»™æµè§ˆå™¨ï¼Œå¹¶ä¸”äºæœ¬åœ°ç³»ç»Ÿè¿›è¡Œç¼“å­˜ï¼Œè¿‡ç¨‹æ˜¯é€’å½’çš„ã€‚</p><ul><li><p>æµè§ˆå™¨ä¼šæ£€æŸ¥æµè§ˆå™¨ç¼“å­˜ä¸­æœ‰æ²¡æœ‰è¿™ä¸ªåŸŸåå¯¹åº”çš„è§£æè¿‡çš„ <code>IP</code> åœ°å€ã€‚</p></li><li><p>å¦‚æœç”¨æˆ·æµè§ˆå™¨ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œæµè§ˆå™¨ä¼šæŸ¥æ‰¾æ“ä½œç³»ç»Ÿç¼“å­˜ <code>hosts</code> æ–‡ä»¶ä¸­æ˜¯å¦æœ‰è¿™ä¸ªåŸŸåå¯¹åº”çš„ <code>DNS</code> è§£æçš„ <code>IP</code> ç»“æœã€‚</p></li><li><p>å¦‚æœ <code>hosts</code> ä¹Ÿæ²¡å‘½ä¸­ï¼Œåˆ™å‘æœ¬åœ° <code>DNS</code> æœåŠ¡å™¨å°è¯•å‘èµ·è§£æè¯·æ±‚ã€‚</p></li><li><p>å¦‚æœæœ¬åœ° <code>DNS</code> æœåŠ¡å™¨æ²¡å‘½ä¸­ï¼Œåˆ™å‘æ ¹ <code>DNS</code> æœåŠ¡å™¨å‘èµ·è§£æè¯·æ±‚ã€‚</p></li></ul><h2 id="CDN-ç¼“å­˜"><a href="#CDN-ç¼“å­˜" class="headerlink" title="CDN ç¼“å­˜"></a><code>CDN</code> ç¼“å­˜</h2><p>å½“æ¥å…¥ <code>CDN</code> ä¹‹åï¼Œ<code>CDN</code> èŠ‚ç‚¹å…·æœ‰ç¼“å­˜æœºåˆ¶ã€‚å½“å®¢æˆ·ç«¯å‘ <code>CDN</code> èŠ‚ç‚¹è¯·æ±‚æ•°æ®æ—¶ï¼Œ<code>CDN</code> ä¼šåˆ¤æ–­ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œè‹¥æ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥å°†ç¼“å­˜æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¦åˆ™å°±å‘æºç«™ç‚¹å‘å‡ºè¯·æ±‚ï¼Œä»æºç«™ç‚¹æ‹‰å–æœ€æ–°æ•°æ®ï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œå¹¶å°†æœ€æ–°æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><h3 id="ä¸æ¥å…¥-CDN"><a href="#ä¸æ¥å…¥-CDN" class="headerlink" title="ä¸æ¥å…¥ CDN"></a>ä¸æ¥å…¥ <code>CDN</code></h3><ul><li>è¾“å…¥åŸŸåä¹‹åï¼Œæµè§ˆå™¨å‘ <code>DNS</code> æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œèµ° <code>DNS</code> è§£æçš„è¿‡ç¨‹ï¼Œæ‹¿åˆ° <code>IP</code> ä¹‹åç›´æ¥å‘å¯¹åº”çš„ <code>IP</code> çš„æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œä»æºç«™ç‚¹æ‹‰å–æœ€æ–°æ•°æ®ï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œå¹¶å°†æœ€æ–°æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul><h3 id="æ¥å…¥-CDN"><a href="#æ¥å…¥-CDN" class="headerlink" title="æ¥å…¥ CDN"></a>æ¥å…¥ <code>CDN</code></h3><ul><li><p><code>CDN</code> ç¼“å­˜ä¸è¿‡æœŸ</p><ul><li>å½“æµè§ˆå™¨æœ¬åœ°ç¼“å­˜çš„èµ„æºè¿‡æœŸä¹‹åï¼Œå…¶ä¸æ˜¯ç›´æ¥å‘æºç«™ç‚¹è¯·æ±‚èµ„æºï¼Œè€Œæ˜¯å‘ <code>CDN</code> è¾¹ç¼˜èŠ‚ç‚¹è¯·æ±‚èµ„æºï¼Œè¯·æ±‚è½åœ¨ <code>CDN</code> è¿™é‡Œçš„æ—¶å€™ï¼Œå› ä¸º <code>CDN</code> è¾¹ç¼˜èŠ‚ç‚¹ä¸­å­˜åœ¨ç¼“å­˜ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨ <code>CDN</code> ä¸­çš„ç¼“å­˜ã€‚</li></ul></li><li><p><code>CDN</code> ç¼“å­˜è¿‡æœŸ</p><ul><li>è‹¥ <code>CDN</code> ä¸­çš„ç¼“å­˜ä¹Ÿè¿‡æœŸï¼Œ<code>CDN</code> èŠ‚ç‚¹ä¼šå‘æºæœåŠ¡å™¨å‘å‡ºå›æºè¯·æ±‚ï¼Œä»æœåŠ¡å™¨æ‹‰å–æœ€æ–°æ•°æ®ï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œå¹¶å°†æœ€æ–°æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul></li></ul><h2 id="æµè§ˆå™¨ç¼“å­˜"><a href="#æµè§ˆå™¨ç¼“å­˜" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜"></a>æµè§ˆå™¨ç¼“å­˜</h2><h3 id="å¼ºç¼“å­˜"><a href="#å¼ºç¼“å­˜" class="headerlink" title="å¼ºç¼“å­˜"></a>å¼ºç¼“å­˜</h3><p>å±äºæœ¬åœ°ç¼“å­˜ï¼Œå› ä¸ºè¦ä¹ˆå°±æ˜¯ç¡¬ç›˜ç¼“å­˜è¦ä¹ˆå°±æ˜¯å†…å­˜ç¼“å­˜ï¼Œå…¶ä¸­ä¼˜å…ˆçº§ <code>Cache-Control</code> é«˜äº <code>Expires</code>ï¼Œå¹¶ä¸”ä¸€æ—¦å‘½ä¸­åˆ™ä¸ä¼šå‘æœåŠ¡ç«¯å‘èµ·ä»»ä½•è¯·æ±‚ã€‚</p><ul><li><p><code>Expires</code></p><ul><li><code>HTTP1.0</code> çš„äº§ç‰©ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´ä¸å‡†ç¡®ã€‚</li></ul></li><li><p><code>Cache-Control</code></p><ul><li><p><code>public</code> è®¤ä¸ºéƒ½å¯ä»¥ç¼“å­˜</p></li><li><p><code>private</code> è®¤ä¸ºéƒ½å¯ä»¥ç¼“å­˜</p></li><li><p><code>no-cache</code> å®¢æˆ·ç«¯ç¼“å­˜å†…å®¹ï¼Œæ˜¯å¦ä½¿ç”¨ç¼“å­˜åˆ™éœ€è¦ç»è¿‡åå•†ç¼“å­˜æ¥éªŒè¯å†³å®šï¼Œæ‰€ä»¥ä½¿ç”¨ <code>Etag</code> æˆ–è€… <code>Last-Modified</code> å­—æ®µæ¥æ§åˆ¶ç¼“å­˜</p></li><li><p><code>no-store</code> ä¸ä½¿ç”¨ç¼“å­˜</p></li><li><p><code>max-age</code> æ‰€æœ‰çš„ç¼“å­˜ä¼šåœ¨è®¾ç½®çš„ç§’æ•°ä¹‹åå¤±æ•ˆ</p></li></ul></li><li><p>å‘½ä¸­æƒ…å†µ</p><p>å½“åšäº†æœ‰æ•ˆç¼“å­˜ç­–ç•¥ä¹‹åï¼Œç½‘ç«™ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™è·å–çš„æ•°æ®æ˜¯å…ˆä»æœåŠ¡å™¨ <code>200</code> è¯·æ±‚ï¼Œå†å› ä¸ºè®¾ç½®ç¼“å­˜ç­–ç•¥ï¼Œå…³æ‰é¡µé¢ï¼Œå†æ‰“å¼€ï¼Œæ•°æ®å†è¯»å–çš„ç¼“å­˜è·å–æ˜¯ä» <code>disk</code> åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥é‡æ–°æ‰“å¼€çš„ç¬¬ä¸€æ¬¡æ˜¯ <code>from disk cache</code>ã€‚</p><p>å½“é‡æ–°ç¬¬ä¸€æ¬¡æ‰“å¼€åŠ è½½æˆåŠŸä¹‹åçš„ç¼“å­˜æ˜¯ <code>from disk cache</code> å¹¶ä¸”è¢«åŠ è½½åˆ°äº†å†…å­˜é‡Œï¼Œåˆ·æ–°é¡µé¢ï¼Œå› ä¸ºå†…å­˜è¯»å–çš„ä¼˜å…ˆçº§é«˜äºç¡¬ç›˜ï¼Œæ‰€ä»¥åˆ·æ–°ä¹‹åçš„ç¼“å­˜è¯»å–æ¥æºæ˜¯ <code>from memory cache</code>ã€‚</p><ul><li><p><code>from disk cache</code></p><ul><li>æŒä¹…ã€ç›¸æ¯”å†…å­˜æ…¢ã€è¯»å–ä¼˜å…ˆçº§ä½äºå†…å­˜</li></ul></li><li><p><code>from memory cache</code></p><ul><li>éæŒä¹…ã€å¿«ã€è¯»å–ä¼˜å…ˆçº§é«˜äºç¡¬ç›˜</li></ul></li></ul></li></ul><h3 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h3><p>å½“å¼ºç¼“å­˜æœªå‘½ä¸­ä¹‹åï¼Œæˆ–è€…å½“å¼ºç¼“å­˜çš„ <code>Cache-Control</code> çš„å€¼è®¾ç½®ä¸º <code>no-cache</code> çš„æ—¶å€™ï¼Œæ ¹æ® <code>1.1</code> ä¸­çš„ <code>ETag</code> ä¼˜å…ˆçº§é«˜äº <code>Last-Modified</code> ä»è€Œå‘èµ·åå•†ç¼“å­˜ã€‚</p><p>å³ä¾¿å¦‚æ­¤ï¼Œå‘èµ·åå•†ç¼“å­˜åœ¨æœ‰æ²¡æœ‰æ¥å…¥ <code>CDN</code> çš„æ—¶å€™ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µã€‚</p><p>å…ˆè¯´ <code>HTTP</code> è¯·æ±‚å’Œç›¸åº”å¤´ï¼š</p><ul><li><p><code>HTTP1.0</code></p><ul><li><p><code>Last-Modified</code></p><ul><li>å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šåœ¨å“åº”å¤´å¢åŠ  <code>Last-Modified</code> çš„ <code>header</code> å­—æ®µæ¥å‘ŠçŸ¥æµè§ˆå™¨å¯¹åº”çš„æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚</li></ul></li><li><p><code>If-Modified-Since</code></p><ul><li>ä¸‹ä¸€æ¬¡è¯·æ±‚è¿™ä¸ªèµ„æºï¼Œæµè§ˆå™¨æ£€æµ‹åˆ°æœ‰ <code>Last-Modified</code> è¿™ä¸ª <code>header</code>ï¼Œäºæ˜¯åœ¨è¯·æ±‚å¤´æ·»åŠ  <code>If-Modified-Since</code> è¿™ä¸ª <code>header</code>ï¼Œå®ƒçš„å†…å®¹å°±æ˜¯ç¬¬ä¸€æ¬¡ <code>Last-Modified</code> è¿”å›çš„æ•°æ®ã€‚</li><li>å½“æœåŠ¡å™¨æ”¶åˆ°ä¹‹åä¼šç”¨è¿™ä¸ªå€¼å’ŒæœåŠ¡å™¨ä¸Šä¿å­˜çš„æœ€åä¸€æ¬¡æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´åšå¯¹æ¯”ï¼Œå¦‚æœå‘½ä¸­ï¼Œåˆ™è¿”å› <code>304</code>ï¼Œå‘ŠçŸ¥æµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå¦åˆ™è¿”å› <code>200</code>ï¼Œå¹¶ä¸”éœ€è¦æ›´æ–° <code>Last-Modified</code> çš„å€¼ï¼Œå¹¶ä¸”ä¸€åŒè¿”å›èµ„æºã€‚</li></ul></li></ul></li><li><p><code>HTTP1.1</code></p><ul><li><p><code>ETag</code></p><ul><li><code>Etag</code> æ˜¯æœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œåœ¨å“åº”å¤´è¿”å›å½“å‰èµ„æºæ–‡ä»¶çš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†(ç”±æœåŠ¡å™¨ç”Ÿæˆ)ï¼Œåªè¦èµ„æºæœ‰å˜åŒ–ï¼Œ<code>Etag</code> å°±ä¼šé‡æ–°ç”Ÿæˆï¼Œå¤§ä½“ç±»ä¼¼æ–‡ä»¶ <code>diff</code> ä¹‹åç”Ÿæˆçš„ä¸€ä¸ª <code>hash</code> å€¼ã€‚</li></ul></li><li><p><code>If-None-Match</code></p><ul><li>ä¸‹ä¸€æ¬¡è¯·æ±‚è¿™ä¸ªèµ„æºï¼Œæµè§ˆå™¨ä¼šå°†ä¸Šæ¬¡ <code>ETag</code> è¿”ä¼šçš„å†…å®¹ï¼Œé€šè¿‡ <code>If-None-Match</code> çš„è¯·æ±‚å¤´ä¼ é€’ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°ä¹‹åä¼šç”¨è¿™ä¸ªå’ŒæœåŠ¡å™¨ä¸Šå­˜çš„æ–‡ä»¶æœ€åä¸€æ¬¡å˜åŠ¨ç”Ÿæˆçš„ <code>ETag</code> çš„å€¼åšå¯¹æ¯”ï¼Œå¦‚æœä¸¤ä¸ªç›¸åŒåˆ™è¿”å› <code>304</code>ï¼Œå‘ŠçŸ¥æµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå¦åˆ™è¿”å› <code>200</code>ï¼Œå¹¶ä¸”éœ€è¦æ›´æ–° <code>ETag</code> çš„å€¼ï¼Œå¹¶ä¸”ä¸€åŒè¿”å›èµ„æºã€‚</li></ul></li></ul></li></ul><p>æ‰€ä»¥æ±‡æ€»ä¸€ä¸‹æµè§ˆå™¨è¯»å–ç¼“å­˜æ•´ä½“çš„ä¸€ä¸ªæµç¨‹ï¼Œåœ¨æ¥å…¥äº† <code>CDN</code> ä¹‹åå’Œä¸æ¥å…¥ <code>CDN</code> çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥æè¿°ä¸€ä¸‹ï¼š</p><ul><li><p>æ¥å…¥ <code>CDN</code> ä¹‹åï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ä¸€ä¸ª <code>URL</code> ä¹‹åï¼Œæµè§ˆå™¨ä¼šå…ˆå»æ ¹æ®è¯·æ±‚å¤´æ¥ç¡®å®šå½“å‰çš„å¼ºç¼“å­˜çš„æ—¶æ•ˆæ€§ï¼Œå¦‚æœæœªå¤±æ•ˆï¼Œåˆ™ä¼šå»è¯»å–æœ¬åœ°ç¼“å­˜ï¼Œè‡³äºè¯»å– <code>disk</code> è¿˜æ˜¯ <code>momery</code>ï¼Œéœ€è¦çœ‹ç”¨æˆ·çš„è¡Œä¸ºã€‚å¦‚æœå¼ºç¼“å­˜æœªå‘½ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>max-age</code> çš„æ—¶é—´è¿‡æœŸäº†ï¼Œæˆ–è€… <code>Cache-Control</code> è®¾ç½®ä¸º <code>no-cache</code>ï¼Œåˆ™ä¼šè¿›è¡Œåå•†ç¼“å­˜ï¼Œåå•†ç¼“å­˜å¦‚æœè¿”å›ç»“æœå‘Šè¯‰æµè§ˆå™¨ï¼Œèµ„æºæœªæ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜ï¼Œåˆ™æµè§ˆå™¨ä¾æ—§è¯»å–æœ¬åœ°ç¼“å­˜ã€‚å¦‚æœå½“åå•†ç¼“å­˜ä¹Ÿå¤±æ•ˆä¹‹åï¼Œæ­¤æ—¶å› ä¸ºæ¥å…¥äº† <code>CDN</code>ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šå‘ <code>CDN</code> çš„è¾¹ç¼˜èŠ‚ç‚¹å‘èµ·è¯·æ±‚ï¼Œè€Œä¸æ˜¯è¿›è¡Œä¸€ç³»åˆ—çš„åŸŸåè§£æå»æºæœåŠ¡å™¨æ‰¾ç¼“å­˜æˆ–è€…èµ„æºï¼Œä½†æ˜¯è¿™ä¼šé¢ä¸´ <code>CDN</code> çš„ç¼“å­˜æ—¶æ•ˆæ€§ï¼Œæ‰€ä»¥åé¢ä¼šæ‰§è¡Œä¸Šè¾¹çš„<code>ã€æ¥å…¥ CDN çš„é€»è¾‘ã€‘</code>ã€‚</p></li><li><p>ä¸æ¥å…¥ <code>CND</code> ä¹‹åï¼Œå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜çš„å‘½ä¸­é€»è¾‘éƒ½å’Œæ¥å…¥ <code>CDN</code> çš„ä¸€è‡´ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰æ¥å…¥ <code>CDN</code>ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡ŒåŸŸåè§£æç­‰ä¸€ç³»åˆ—æ­¥éª¤ï¼Œæ‰§è¡Œçš„æ˜¯ä¸Šè¾¹<code>ã€ä¸æ¥å…¥ CDN ã€‘çš„é€»è¾‘</code>ã€‚</p></li></ul><h2 id="ä¸€äº›å¯èƒ½å¯¹ç¼“å­˜é€ æˆçš„å½±å“"><a href="#ä¸€äº›å¯èƒ½å¯¹ç¼“å­˜é€ æˆçš„å½±å“" class="headerlink" title="ä¸€äº›å¯èƒ½å¯¹ç¼“å­˜é€ æˆçš„å½±å“"></a>ä¸€äº›å¯èƒ½å¯¹ç¼“å­˜é€ æˆçš„å½±å“</h2><h3 id="ç”¨æˆ·è¡Œä¸º"><a href="#ç”¨æˆ·è¡Œä¸º" class="headerlink" title="ç”¨æˆ·è¡Œä¸º"></a>ç”¨æˆ·è¡Œä¸º</h3><ul><li>ç¬¬ä¸€æ¬¡æ‰“å¼€ç½‘é¡µï¼Œè·å–å†…å®¹å­˜å…¥ <code>disk</code>ï¼Œå†æ¬¡æ‰“å¼€å¦‚æœ <code>disk</code> æœ‰ï¼Œåˆ™è¯»å–ã€‚æ²¡æœ‰åˆ™æŸ¥çœ‹åå•†ç¼“å­˜</li><li>æ™®é€šåˆ·æ–°ï¼Œè‹¥ç¬¬ä¸€æ¬¡å‘½ä¸­äº† <code>disk</code> çš„ç¼“å­˜ï¼Œåˆ·æ–°çš„æ—¶å€™ä¼šç›´æ¥è¯»å– <code>memory</code> å¹¶ä¸”ä¼˜å…ˆçº§é«˜äº <code>disk</code></li><li>å¼ºåˆ¶æ¸…ç¼“å­˜åˆ·æ–°ï¼Œä¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜</li></ul><h3 id="webpack-æ‰“åŒ…åçš„æ–‡ä»¶"><a href="#webpack-æ‰“åŒ…åçš„æ–‡ä»¶" class="headerlink" title="webpack æ‰“åŒ…åçš„æ–‡ä»¶"></a><code>webpack</code> æ‰“åŒ…åçš„æ–‡ä»¶</h3><ul><li><p>å¦‚æœè®¾ç½®äº†å¼ºç¼“å­˜ï¼Œåœ¨ <code>webpack</code> æ‰“åŒ…ä¹‹åï¼Œå› ä¸ºæ–‡ä»¶å†…å®¹æ”¹å˜æœ€ç»ˆæ‰“åŒ…çš„åç§° <code>chunkhash</code> ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æµè§ˆå™¨çš„ç¼“å­˜å¤±æ•ˆï¼Œå°±ä¼šè¯·æ±‚æ–°çš„èµ„æºï¼Œå¹¶ä¸ä¼šå¯¼è‡´å‡ºç°è¯·æ±‚æ—§çš„èµ„æºçš„é—®é¢˜ã€‚</p><p>æ‰€ä»¥ç¬¬ä¸€æ¬¡è¯·æ±‚æ–°èµ„æºï¼Œä»¥åå¯èƒ½ä¼šè¯»å–ç¼“å­˜ã€‚</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æµè§ˆå™¨</tag>
      
      <tag>ç¼“å­˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨ Workbox ä¸ºåšå®¢å¢åŠ PWAåŠŸèƒ½</title>
    <link href="/2021/01/31/website-realize-pwa/"/>
    <url>/2021/01/31/website-realize-pwa/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p>å¾ˆæ—©ä¹‹å‰å°±äº†è§£è¿‡ <code>Service Worker</code> å†åˆ°åæ¥çš„ <code>PWA</code>ï¼Œå¹¶ä¸”ä¸€ç›´æƒ³å°è¯•ä¸ºç½‘ç«™å¢åŠ ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œå°¤å…¶æ˜¯ <code>PWA</code> çš„å¯ä»¥å°†ç½‘ç«™å®‰è£…åœ¨æ¡Œé¢è¿™ä¸€ä¸ªåŠŸèƒ½éå¸¸å¸å¼•æˆ‘ï¼Œè€Œæ­£å¥½ <code>github-pages</code> æ˜¯éƒ¨ç½²åœ¨ <code>https</code> ä¸Šï¼Œæ‰€ä»¥ç”¨ <code>workbox</code> ç›´æ¥æ”¹é€ äº†åŸºäº <code>github-pages</code> çš„ <code>hexo</code> ä¸ªäººåšå®¢ã€‚</p><p><code>PWA</code> çš„å¥½å¤„è‡ªç„¶ä¸ç”¨å¤šè¯´ï¼Œå…¶èƒ½å‘é€å¿«æ·æ–¹å¼åˆ°æ¡Œé¢ä¸Šè¿™ä¸€åŠŸèƒ½ï¼Œå°†ç”¨æˆ·çš„æ“ä½œé“¾ç”±ä¹‹å‰çš„æœ€é•¿çš„ æ‰“å¼€æµè§ˆå™¨-&gt;è¾“å…¥ç½‘å€[é¢ä¸´æ•²é”™çš„å°´å°¬åœ°æ­¥]-&gt;æ¸²æŸ“ç›®æ ‡ç½‘ç«™ æˆ–è€…æœ€çŸ­çš„ æ‰“å¼€æµè§ˆå™¨-&gt;é€‰æ‹©ä¹¦ç­¾åŠ è½½ç›®æ ‡ç½‘ç«™ï¼Œä¼˜åŒ–åˆ°äº†åªæœ‰ç‚¹å‡»å‘é€åˆ°æ¡Œé¢çš„å¿«æ·æ–¹å¼ç›´æ¥æ‰“å¼€ç½‘ç«™è¿™ä¸€æ­¥ï¼Œå³ä¸€è§¦å³è¾¾ï¼Œè€Œä¸”æ²¡æœ‰æµè§ˆå™¨èœå•æ ã€åœ°å€æ çš„å½±å“ï¼Œå†é…åˆ <code>Service Worker</code> å®ç°çš„åŠ é€Ÿå’Œç¦»çº¿è®¿é—®ï¼Œè¿™å¯è°“è¯´æ˜¯å¤§å¤§æé«˜äº†ç”¨æˆ·çš„ç²˜æ€§ï¼Œéå¸¸åˆ©äºç½‘ç«™ç•™å­˜ã€‚</p><p><code>PWA</code> ä¸æ˜¯ç‰¹æŒ‡æŸä¸€é¡¹æŠ€æœ¯ï¼Œè€Œæ˜¯åº”ç”¨äº†å¤šé¡¹æŠ€æœ¯çš„ <code>Web App</code>ã€‚å…¶æ ¸å¿ƒæŠ€æœ¯åŒ…æ‹¬ App Manifestã€<code>Service Worker</code>ã€<code>Web Push</code> ç­‰ã€‚æˆ‘ä»¬èƒ½å¤Ÿå‘ç°ä¸€äº›ä¸»æµç½‘ç«™ä¾‹å¦‚ <code>vue</code> çš„å®˜ç½‘ã€æ˜Ÿå·´å…‹ <code>web</code> ç‰ˆéƒ½æ˜¯æ”¯æŒ <code>PWA</code> çš„ã€‚</p><h2 id="workbox"><a href="#workbox" class="headerlink" title="workbox"></a><code>workbox</code></h2><p><code>workbox</code> æ˜¯ <code>GoogleChrome</code> å›¢é˜Ÿæ¨å‡ºçš„ä¸€å¥— <code>Web App</code> é™æ€èµ„æºå’Œè¯·æ±‚ç»“æœçš„æœ¬åœ°å­˜å‚¨çš„è§£å†³æ–¹æ¡ˆï¼Œè¯¥è§£å†³æ–¹æ¡ˆåŒ…å«ä¸€äº› Js åº“å’Œæ„å»ºå·¥å…·ï¼Œåœ¨ <code>Chrome Submit 2017</code> ä¸Šé¦–æ¬¡éš†é‡é¢ä¸–ã€‚è€Œåœ¨ <code>workbox</code> èƒŒååˆ™æ˜¯ <code>Service Worker</code> å’Œ <code>Cache API</code> ç­‰æŠ€æœ¯å’Œæ ‡å‡†åœ¨é©±åŠ¨ã€‚</p><h2 id="App-Manifest"><a href="#App-Manifest" class="headerlink" title="App Manifest"></a><code>App Manifest</code></h2><p>ä¸€ä¸ª <code>json</code> çš„æ–‡ä»¶ï¼Œé€šè¿‡ä¸€ç³»åˆ—é…ç½®ï¼Œå°±å¯ä»¥æŠŠä¸€ä¸ª <code>PWA</code> åƒ <code>APP</code> ä¸€æ ·ï¼Œæ·»åŠ ä¸€ä¸ªå›¾æ ‡åˆ°æ‰‹æœºå±å¹•ä¸Šï¼Œç‚¹å‡»å›¾æ ‡å³å¯æ‰“å¼€ç«™ç‚¹ã€‚</p><h2 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a><code>Service Worker</code></h2><p>ä¹Ÿæ˜¯ <code>PWA</code> æŠ€æœ¯èƒŒåéå¸¸é‡è¦çš„è§’è‰²ï¼Œ<code>Service worker</code> å®é™…ä¸Šæ˜¯ä¸€æ®µ <code>js</code> è„šæœ¬ï¼Œåœ¨åå°è¿è¡Œï¼Œå¹¶ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œã€‚å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œè¿è¡Œç¯å¢ƒä¸æ™®é€šè„šæœ¬ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å‚ä¸ <code>Web</code> äº¤äº’è¡Œä¸ºï¼Œæ— æ³•æ“ä½œ <code>dom</code> ç­‰ç­‰ï¼Œ<code>Service Worker</code> çš„å‡ºç°æ˜¯æ­£æ˜¯ä¸ºäº†ä½¿å¾— <code>Web App</code> ä¹Ÿå¯ä»¥åšåˆ°åƒ <code>Native App</code> é‚£æ ·å¯ä»¥ç¦»çº¿ä½¿ç”¨ã€æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ã€‚<code>Service Worker</code> æ˜¯å…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºï¼šå®‰è£…ã€æ¿€æ´»ã€å¸è½½ã€‚</p><h2 id="è¯¦ç»†æµç¨‹"><a href="#è¯¦ç»†æµç¨‹" class="headerlink" title="è¯¦ç»†æµç¨‹"></a>è¯¦ç»†æµç¨‹</h2><ul><li><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm install workbox-build gulp gulp-uglify readable-stream uglify-es --save-dev<br></code></pre></td></tr></table></figure><ul><li><h3 id="æ–°å»ºæ–‡ä»¶"><a href="#æ–°å»ºæ–‡ä»¶" class="headerlink" title="æ–°å»ºæ–‡ä»¶"></a>æ–°å»ºæ–‡ä»¶</h3><p>æˆ‘ä»¬é¦–å…ˆåœ¨åšå®¢çš„æ ¹ç›®å½•ä¸‹æ–°å»º <code>gulpfile.js</code> æ–‡ä»¶</p></li></ul><p>å¤§æ¦‚è§£é‡Šä¸€ä¸‹ <code>gulpfile.js</code> çš„æ–‡ä»¶å†…å®¹ï¼šé¦–å…ˆæ˜¯ <code>gulp</code> ä¼šæ‰§è¡Œä¸€ä¸ªä»»åŠ¡å«<code>generate-service-worker</code>å³ç”Ÿæˆ <code>service-worker</code>ï¼Œå½“ç„¶è¿™ä¸ªä»»åŠ¡åæ˜¯è‡ªå·±éšæ„èµ·çš„ï¼Œç„¶åé€šè¿‡ <code>injectManifest</code> æ³¨å…¥ï¼Œ<code>globPatterns</code> æ˜¯åŒ¹é…çš„æ‰€æœ‰èµ„æºçš„åˆ—è¡¨ï¼Œåšå®¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè‡ªåŠ¨å°†è¿™äº›æ–‡ä»¶ç¼“å­˜ï¼Œç„¶ååˆ©ç”¨ <code>sw-template.js</code> æ¨¡æ¿ï¼Œæœ€ååœ¨æ‰§è¡Œ <code>gulp build</code> å°±ä¼šåœ¨ <code>hexo generate</code> ä¹‹åçš„ <code>public</code> æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä»½çº¿ä¸Šå¯ç”¨çš„ <code>sw.js</code> æ–‡ä»¶ã€‚ç¬¬äºŒä¸ªä»»åŠ¡æ˜¯å‹ç¼©ç”Ÿæˆçš„ <code>sw</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp"</span>);<br><span class="hljs-keyword">const</span> workbox = <span class="hljs-built_in">require</span>(<span class="hljs-string">"workbox-build"</span>);<br><span class="hljs-keyword">const</span> uglifyes = <span class="hljs-built_in">require</span>(<span class="hljs-string">"uglify-es"</span>);<br><span class="hljs-keyword">const</span> composer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-uglify/composer"</span>);<br><span class="hljs-keyword">const</span> uglify = composer(uglifyes, <span class="hljs-built_in">console</span>);<br><span class="hljs-keyword">const</span> pipeline = <span class="hljs-built_in">require</span>(<span class="hljs-string">"readable-stream"</span>).pipeline;<br><br>gulp.task(<span class="hljs-string">"generate-service-worker"</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">return</span> workbox.injectManifest(&#123;<br>    <span class="hljs-attr">swSrc</span>: <span class="hljs-string">"./sw-template.js"</span>,<br>    <span class="hljs-attr">swDest</span>: <span class="hljs-string">"./public/sw.js"</span>,<br>    <span class="hljs-attr">globDirectory</span>: <span class="hljs-string">"./public"</span>,<br>    <span class="hljs-attr">globPatterns</span>: [<span class="hljs-string">"**/*.&#123;html,css,js,json,woff2&#125;"</span>],<br>    <span class="hljs-attr">modifyURLPrefix</span>: &#123;<br>      <span class="hljs-string">""</span>: <span class="hljs-string">"./"</span><br>    &#125;<br>  &#125;);<br>&#125;);<br><br>gulp.task(<span class="hljs-string">"uglify"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> pipeline(gulp.src(<span class="hljs-string">"./public/sw.js"</span>), uglify(), gulp.dest(<span class="hljs-string">"./public"</span>));<br>&#125;);<br><br>gulp.task(<span class="hljs-string">"build"</span>, gulp.series(<span class="hljs-string">"generate-service-worker"</span>, <span class="hljs-string">"uglify"</span>));<br></code></pre></td></tr></table></figure><p>ç„¶åä¹Ÿåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º <code>sw-template.js</code> æ–‡ä»¶ï¼Œæˆ‘ç”¨çš„æ˜¯ <code>6.1.0</code> çš„ <code>CDN</code> ç‰ˆæœ¬ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ä½¿ç”¨Google Cloud Storageä¸Šçš„Workbox CDN</span><br>importScripts(<br>  <span class="hljs-string">`https://storage.googleapis.com/workbox-cdn/releases/6.1.0/workbox-sw.js`</span><br>);<br><br><span class="hljs-comment">// è¿™ä¸ªprefixéå¸¸é‡è¦ï¼Œéœ€è¦æ”¹æˆè‡ªå·±çš„githubçš„name</span><br>workbox.core.setCacheNameDetails(&#123;<br>  <span class="hljs-attr">prefix</span>: <span class="hljs-string">"tennesseesunshine"</span><br>&#125;);<br><br>workbox.core.skipWaiting();<br><br>workbox.core.clientsClaim();<br><br>workbox.precaching.precacheAndRoute(self.__WB_MANIFEST);<br><br>workbox.precaching.cleanupOutdatedCaches();<br><br><span class="hljs-comment">// workbox.routing.registerRoute åˆ©ç”¨æ­£åˆ™æ¥åŒ¹é…æ³¨å†Œè·¯ç”±ï¼Œç±»ä¼¼äºwebpackçš„loaderï¼ŒåŒ¹é…åˆ°ä¹‹åç”¨callbackå¤„ç†</span><br><br>workbox.routing.registerRoute(<br>  <span class="hljs-regexp">/\.(?:png|jpg|jpeg|gif|bmp|webp|svg|ico)$/</span>,<br>  <span class="hljs-comment">// ç¼“å­˜å›¾ç‰‡ï¼Œä»¥åŠè®¾ç½®ç¼“å­˜æ—¶é—´</span><br>  <span class="hljs-keyword">new</span> workbox.strategies.CacheFirst(&#123;<br>    <span class="hljs-attr">cacheName</span>: <span class="hljs-string">"images"</span>,<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-keyword">new</span> workbox.expiration.ExpirationPlugin(&#123;<br>        <span class="hljs-attr">maxEntries</span>: <span class="hljs-number">1000</span>,<br>        <span class="hljs-attr">maxAgeSeconds</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span><br>      &#125;),<br>      <span class="hljs-keyword">new</span> workbox.cacheableResponse.CacheableResponsePlugin(&#123;<br>        <span class="hljs-attr">statuses</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">200</span>]<br>      &#125;)<br>    ]<br>  &#125;)<br>);<br><br><span class="hljs-comment">// Fonts</span><br>workbox.routing.registerRoute(<br>  <span class="hljs-regexp">/\.(?:eot|ttf|woff|woff2)$/</span>,<br>  <span class="hljs-keyword">new</span> workbox.strategies.CacheFirst(&#123;<br>    <span class="hljs-attr">cacheName</span>: <span class="hljs-string">"fonts"</span>,<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-keyword">new</span> workbox.expiration.ExpirationPlugin(&#123;<br>        <span class="hljs-attr">maxEntries</span>: <span class="hljs-number">1000</span>,<br>        <span class="hljs-attr">maxAgeSeconds</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span><br>      &#125;),<br>      <span class="hljs-keyword">new</span> workbox.cacheableResponse.CacheableResponsePlugin(&#123;<br>        <span class="hljs-attr">statuses</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">200</span>]<br>      &#125;)<br>    ]<br>  &#125;)<br>);<br><br><span class="hljs-comment">// Google Fonts</span><br>workbox.routing.registerRoute(<br>  <span class="hljs-regexp">/^https:\/\/fonts\.googleapis\.com/</span>,<br>  <span class="hljs-keyword">new</span> workbox.strategies.StaleWhileRevalidate(&#123;<br>    <span class="hljs-attr">cacheName</span>: <span class="hljs-string">"google-fonts-stylesheets"</span><br>  &#125;)<br>);<br>workbox.routing.registerRoute(<br>  <span class="hljs-regexp">/^https:\/\/fonts\.gstatic\.com/</span>,<br>  <span class="hljs-keyword">new</span> workbox.strategies.CacheFirst(&#123;<br>    <span class="hljs-attr">cacheName</span>: <span class="hljs-string">"google-fonts-webfonts"</span>,<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-keyword">new</span> workbox.expiration.ExpirationPlugin(&#123;<br>        <span class="hljs-attr">maxEntries</span>: <span class="hljs-number">1000</span>,<br>        <span class="hljs-attr">maxAgeSeconds</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span><br>      &#125;),<br>      <span class="hljs-keyword">new</span> workbox.cacheableResponse.CacheableResponsePlugin(&#123;<br>        <span class="hljs-attr">statuses</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">200</span>]<br>      &#125;)<br>    ]<br>  &#125;)<br>);<br><br><span class="hljs-comment">// Static Libraries</span><br>workbox.routing.registerRoute(<br>  <span class="hljs-regexp">/^https:\/\/cdn\.jsdelivr\.net/</span>,<br>  <span class="hljs-keyword">new</span> workbox.strategies.CacheFirst(&#123;<br>    <span class="hljs-attr">cacheName</span>: <span class="hljs-string">"static-libs"</span>,<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-keyword">new</span> workbox.expiration.ExpirationPlugin(&#123;<br>        <span class="hljs-attr">maxEntries</span>: <span class="hljs-number">1000</span>,<br>        <span class="hljs-attr">maxAgeSeconds</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span><br>      &#125;),<br>      <span class="hljs-keyword">new</span> workbox.cacheableResponse.CacheableResponsePlugin(&#123;<br>        <span class="hljs-attr">statuses</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">200</span>]<br>      &#125;)<br>    ]<br>  &#125;)<br>);<br><br><span class="hljs-comment">// External Images</span><br>workbox.routing.registerRoute(<br>  <span class="hljs-regexp">/^https:\/\/raw\.githubusercontent\.com\/reuixiy\/hugo-theme-meme\/master\/static\/icons\/.*/</span>,<br>  <span class="hljs-keyword">new</span> workbox.strategies.CacheFirst(&#123;<br>    <span class="hljs-attr">cacheName</span>: <span class="hljs-string">"external-images"</span>,<br>    <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-keyword">new</span> workbox.expiration.ExpirationPlugin(&#123;<br>        <span class="hljs-attr">maxEntries</span>: <span class="hljs-number">1000</span>,<br>        <span class="hljs-attr">maxAgeSeconds</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span><br>      &#125;),<br>      <span class="hljs-keyword">new</span> workbox.cacheableResponse.CacheableResponsePlugin(&#123;<br>        <span class="hljs-attr">statuses</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">200</span>]<br>      &#125;)<br>    ]<br>  &#125;)<br>);<br><br>workbox.googleAnalytics.initialize();<br></code></pre></td></tr></table></figure><p>æ¥ç€åœ¨åšå®¢ä¸»é¢˜çš„ <code>source</code> æºç ä¸‹ï¼Œåˆ›å»º <code>manifest.json</code> æ–‡ä»¶ï¼Œç”¨äºå‘é€åˆ°æ¡Œé¢å¿«æ·æ–¹å¼çš„ä¸€äº›é…ç½®ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"å¡«å†™ä½ éœ€è¦çš„åå­—"</span>,<br>  <span class="hljs-attr">"short_name"</span>: <span class="hljs-string">"å¡«å†™ä½ éœ€è¦çš„åå­—"</span>,<br>  <span class="hljs-attr">"icons"</span>: [<br>    &#123;<br>      <span class="hljs-attr">"src"</span>: <span class="hljs-string">"/img/icons.png"</span>,<br>      <span class="hljs-attr">"sizes"</span>: <span class="hljs-string">"256x256"</span>,<br>      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"image/png"</span><br>    &#125;<br>  ],<br>  <span class="hljs-attr">"theme_color"</span>: <span class="hljs-string">"#fff"</span>,<br>  <span class="hljs-attr">"background_color"</span>: <span class="hljs-string">"#fff"</span>,<br>  <span class="hljs-attr">"display"</span>: <span class="hljs-string">"standalone"</span>,<br>  <span class="hljs-attr">"orientation"</span>: <span class="hljs-string">"portrait-primary"</span>,<br>  <span class="hljs-attr">"start_url"</span>: <span class="hljs-string">"."</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„çš„äº‹é¡¹ï¼š<code>icons</code> ä¸‹çš„ <code>sizes</code> å¿…é¡»æ˜¯æ­£æ–¹å½¢ï¼Œå¹¶ä¸”éœ€è¦å¤§äº <code>144px</code> å·¦å³ï¼Œç”¨ <code>256</code> å°±å¯ä»¥ã€‚</p><ul><li><h3 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h3>å…ˆ <code>hexo</code> ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œå†æœ‰ <code>gulp</code> ç”Ÿæˆ <code>sw</code> ç¼“å­˜åˆ—è¡¨ã€‚</li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">hexo g <span class="hljs-meta">&amp;&amp; gulp build</span><br></code></pre></td></tr></table></figure><ul><li><h3 id="ç¼–è¾‘æ¨¡ç‰ˆ"><a href="#ç¼–è¾‘æ¨¡ç‰ˆ" class="headerlink" title="ç¼–è¾‘æ¨¡ç‰ˆ"></a>ç¼–è¾‘æ¨¡ç‰ˆ</h3></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨ <code>HTML</code> é¡µé¢ä¸­åŠ å…¥ç›¸å…³ä»£ç ä»¥æ³¨å†Œ <code>Service Worker</code>ï¼Œå¹¶æ·»åŠ é¡µé¢æ›´æ–°åçš„æé†’åŠŸèƒ½ã€‚è¿™ä¸ªéœ€è¦æ ¹æ®è‡ªå·±çš„ç›®å‰ä½¿ç”¨çš„ä¸»é¢˜æ¥ä¿®æ”¹ï¼Œå…·ä½“åšæ³•å°±æ˜¯æ‰¾åˆ°è‡ªå·±ç›®å‰ä½¿ç”¨åšå®¢ä¸»é¢˜çš„ç›®å½•ï¼Œåœ¨å…¶æ¨¡ç‰ˆç›¸å…³æ–‡ä»¶çš„<code>&lt;/body&gt;</code>ä¸‹ï¼Œæ’å…¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-refresh"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app-refresh"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-refresh-wrap"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"location.reload()"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"cursor: pointer;"</span>&gt;</span>ç‚¹å‡»åˆ·æ–°<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><br>  <span class="hljs-keyword">if</span> (<span class="hljs-string">"serviceWorker"</span> <span class="hljs-keyword">in</span> navigator) &#123;<br>    <span class="hljs-keyword">if</span> (navigator.serviceWorker.controller) &#123;<br>      navigator.serviceWorker.addEventListener(<span class="hljs-string">"controllerchange"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>        showNotification();<br>      &#125;);<br>    &#125;<br>    <span class="hljs-comment">// å› ä¸ºåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸‹ä¸éœ€è¦swçš„ç¼“å­˜ï¼Œåœ¨æ›´æ–°åšå®¢ä¹‹åï¼Œåˆ·æ–°ä¼šåˆ·ä¸å‡ºæ¥æ–°çš„åšå®¢å†…å®¹ï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­å¦‚æœæ˜¯çº¿ä¸Šæ‰æ³¨å†Œswå¦åˆ™å°±å¸è½½æ‰</span><br><br>    <span class="hljs-comment">// è¿™é‡Œçš„åˆ¤æ–­æ¡ä»¶å°±æ˜¯è‡ªå·±çš„åšå®¢çš„åŸŸå</span><br>    <span class="hljs-keyword">if</span> (location.host === <span class="hljs-string">"tennesseesunshine.github.io"</span>) &#123;<br>      <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"load"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>        navigator.serviceWorker.register(<span class="hljs-string">"/sw.js"</span>);<br>      &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      navigator.serviceWorker.getRegistrations().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">registrations</span>) </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> registration <span class="hljs-keyword">of</span> registrations) &#123;<br>          registration.unregister();<br>        &#125;<br>      &#125;);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showNotification</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"meta[name=theme-color]"</span>).content = <span class="hljs-string">"#000"</span>;<br>    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"app-refresh"</span>).className += <span class="hljs-string">" app-refresh-show"</span>;<br>  &#125;<br></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><h3 id="è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼"><a href="#è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼" class="headerlink" title="è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼"></a>è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼</h3></li></ul><p>ä¾æ—§æ˜¯æ‰¾åˆ°è‡ªå·±çš„åšå®¢ä¸»é¢˜ï¼Œæ‰¾åˆ° <code>css</code> æ ·å¼æ–‡ä»¶ï¼Œåœ¨å…¶ä¸‹å¢åŠ <code>_customs/custom.styl</code> æ–‡ä»¶ï¼Œå†™å…¥ä¸€ä¸‹å†…å®¹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs styl">.app-refresh<br>  background #000<br>  height 0<br>  line-height 3em<br>  overflow hidden<br>  position fixed<br>  top 0<br>  left 0<br>  right 0<br>  z-index 1031<br>  padding 0 1em<br>  transition all .3s ease<br>.app-refresh-wrap<br>  display flex<br>  color #fff<br><br>.app-refresh-wrap label<br>  flex 1<br><br>.app-refresh-show<br>  height 3em<br></code></pre></td></tr></table></figure><p>å†äºç»Ÿä¸€å¯¼å‡ºçš„ <code>styl</code> çš„æ–‡ä»¶ä¸­ï¼Œå¼•å…¥<br><code>@import &quot;\_customs/custom&quot;</code></p><p>è‡³æ­¤æ‰€æœ‰çš„é…ç½®éƒ½å·²ç»å®Œæˆã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://io-oi.me/tech/pwa-via-workbox/" target="_blank" rel="noopener">åˆ©ç”¨ Workbox å®ç°åšå®¢çš„ PWA</a></p><p><a href="https://guanqr.com/tech/website/realize-pwa/" target="_blank" rel="noopener">åšå®¢å®ç° PWA åŠŸèƒ½</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>pwa</tag>
      
      <tag>Workbox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¢ç©¶ webpack å¼‚æ­¥åŠ è½½åŸç†ä»¥åŠçƒ­æ›´æ–°æµç¨‹</title>
    <link href="/2021/01/30/webpackDynamicLoad/"/>
    <url>/2021/01/30/webpackDynamicLoad/</url>
    
    <content type="html"><![CDATA[<p>å¼‚æ­¥åŠ è½½åº”è¯¥åˆ†ä¸ºä»£ç æ¨¡å—çš„å¼‚æ­¥åŠ è½½å’Œè·¯ç”±çš„å¼‚æ­¥åŠ è½½ï¼Œä½†å…¶åŸç†åŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªæ¨¡å—çš„å¼‚æ­¥åŠ è½½ã€‚</p><h2 id="æ¨¡å—å¼‚æ­¥åŠ è½½"><a href="#æ¨¡å—å¼‚æ­¥åŠ è½½" class="headerlink" title="æ¨¡å—å¼‚æ­¥åŠ è½½"></a>æ¨¡å—å¼‚æ­¥åŠ è½½</h2><h3 id="åˆå§‹åŒ–æ–‡ä»¶ç»“æ„"><a href="#åˆå§‹åŒ–æ–‡ä»¶ç»“æ„" class="headerlink" title="åˆå§‹åŒ–æ–‡ä»¶ç»“æ„"></a>åˆå§‹åŒ–æ–‡ä»¶ç»“æ„</h3><p>é¦–å…ˆæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥å¼€å§‹ï¼Œæ–°å»ºä¸€ä¸ªç›®å½• <code>checkWebpackBundled</code>ï¼Œå®‰è£… <code>webpackã€webpack-cliã€html-webpack-pluginã€clean-webpack-plugin</code> æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶ç»“æ„å¤§æ¦‚ç±»ä¼¼äºï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-string">|-- checkWebpackBundled</span><br>    <span class="hljs-string">|-- index.html // ç”¨äºhtml-webpack-pluginç”¨çš„æ¨¡æ¿</span><br>    <span class="hljs-string">|-- package.json</span><br>    <span class="hljs-string">|-- webpack.config.js</span><br>    <span class="hljs-string">|-- src</span><br>        <span class="hljs-string">|-- buttonHello.js</span><br>        <span class="hljs-string">|-- buttonHi.js</span><br>        <span class="hljs-string">|-- main.js // webpackæ‰“åŒ…å…¥å£æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h3 id="ç¼–å†™æ–‡ä»¶å†…å®¹"><a href="#ç¼–å†™æ–‡ä»¶å†…å®¹" class="headerlink" title="ç¼–å†™æ–‡ä»¶å†…å®¹"></a>ç¼–å†™æ–‡ä»¶å†…å®¹</h3><p>æˆ‘ä»¬å…ˆæ¥å†™ä¸€ä¸ª <code>main.js</code> æ–‡ä»¶ï¼Œå…¶ä¸­ç›´æ¥å¼•å…¥ä¸¤ä¸ªæ–‡ä»¶ä¸€ä¸ªæ˜¯ <code>buttonHi.js</code> å¦ä¸€ä¸ªæ˜¯ <code>buttonHello.js</code>ï¼Œç„¶åæˆ‘ä»¬é…ç½®ä¸€ä¸‹ <code>webpack</code>ï¼Œç¼–å†™ä¸€ä¸ª <code>index.html</code> çš„æ¨¡æ¿ã€‚</p><p><code>main.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> buttonHi <span class="hljs-keyword">from</span> <span class="hljs-string">"./buttonHi"</span>;<br><span class="hljs-keyword">import</span> buttonHello <span class="hljs-keyword">from</span> <span class="hljs-string">"./buttonHello"</span>;<br><br><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">".button-hi"</span>).addEventListener(<span class="hljs-string">"click"</span>, () =&gt; &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"buttonHi"</span>, buttonHi);<br>&#125;);<br><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">".button-hello"</span>).addEventListener(<span class="hljs-string">"click"</span>, () =&gt; &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"buttonHello"</span>, buttonHello);<br>&#125;);<br></code></pre></td></tr></table></figure><p><code>buttonHi.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> a = <span class="hljs-string">"button-hi!"</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> a;<br></code></pre></td></tr></table></figure><p><code>buttonHello.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> a = <span class="hljs-string">"button-hello!!"</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> a;<br></code></pre></td></tr></table></figure><p><code>webpack.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack"</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);<br><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">"clean-webpack-plugin"</span>);<br><span class="hljs-comment">/**<br> * @type &#123;webpack.Configuration&#125;<br> */</span><br><span class="hljs-keyword">const</span> config = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">"./src/main.js"</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">"[name].js"</span>,<br>    <span class="hljs-attr">path</span>: path.join(__dirname, <span class="hljs-string">"dist"</span>)<br>  &#125;,<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">"development"</span>, <span class="hljs-comment">// æˆ‘ä»¬é€‰æ‹©äº†devæ¨¡å¼ï¼Œåˆ°æ—¶å€™æ‰“åŒ…å®Œæˆä¹‹åçš„ä»£ç å°±ä¸æ˜¯å‹ç¼©ä¹‹åçš„ï¼Œè€Œä¸”è¿˜æ˜¯æ”¯æŒevelçš„sourceMap</span><br>  plugins: [<br>    <span class="hljs-keyword">new</span> CleanWebpackPlugin(),<br>    <span class="hljs-keyword">new</span> HtmlWebpackPlugin(&#123;<br>      <span class="hljs-attr">template</span>: <span class="hljs-string">"./index.html"</span><br>    &#125;)<br>  ]<br>&#125;;<br><br><span class="hljs-built_in">module</span>.exports = config;<br></code></pre></td></tr></table></figure><p><code>index.html</code> æ¨¡æ¿</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>webpackå¼‚æ­¥åŠ è½½åŸç†<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button-hi"</span>&gt;</span>ç‚¹æˆ‘æ˜¯ hiï¼<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button-hello"</span>&gt;</span>ç‚¹æˆ‘æ˜¯ hello!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹åœ¨ç»ˆç«¯è¿è¡Œ <code>npx webpack</code>ï¼Œç”Ÿæˆäº† <code>dist</code> ç›®å½•ï¼Œé‡Œé¢æœ‰æˆ‘ä»¬æ‰“åŒ…æˆåŠŸçš„ <code>js</code> æ–‡ä»¶å’Œ <code>HtmlWebpackPlugin</code> æ’ä»¶ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ <code>index.html</code>ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ <code>index.html</code>ï¼Œä¾æ¬¡ç‚¹å‡»é¡µé¢çš„ä¸¤ä¸ªæŒ‰é’®å‘ç°ï¼Œåˆ†åˆ«åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰“å°å‡ºäº†<code>buttonHi button-hi!</code>å’Œ<code>buttonHello button-hello!!</code>ã€‚è€Œä¸”æˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬çš„ä¸¤ä¸ªä¾èµ–æ–‡ä»¶å…¨éƒ¨éƒ½è¢«æ‰“åŒ…åˆ°äº† <code>main.js</code> æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ç§æ¨¡å¼æ‰“åŒ…çš„äº§ç‰©æ˜¯ä»€ä¹ˆï¼š</p><p>é¦–å…ˆæˆ‘ä»¬æ‰“å¼€ <code>main.js</code>ï¼Œå°†ä»£ç æŠ˜å èµ·æ¥ï¼Œæˆ‘ä»¬å‘ç°æœ€ç»ˆæ‰“åŒ…æˆåŠŸçš„æ–‡ä»¶æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼Œæˆ‘ä»¬æ¥ç®€å•çœ‹ä¸€ä¸‹æœ‰ç”¨çš„å†…å®¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// webpackBootstrap</span><br><span class="hljs-meta">  "use strict"</span>;<br>  <span class="hljs-comment">// æˆ‘ä»¬æ¥çœ‹__webpack_modules__è¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªmapçš„æ˜ å°„ï¼Œkeyæ˜¯æˆ‘ä»¬éœ€è¦åŠ è½½çš„æ¨¡å—çš„åç§°ä¹Ÿå°±æ˜¯ä¾èµ–æ–‡ä»¶çš„è·¯å¾„ï¼Œvalueæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼å…¶å®å°±æ˜¯å°†æˆ‘ä»¬çš„æºç çš„å†…å®¹è½¬ä¸ºäº†webpackçš„ä¸€äº›æ–¹æ³•</span><br>  <span class="hljs-keyword">var</span> __webpack_modules__ = &#123;<br>    <span class="hljs-comment">// è¿™é‡Œæœ‰ä¸‰ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬åªçœ‹è¿™ä¸€ä¸ªï¼Œå…¶ä»–çš„åŒç†</span><br>    <span class="hljs-string">"./src/buttonHello.js"</span>:<br>      <span class="hljs-comment">/*!****************************!*\<br>  !*** ./src/buttonHello.js ***!<br>  \****************************/</span><br>      <span class="hljs-function">(<span class="hljs-params">__unused_webpack_module, __webpack_exports__, __webpack_require__</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// è¿™é‡Œæ˜¯å› ä¸ºæˆ‘ä»¬çš„webpackçš„modeè®¾ç½®çš„æ˜¯develpomentæ¨¡å¼ï¼Œå¼€å¯çš„evalçš„sourceMapï¼Œevalä¼šå°†å­—ç¬¦ä¸²å˜ä¸ºå¯ä»¥æ‰§è¡Œçš„js</span><br>        <span class="hljs-built_in">eval</span>(<br>          <span class="hljs-string">"__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, &#123;\n/* harmony export */   \"default\": () =&gt; __WEBPACK_DEFAULT_EXPORT__\n/* harmony export */ &#125;);\nconst a = 'button-hello!!'\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (a);\n\n//# sourceURL=webpack://checkWebpackBundled/./src/buttonHello.js?"</span><br>        );<br><br>        <span class="hljs-comment">/***/</span><br>      &#125;,<br>    <span class="hljs-string">"./src/main.js"</span>: (<br>      __unused_webpack_module,<br>      __webpack_exports__,<br>      __webpack_require__<br>    ) =&gt; &#123;<br>      <span class="hljs-comment">// æˆ˜ç•¥æ€§çœç•¥</span><br>    &#125;,<br>    <span class="hljs-string">"./src/buttonHi.js"</span>: (<br>      __unused_webpack_module,<br>      __webpack_exports__,<br>      __webpack_require__<br>    ) =&gt; &#123;<br>      <span class="hljs-comment">// æˆ˜ç•¥æ€§çœç•¥</span><br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªç¼“å­˜æ¨¡å—</span><br>  <span class="hljs-keyword">var</span> __webpack_module_cache__ = &#123;&#125;;<br>  <span class="hljs-comment">// webpackçš„åŠ è½½å‡½æ•°ï¼Œåˆ°æœ€ç»ˆCJSå’ŒESMéƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•åŠ è½½æ–‡ä»¶</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__webpack_require__</span>(<span class="hljs-params">moduleId</span>) </span>&#123;<br>    <span class="hljs-comment">// è·Ÿnodejsçš„åŠ è½½æ¨¡å—åŸç†ä¸€è‡´ï¼Œä¹‹å‰è¯»å–è¿‡çš„è¯å†æ¬¡è¯»å–ä¼šä»ç¼“å­˜ä¸­æ‹¿</span><br>    <span class="hljs-keyword">if</span> (__webpack_module_cache__[moduleId]) &#123;<br>      <span class="hljs-keyword">return</span> __webpack_module_cache__[moduleId].exports;<br>    &#125;<br>    <span class="hljs-comment">// æ²¡æœ‰å‘½ä¸­çš„è¯ï¼Œå°†æ–°æ¨¡å—æ¨å…¥ç¼“å­˜ä¸­</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = (__webpack_module_cache__[moduleId] = &#123;<br>      <span class="hljs-comment">// no module.id needed</span><br>      <span class="hljs-comment">// no module.loaded needed</span><br>      exports: &#123;&#125;<br>    &#125;);<br><br>    <span class="hljs-comment">// ç”¨__webpack_modules__çš„æ˜ å°„å»æ‰§è¡Œå¯¹åº”çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œç›¸åº”çš„moduleIdå¯¹åº”çš„æ¨¡å—å†…å®¹ï¼Œå°†æ¨¡å—çš„åŠ è½½æŒ‚åœ¨exportsçš„å¯¹è±¡ä¸Š</span><br>    __webpack_modules__[moduleId](<span class="hljs-built_in">module</span>, <span class="hljs-built_in">module</span>.exports, __webpack_require__);<br><br>    <span class="hljs-comment">// Return the exports of the module</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">module</span>.exports;<br>  &#125;<br><br>  <span class="hljs-comment">/* webpack/runtime/define property getters */</span><br>  (<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// define getter functions for harmony exports</span><br>    __webpack_require__.d = <span class="hljs-function">(<span class="hljs-params">exports, definition</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> definition) &#123;<br>        <span class="hljs-keyword">if</span> (<br>          __webpack_require__.o(definition, key) &amp;&amp;<br>          !__webpack_require__.o(exports, key)<br>        ) &#123;<br>          <span class="hljs-built_in">Object</span>.defineProperty(exports, key, &#123;<br>            <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">get</span>: definition[key]<br>          &#125;);<br>        &#125;<br>      &#125;<br>    &#125;;<br>  &#125;)();<br><br>  <span class="hljs-comment">/* webpack/runtime/hasOwnProperty shorthand */</span><br>  <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> &#123;<br>    __webpack_require__.o = <span class="hljs-function">(<span class="hljs-params">obj, prop</span>) =&gt;</span><br>      <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(obj, prop);<br>  &#125;)();<br><br>  <span class="hljs-comment">/* webpack/runtime/make namespace object */</span><br>  <span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// define __esModule on exports</span><br>    __webpack_require__.r = <span class="hljs-function"><span class="hljs-params">exports</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> !== <span class="hljs-string">"undefined"</span> &amp;&amp; <span class="hljs-built_in">Symbol</span>.toStringTag) &#123;<br>        <span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-built_in">Symbol</span>.toStringTag, &#123; <span class="hljs-attr">value</span>: <span class="hljs-string">"Module"</span> &#125;);<br>      &#125;<br>      <span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> &#125;);<br>    &#125;;<br>  &#125;)();<br><br>  <span class="hljs-comment">// è¿™é‡Œå°±æ˜¯åˆå§‹åŒ–åŠ è½½æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶</span><br>  __webpack_require__(<span class="hljs-string">"./src/main.js"</span>);<br>&#125;)();<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬ç»“åˆæ„å»ºæœºåˆ¶çœ‹ä¸€ä¸‹ï¼Œæ„å»ºå¼€å§‹æ˜¯ï¼š <code>webpack</code> è½¬æ¢ä»£ç å¹¶ç”Ÿæˆå•ä¸ªæ–‡ä»¶ä¾èµ–ï¼Œä»å…¥å£æ–‡ä»¶å¼€å§‹é€’å½’åˆ†æå¹¶ç”Ÿæˆä¾èµ–å›¾è°±ï¼Œå³ <code>webpack</code> èƒ½å¤Ÿæ‰¾åˆ°å…¥å£æ–‡ä»¶ï¼Œå‰©ä¸‹çš„æ¨¡å—éƒ½æ˜¯æŒ‰ç…§æµç¨‹æ‰§è¡Œçš„ã€‚æ‰€ä»¥æœ€åçš„æ‰§è¡Œæµç¨‹æ˜¯ï¼Œ<code>webpack</code> æœ€ç»ˆæ‰“åŒ…ç”Ÿæˆçš„æ˜¯ä¸€ä¸ª <code>IIFE</code>ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šè‡ªæ‰§è¡Œå‡½æ•°æ˜¯ä¸º<code>webpack_require</code>æ‰©å±•å¢åŠ çš„æ–¹æ³•ï¼Œè€Œä¸”æˆ‘ä»¬èƒ½å¤Ÿå‘ç°æˆ‘ä»¬ç¼–å†™çš„ä»£ç æ¨¡å—å·²ç»è¢« <code>webpack</code> çš„å†…éƒ¨æ‰©å±•çš„æ–¹æ³•åŒ…è£…è¿‡äº†ï¼Œåœ¨æœ€åæˆ‘ä»¬å‘ç°<code>webpack_require(&quot;./src/main.js&quot;)</code>ï¼Œè¿™æ˜¯è°ƒç”¨äº†å…¥å£æ–‡ä»¶å¼€å§‹æ‰§è¡Œï¼Œè¿™æ ·æ‰“åŒ…ç”Ÿæˆçš„æœ€åçš„æ–‡ä»¶ï¼Œå°±ä¼šæŒ‰ç…§ç”Ÿæˆçš„ä¾èµ–åˆ†åˆ«åŠ è½½å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œä»è€Œåœ¨æµè§ˆå™¨ä¸­åŠ è½½ä»¥åŠåŠ è½½å¯¹åº”çš„é¡µé¢æˆ–è€…æ–¹æ³•ã€‚</p><p>å¼•ç”³å‡ºæ¥çš„é—®é¢˜ï¼šåˆ°è¿™é‡Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä½“ä¼šåˆ°ä¸€ä¸ªç¼ºç‚¹ï¼Œå¦‚æœé¡¹ç›®çš„ä¾èµ–å¤ªå¤šä¸”æœ‰çš„ä¾èµ–å¾ˆå¤§ï¼Œæˆ‘ä»¬ç°åœ¨è¿™ç§å¼•å…¥æ–¹å¼æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€æœ‰çš„å¼•ç”¨æœ€ç»ˆå¦‚æœéƒ½è¢«æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œåœ¨åˆå§‹åŒ–è¯·æ±‚åˆ°æ—¶å€™ï¼Œå°±ä¼šé€ æˆå¾ˆå¤šæµªè´¹ä»¥åŠå»¶é•¿åŠ è½½æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æœ‰äº›ä¾èµ–æ‹†åˆ†å‡ºå»ï¼Œåªåœ¨åˆå§‹åŒ–çš„æ—¶å€™è¯·æ±‚å¿…é¡»çš„æ–‡ä»¶ï¼Œåˆ«çš„æ–‡ä»¶åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼ˆåŠ¨æ€å¼•å…¥çš„æ–¹æ³•ï¼‰ï¼Œæˆ–è€…è·¯ç”±åˆ‡æ¢çš„æ—¶å€™ï¼ˆè·¯ç”±æ‡’åŠ è½½ï¼‰æ‰å»åŠ è½½æˆ–è€…é…åˆ <code>webpack</code> çš„ <code>splitchunk</code> æ¥åšåˆ†åŒ…ã€‚</p><h3 id="åŠ¨æ€åŠ è½½çš„ä¸¤ç§æ–¹æ³•"><a href="#åŠ¨æ€åŠ è½½çš„ä¸¤ç§æ–¹æ³•" class="headerlink" title="åŠ¨æ€åŠ è½½çš„ä¸¤ç§æ–¹æ³•"></a>åŠ¨æ€åŠ è½½çš„ä¸¤ç§æ–¹æ³•</h3><ul><li><code>ESM</code> çš„ <code>import</code></li><li><code>webpack</code> çš„ <code>webpack.ensure</code></li></ul><p><code>webpack</code> å·²ç»ä¸æ¨èä½¿ç”¨ <code>webpack.ensure</code> äº†ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ <code>import</code> æ¥æµ‹è¯•ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥ä½¿ç”¨ <code>import</code> æ¥å¼‚æ­¥åŠ è½½æ¨¡å—ï¼Œæˆ‘ä»¬ä¿®æ”¹ <code>main.js</code> æ–‡ä»¶</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">- import buttonHi from "./buttonHi";</span><br><span class="hljs-deletion">- import buttonHello from "./buttonHello";</span><br><br>document.querySelector(".button-hi").addEventListener("click", () =&gt; &#123;<br><span class="hljs-deletion">-  console.log("buttonHi", buttonHi);</span><br><span class="hljs-addition">+  import(/* webpackChunkName */`./buttonHi`).then(data =&gt; &#123;</span><br><span class="hljs-addition">+    console.log('data', data.default);</span><br><span class="hljs-addition">+  &#125;)</span><br>&#125;);<br>document.querySelector(".button-hello").addEventListener("click", () =&gt; &#123;<br><span class="hljs-deletion">-  console.log("buttonHello", buttonHello);</span><br><span class="hljs-addition">+  import(/* webpackChunkName */`./buttonHello`).then(data =&gt; &#123;</span><br><span class="hljs-addition">+    console.log('data', data.default);</span><br><span class="hljs-addition">+  &#125;)</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œ <code>npx webpack</code> å‘ç°æˆ‘ä»¬çš„ <code>dist</code> ä¸‹æ‰“åŒ…å‡ºæ¥ä¸‰ä¸ª <code>js</code> æ–‡ä»¶</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-string">|-- dist</span><br>    <span class="hljs-string">|-- index.html</span><br>    <span class="hljs-string">|-- main.js</span><br>    <span class="hljs-string">|-- src_buttonHello_js.js</span><br>    <span class="hljs-string">|-- src_buttonHi_js.js</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬èƒ½æ¸…æ¥šçš„çœ‹åˆ°æ‰“åŒ…ç”Ÿæˆäº†ä¸‰ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­è¢«æˆ‘ä»¬ <code>import</code> å¼•å…¥çš„æ–‡ä»¶åˆ†åˆ«è¢«å•ç‹¬æ‰“åŒ…äº†ã€‚è€Œä¸”æˆ‘ä»¬æŸ¥çœ‹ <code>index.html</code> å‘ç°åªå¼•ç”¨äº†ä¸€ä¸ªå…¥å£æ–‡ä»¶ <code>main.js</code>ï¼Œå¦å¤–ä¸¤ä¸ªæ–‡ä»¶æ˜¯æ²¡æœ‰è¢«å¼•å…¥çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­ç»§ç»­åˆ·æ–°é¡µé¢ï¼Œå‘ç° <code>network</code> åªè¯·æ±‚äº† <code>index.html</code> å’Œ <code>main.js</code> æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬å¼€å§‹ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼Œå†è§‚å¯Ÿ <code>network</code> å‘ç°åŠ è½½äº† <code>src_buttonHi_js.js</code> æ–‡ä»¶ï¼Œå¹¶ä¸”æµè§ˆå™¨æ§åˆ¶å°è¾“å‡ºäº†æˆ‘ä»¬è¦æ‰“å°çš„æ–‡å­—ï¼Œç¬¬äºŒä¸ªæŒ‰é’®åŒç†ï¼Œä¹Ÿæ˜¯åœ¨ç‚¹å‡»çš„æ—¶å€™é‡‡å–ä¸»åŠ¨è¯·æ±‚ã€‚<br>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹æµè§ˆå™¨æ§åˆ¶å°é¢æ¿çš„ <code>preview</code> çœ‹çœ‹æœ¬æ¬¡çš„è¯·æ±‚çš„æ–‡ä»¶å†…å®¹åˆ°åº•æ˜¯ä»€ä¹ˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">(self[<span class="hljs-string">"webpackChunkcheckWebpackBundled"</span>] =<br>  self[<span class="hljs-string">"webpackChunkcheckWebpackBundled"</span>] || []).push([<br>  [<span class="hljs-string">"src_buttonHi_js"</span>],<br>  &#123;<br>    <span class="hljs-comment">/***/</span> <span class="hljs-string">"./src/buttonHi.js"</span>:<br>      <span class="hljs-comment">/*!*************************!*\<br>  !*** ./src/buttonHi.js ***!<br>  \*************************/</span><br>      <span class="hljs-comment">/***/</span> (<br>        __unused_webpack_module,<br>        __webpack_exports__,<br>        __webpack_require__<br>      ) =&gt; &#123;<br>        <span class="hljs-string">"use strict"</span>;<br>        <span class="hljs-built_in">eval</span>(<br>          <span class="hljs-string">"__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, &#123;\n/* harmony export */   \"default\": () =&gt; __WEBPACK_DEFAULT_EXPORT__\n/* harmony export */ &#125;);\nconst a = 'button-hi!'\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (a);\n\n//# sourceURL=webpack://checkWebpackBundled/./src/buttonHi.js?"</span><br>        );<br><br>        <span class="hljs-comment">/***/</span><br>      &#125;<br>  &#125;<br>]);<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å»æŸ¥çœ‹æ‰“åŒ…åçš„æ–‡ä»¶å‘ç°è¿™ä¸ª <code>webpackChunkcheckWebpackBundled</code> æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªå«åš <code>webpackJsonpCallback</code> çš„æ–¹æ³•ä¸­ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯åŠ¨æ€åŠ è½½çš„æ ¸å¿ƒã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs js">__webpack_require__.l = <span class="hljs-function">(<span class="hljs-params">url, done, key, chunkId</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (inProgress[url]) &#123;<br>    inProgress[url].push(done);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">var</span> script, needAttach;<br>  <span class="hljs-comment">// ......</span><br>  <span class="hljs-comment">// åŠ¨æ€åˆ›å»ºscriptæ ‡ç­¾çš„å¸¸è§„æ“ä½œ</span><br>  <span class="hljs-keyword">if</span> (!script) &#123;<br>    needAttach = <span class="hljs-literal">true</span>;<br>    script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"script"</span>);<br><br>    script.charset = <span class="hljs-string">"utf-8"</span>;<br>    script.timeout = <span class="hljs-number">120</span>;<br>    <span class="hljs-keyword">if</span> (__webpack_require__.nc) &#123;<br>      script.setAttribute(<span class="hljs-string">"nonce"</span>, __webpack_require__.nc);<br>    &#125;<br>    script.setAttribute(<span class="hljs-string">"data-webpack"</span>, dataWebpackPrefix + key);<br>    script.src = url;<br>  &#125;<br>  inProgress[url] = [done];<br><br>  <span class="hljs-comment">// ä¸€äº›é”™è¯¯å¤„ç†</span><br>  <span class="hljs-keyword">var</span> onScriptComplete = <span class="hljs-function">(<span class="hljs-params">prev, event</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// avoid mem leaks in IE.</span><br>    script.onerror = script.onload = <span class="hljs-literal">null</span>;<br>    clearTimeout(timeout);<br>    <span class="hljs-keyword">var</span> doneFns = inProgress[url];<br>    <span class="hljs-keyword">delete</span> inProgress[url];<br>    script.parentNode &amp;&amp; script.parentNode.removeChild(script);<br>    doneFns &amp;&amp; doneFns.forEach(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> fn(event));<br>    <span class="hljs-keyword">if</span> (prev) <span class="hljs-keyword">return</span> prev(event);<br>  &#125;;<br>  <span class="hljs-keyword">var</span> timeout = setTimeout(<br>    onScriptComplete.bind(<span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>, &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">"timeout"</span>, <span class="hljs-attr">target</span>: script &#125;),<br>    <span class="hljs-number">120000</span><br>  );<br>  script.onerror = onScriptComplete.bind(<span class="hljs-literal">null</span>, script.onerror);<br>  script.onload = onScriptComplete.bind(<span class="hljs-literal">null</span>, script.onload);<br>  <span class="hljs-comment">// å°†ç”Ÿæˆçš„æ ‡ç­¾æ’å…¥åˆ°headä¸­</span><br>  needAttach &amp;&amp; <span class="hljs-built_in">document</span>.head.appendChild(script);<br>&#125;;<br></code></pre></td></tr></table></figure><p>é™¤äº†è¿™ä¸ªæˆ‘ä»¬è¿˜èƒ½å‘ç°<code>__webpack_require__.l</code>ä¸­æœ‰åŠ¨æ€åˆ›å»º <code>script</code> æ ‡ç­¾ï¼Œæ’å…¥åˆ° <code>head</code> çš„æ“ä½œï¼Œä½†æ˜¯æœ¬æ¬¡æˆ‘ä»¬åªèƒ½çœ‹åˆ°åŠ¨æ€è¯·æ±‚ï¼Œå¹¶æ²¡å‘ç°åŠ¨æ€åˆ›å»º <code>script</code> æ’å…¥åˆ° <code>head</code> ä¸­çš„æ“ä½œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ„å»ºä¸€ä¸ªå•é¡µé¢åº”ç”¨æ¥æŸ¥çœ‹å’ŒéªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯åªæœ‰åœ¨è·¯ç”±æ‡’åŠ è½½çš„æ—¶å€™æ‰ä¼šå¦‚æ­¤è§¦å‘ã€‚</p><h2 id="è·¯ç”±æ‡’åŠ è½½"><a href="#è·¯ç”±æ‡’åŠ è½½" class="headerlink" title="è·¯ç”±æ‡’åŠ è½½"></a>è·¯ç”±æ‡’åŠ è½½</h2><p>è·¯ç”±æ‡’åŠ è½½æˆ‘ä»¬ä½¿ç”¨ <code>react-cli</code> æ¥åˆ›å»ºä¸€ä¸ªé¡¹ç›®æ¥éªŒè¯ä»¥åŠçœ‹ä¸€ä¸‹ï¼Œè·¯ç”±åŠ è½½çš„åŸç†ã€‚</p><p>æˆ‘ä»¬<code>npx create-react-app lazy-load-components</code>æ¥åˆ›å»ºä¸€ä¸ª <code>react</code> çš„é¡¹ç›®ï¼Œç„¶ååˆå§‹åŒ–ä¹‹åçš„ <code>src</code> æ–‡ä»¶ç›®å½•åº”è¯¥æ˜¯å¦‚ä¸‹è¿™æ ·:</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-string">|-- src</span><br>  <span class="hljs-string">|-- App.css</span><br>  <span class="hljs-string">|-- App.js</span><br>  <span class="hljs-string">|-- App.test.js</span><br>  <span class="hljs-string">|-- index.css</span><br>  <span class="hljs-string">|-- index.js</span><br>  <span class="hljs-string">|-- logo.svg</span><br>  <span class="hljs-string">|-- reportWebVitals.js</span><br>  <span class="hljs-string">|-- setupTests.js</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬éœ€è¦è·¯ç”±æ‡’åŠ è½½ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹ <code>react</code> çš„è·¯ç”±ï¼Œç»ˆç«¯æ‰§è¡Œ <code>yarn add react-router-dom</code>ï¼Œå®‰è£…æˆåŠŸä¹‹åæˆ‘ä»¬å¼€å§‹ç¼–å†™æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨ <code>src</code> ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹åˆ†åˆ«æ˜¯ <code>components</code> å’Œ <code>utils</code>ï¼Œåœ¨ <code>components</code> ä¸‹åˆ›å»º <code>User.jsx</code> å’Œ <code>About.jsx</code> å¹¶ä¸”åœ¨ <code>utils</code> ä¸‹åˆ›å»º <code>index.js</code> æ–‡ä»¶ã€‚æœ€åçš„ç›®å½•åº”è¯¥æ˜¯:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs undefined">|<span class="hljs-string">-- src<br>  </span>|<span class="hljs-string">-- App.css<br>  </span>|<span class="hljs-string">-- App.js<br>  </span>|<span class="hljs-string">-- App.test.js<br>  </span>|<span class="hljs-string">-- index.css<br>  </span>|<span class="hljs-string">-- index.js<br>  </span>|<span class="hljs-string">-- logo.svg<br>  </span>|<span class="hljs-string">-- reportWebVitals.js<br>  </span>|<span class="hljs-string">-- setupTests.js<br>  </span>|<span class="hljs-string">-- components // æ–°å¢<br>  </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- About.jsx<br>  </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- User.jsx<br>  </span>|<span class="hljs-string">-- utils // æ–°å¢<br>      </span>|<span class="hljs-string">-- index.js</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç¼–å†™ï¼š<br><code>About.jsx</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;<br><span class="hljs-keyword">const</span> About = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>About ä»Šå¤©å¤©æ°”ä¸é”™ï¼<span class="hljs-tag">&lt;/&gt;</span>;<br>&#125;;<br>export default About;</span><br></code></pre></td></tr></table></figure><p><code>User.jsx</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;<br><span class="hljs-keyword">const</span> User = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>User åœ¨å¹²å˜›ï¼Ÿåƒäº†å—ï¼Ÿåƒçš„å•¥ï¼Ÿ<span class="hljs-tag">&lt;/&gt;</span>;<br>&#125;;<br>export default User;</span><br></code></pre></td></tr></table></figure><p><code>utils -&gt; index.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;<br><span class="hljs-keyword">const</span> Loading = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>loading<span class="hljs-tag">&lt;/&gt;</span>;<br>/**<br> * å®ç°è·¯ç”±åˆ†å‰²<br> * éœ€è¦é…åˆReact.Suspense<br> * @param &#123;*&#125; components ä¼ é€’ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åŠ¨æ€å¯¼å…¥çš„ç»„ä»¶<br> */<br>export default function dynamic(components) &#123;<br>  const LazyComponents = React.lazy(components);<br>  return () =&gt; (<br>    <span class="hljs-tag">&lt;<span class="hljs-name">React.Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Loading</span> /&gt;</span>&#125;&gt;<br>      <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponents</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">React.Suspense</span>&gt;</span><br>  );<br>&#125;</span><br></code></pre></td></tr></table></figure><p><code>src -&gt; index.js</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs diff">import React from 'react';<br>import './index.css';<br><span class="hljs-deletion">- import App from './App';</span><br>import reportWebVitals from './reportWebVitals';<br>import ReactDOM from 'react-dom';<br><span class="hljs-addition">+ import &#123; HashRouter, Link, Route &#125; from 'react-router-dom';</span><br><span class="hljs-addition">+ import dynamic from './utils'</span><br><span class="hljs-addition">+ const dynamicAbout = dynamic(() =&gt; import('./components/About'))</span><br><span class="hljs-addition">+ const dynamicUser = dynamic(() =&gt; import('./components/User'))</span><br><br>ReactDOM.render(<br>  &lt;React.StrictMode&gt;<br><span class="hljs-deletion">-    &lt;App /&gt;</span><br><span class="hljs-addition">+    &lt;HashRouter&gt;</span><br><span class="hljs-addition">+      &lt;Link to="/"&gt;Useré¡µé¢&lt;/Link&gt;&lt;br/&gt;</span><br><span class="hljs-addition">+      &lt;Link to="/about"&gt;åˆ‡æ¢åˆ°Abouté¡µé¢&lt;/Link&gt;&lt;br/&gt;</span><br><span class="hljs-addition">+      &lt;Route exact=&#123;true&#125; path="/" component=&#123;dynamicUser&#125;/&gt;</span><br><span class="hljs-addition">+      &lt;Route path="/about" component=&#123;dynamicAbout&#125; /&gt;</span><br><span class="hljs-addition">+    &lt;/HashRouter&gt;</span><br>  &lt;/React.StrictMode&gt;,<br>  document.getElementById('root')<br>);<br><br>// If you want to start measuring performance in your app, pass a function<br>// to log results (for example: reportWebVitals(console.log))<br>// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals<br>reportWebVitals();<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆä¹‹åä¿å­˜ï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯æ‰§è¡Œ <code>npm start</code>ï¼Œè‡ªåŠ¨æ‰“å¼€é¡µé¢ï¼Œæˆ‘ä»¬å‘ç°ä¿®æ”¹çš„å†…å®¹å·²ç»ç”Ÿæ•ˆäº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ¥å›å¿†ä¸€ä¸‹ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹ <code>webpack</code> ä¼šå°†æ‰“åŒ…çš„æ–‡ä»¶æ”¾åœ¨å†…å­˜ä¸­ï¼Œå…¶å®è·Ÿæ‰‹åŠ¨ <code>build</code> ä»¥æ–‡ä»¶çš„æ–¹å¼åŒºåˆ«ä¸å¤§ï¼Œåªæ˜¯åœ¨å†…å­˜ä¸­è¿™æ ·è¯»å–ä¼šå¾ˆå¿«ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡æ–°åˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼ŒåŠ è½½çš„æ—¶å€™æŸ¥çœ‹ä¸€ä¸‹æµè§ˆå™¨çš„ <code>network</code> é¢æ¿ï¼Œå‘ç°åŠ è½½äº†å¾ˆå¤šæ–‡ä»¶ï¼Œæˆ‘ä»¬èƒ½å‘ç°å…¶ä¸­ <code>3.chunk.js</code> å°±æ˜¯æˆ‘ä»¬çš„é¦–é¡µä¹Ÿå°±æ˜¯ <code>User.js</code>ï¼Œé‡Œé¢çš„é€»è¾‘å°±æ˜¯ä¸€ä¸ª <code>webpackJsonp</code> åŠ è½½å¯¹åº”çš„ <code>chunk</code> æ–‡ä»¶ï¼Œå†ä¸‹è¾¹æ˜¯ä¸€äº›çƒ­æ¨¡å—æ›´æ–°çš„å†…å®¹ã€‚ç„¶åç°åœ¨æˆ‘ä»¬åˆ‡æ¢ä¸€ä¸‹é¢æ¿åˆ° <code>Elements</code>ï¼Œåˆ° <code>head</code> ä¸‹æŸ¥çœ‹ä¸€ä¸‹ï¼Œå‘ç°æ­¤æ—¶çš„ <code>script</code> åªæœ‰ <code>3.chunk.js</code> ä¹Ÿå°±æ˜¯ <code>User.js</code>ã€‚<br><img src="../../../../images/initChunk.png" srcset="/img/loading.gif" alt="åˆå§‹åŒ–åŠ è½½"></p><p>æˆ‘ä»¬åˆ‡æ¢è·¯ç”±åˆ° <code>about</code> é¡µé¢ï¼Œå†æ¥è§‚å¯Ÿï¼Œå‘ç°é¡µé¢ <code>network</code> åŠ è½½äº†æˆ‘ä»¬å¯¹åº”çš„ç»„ä»¶ï¼Œå¹¶ä¸” <code>Elements</code> çš„ <code>head</code> ä¸­å¢åŠ äº†ä¸€ä¸ª <code>script</code> æ ‡ç­¾ï¼Œå…¶ <code>src</code> å°±æ˜¯æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„ <code>2.chunk.js</code> ä¹Ÿå°±è¯´ï¼Œåœ¨æˆ‘ä»¬åˆ‡æ¢è·¯ç”±çš„æ—¶å€™æµè§ˆå™¨å»ä¸‹è½½äº†å¯¹ç”¨çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ’å…¥åˆ° <code>head</code> ä¸­ï¼Œä»è€Œå®ç°æˆ‘ä»¬åœ¨è·¯ç”±åˆ‡æ¢å®Œæˆä¹‹åï¼Œçœ‹åˆ°äº†å¯¹åº”ç»„ä»¶æˆ–è€…é¡µé¢çš„æ˜¾ç¤ºã€‚æ‰€ä»¥è¿™å°±éªŒè¯äº†æˆ‘ä»¬ç¬¬ä¸€æ­¥é‡Œçš„ä»£ç åˆ†æåŠ¨æ€åŠ è½½ <code>script</code> çš„é‚£å—ã€‚<br><img src="../../../../images/%E5%8A%A0%E8%BD%BDabout%E7%BB%84%E4%BB%B6.jpg" srcset="/img/loading.gif" alt="åˆ‡æ¢è·¯ç”±çš„æ—¶å€™networkä¸‹è½½çš„chunk"><br><img src="../../../../images/%E5%8A%A0%E8%BD%BDaboutScript%E5%88%B0head%E4%B8%AD.jpg" srcset="/img/loading.gif" alt="åˆ‡æ¢è·¯ç”±çš„æ—¶å€™åŠ¨æ€åŠ è½½çš„scriptè„šæœ¬"></p><p>æ€»ç»“ï¼šæ‰€ä»¥è‡³æ­¤æˆ‘ä»¬å¤§æ¦‚èƒ½å¤Ÿæ¸…æ¥šæµè§ˆå™¨æ˜¯å¦‚ä½•åŠ è½½æˆ‘ä»¬ <code>webpack</code> æ‰“åŒ…åçš„æ–‡ä»¶ï¼Œæµç¨‹å¤§æ¦‚åº”è¯¥æ˜¯ï¼š<code>webpack</code> å°†æ–‡ä»¶æœ€ç»ˆéƒ½æ‰“åŒ…æˆä¸º<code>webpack_modules</code>çš„ä¸€ä¸ªäº’ç›¸ä¾èµ–çš„ <code>kay:value</code> çš„ä¸€ä¸ªæ˜ å°„ï¼Œæœ€å¤–å±‚æ˜¯ <code>webpackBootstrap</code> çš„ä¸€ä¸ª <code>IIFE</code>ï¼Œ<code>IIFE</code> çš„æœ€ä¸‹è¾¹å¼€å§‹æ‰§è¡Œ<code>webpack_require(&quot;./src/main.js&quot;)</code>ä¹Ÿå°±æ˜¯æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œå› ä¸ºå·²ç»å½¢æˆäº†ä¾èµ–ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œå¯¹åº”æ–‡ä»¶çš„æ—¶å€™ä¼šæŒ‰ç…§æˆ‘ä»¬ä»£ç ç¼–å†™çš„é¢„æœŸæ‰§è¡Œï¼Œè‡³äºåŠ¨æ€åŠ è½½çš„æ—¶å€™ï¼ŒåŠ¨æ€åŠ è½½æ–¹æ³•åªæ˜¯åœ¨è§¦å‘å¯¹åº”çš„äº‹ä»¶çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œé€»è¾‘ï¼Œè€Œè·¯ç”±çš„æ‡’åŠ è½½åˆ™æ˜¯ï¼Œåœ¨åˆ‡æ¢è·¯ç”±ä¹‹åï¼Œæµè§ˆå™¨ä¼šå‘èµ·ä¸€ä¸ªå¯¹åº”çš„ <code>chunk</code> çš„è¯·æ±‚ï¼Œå°†è¿™ä¸ªè¯·æ±‚çš„æ–‡ä»¶ä¸‹è½½æˆåŠŸä¹‹åï¼Œé€šè¿‡åŠ¨æ€åˆ›å»º <code>script</code> çš„å½¢å¼æ’å…¥åˆ° <code>head</code> æ ‡ç­¾ä¸­ï¼Œä»è€Œå®ç°åŠ¨æ€åŠ è½½ã€‚</p><h2 id="HMR-çƒ­æ¨¡å—æ›´æ–°æœºåˆ¶"><a href="#HMR-çƒ­æ¨¡å—æ›´æ–°æœºåˆ¶" class="headerlink" title="HMR çƒ­æ¨¡å—æ›´æ–°æœºåˆ¶"></a>HMR çƒ­æ¨¡å—æ›´æ–°æœºåˆ¶</h2><p>æˆ‘ä»¬èƒ½å¤Ÿåœ¨åˆšåˆšçš„æˆªå›¾ä¸­å‘ç°ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™æœ‰ä¸€ä¸ª <code>ws://localhost:3000/sockjs-node</code> çš„è¯·æ±‚ï¼Œé‚£è¿™ä¸ªä¸œè¥¿æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿå…¶å®è¿™å°±æ˜¯çƒ­æ¨¡å—æ›´æ–°çš„é‡è¦çš„æœºåˆ¶ã€‚<br><img src="../../../../images/%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96.png" srcset="/img/loading.gif" alt="åˆå§‹åŒ–åŠ è½½çƒ­æ¨¡å—æ›´æ–°çš„ä¸€äº›èµ„æº"></p><p>æˆ‘ä»¬å…ˆä¿®æ”¹ä¸€ä¸‹ <code>About</code> ç»„ä»¶çš„å†…å®¹ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs diff">import React from 'react'<br>const About = () =&gt; &#123;<br>  return &lt;&gt;<br>    å…³äºç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯å“ˆ<br><span class="hljs-addition">+    &lt;h1&gt;è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜&lt;/h1&gt;</span><br>  &lt;/&gt;<br>&#125;<br>export default About<br></code></pre></td></tr></table></figure><p>ä¿å­˜ä¹‹åï¼Œå‘ç°é¡µé¢è‡ªåŠ¨æ›´æ–°äº†å¹¶ä¸” <code>network</code> è‡ªåŠ¨åŠ è½½äº†ä¸¤ä¸ªæ–‡ä»¶ä¸€ä¸ªæ˜¯ <code>json</code> æ–‡ä»¶ä¸€ä¸ªæ˜¯ <code>js</code> æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›ä¸œè¥¿æ˜¯ä»€ä¹ˆã€‚<br><img src="../../../../images/%E7%94%9F%E6%88%90json-js%E6%96%87%E4%BB%B6.jpg" srcset="/img/loading.gif" alt="ç¬¬ä¸€æ¬¡çƒ­æ›´æ–°åŠ è½½çš„æ–‡ä»¶"></p><p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨æˆ‘ä»¬åˆå§‹åŒ–çš„ <code>ws</code> é‡Œæ¥å—çš„ <code>data</code> çš„æ˜¯ä¸€ä¸ª <code>205487be9270982f923b</code> çš„ <code>hash</code> å€¼ï¼Œåœ¨æˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶ä¿å­˜ä¹‹åï¼Œçƒ­æ¨¡å—è‡ªåŠ¨æ›´æ–°çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ª <code>205487be9270982f923b.hot-update.json</code> å’Œ<code>[chunkId].205487be9270982f923b.hot-update.js</code> çš„æ–‡ä»¶ï¼Œè¿™ä¸ª <code>json</code> æ–‡ä»¶è¿”å›äº†ä¸€ä¸ª <code>e3ab8e66727600303a2d</code> çš„ <code>hash</code> æ˜¯ç”¨äºè¿æ¥ä¸‹æ¬¡çƒ­æ›´æ–°çš„äºæœ¬æ¬¡ç±»ä¼¼çš„åŠ è½½æ“ä½œï¼Œè€Œ <code>js</code> æ–‡ä»¶åˆ™æ˜¯çƒ­æ¨¡å—æ›´æ–°é‡æ–°æ‰“åŒ…çš„éœ€è¦æ‰§è¡Œçš„æ–‡ä»¶å†…å®¹ï¼ŒåŒæ ·æˆ‘ä»¬åˆ‡æ¢åˆ° <code>Elements</code> èƒ½å¤Ÿå‘ç°ï¼Œçƒ­æ¨¡å—æ›´æ–°çš„æ—¶å€™ä¸‹è½½çš„æ–‡ä»¶ä¹Ÿæ˜¯è¢«ç›´æ¥æ’å…¥åˆ° <code>head</code> æ ‡ç­¾ä¸­çš„ä»è€Œå®ç° <code>script</code> çš„å®æ—¶æ›¿æ¢å’Œé¡µé¢è‡ªåŠ¨åˆ·æ–°ã€‚<br><img src="../../../../images/hot-load-add-script.jpg" srcset="/img/loading.gif" alt="çƒ­æ¨¡å—æ›´æ–°æ’å…¥è„šæœ¬"></p><p>æ€»ç»“ï¼šçƒ­æ¨¡å—æ›´æ–°çš„æœºåˆ¶å¤§è‡´æ˜¯å’Œæ‡’åŠ è½½çš„é€»è¾‘ç›¸åŒï¼Œåªä¸è¿‡å…¶åœ¨åˆå§‹åŒ–æ—¶å€™ï¼Œå¼€å¯äº†ä¸€ä¸ª <code>ws</code> çš„è¯·æ±‚ï¼Œå½“ä¿®æ”¹æ–‡ä»¶ä¿®æ”¹çš„æ—¶å€™ï¼Œ<code>webpack</code> ä¼šç›‘å¬æ–‡ä»¶çš„å˜åŠ¨ï¼Œ<code>ws</code> æ¥å— <code>hash</code> ä½œä¸ºä¸‹ä¸€æ¬¡çƒ­æ›´æ–°çš„æ–‡ä»¶è¯·æ±‚ï¼Œå› ä¸ºåœ¨åˆå§‹åŒ–å’Œæ¯ä¸€æ¬¡ä¿®æ”¹ä¹‹åéƒ½ä¼šç”Ÿæˆä¸‹ä¸€æ¬¡çƒ­æ›´æ–°çš„ä¸€ä¸ªéœ€æ±‚è¯·æ±‚æ–‡ä»¶çš„ <code>hash</code>ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹æ–‡ä»¶ä¹‹åï¼Œæµè§ˆå™¨ä¼šæ ¹æ®ä¸Šä¸€æ¬¡çš„çƒ­æ¨¡å—ç”Ÿæˆçš„ <code>hash</code> æ¥ä¸‹è½½ä¸‹ä¸€æ¬¡çš„æ›´æ–°çš„ <code>js</code>ï¼Œæµè§ˆå™¨ä¸‹è½½å®Œæˆçƒ­æ›´æ–°æ‰“åŒ…çš„ <code>js</code> ä¹‹åå†å¦‚åŒæ‡’åŠ è½½ä¸€æ ·ï¼ŒåŠ¨æ€åˆ›å»º <code>script</code> è„šæœ¬æ’å…¥åˆ° <code>head</code> æ ‡ç­¾ä¸­ï¼Œå®ç°è‡ªåŠ¨æ›´æ–°é¡µé¢ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»é›¶å¼€å§‹æ‰‹å†™ä¸€ä¸ªç®€å•çš„ loaderï¼ˆäºŒï¼‰</title>
    <link href="/2021/01/26/markdownToHtmlLoaderOptimization/"/>
    <url>/2021/01/26/markdownToHtmlLoaderOptimization/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯å…³äº <code>webpack</code> çš„ä¸€äº›æ‰©å±•ã€‚</p><p><a href="https://tennesseesunshine.github.io/2021/01/25/markdownToHtmlLoader/" target="_blank" rel="noopener">ä»é›¶å¼€å§‹æ‰‹å†™ä¸€ä¸ªç®€å•çš„ loaderï¼ˆä¸€ï¼‰</a> é‡Œé¢å·²ç»ç”Ÿæˆäº† <code>html</code> å­—ç¬¦ä¸²å¹¶ä¸”æ¸²æŸ“åˆ°äº†é¡µé¢ã€‚ä½†æ˜¯æˆ‘ä»¬å‘ç°å…¶æ ·å¼æ— ç¾æ„Ÿï¼Œé‚£è¿™ä¸€æœŸæˆ‘ä»¬å¢åŠ ä¸€äº›æ ·å¼ï¼Œå°†ç”Ÿæˆçš„ <code>html</code> æ¸²æŸ“çš„åƒå’±ä»¬åšå®¢ä¸­çš„é‚£æ ·ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çš„ <code>loader</code> æ˜¯ <code>css-loader</code> å’Œ <code>style-loader</code>ï¼Œæˆ‘ä»¬å¼€å§‹å®‰è£…è¿™ä¸¤ä¸ªä¾èµ–ã€‚<br><code>css-loader</code> ç”¨äºå°† <code>css</code> å¯ä»¥æ¨¡å—åŒ–çš„å¼•å…¥ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º <code>js</code> ä»£ç ï¼Œ<code>style-loader</code> ç”¨äºå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„ <code>js</code> ä¸­åŒ…å«çš„ <code>css</code>ï¼Œç”Ÿæˆå¯ç”¨çš„æ ·å¼å¹¶ä¸”ï¼Œé€šè¿‡ç”Ÿæˆ <code>style</code> æ ‡ç­¾æ’å…¥åˆ° <code>head</code> æ ‡ç­¾ä¸­ã€‚</p><ul><li>å®‰è£…ä¾èµ–</li></ul><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">cnpm install --<span class="hljs-built_in">save</span>-dev css-loader <span class="hljs-built_in">style</span>-loader<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç€æ¥é…ç½® <code>webpack.config.js</code> æ–‡ä»¶ï¼Œåœ¨ <code>module</code> çš„ <code>rules</code> é‡Œå†åŠ ä¸Šä¸€ä¸ªåŒ¹é…é¡¹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">rules: [<br>  &#123;<br>    <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.md$/</span>,<br>    <span class="hljs-attr">use</span>: [<br>      <span class="hljs-string">'./loader/md2html-loader.js'</span><br>    ]<br>  &#125;,<br>+  &#123;<br>+    test: <span class="hljs-regexp">/\.css$/</span>,<br>+    use: [<br>+      <span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span><br>+    ]<br>+  &#125;<br>]<br></code></pre></td></tr></table></figure><ul><li>åˆ›å»º <code>css</code> æ–‡ä»¶</li></ul><p>ç´§æ¥ç€æˆ‘ä»¬åœ¨ <code>src</code> ä¸‹åˆ›å»ºä¸€ä¸ª <code>index.css</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ <code>css</code> æ ·å¼ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">pre</span> &#123;<br>  <span class="hljs-attribute">display</span>: block;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#282c34</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">24px</span>;<br>  <span class="hljs-attribute">text-align</span>: left;<br>  <span class="hljs-attribute">font-family</span>: Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid transparent;<br>  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.4</span>;<br>  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;<br>  <span class="hljs-attribute">overflow-x</span>: auto;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">13px</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">white-space</span>: pre;<br>  <span class="hljs-attribute">word-spacing</span>: normal;<br>  <span class="hljs-attribute">word-break</span>: normal;<br>  <span class="hljs-attribute">word-wrap</span>: normal;<br>&#125;<br><br><span class="hljs-selector-tag">pre</span> <span class="hljs-selector-tag">code</span> &#123;<br>  <span class="hljs-attribute">font-family</span>: inherit;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-tag">code</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.2em</span> <span class="hljs-number">0.4em</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">85%</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(27, 31, 35, 0.05);<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>;<br>  <span class="hljs-attribute">color</span>: palevioletred;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¼•å…¥æ ·å¼æ–‡ä»¶</li></ul><p>ç„¶åæˆ‘ä»¬å›åˆ° <code>main.js</code> é‡Œå°† <code>index.css</code> å¼•å…¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">"./index.css"</span>;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å†å»ç»ˆç«¯è¿è¡Œ <code>npx webpack</code>ï¼Œå†åˆ·æ–°é¡µé¢ï¼Œå‘ç°ç”Ÿæˆçš„ <code>html</code> å·²ç»è¢«æˆ‘ä»¬åŠ ä¸Šäº†æ ·å¼ã€‚</p><p><img src="../../../../images/rander-html.png" srcset="/img/loading.gif" alt="æœ€ç»ˆæ¸²æŸ“çš„é¡µé¢"></p><p>æˆªè‡³ç›®å‰æˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªå¯ä»¥ç”Ÿæˆ <code>html</code> çš„ <code>loader</code>ï¼Œå¹¶ä¸”å·²ç»ä¸ºå…¶åŠ ä¸Šäº†æ ·å¼ã€‚</p><p>æˆ‘ä»¬ç›®å‰ç”¨çš„æ˜¯ <code>style-loader</code> æ˜¯å°†ç”Ÿæˆçš„ <code>css</code> é€šè¿‡ <code>style</code> çš„æ–¹å¼æ’å…¥åˆ° <code>head</code> æ ‡ç­¾ä¸­ã€‚å…¶å®æˆ‘ä»¬è¿˜æœ‰ä¸€ç§åŠæ³•ï¼Œå°† <code>css</code> æå–å‡ºæ¥ï¼Œä½œä¸ºå•ä¸ªæ–‡ä»¶é€šè¿‡ <code>link</code> æ ‡ç­¾åŠ è½½ã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚</p><ul><li>æå– <code>css</code></li></ul><p>è¦æå– <code>css</code> æ ·å¼æ–‡ä»¶ï¼Œ<code>webpack4.0</code> ä¹‹åç”¨çš„æ’ä»¶å«: <code>mini-css-extract-plugin</code><br>æˆ‘ä»¬æ¥å®‰è£…è¿™ä¸ªæ’ä»¶:</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">cnpm install --<span class="hljs-built_in">save</span>-<span class="hljs-built_in">dev</span> mini-css-extract-plugin<br></code></pre></td></tr></table></figure><p>å› ä¸º <code>style-loader</code> å’Œ <code>mini-css-extract-plugin</code> æ’ä»¶ä¸èƒ½å…±å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ é™¤ <code>webpack</code> ä¸­ä¹‹å‰é…ç½®çš„ <code>style-loader</code>ï¼Œæ·»åŠ  <code>mini-css-extract-plugin</code>ï¼Œå…·ä½“ä¿®æ”¹å¦‚ä¸‹ï¼š</p><p><code>webpack.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js">+ <span class="hljs-keyword">const</span> MiniCssExtractPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>);<br><br><span class="hljs-built_in">module</span>: &#123;<br>  <span class="hljs-attr">rules</span>: [<br>    &#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.md$/</span>,<br>      <span class="hljs-attr">use</span>: [<br>        <span class="hljs-string">'./loader/md2html-loader.js'</span><br>      ]<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,<br>      <span class="hljs-attr">use</span>: [<br>+        MiniCssExtractPlugin.loader, <span class="hljs-string">'css-loader'</span><br>      ]<br>    &#125;<br>  ]<br>&#125;,<br><span class="hljs-attr">plugins</span>: [<br>  <span class="hljs-keyword">new</span> CleanWebpackPlugin(),<br>  <span class="hljs-keyword">new</span> HtmlWebpackPlugin(),<br>+  <span class="hljs-keyword">new</span> MiniCssExtractPlugin()<br>]<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å»ç»ˆç«¯è¿è¡Œ <code>npx webpack</code>ï¼Œåˆ·æ–°é¡µé¢å‘ç°æ ·å¼æ²¡æ”¹å˜å†å»çœ‹å¼€å‘äººå‘˜é€‰é¡¹ï¼Œå‘ç°æ ·å¼æ–‡ä»¶ç›®å‰æ˜¯é€šè¿‡ <code>link</code> æ ‡ç­¾å¼•å…¥çš„ï¼Œè¯æ˜æˆ‘ä»¬çš„æå– <code>css</code> é…ç½®æ˜¯ç”Ÿæ•ˆçš„ã€‚</p><p><img src="../../../../images/link-element.jpg" srcset="/img/loading.gif" alt="æ§åˆ¶å°æ ‡ç­¾å…ƒç´ "></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä¸€ä¸ªç®€å•çš„ <code>loader</code> å°±å…¨éƒ¨å®Œæˆäº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»é›¶å¼€å§‹æ‰‹å†™ä¸€ä¸ªç®€å•çš„ loaderï¼ˆä¸€ï¼‰</title>
    <link href="/2021/01/25/markdownToHtmlLoader/"/>
    <url>/2021/01/25/markdownToHtmlLoader/</url>
    
    <content type="html"><![CDATA[<p>é‡å­¦ <code>webpack</code> ä¹‹åï¼Œå¯¹ <code>webpack</code> çš„ç†è§£åˆä¸Šäº†ä¸€ä¸ªå±‚æ¬¡ï¼Œ<code>webpack</code> çš„ <code>loader</code> ä½œä¸ºå…¶ä¸€ä¸ªéå¸¸é‡è¦çš„é“¾è·¯ï¼Œèƒ½ç”¨è‡ªå®šä¹‰çš„ <code>loader</code> æ¥å¤„ç†æ—¥å¸¸å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜ä¿¨ç„¶å·²ç»æˆä¸ºäº†ä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆçš„åŸºæœ¬ç´ å…»ï¼Œæ‰€ä»¥æœ€åŸºæœ¬çš„è¦æ±‚å°±æ˜¯èƒ½å¤Ÿæ‰‹å†™è‡ªå®šä¹‰çš„ <code>loader</code>ã€‚</p><p><code>webpack</code> è‡ªèº«åªèƒ½å¤Ÿå¤„ç† <code>JS</code> å’Œ <code>JSON</code> æ–‡ä»¶ï¼Œè€Œä½œä¸ºéæ­¤äºŒè€…çš„å…¶ä»–æ–‡ä»¶ï¼Œ<code>webpack</code> ä¹Ÿæ˜¯æ”¯æŒå…¶ä½œä¸ºæ¨¡å—é€šè¿‡ <code>importã€exportã€export.default</code> ç­‰ï¼Œæ‰€ä»¥åœ¨å¯¹è¿™äº›æ–‡ä»¶å¤„ç†çš„æ—¶å€™ï¼Œå°±éœ€è¦å¯¹åº”çš„ä¸€äº› <code>loader</code> æ¥è§£æï¼Œä¾‹å¦‚åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ <code>sass</code>ï¼Œé‚£è‚¯å®šæ˜¯ä¸èƒ½ç¼ºå°‘è§£æ <code>sass</code> çš„ <code>loader</code>ã€‚ä½¿ç”¨ <code>ts</code> å°‘ä¸äº† <code>ts-loader</code> ç­‰ç­‰ã€‚</p><p>è€Œä¸” <code>loader</code> åœ¨ <code>webpack</code> ä¸­æ˜¯å¯ä»¥è¿›è¡Œä¸²è”è°ƒç”¨ï¼Œä»å…¶ä»åå¾€å‰æˆ–è€…ä»å³å¾€å·¦çš„é¡ºåºå¯ä»¥çŸ¥é“ï¼Œ<code>webpack</code> é‡‡ç”¨çš„æ˜¯ <code>compose</code> çš„æ–¹å¼æ¥åœ¨ä¸‹ä¸€ä¸ª <code>loader</code> ä¸­ç»“åˆä¸Šä¸€ä¸ª <code>loader</code> å¤„ç†å®Œçš„ç»“æœã€‚å…¶å®åœ¨è¿™ç§ä¸²è”ç»„åˆä¸­çš„ <code>loader</code> å¹¶ä¸ä¸€å®šè¦è¿”å› <code>JS</code> ä»£ç ã€‚åªè¦ä¸‹æ¸¸çš„ <code>loader</code> èƒ½æœ‰æ•ˆå¤„ç†ä¸Šæ¸¸ <code>loader</code> çš„è¾“å‡ºï¼Œé‚£ä¹ˆä¸Šæ¸¸çš„ <code>loader</code> å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„æ¨¡å—ã€‚</p><p>ä»Šå¤©çš„ä»»åŠ¡æ˜¯å†™ä¸€ä¸ªï¼Œå°† <code>markdown</code> è½¬ä¸º <code>html</code> çš„ <code>loader</code>ã€‚</p><h2 id="ä¾èµ–åˆ†æ"><a href="#ä¾èµ–åˆ†æ" class="headerlink" title="ä¾èµ–åˆ†æ"></a>ä¾èµ–åˆ†æ</h2><p>å…ˆåˆ†æä¸€ä¸‹æ„å»ºè¿™äº›ï¼Œ <code>webpack</code> å·¥å…·éœ€è¦å“ªäº›ä¸œè¥¿ï¼Œé¦–å…ˆè‚¯å®šéœ€è¦ <code>webpack</code> å’Œ <code>webpack-cli</code> ä½œä¸ºæœ€åŸºç¡€çš„ä¾èµ–ï¼Œç„¶åéœ€è¦ <code>marked</code> å°† <code>md</code> æ–‡ä»¶è½¬ä¸º <code>html</code>ï¼Œè€Œä¸”å³ä¾¿å¾ˆç®€å•çš„ <code>loader</code>ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ª <code>CleanWebpackPlugin</code> å’Œ <code>HtmlWebpackPlugin</code> ä½œä¸ºåœ¨æ‰“åŒ…ä¹‹å‰å’ŒæˆåŠŸä¹‹åæœ€åº•å±‚çš„æ”¯æŒï¼Œä¸€ä¸ªç”¨äºæ¸…é™¤æ‰“åŒ…ç»“æœï¼Œä¸€ä¸ªç”¨äºç”Ÿæˆæ‰“åŒ…åçš„ <code>html</code> æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬æ±‡æ€»ä¸€ä¸‹éœ€è¦å®‰è£…çš„å‡ ä¸ªä¾èµ–ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-bullet">- </span>webpack<br><span class="hljs-bullet">- </span>webpack-cli<br><span class="hljs-bullet">- </span>marked<br><span class="hljs-bullet">- </span>CleanWebpackPlugin<br><span class="hljs-bullet">- </span>HtmlWebpackPlugin<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ã€æ–‡ä»¶"><a href="#åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ã€æ–‡ä»¶" class="headerlink" title="åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ã€æ–‡ä»¶"></a>åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ã€æ–‡ä»¶</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ©ç”¨ <code>npm</code> è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª <code>package.json</code> æ–‡ä»¶ï¼š</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-built_in">npm</span> init -y<br></code></pre></td></tr></table></figure><p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>src</code> æ–‡ä»¶å¤¹ã€<code>loader</code> æ–‡ä»¶å¤¹ä»¥åŠå…¶å­æ–‡ä»¶ <code>md2html-loader.js</code> å’Œ <code>webpack.config.js</code> æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ <code>src</code> ä¸‹åˆ›å»º <code>index.mdã€main.js</code>ï¼ŒæˆåŠŸä¹‹åæˆ‘ä»¬çš„æ–‡ä»¶å¤¹ç›®å½•åº”è¯¥æ˜¯ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs undefined">+ src<br>  - index<span class="hljs-selector-class">.md</span><br>  - main<span class="hljs-selector-class">.js</span><br>+ loader<br>  - md2html-loader<span class="hljs-selector-class">.js</span><br>- package<span class="hljs-selector-class">.json</span><br>- webpack<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span><br></code></pre></td></tr></table></figure><h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h2><p>æˆ‘ä»¬åˆ©ç”¨ <code>cnpm</code> ä¸€æ¬¡æ€§å°†æ‰€éœ€è¦çš„ä¾èµ–å…¨éƒ¨å®‰è£…å®Œæˆã€‚</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">cnpm install --<span class="hljs-keyword">save</span>-dev html-webpack-<span class="hljs-keyword">plugin</span> webpack webpack-<span class="hljs-keyword">cli</span> marked clean-webpack-<span class="hljs-keyword">plugin</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹ä¸‹è½½æˆåŠŸä¹‹åçš„ä¾èµ–åˆ†åˆ«éƒ½æ˜¯ä»€ä¹ˆç‰ˆæœ¬ã€‚å‘ç° <code>clean-webpack-plugin</code> æ˜¯ <code>3.0.0</code>ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬éœ€è¦è§£æ„å‡ºæ„é€ å‡½æ•°ä»è€Œå®ä¾‹åŒ–ï¼Œå¦åˆ™ <code>webpack</code> ä¼šæŠ›å‡º<code>TypeError: CleanWebpackPlugin is not a constructor</code>çš„é”™è¯¯ã€‚</p><ul><li><code>package.json</code></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">"devDependencies": &#123;<br>  "clean-webpack-plugin": "^3.0.0",<br>  "html-webpack-plugin": "^4.5.1",<br>  "marked": "^1.2.7",<br>  "webpack": "^5.17.0",<br>  "webpack-cli": "^4.4.0"<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç¼–å†™æ–‡ä»¶å†…å®¹"><a href="#ç¼–å†™æ–‡ä»¶å†…å®¹" class="headerlink" title="ç¼–å†™æ–‡ä»¶å†…å®¹"></a>ç¼–å†™æ–‡ä»¶å†…å®¹</h2><ul><li><code>index.md</code></li></ul><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-comment"># ä»Šå¤©æ˜¯ 2021 å¹´ï¼Œå¼€å§‹è®¤çœŸå·¥ä½œçš„ä¸€å¤©</span><br><br>è¿™æ˜¯ä¸€ä¸ªæ®µè½<br><br>- è¿™æ˜¯ç¬¬ä¸€é¡¹<br>- è¿™æ˜¯ç¬¬äºŒé¡¹<br><br>è¿™æ˜¯ä¸€æ®µè½`code`<br><br>const <span class="hljs-keyword">a</span> = <span class="hljs-string">'webpack-demo'</span><br>console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'a'</span>, <span class="hljs-keyword">a</span>)<br></code></pre></td></tr></table></figure><ul><li><code>main.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> md <span class="hljs-keyword">from</span> <span class="hljs-string">"./index.md"</span>;<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">"md"</span>, md);<br></code></pre></td></tr></table></figure><ul><li><code>md2html-loader.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">source</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"source"</span>, source);<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">"source"</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li><code>webpack.config.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack"</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);<br><span class="hljs-keyword">const</span> HtmlWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);<br><span class="hljs-keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">"clean-webpack-plugin"</span>);<br><br><span class="hljs-comment">// å¢åŠ Configurationæ˜¯ä¸ºäº†é…ç½®çš„keyæç¤º</span><br><span class="hljs-comment">/**<br> * @type &#123;webpack.Configuration&#125;<br> */</span><br><span class="hljs-keyword">const</span> config = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">"./src/main.js"</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">"bundle.js"</span>,<br>    <span class="hljs-attr">path</span>: path.join(__dirname, <span class="hljs-string">"dist"</span>)<br>  &#125;,<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">"development"</span>,<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.md$/</span>,<br>        <span class="hljs-attr">use</span>: [<span class="hljs-string">"./loader/md2html-loader.js"</span>]<br>      &#125;<br>    ]<br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> CleanWebpackPlugin(), <span class="hljs-keyword">new</span> HtmlWebpackPlugin()]<br>&#125;;<br><br><span class="hljs-built_in">module</span>.exports = config;<br></code></pre></td></tr></table></figure><p>åœ¨ç»ˆç«¯è¾“å…¥ <code>npx webpack</code> ä¹‹åè¿è¡Œï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‘ç°ï¼Œæ‰“å°å‡ºäº†æˆ‘ä»¬ <code>loader</code>æ–‡ä»¶é‡Œæ‰“å°çš„ <code>source</code> çš„å†…å®¹ï¼Œå¦‚ä¸‹ï¼š</p><hr><p>source # ä»Šå¤©æ˜¯ 2021 å¹´ï¼Œå¼€å§‹è®¤çœŸå·¥ä½œçš„ä¸€å¤©</p><p>è¿™æ˜¯ä¸€ä¸ªæ®µè½</p><ul><li>è¿™æ˜¯ç¬¬ä¸€é¡¹</li><li>è¿™æ˜¯ç¬¬äºŒé¡¹</li></ul><p>è¿™æ˜¯ä¸€æ®µè½<code>code</code></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined">const <span class="hljs-keyword">a</span> = <span class="hljs-string">'webpack-demo'</span><br>console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'a'</span>, <span class="hljs-keyword">a</span>)<br></code></pre></td></tr></table></figure><hr><p>ä»è¿™é‡Œæˆ‘ä»¬èƒ½å‘ç°ï¼Œå…¶å® <code>loader</code> æ¥å—çš„å‚æ•°å°±æ˜¯æˆ‘ä»¬ <code>md</code> æ–‡ä»¶çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°† <code>md</code> æ–‡ä»¶è½¬æ¢ä¸º <code>html</code>ï¼Œå°±éœ€è¦ä½¿ç”¨ <code>marked</code> æ–¹æ³•ï¼Œç»§ç»­ç¼–å†™ <code>loader</code> æ–‡ä»¶ï¼Œå¼•å…¥ <code>marked</code>ï¼Œå¤„ç†å®Œæˆ <code>md</code> æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å†å°†å¤„ç†çš„æ–‡ä»¶ç»„æˆæ–‡ä»¶å†…å®¹å¯¼å‡ºã€‚</p><ul><li><code>md2html-loader.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">"marked"</span>);<br><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">source</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> html = marked(source);<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"html"</span>, html);<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`module.exports = <span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(html)&#125;</span>`</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å»æ‰§è¡Œï¼Œ<code>npx webpack</code> å‘ç°ç»ˆç«¯æ‰“å°çš„è¾“å‡ºä¸ºä¸€æ®µ <code>html</code> å­—ç¬¦ä¸²ï¼Œè¿™å°±æ˜¯ <code>md</code> æ–‡ä»¶è¢«è½¬æ¢ä¸º <code>html</code>ï¼š</p><hr><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs undefined">html <span class="hljs-variable">&lt;h1 id="ä»Šå¤©æ˜¯-2021-å¹´ï¼Œå¼€å§‹è®¤çœŸå·¥ä½œçš„ä¸€å¤©"&gt;</span>ä»Šå¤©æ˜¯ 2021 å¹´ï¼Œå¼€å§‹è®¤çœŸå·¥ä½œçš„ä¸€å¤©<span class="hljs-variable">&lt;/h1&gt;</span><br><span class="hljs-variable">&lt;p&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ®µè½<span class="hljs-variable">&lt;/p&gt;</span><br><span class="hljs-variable">&lt;ul&gt;</span><br><span class="hljs-variable">&lt;li&gt;</span>è¿™æ˜¯ç¬¬ä¸€é¡¹<span class="hljs-variable">&lt;/li&gt;</span><br><span class="hljs-variable">&lt;li&gt;</span>è¿™æ˜¯ç¬¬äºŒé¡¹<span class="hljs-variable">&lt;/li&gt;</span><br><span class="hljs-variable">&lt;/ul&gt;</span><br><span class="hljs-variable">&lt;p&gt;</span>è¿™æ˜¯ä¸€æ®µè½<span class="hljs-variable">&lt;code&gt;</span>code<span class="hljs-variable">&lt;/code&gt;</span><span class="hljs-variable">&lt;/p&gt;</span><br><span class="hljs-variable">&lt;pre&gt;</span><span class="hljs-variable">&lt;code&gt;</span>const a = &amp;<span class="hljs-comment">#39;webpack-demo&amp;#39;</span><br>console.log(&amp;<span class="hljs-comment">#39;a&amp;#39;, a)&lt;/code&gt;&lt;/pre&gt;</span><br></code></pre></td></tr></table></figure><hr><p>ç„¶åæˆ‘ä»¬å†æ‰“å¼€ <code>dist</code> ç›®å½•ä¸‹çš„ <code>index.html</code> æŸ¥çœ‹é¡µé¢ï¼Œ<code>F12</code> æ‰“å¼€æ§åˆ¶å°å‘ç°æµè§ˆå™¨æ§åˆ¶å°æ‰“å°å‡ºäº†ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs undefined">md <span class="hljs-variable">&lt;h1 id="ä»Šå¤©æ˜¯-2021-å¹´ï¼Œå¼€å§‹è®¤çœŸå·¥ä½œçš„ä¸€å¤©"&gt;</span>ä»Šå¤©æ˜¯ 2021 å¹´ï¼Œå¼€å§‹è®¤çœŸå·¥ä½œçš„ä¸€å¤©<span class="hljs-variable">&lt;/h1&gt;</span><br><span class="hljs-variable">&lt;p&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ®µè½<span class="hljs-variable">&lt;/p&gt;</span><br><span class="hljs-variable">&lt;ul&gt;</span><br><span class="hljs-variable">&lt;li&gt;</span>è¿™æ˜¯ç¬¬ä¸€é¡¹<span class="hljs-variable">&lt;/li&gt;</span><br><span class="hljs-variable">&lt;li&gt;</span>è¿™æ˜¯ç¬¬äºŒé¡¹<span class="hljs-variable">&lt;/li&gt;</span><br><span class="hljs-variable">&lt;/ul&gt;</span><br><span class="hljs-variable">&lt;p&gt;</span>è¿™æ˜¯ä¸€æ®µè½<span class="hljs-variable">&lt;code&gt;</span>code<span class="hljs-variable">&lt;/code&gt;</span><span class="hljs-variable">&lt;/p&gt;</span><br><span class="hljs-variable">&lt;pre&gt;</span><span class="hljs-variable">&lt;code&gt;</span>const a = &amp;<span class="hljs-comment">#39;webpack-demo&amp;#39;</span><br>console.log(&amp;<span class="hljs-comment">#39;a&amp;#39;, a)&lt;/code&gt;&lt;/pre&gt;</span><br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨æ§åˆ¶å°çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬ <code>main.js</code> é‡Œæ‰“å°çš„å†…å®¹ï¼Œè‡³æ­¤ï¼Œè¯´æ˜æˆ‘ä»¬çš„æ¨¡å—å·²ç»ç”Ÿæ•ˆï¼Œ<code>md</code> è½¬ä¸º <code>html</code> ä¹Ÿå·²ç»ç”Ÿæ•ˆï¼Œå¹¶ä¸”å½“æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™å…¶å®å°±å·²ç»æ˜ç™½æ€ä¹ˆæ˜¾ç¤ºåˆ°é¡µé¢ä¸Šäº†ã€‚</p><p>äºæ˜¯æˆ‘ä»¬ç»§ç»­ç¼–å†™ <code>main.js</code>å°† html å­—ç¬¦ä¸²æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼š</p><ul><li><code>main.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> md <span class="hljs-keyword">from</span> <span class="hljs-string">"./index.md"</span>;<br><span class="hljs-comment">// console.log("md", md);</span><br><span class="hljs-keyword">const</span> ele = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>);<br>ele.innerHTML = md;<br><span class="hljs-built_in">document</span>.body.appendChild(ele);<br></code></pre></td></tr></table></figure><p>ç»§ç»­è¿è¡Œï¼Œ<code>npx webpack</code>ï¼Œç„¶åæˆ‘ä»¬åˆ·æ–°åˆšåˆšçš„é¡µé¢ï¼Œå‘ç°ç”Ÿæˆçš„ <code>html</code> å­—ç¬¦ä¸²å·²ç»è¢«æˆ‘ä»¬æ¸²æŸ“åˆ°é¡µé¢ä¸Šäº†ã€‚</p><p>è‡³æ­¤ä¸€ä¸ª <code>md</code> è½¬æ¢ä¸º <code>html</code> å¹¶ä¸”æ˜¾ç¤ºåœ¨é¡µé¢çš„ç®€å• <code>loader</code> å·²ç»å®Œæˆã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pipe å’Œ compose åœ¨ JavaScript ä¸­çš„åº”ç”¨</title>
    <link href="/2021/01/17/pipeAndCompose/"/>
    <url>/2021/01/17/pipeAndCompose/</url>
    
    <content type="html"><![CDATA[<p>å‡½æ•°å¼ç¼–ç¨‹çš„ä¸­ä»å·¦å¾€å³çš„ <code>pipe</code> å‡½æ•°å’Œä»å³å¾€å·¦çš„ <code>compose</code> å‡½æ•°ï¼Œåœ¨ <code>js</code> ä¸­çš„ä¸€äº›åº”ç”¨åœºæ™¯ã€‚</p><h3 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h3><p>ä¹Ÿç§°ä¸ºç®¡é“å‡½æ•°ï¼Œå®ƒæ¥å— <code>n</code> å¤šä¸ªå‡½æ•°ï¼Œä¾æ¬¡ä»å·¦å¾€å³æ‰§è¡Œï¼Œç”¨æœ€åä¸€ä¸ªå‡½æ•°ä½œä¸ºæœ€ç»ˆçš„è¾“å‡ºã€‚ç”¨äºæ”¹å–„å‡½æ•°åµŒå¥—è°ƒç”¨ï¼Œä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">first</span> (<span class="hljs-params">params</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`æˆ‘æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘è·å–æˆ‘çš„å‚æ•°ã€Œ<span class="hljs-subst">$&#123;params&#125;</span>ã€å¹¶ä¸”è¿”å›`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">second</span> (<span class="hljs-params">params</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`æˆ‘æ¥å—äº†ç¬¬ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ã€Œ<span class="hljs-subst">$&#123;params&#125;</span>ã€ï¼Œä½œä¸ºæˆ‘çš„å‚æ•°ï¼Œç„¶åå’Œæˆ‘çš„æ•°æ®æ‹¼æ¥å†è¿”å›`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">end</span> (<span class="hljs-params">params</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`æˆ‘æ˜¯æœ€åçš„æ•°æ®çš„æ‹¼æ¥å¤„ç†ï¼Œç»“åˆäº†firstå‡½æ•°å’Œsecondçš„è¿”å›å€¼ã€Œ<span class="hljs-subst">$&#123;params&#125;</span>ã€`</span><br>&#125;<br><br>end(second(first(<span class="hljs-string">`hiï½æˆ‘æ¥äº†ï¼ğŸ’`</span>)))<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆè¿”å›ï¼š â€œæˆ‘æ˜¯æœ€åçš„æ•°æ®çš„æ‹¼æ¥å¤„ç†ï¼Œç»“åˆäº† <code>first</code> å‡½æ•°å’Œ <code>second</code> çš„è¿”å›å€¼ã€Œæˆ‘æ¥å—äº†ç¬¬ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ã€Œæˆ‘æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘è·å–æˆ‘çš„å‚æ•°ã€Œ<code>hi</code> ï½æˆ‘æ¥äº†ï¼ğŸ’ã€å¹¶ä¸”è¿”å›ã€ï¼Œä½œä¸ºæˆ‘çš„å‚æ•°ï¼Œç„¶åå’Œæˆ‘çš„æ•°æ®æ‹¼æ¥å†è¿”å›ã€â€</p><p>èƒ½çœ‹åˆ°çš„æ˜¯ï¼Œå‡½æ•°ä¹‹é—´å½¢æˆä¸€ç§å…³ç³»ï¼Œå³åä¸€ä¸ªå‡½æ•°æ¥å—ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ï¼Œæœ¬ä¾‹ä¸­ä¹Ÿå°±æ˜¯ <code>end</code> å‡½æ•°æ¥å— <code>second</code> çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ï¼Œè€Œ <code>second</code> çš„è¿”å›å€¼åˆæ˜¯æ¥å— <code>first</code> çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ã€‚</p><p>å…¶å®èƒ½çœ‹åˆ° <code>end(second(first()))</code>è¿™ä¹ˆè°ƒç”¨åµŒå¥—ä¸ç›´è§‚ï¼Œæˆ‘ä»¬ç”¨<code>reduce</code>å®ç°ç®¡é“ <code>pipe</code> ä¾æ¬¡è°ƒç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> pipe = <span class="hljs-function">(<span class="hljs-params">...arg</span>) =&gt;</span> <span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> arg.reduce(<span class="hljs-function">(<span class="hljs-params">res, callback</span>) =&gt;</span> callback(res), result)<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ <code>pipe(first, second, end)(&#39;hi ï½æˆ‘æ¥äº†ï¼ğŸ’&#39;)</code>ï¼Œä¼šå°†å‚æ•°å…ˆä¼ é€’ç»™ <code>first</code>ï¼Œç„¶åå¤„ç†æˆåŠŸä¹‹åï¼Œå†å°†ç»“æœä½œä¸º <code>second</code> çš„å‚æ•°ï¼Œä¼ é€’ï¼Œ<code>second</code> å¤„ç†å®Œæˆä¹‹åï¼Œå°†ç»“æœä½œä¸º <code>end</code> å‡½æ•°çš„å‚æ•°ï¼Œåœ¨ <code>end</code> å‡½æ•°å¤„ç†å®Œæˆä¹‹åï¼Œå°†æ‰€æœ‰ç»“æœè¿”å›ã€‚æœ€ç»ˆ <code>pipe</code> å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œå°†ä¼šä¸Šè¾¹å‡½æ•°åµŒå¥—æ‰§è¡Œçš„ç»“æœä¸€è‡´ã€‚</p><h2 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h2><p>ç»„åˆå‡½æ•°å’Œ <code>pipe</code> åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯å…¶è°ƒç”¨é¡ºåºæ˜¯ä»å³å¾€å·¦ã€‚</p><p>ç»„åˆå‡½æ•°åœ¨ <code>webpack</code> çš„ <code>loader</code> ä¸­ä¹Ÿæœ‰åº”ç”¨ï¼Œæœ¬ä¾‹ä¸­çš„ <code>pipe</code> æ˜¯ä»å·¦å¾€å³ä¾æ¬¡æ‰§è¡Œï¼Œ<code>webpack</code> çš„ <code>loader</code> æ˜¯ä»å³å‘å·¦æ‰§è¡Œï¼ˆ<code>composeï¼‰</code>ï¼Œå…¶å®å¯ä»¥åˆ©ç”¨ <code>reduceRight</code> å®ç°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> compose = <span class="hljs-function">(<span class="hljs-params">...arg</span>) =&gt;</span> <span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> arg.reduceRight(<span class="hljs-function">(<span class="hljs-params">res, callback</span>) =&gt;</span> callback(res), result)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ï¼Œå¦‚æœä¸Šè¿°çš„ä¾‹å­æ˜¯é€šè¿‡ <code>compose</code> å‡½æ•°æ¥å®ç°çš„è¯ï¼Œåº”è¯¥æ˜¯ <code>compose(first, second, end)(&#39;hi ï½æˆ‘æ¥äº†ï¼ğŸ’&#39;)</code>ï¼Œæœ€å¤–è¾¹çš„å‚æ•°åº”è¯¥å…ˆæ˜¯ç»™ <code>end</code> å‡½æ•°ï¼Œå¤„ç†å®Œæˆä¹‹åå†ç»™ <code>second</code>ï¼Œæœ€ç»ˆç»™ <code>first</code>ï¼Œç”± <code>first</code> å¤„ç†ï¼Œæœ€ç»ˆè¿”å›ç»“æœã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœä¸€ä¸ªæ•°æ®æœ€ç»ˆç»“æœï¼Œæ˜¯éœ€è¦ç»è¿‡å¾ˆå¤šå‡½æ•°çš„å¤„ç†ï¼Œå¹¶ä¸”é‚£äº›å‡½æ•°ï¼Œéœ€è¦ç”¨ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œè¿™ç§åœºæ™¯ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>pipe</code> æˆ–è€… <code>compose</code> å‡½æ•°æ¥å¤„ç†ï¼Œå…¶å®ä½¿ç”¨ <code>pipe</code> æˆ–è€… <code>compose</code> éƒ½æ˜¯å¯ä»¥çš„ï¼Œåªéœ€è¦ä¿è¯ä¼ å…¥çš„å‡½æ•°çš„é¡ºåºæ˜¯æŒ‰ç…§æ•°æ®æ­£ç¡®æ‰§è¡Œçš„å‡½æ•°é¡ºåºå³å¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reduceé«˜çº§å‡½æ•°çš„ä¸€äº›åº”ç”¨</title>
    <link href="/2021/01/15/jsReduceFunction/"/>
    <url>/2021/01/15/jsReduceFunction/</url>
    
    <content type="html"><![CDATA[<h3 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h3><p>åœ¨æœ€è¿‘çš„å·¥ä½œä¸­ï¼Œ<code>reduce</code> æˆä¸ºäº†å‡ºå¢ƒç‡å’Œä½¿ç”¨ç‡éå¸¸é«˜çš„ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹å·¥ä½œä¸­ä»¥åŠ <code>reduce</code> å¯èƒ½ä¼šå®ç°çš„ä¸€äº›åŠŸèƒ½ã€‚</p><p>å…ˆç®€å•è¯´ä¸€ä¸‹ <code>reduce</code> å‡½æ•°ï¼Œå®ƒçš„è¯­æ³•ä¸º <code>Array.reduce(callback, [initialValue])</code>ï¼Œæ¥å—çš„å‚æ•°æ˜¯ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶å›è°ƒå‡½æ•°æ¥å—å››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºåˆå§‹å€¼ï¼ˆæˆ–è€…ä¸Šæ¬¡çš„å›è°ƒå‡½æ•°çš„è¿”å›å€¼ï¼‰ã€å½“å‰å…ƒç´ ã€å½“å‰ç´¢å¼•ã€åŸæ•°ç»„ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•° <code>initialValue</code> ä¸ºå¯é€‰ï¼Œå¦‚æœä¼ é€’ï¼Œåˆ™ <code>initialValue</code> ä½œä¸ºç¬¬ä¸€æ¬¡å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</li></ul><p>éœ€è¦è®°ä½çš„ç‚¹æ˜¯ï¼šå¦‚æœä¸º <code>reduce</code> æä¾› <code>initialValue</code> å‚æ•°ï¼Œåˆ™å›è°ƒå‡½æ•°ä¼šä»ç´¢å¼•ä¸º <code>0</code> çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œ <code>callback</code>ï¼Œå¦åˆ™ä¼šä»ç´¢å¼•ä¸º <code>1</code> çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸ª <code>demo</code> éªŒè¯ä¸€ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!-- æ— åˆå§‹åŒ–å‚æ•° --&gt;<br><br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">9</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>]<br>arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur, idx</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(pre, cur, <span class="hljs-string">'çœ‹ç´¢å¼•å¼€å§‹:'</span>, idx)<br>  <span class="hljs-keyword">return</span> pre + cur<br>&#125;)<br><br><span class="hljs-comment">// 9 19 "çœ‹ç´¢å¼•å¼€å§‹:" 1</span><br><span class="hljs-comment">// 28 20 "çœ‹ç´¢å¼•å¼€å§‹:" 2</span><br><span class="hljs-comment">// 48</span><br><br>&lt;!-- æœ‰åˆå§‹åŒ–å‚æ•° --&gt;<br><br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">9</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>]<br>arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur, idx</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(pre, cur, <span class="hljs-string">'çœ‹ç´¢å¼•å¼€å§‹:'</span>, idx)<br>  <span class="hljs-keyword">return</span> pre + cur<br>&#125;, <span class="hljs-number">0</span>)<br><br><span class="hljs-comment">// 0 9 "çœ‹ç´¢å¼•å¼€å§‹:" 0</span><br><span class="hljs-comment">// 9 19 "çœ‹ç´¢å¼•å¼€å§‹:" 1</span><br><span class="hljs-comment">// 28 20 "çœ‹ç´¢å¼•å¼€å§‹:" 2</span><br><span class="hljs-comment">// 48</span><br></code></pre></td></tr></table></figure><h3 id="æ•°ç»„æ±‚å’Œ"><a href="#æ•°ç»„æ±‚å’Œ" class="headerlink" title="æ•°ç»„æ±‚å’Œ"></a>æ•°ç»„æ±‚å’Œ</h3><ul><li>ç®€å•æ•°ç»„æ±‚å’Œ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br>arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> pre + cur, <span class="hljs-number">0</span>) <span class="hljs-comment">// 15</span><br></code></pre></td></tr></table></figure><ul><li>å¤æ‚ä¸€ç‚¹çš„ï¼Œæ•°ç»„å¯¹è±¡ä¸­çš„æ•°æ®</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> list = [<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'è‹¹æœ'</span>,<br>    <span class="hljs-attr">count</span>: <span class="hljs-number">20</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'é¦™è•‰'</span>,<br>    <span class="hljs-attr">count</span>: <span class="hljs-number">40</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">'çŒ•çŒ´æ¡ƒ'</span>,<br>    <span class="hljs-attr">count</span>: <span class="hljs-number">90</span>,<br>  &#125;<br>]<br>list.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> pre + cur.count, <span class="hljs-number">0</span>) <span class="hljs-comment">// 150</span><br></code></pre></td></tr></table></figure><h3 id="ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°"><a href="#ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°"></a>ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°</h3><p>åˆ©ç”¨ <code>{}</code> å¯¹è±¡æ¥åˆ¤æ–­æ˜¯å¦èƒ½å–åˆ°å½“å‰å€¼ï¼Œè·å–ä¸åˆ°åˆ™è¡¨ç¤ºå½“å‰å…ƒç´ æ²¡æœ‰ï¼Œè®¾ç½®æ¬¡æ•°ä¸º <code>1</code>ï¼Œæœ‰åˆ™æ¬¡æ•°é€’å¢ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> str = <span class="hljs-string">'aabcddeffghhijklllm'</span><br>str.split(<span class="hljs-string">''</span>).reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> &#123;<br>  pre[cur] ? pre[cur]++ : pre[cur] = <span class="hljs-number">1</span><br>  <span class="hljs-keyword">return</span> pre<br>&#125;, &#123;&#125;)<br></code></pre></td></tr></table></figure><h3 id="å»é‡"><a href="#å»é‡" class="headerlink" title="å»é‡"></a>å»é‡</h3><p>åˆ©ç”¨ <code>includes</code> åˆ¤æ–­ä¸Šæ¬¡ç´¯åŠ çš„æ•°ç»„ä¸­æ˜¯å¦å…·æœ‰å½“å‰å€¼ï¼Œæ²¡æœ‰çš„è¯å°±å°†å½“å‰å€¼å’Œä¸Šæ¬¡çš„è¿”å›å€¼è¿æ¥èµ·æ¥è¿”å›ï¼Œæœ‰çš„è¯ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡çš„ç»“æœã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]<br>arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> !pre.includes(cur) ? [...pre, ...[cur]] : pre, [])<br></code></pre></td></tr></table></figure><h3 id="æ•°ç»„æ‰å¹³åŒ–"><a href="#æ•°ç»„æ‰å¹³åŒ–" class="headerlink" title="æ•°ç»„æ‰å¹³åŒ–"></a>æ•°ç»„æ‰å¹³åŒ–</h3><ul><li>äºŒç»´ç®€å•æ•°ç»„</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> arr = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>]]<br>arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> [...pre, ...cur], [])<br><span class="hljs-comment">// [1, 2, 3, 4, 5]</span><br></code></pre></td></tr></table></figure><ul><li>å¤æ‚çš„é«˜çº¬åº¦æ•°ç»„</li></ul><p>åˆ©ç”¨é€’å½’æ‰å¹³æ·±å±‚åµŒå¥—çš„æ•°ç»„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> arr = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, [[<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]]], [<span class="hljs-number">3</span>, [[<span class="hljs-number">7</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">8</span>, <span class="hljs-number">1</span>]]], [<span class="hljs-number">5</span>, [[<span class="hljs-number">5</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">10</span>]]]]<br><span class="hljs-keyword">var</span> flat = <span class="hljs-function">(<span class="hljs-params">arr</span>) =&gt;</span> arr.reduce(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> [...pre, ...(<span class="hljs-built_in">Array</span>.isArray(cur) ? flat(cur) : [cur])], [])<br>flat(arr)<br><span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 3, 7, 8, 8, 1, 5, 5, 4, 9, 10]</span><br></code></pre></td></tr></table></figure><p><code>ES6</code> çš„è§£å†³åŠæ³•ï¼š<br>ä½¿ç”¨æ•°ç»„çš„ <code>flat</code> æ–¹æ³•ï¼Œè¯­æ³• <code>arr.flat([depth])</code>ï¼Œ<code>depth</code> å‚æ•°ä¸ºæ·±åº¦ï¼Œä¸ä¼ å‚æ•°é»˜è®¤æ‰å¹³ <code>1</code> çº§åµŒå¥—ï¼Œå¯ä»¥è¾“å…¥å…³é”®å­— <code>Infinity</code> å®ç°ä»»ä½•å±‚æ•°åµŒå¥—çš„æ‰å¹³ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ç°ä¸€ä¸ªç®€å•çš„ vue ä¸­çš„ EventBus</title>
    <link href="/2021/01/14/concisEventBus/"/>
    <url>/2021/01/14/concisEventBus/</url>
    
    <content type="html"><![CDATA[<p>å…ˆåˆ†æä¸€ä¸‹ <code>vue</code> ä¸­çš„ä¸€äº›ç”¨æ³•</p><h3 id="on-æ³¨å†Œ"><a href="#on-æ³¨å†Œ" class="headerlink" title="on æ³¨å†Œ"></a><code>on</code> æ³¨å†Œ</h3><ul><li><code>this.$on(&#39;eventName&#39;, (...params) =&gt; {})</code><br>å…¶å®æˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¯ä»¥å‘ç°ï¼Œ<code>$on</code>çš„äº‹ä»¶å¯ä»¥æ³¨å†Œå¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨å¾ˆå¤šç»„ä»¶é‡Œè¿›è¡Œä¸€ä¸ªäº‹ä»¶çš„æ³¨å†Œï¼Œåœ¨<code>$emit</code> è§¦å‘ç›¸åº”çš„äº‹ä»¶çš„æ—¶å€™ï¼Œå¯¹åº”æ³¨å†Œçš„æ‰€æœ‰äº‹ä»¶éƒ½ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½æƒ³åˆ°å®ƒçš„å®ç°ä¸€å®šæ˜¯ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œæ³¨å†Œäº†ç›¸åŒçš„äº‹ä»¶ï¼Œä¼šä¸€ç›´å¾€å½“å‰çš„è¿™ä¸ªäº‹ä»¶æ•°ç»„çš„é›†åˆä¸­è¿½åŠ å›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="emitè§¦å‘"><a href="#emitè§¦å‘" class="headerlink" title="emitè§¦å‘"></a><code>emit</code>è§¦å‘</h3><ul><li><code>this.$emit(&#39;eventName&#39;, params)</code><br>ä¸Šä¸€æ­¥æåˆ°ï¼Œ<code>$emit</code> çš„æ—¶å€™ï¼Œç›¸åº”æ³¨å†Œçš„äº‹ä»¶éƒ½ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè€Œä¸” <code>on</code> æ³¨å†Œçš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥å…¶å®ç°åº”è¯¥æ˜¯éå† <code>emit</code> äº‹ä»¶æ‰€å¯¹åº”çš„æ•°ç»„ï¼Œä¾æ¬¡æ‰§è¡Œ <code>callback</code> å¹¶ä¸”å°†å‚æ•°ä¼ é€’å‡ºå»ã€‚</li></ul><h3 id="once-ä¸€æ¬¡è§¦å‘"><a href="#once-ä¸€æ¬¡è§¦å‘" class="headerlink" title="once ä¸€æ¬¡è§¦å‘"></a><code>once</code> ä¸€æ¬¡è§¦å‘</h3><ul><li><code>this.$once(&#39;eventName&#39;, (...params) =&gt; {})</code><br>è§¦å‘ä¸€æ¬¡ï¼Œå®ƒçš„å®ç°åº”è¯¥æ˜¯æ— éœ€åˆ¤æ–­ä¹‹å‰äº‹ä»¶æœ‰æ²¡æœ‰æ³¨å†Œï¼Œè¦æ˜¯æ³¨å†Œç›´æ¥æ”¾è¿›å»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ³¨å†Œç›¸åŒçš„äº‹ä»¶åè€…ä¼šè¦†ç›–æ‰å‰è€…ï¼Œæ³¨å†Œæ–°çš„ä¼šå¢åŠ ã€‚</li></ul><h3 id="offç§»é™¤"><a href="#offç§»é™¤" class="headerlink" title="offç§»é™¤"></a><code>off</code>ç§»é™¤</h3><ul><li><code>this.$off(&#39;eventName)</code><br><code>off</code> ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç›´æ¥ç”¨å¯¹è±¡ä¸Šåˆ æ‰å½“å‰çš„äº‹ä»¶ã€‚</li></ul><p>åœ¨ <code>vue2.0</code> çš„ <code>SFC</code> ä¸­ï¼Œ<code>this</code> æŒ‡å‘æ˜¯ <code>new Vue()</code>çš„å®ä¾‹ <code>vm</code>ï¼Œå› ä¸ºå…¶ä¸Šå®ä¾‹ä¸Šå·²ç»å…·æœ‰ <code>eventBus</code> çš„æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ã€‚</p><p>ä¼ªä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> EventBus = &#123;<br>  <span class="hljs-attr">taskMap</span>: &#123;&#125;,<br>  $on(eventName, fn) &#123;<br>    &lt;!-- å¦‚æœmapä¸­æ— æ³¨å†Œäº‹ä»¶ï¼Œåˆ™å°†äº‹ä»¶æ¨å…¥ï¼Œå¦‚æœæœ‰æ³¨å†Œçš„äº‹ä»¶ï¼Œç»§ç»­å¾€é‡Œè¿½åŠ  --&gt;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.taskMap[eventName]) &#123;<br>      <span class="hljs-keyword">this</span>.taskMap[eventName] = [fn]<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">this</span>.taskMap[eventName].push(fn)<br>    &#125;<br>  &#125;,<br>  $emit(eventName, ...msg) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.taskMap[eventName]) &#123;<br>      <span class="hljs-keyword">return</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      &lt;!-- éå†æ³¨å†Œè¿‡çš„äº‹ä»¶ï¼Œä¾æ¬¡æ‰§è¡Œ --&gt;<br>      <span class="hljs-keyword">this</span>.taskMap[eventName].forEach(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> callback(...msg))<br>    &#125;<br>  &#125;,<br>  $once(eventName, fn) &#123;<br>    &lt;!-- ä¸éœ€è¦åˆ¤æ–­ï¼Œåæ¥çš„è¦†ç›–å‰è¾¹çš„ --&gt;<br>    <span class="hljs-keyword">this</span>.taskMap[eventName] = [fn]<br>  &#125;,<br>  $off(eventName) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.taskMap[eventName]) &#123;<br>      <span class="hljs-keyword">return</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      &lt;!-- åˆ æ‰æ³¨å†Œçš„äº‹ä»¶ --&gt;<br>      <span class="hljs-built_in">Reflect</span>.deleteProperty(<span class="hljs-keyword">this</span>.taskMap, [eventName])<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ³¨å†Œ</span><br>EventBus.$on(<span class="hljs-string">'begin'</span>, (...x) =&gt; &#123;<span class="hljs-built_in">console</span>.log(...x)&#125;)<br>EventBus.$off(<span class="hljs-string">'begin'</span>)<br>EventBus.$emit(<span class="hljs-string">'begin'</span>, <span class="hljs-string">'å‚æ•°1000000'</span>, <span class="hljs-string">'å‚æ•°2'</span>) <span class="hljs-comment">// ä¸ä¼šè§¦å‘</span><br>EventBus.$once(<span class="hljs-string">'begin'</span>, (...x) =&gt; &#123;<span class="hljs-built_in">console</span>.log(x)&#125;)<br>EventBus.$emit(<span class="hljs-string">'begin'</span>, <span class="hljs-string">'ğŸ…'</span>, <span class="hljs-string">'ğŸ‰'</span>) <span class="hljs-comment">// è§¦å‘ä¸€æ¬¡once ["ğŸ…", "ğŸ‰"]</span><br>EventBus.$off(<span class="hljs-string">'begin'</span>)<br><br>EventBus.$on(<span class="hljs-string">'begin'</span>, (...x) =&gt; &#123;<span class="hljs-built_in">console</span>.log(...x, <span class="hljs-string">'1'</span>)&#125;)<br>EventBus.$on(<span class="hljs-string">'begin'</span>, (...x) =&gt; &#123;<span class="hljs-built_in">console</span>.log(...x, <span class="hljs-string">'2'</span>)&#125;)<br>EventBus.$emit(<span class="hljs-string">'begin'</span>, <span class="hljs-string">'ğŸƒâ€â™€ï¸'</span>, <span class="hljs-string">'ğŸš¢'</span>) <span class="hljs-comment">// è§¦å‘2æ¬¡on ğŸƒâ€â™€ï¸ï¼ŒğŸš¢ï¼Œ1  ğŸƒâ€â™€ï¸ï¼ŒğŸš¢ï¼Œ2</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è·¨æ·±ç»„ä»¶ä¼ é€’æ•°æ®å’Œè°ƒç”¨æ–¹æ³•</title>
    <link href="/2021/01/03/useContext/"/>
    <url>/2021/01/03/useContext/</url>
    
    <content type="html"><![CDATA[<p>åœ¨çˆ¶å­ç»„ä»¶ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼Œ<code>react</code> æœ€å¸¸ç”¨çš„</p><h4 id="ä¼ ç»Ÿç®€å•çš„ç»„ä»¶é€šä¿¡æ–¹å¼"><a href="#ä¼ ç»Ÿç®€å•çš„ç»„ä»¶é€šä¿¡æ–¹å¼" class="headerlink" title="ä¼ ç»Ÿç®€å•çš„ç»„ä»¶é€šä¿¡æ–¹å¼"></a>ä¼ ç»Ÿç®€å•çš„ç»„ä»¶é€šä¿¡æ–¹å¼</h4><ul><li>çˆ¶ç»„ä»¶ â€”&gt; å­ç»„ä»¶ <code>props</code></li><li>å­ç»„ä»¶ â€”&gt; çˆ¶ç»„ä»¶ <code>callback</code><br>ä½†æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼Œæ¯”å¦‚æ˜¯åµŒå¥—æ¯”è¾ƒæ·±çš„ç»„ä»¶ï¼Œ<code>Aâ€”&gt;Bâ€”&gt;Câ€”&gt;D</code> åµŒå¥—ï¼Œä¸€æ—¦è¿™ç§ç»“æœä½¿ç”¨ <code>props</code> ä¼ é€’æ•°æ®ï¼Œå°±ä¼šæ˜¾å¾—ç»„ä»¶éå¸¸è‡ƒè‚¿ï¼Œè€Œ <code>react</code> æœ‰æä¾›æ–¹å¼æ¥è§£å†³ï¼Œå³ <code>useContext</code></li></ul><h4 id="åµŒå¥—æ·±çš„ç»„ä»¶çš„é€šä¿¡"><a href="#åµŒå¥—æ·±çš„ç»„ä»¶çš„é€šä¿¡" class="headerlink" title="åµŒå¥—æ·±çš„ç»„ä»¶çš„é€šä¿¡"></a>åµŒå¥—æ·±çš„ç»„ä»¶çš„é€šä¿¡</h4><ul><li><code>React.createContext</code></li><li><code>useContext</code></li></ul><p>å‡å¦‚ç°åœ¨æœ‰ä¾èµ–å…³ç³»çš„ï¼Œç»„ä»¶ <code>A-&gt;B-&gt;C</code>ï¼Œ<code>useContext</code> ä½¿ç”¨å°ç»“:</p><p>å¯ä»¥å…¨å±€ç»´æŠ¤ä¸€ä¸ª <code>context.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// åˆ©ç”¨ React.CreateContext api åˆ›å»ºä¸€ä¸ªå¸¦æœ‰é»˜è®¤å€¼çš„context</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> CreateContextData = React.createContext(<span class="hljs-string">''</span>)<br></code></pre></td></tr></table></figure><p><code>A.jsx</code><br>å¿…é¡»è¦ä½¿ç”¨ <code>Provider</code> å¹¶ä¸”å°†æ•°æ®ä»¥ <code>value</code> çš„å½¢å¼ä¼ é€’ä¸‹å»ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tsx">const A = () =&gt; &#123;<br>  const text = &apos;react&apos;<br>  return (<br>    &lt;CreateContextData.Provider value=&#123;text&#125;&gt;<br>      &lt;B /&gt;<br>    &lt;/CreateContextData.Provider&gt;<br>  )<br>&#125;<br></code></pre></td></tr></table></figure><p><code>B.jsx</code><br>ä¸­é—´ç»„ä»¶ä¸ç”¨åœ¨æ„ <code>A</code> å¾€ä¸‹ä¼ é€’çš„å‚æ•°å’Œæ•°æ®æ˜¯ä»€ä¹ˆï¼Œå…¶åªéœ€è¦ä¿è¯ <code>B</code> å’Œ <code>C</code> çš„æ¥å£ç¨³å®šã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tsx">const B = () =&gt; &#123;<br>  return (<br>    &lt;div&gt;<br>      &lt;div&gt;å¤§çº²&lt;/div&gt;<br>      &lt;C/&gt;<br>    &lt;/div&gt;<br>  )<br>&#125;<br></code></pre></td></tr></table></figure><p><code>C.jsx</code><br>é€šè¿‡è·å–å…¨å±€åˆ›å»ºçš„ <code>context</code> å¯¹è±¡æ¥è·å– <code>A</code> ç»„ä»¶çš„é€šä¿¡æ•°æ®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tsx">import &#123; CreateContextData &#125; from &apos;./context.js&apos;<br><br>const C = () =&gt; &#123;<br>  // é€šè¿‡useContextè·å–contextçš„æ•°æ® ä¸€å®šè¦ä¼ å…¥åˆ›å»ºçš„ä¸Šä¸‹æ–‡å®ä¾‹ å¦åˆ™è·å–ä¸åˆ°æ•°æ®<br>  const initText = useContext(CreateContextData)<br>  return (&lt;&gt;æˆ‘æ­£åœ¨å­¦ä¹ &#123;initText&#125;&lt;/&gt;)<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåµŒå¥—çš„ç»„ä»¶ï¼Œå­ç»„ä»¶ä¸­ä¹Ÿæœ‰ <code>provider</code> æä¾›ï¼Œåˆ™æŒ‰ç…§æœ€è¿‘çš„å–å€¼ï¼Œä¸€èˆ¬æ­£å¸¸çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯æœ€é¡¶å±‚ç»„ä»¶å¢åŠ  <code>provider</code></p><p>æ¯æ¬¡åˆ›å»ºçš„çš„ä¸Šä¸‹æ–‡å®ä¾‹ï¼Œéƒ½éœ€è¦å¯¼å‡ºï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç»Ÿä¸€çš„æ–‡ä»¶ç®¡ç†è¿™ç§åˆ›å»ºçš„ä¸Šä¸‹æ–‡ï¼Œæœ€å <code>export</code> ä»¥åŠåœ¨éœ€è¦çš„åœ°æ–¹ <code>import</code></p><p>é€ä¼ ä¸ä»…ä»…å¯ä»¥æ˜¯ <code>state</code>ï¼Œè¿˜å¯ä»¥æ˜¯çˆ¶ç»„ä»¶çš„æ–¹æ³•ï¼Œåœ¨æ·±å±‚ç»„ä»¶è·å–ä¹‹åï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶æ•°æ®</p><p>è°ƒç”¨äº† <code>useContext</code> çš„ç»„ä»¶æ€»ä¼šåœ¨ <code>context</code> å€¼å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ï¼Œå¦‚æœç»„ä»¶æ¸²æŸ“å¼€é”€å¤ªå¤§ï¼Œå¯ä»¥ä½¿ç”¨ <code>useMome</code> åŒ…è£…ä¸€ä¸‹</p>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡å…³äºnodeä¸­é—´å±‚å¤„ç†çš„æ–‡ä»¶ä¸Šä¼ </title>
    <link href="/2021/01/01/uploadFile/"/>
    <url>/2021/01/01/uploadFile/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸é¡¹ç›®çš„æ¶æ„æ˜¯ <code>umi</code> â€”&gt;  <code>nodejs</code> â€”&gt; <code>api</code></p><p>åœ¨æœ€è¿‘ä¸€æ¬¡çš„éœ€æ±‚ä¸­ï¼Œæœ‰ä¸€ä¸ªæ‰¹é‡ä¸Šä¼ çš„åŠŸèƒ½ï¼Œå¤§ä½“çš„äº¤äº’æ˜¯ï¼šåœ¨ <code>excel</code> é‡Œå…ˆå¡«å†™å¥½æ•°æ®ï¼Œ<code>web</code> é€šè¿‡ä¸Šä¼ æ–‡ä»¶æ¥åœ¨é¡µé¢è¡¨æ ¼é‡Œé¢„è§ˆï¼Œç„¶åå†å°† <code>excel</code> æ–‡ä»¶ç»‘å®šä¸€äº›è¡¨å•çš„æ•°æ®ä¸€èµ·æ‰“åŒ…å‘é€ç»™åå°ï¼Œæœ‰ç‚¹ç±»ä¼¼äºè¡¨å•ä¸­åµŒå¥—äº†æ–‡ä»¶ä¸Šä¼ ï¼Œæœ€åå†æäº¤è¡¨å•ã€‚</p><h4 id="ä¸€äº›æƒ³æ³•å’Œå¯¹äº¤äº’çš„è°ƒæ•´"><a href="#ä¸€äº›æƒ³æ³•å’Œå¯¹äº¤äº’çš„è°ƒæ•´" class="headerlink" title="ä¸€äº›æƒ³æ³•å’Œå¯¹äº¤äº’çš„è°ƒæ•´"></a>ä¸€äº›æƒ³æ³•å’Œå¯¹äº¤äº’çš„è°ƒæ•´</h4><p>æœ€åˆçš„é¡µé¢è®¾è®¡æ˜¯æ”¾åœ¨æ­¥éª¤æ¡é‡Œä¸€å…±åˆ†ä¸ºä¸‰æ­¥ã€‚ä¸Šä¼ åœ¨æ­¥éª¤æ¡çš„ç¬¬ä¸€æ­¥ï¼Œè¡¨å•åœ¨ç¬¬äºŒæ­¥ï¼Œ<code>ant-design</code> çš„æ­¥éª¤æ¡åœ¨åˆ‡æ¢ä¸Šä¸‹æ­¥éª¤ä¹‹åï¼Œä¸Šä¸€ä¸ªç»„ä»¶çš„ <code>dom</code> ä¼šé”€æ¯ï¼Œå¯¼è‡´ç¬¬äºŒæ­¥æ— æ³•è·å–åˆ°ç¬¬ä¸€æ­¥åœ¨ä¸Šä¼ çš„æ—¶å€™ç”Ÿæˆçš„æ–‡ä»¶å¯¹è±¡ï¼Œä¹Ÿå°±æ— æ³•ä¸Šä¼ æ–‡ä»¶ã€‚äºæ˜¯åæ¥è°ƒæ•´é¡µé¢ï¼Œå°†è¡¨å•å’Œä¸Šä¼ æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªé¡µé¢ï¼Œè¿™æ ·åœ¨è§£ææ–‡ä»¶æˆåŠŸä¹‹åï¼Œåœ¨å½“å‰è¿™ä¸€æ­¥é‡Œå°±èƒ½ä¸€ç›´è·å–åˆ°æ–‡ä»¶çš„å¯¹è±¡ï¼Œæ‹¿åˆ°æ–‡ä»¶å¯¹è±¡å°±å¯ä»¥å‘æ¥å£å‘èµ·è¯·æ±‚ã€‚</p><h4 id="æœªä½¿ç”¨-ant-design-ä¸Šä¼ ç»„ä»¶çš„åŸå› "><a href="#æœªä½¿ç”¨-ant-design-ä¸Šä¼ ç»„ä»¶çš„åŸå› " class="headerlink" title="æœªä½¿ç”¨ ant-design ä¸Šä¼ ç»„ä»¶çš„åŸå› "></a>æœªä½¿ç”¨ <code>ant-design</code> ä¸Šä¼ ç»„ä»¶çš„åŸå› </h4><p><code>ant-design</code> çš„ <code>Upload</code> ç»„ä»¶ä¸Šä¼ ä¹‹åçš„æ–‡ä»¶å¯¹è±¡ä¼šç«‹é©¬è¿”å›ï¼Œä½†æ˜¯å‰ç«¯æ— æ³•å°†è¿™ä¸ªå¯¹è±¡ä¸€ç›´æ‹¿ç€åœ¨æäº¤çš„æ—¶å€™å†ç»™æ¥å£ï¼Œå› ä¸ºæ–‡ä»¶å¯¹è±¡çš„ä¸€äº› <code>key</code> ä¸èƒ½æ‹·è´è¿‡å»ã€ä¹Ÿæ˜¯è¿™æ¬¡æ‰å‘ç°åªæœ‰ <code>uid</code> ä¸€ä¸ªå­—æ®µå¯ä»¥éå†ã€‘ï¼Œè€Œä¸”åœ¨é€šè¿‡ <code>document.getElementById(&#39;file&#39;).files</code> è·å–ä¸Šä¼ çš„æ–‡ä»¶å¯¹ï¼Œå…¶ <code>FileList</code> æ˜¯ <code>{length: 0}</code>ï¼Œæ‰€ä»¥åæ¥é€‰æ‹©åˆ©ç”¨åŸç”Ÿ <code>input</code> æ¥è§£å†³é—®é¢˜ï¼Œé€šè¿‡åˆ›å»º <code>ref</code> å°† <code>input</code> çš„ <code>dom</code> å±æ€§å­˜èµ·æ¥ï¼Œç„¶åå°† <code>ref</code> è·å–çš„å±æ€§è¿”å›åˆ°çˆ¶ç»„ä»¶ï¼Œåœ¨çˆ¶ç»„ä»¶é‡Œæäº¤çš„æ—¶å€™ï¼Œè·å– <code>ref</code> ä¸­çš„æ–‡ä»¶å¯¹è±¡ï¼Œä¼ é€’ç»™æ¥å£ã€‚</p><h4 id="å…·ä½“æ€è·¯"><a href="#å…·ä½“æ€è·¯" class="headerlink" title="å…·ä½“æ€è·¯"></a>å…·ä½“æ€è·¯</h4><ul><li>åˆ›å»º <code>ref</code> å¯¹è±¡æ¥å­˜å‚¨ <code>input</code> <code>dom</code> å±æ€§</li><li>åˆå§‹åŒ–åˆ©ç”¨ <code>addEventListener</code> æ¥ç›‘å¬åŸç”Ÿ <code>input</code> çš„ <code>change</code> äº‹ä»¶</li><li>åˆ©ç”¨ <code>button</code> è¦†ç›–é»˜è®¤çš„ä¸Šä¼ æ ·å¼ï¼Œç‚¹å‡» <code>button</code> çš„æ—¶å€™æ¨¡æ‹Ÿè§¦å‘ç‚¹å‡» <code>input</code> ä¸Šä¼ </li><li>æ•è·åˆ°äº‹ä»¶ä¹‹åï¼ŒæˆåŠŸè·å–åˆ°æ–‡ä»¶å¯¹è±¡ï¼Œä¾æ¬¡å°†æ–‡ä»¶å¯¹è±¡ä¼ é€’ç»™ <code>xlsx</code> æ¥è§£æä¸º <code>json</code> æ•°æ®ï¼Œå†å°† <code>json</code> æ•°æ®ä¼ é€’ç»™ <code>and-table</code> æ¥æ˜¾ç¤ºé¢„è§ˆã€å°† <code>input</code> çš„ <code>ref</code> å±æ€§å€¼å›ä¼ åˆ°çˆ¶ç»„ä»¶ï¼ˆ<code>handleFileInputRefs</code> æ–¹æ³•æ˜¯çˆ¶ç»„ä»¶ä¼ é€’çš„ <code>props</code> æ¥è·å–è‡ªç»„ä»¶çš„ <code>input ref</code>ï¼‰</li><li>çˆ¶ç»„ä»¶ä¸­ä¹Ÿå·²ç»æ¥å—äº†è¡¨å•çš„æ•°æ®ï¼Œå¹¶ä¸”æ¥å—äº† <code>input</code> çš„å±æ€§ï¼Œé€šè¿‡ <code>FormData</code> å°†æ•°æ®å’Œæ–‡ä»¶æ··ä¼ ç»™ <code>node</code> çš„ <code>controller</code></li><li><code>controller</code> è·å–åˆ°æ–‡ä»¶å¯¹è±¡å’Œé¢å¤–çš„è¡¨å•å‚æ•°ï¼Œå†å‘çœŸæ­£çš„æ¥å£å‘èµ·è¯·æ±‚</li></ul><h4 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h4><h5 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h5><p>å­ç»„ä»¶ <code>paresExcel.tsx</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> ONE_M_TO_BYTES: number = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;<br><span class="hljs-keyword">const</span> MAX_FILE_SIZE: number = <span class="hljs-number">10</span>;<br><br><span class="hljs-comment">// åˆå§‹åŒ–å®šä¹‰refæ¥å­˜å‚¨input domå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œçš„fileså¯¹è±¡å¯ä»¥ä¸€ç›´è·å–åˆ°</span><br><span class="hljs-keyword">const</span> uploadInput = useRef(<span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">/**<br> * è·å–columnçš„å¯¹è±¡keyï¼Œæ•°ç»„è½¬å¯¹è±¡<br> * tableColumnKey æ˜¯çˆ¶ç»„ä»¶ä¼ é€’å›æ¥çš„tableçš„jsonï¼Œç±»ä¼¼<br> *<br> * [&#123;<br> *    title: 'å…³é”®è¯',<br> *    dataIndex: 'word',<br> *    key: 'word',<br> *  &#125;,<br> *  &#123;<br> *    title: 'è±å…è¯',<br> *    dataIndex: 'exWord',<br> *    key: 'exWord',<br> *  &#125;]<br> */</span><br><span class="hljs-keyword">const</span> formatTitleOrFileld = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> entozh = tableColumnKey.map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      index,<br>      <span class="hljs-attr">key</span>: item.key,<br>    &#125;;<br>  &#125;);<br>  <span class="hljs-keyword">return</span> entozh;<br>&#125;;<br><br><span class="hljs-comment">/**<br> * è¿™ä¸ªæ–¹æ³•å…¶å®å°±æ˜¯å°†æ•°æ®è½¬ä¸ºè¡¨æ ¼å¯ä»¥ç”¨çš„json<br> */</span><br><span class="hljs-keyword">const</span> handleImpotedJson = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [header, ...tableBody] = jsonArr;<br>  <span class="hljs-keyword">const</span> keysArr = formatTitleOrFileld();<br>  <span class="hljs-keyword">const</span> len = header.length;<br><br>  <span class="hljs-comment">// ç¨€ç–æ•°ç»„è¡¥å…¨emptyé¡¹ï¼Œå› ä¸ºexcelä¸­æœ‰çš„æ•°æ®æ˜¯ç©ºï¼Œè§£æå‡ºæ¥çš„æ•°æ®æ˜¯ç´¢å¼•ä¸è¿ç»­çš„ï¼Œè¿™ä¸€æ­¥çš„ç›®çš„å°±æ˜¯è¡¥å…¨index</span><br>  tableBody.forEach(<span class="hljs-function">(<span class="hljs-params">item: any</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= len - <span class="hljs-number">1</span>; i++) &#123;<br>      item[i] = item[i] || <span class="hljs-string">''</span>;<br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-comment">/**<br>   * å°†è§£æçš„excelæ•°æ®è½¬æ¢ä¸ºant-tableæ”¯æŒæ¸²æŸ“çš„æ•°æ®æ ¼å¼<br>   */</span><br>  <span class="hljs-keyword">const</span> parsedExcelData = tableBody.map(<span class="hljs-function">(<span class="hljs-params">ele: any</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> newitem = &#123;&#125;;<br>    ele.forEach(<span class="hljs-function">(<span class="hljs-params">im: any, i: number</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> newKey = keysArr[i].key;<br>      newitem[newKey] = im;<br>    &#125;);<br>    <span class="hljs-keyword">return</span> newitem;<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">/**<br> * ä¸Šä¼ æ–‡ä»¶çš„æ–¹æ³•ï¼Œä¸»è¦åšä¸€äº›æ–‡ä»¶å¤§å°çš„åˆ¤æ–­ã€æ–‡ä»¶çš„è¯»å–å°†excelçš„æ•°æ®è½¬æ¢ä¸ºjson<br> * è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•æ˜¯ï¼Œè§£æå®Œæˆçš„jsonæ•°æ®ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰keyçš„<br> * è¡¨æ ¼åœ¨å±•ç¤ºçš„æ—¶å€™éœ€è¦keyå¯¹åº”ä¸Šï¼Œvalueæ‰ä¼šåœ¨è¡¨æ ¼é‡Œæ˜¾ç¤ºï¼Œæ‰€ä»¥éœ€è¦è°ƒæ–¹æ³•å¤„ç†ä¸€ä¸‹<br> */</span><br><span class="hljs-keyword">const</span> beforeUpload = <span class="hljs-function">(<span class="hljs-params">file: any</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (file.size / ONE_M_TO_BYTES &gt; MAX_FILE_SIZE) &#123;<br><br>    message.warning(<span class="hljs-string">'è¯·ä¸Šä¼ å°äº10Mçš„æ–‡ä»¶ï¼'</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br><br>    <span class="hljs-keyword">const</span> f = file;<br>    <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> FileReader();<br><br>    reader.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;<br>      <span class="hljs-keyword">const</span> datas = e?.target?.result;<br>      <span class="hljs-comment">// è§£ædatas</span><br>      <span class="hljs-keyword">const</span> workbook = XLSX.read(datas, &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">'binary'</span>,<br>      &#125;);<br><br>      <span class="hljs-comment">// æ˜¯å·¥ä½œç°¿ä¸­çš„å·¥ä½œè¡¨çš„æœ‰åºåˆ—è¡¨</span><br>      <span class="hljs-keyword">const</span> first_worksheet = workbook.Sheets[workbook.SheetNames[<span class="hljs-number">0</span>]];<br>      <span class="hljs-comment">// å°†å·¥ä½œç°¿å¯¹è±¡è½¬æ¢ä¸ºJSONå¯¹è±¡æ•°ç»„</span><br>      <span class="hljs-keyword">const</span> jsonArr = XLSX.utils.sheet_to_json(first_worksheet, &#123; <span class="hljs-attr">header</span>: <span class="hljs-number">1</span> &#125;);<br><br>      handleImpotedJson(jsonArr);<br>    &#125;;<br><br>    reader.readAsBinaryString(f);<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">// åœ¨äº‹ä»¶ç›‘å¬æ–‡ä»¶çš„changeçš„å›è°ƒå‡½æ•°ä¸­ï¼Œè·å–åˆ°æ–‡ä»¶å¯¹è±¡ä¹‹åè°ƒç”¨æ–¹æ³•æ¥å°†excelæ•°æ®è§£æä¸ºjson</span><br><span class="hljs-keyword">const</span> handleUpload = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  beforeUpload(uploadInput?.current?.files[<span class="hljs-number">0</span>]);<br>&#125;;<br><br><span class="hljs-comment">// ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œè§¦å‘inputçš„ä¸Šä¼ clickäº‹ä»¶</span><br><span class="hljs-keyword">const</span> handleFakeUpload = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  uploadInput?.current?.click();<br>&#125;;<br><br>useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>) &#123;<br>    <span class="hljs-comment">/**<br>      * ç›‘å¬inputä¸Šä¼ äº‹ä»¶ åœ¨å¾—åˆ°æ–‡ä»¶æµä¹‹å æŠŠinputçš„refå›ä¼ åˆ°çˆ¶ç»„ä»¶<br>      * å¹¶ä¸”è§£ææ–‡ä»¶è½¬ä¸ºjsonæ¥åœ¨è¡¨æ ¼é‡Œæ˜¾ç¤º<br>      */</span><br>    <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">`[name=uploadExcel]`</span>)!.addEventListener(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>&#123;<br>      <span class="hljs-keyword">if</span> (event?.target &amp;&amp; event?.target?.files) &#123;<br>        handleFileInputRefs &amp;&amp; handleFileInputRefs(uploadInput);<br>        handleUpload();<br>      &#125;<br>    &#125;);<br>  &#125;<br>&#125;, []);<br><br><span class="hljs-keyword">return</span> (<br>  &lt;div className="fix-input-button"&gt;<br>    &lt;input type="file" name="uploadExcel" ref=&#123;uploadInput&#125; /&gt;<br>    &lt;Button icon=&#123;&lt;Iconfont name="iconshangchuan" /&gt;&#125; onClick=&#123;handleFakeUpload&#125;&gt;<br>      ä¸Šä¼ <br>    &lt;/Button&gt;<br>  &lt;/div&gt;<br>)<br></code></pre></td></tr></table></figure><p>çˆ¶ç»„ä»¶</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// uploadRefs æ˜¯useStateå®šä¹‰çš„ä¿å­˜refçš„å˜é‡</span><br><br><span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> FormData();<br><br>formData.append(<span class="hljs-string">'fileStream'</span>, uploadRefs?.current?.files[<span class="hljs-number">0</span>]);<br><span class="hljs-comment">// æ¥å£è¿˜éœ€è¦ä¸€äº›åˆ«çš„å‚æ•°</span><br>formData.append(<span class="hljs-string">'connectBusiness'</span>, <span class="hljs-built_in">JSON</span>.stringify(connectBusiness));<br><span class="hljs-comment">/**<br>  * è¿™é‡Œä¸èƒ½è®¾ç½®è¯·æ±‚å¤´<br>  * æµè§ˆå™¨æ£€æµ‹åˆ°åè‡ªå·±åŠ ä¸Š Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryXXXx è¿™æ ·<br>  */</span><br>setIsLoading(<span class="hljs-literal">true</span>)<br>fetch(<span class="hljs-string">'/api/appName/parseExcelUpload'</span>, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,<br>  <span class="hljs-attr">body</span>: formData,<br>&#125;)<br>  .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())<br>  .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(data);<br>  &#125;)<br>  .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'err'</span>, err);<br>  &#125;)<br>  .finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    setIsLoading(<span class="hljs-literal">false</span>);<br>  &#125;);<br></code></pre></td></tr></table></figure><h5 id="node-å±‚"><a href="#node-å±‚" class="headerlink" title="node å±‚"></a><code>node</code> å±‚</h5><p><code>node</code> ç”¨çš„æ˜¯ <code>thinkjs</code>ï¼Œ<code>controller</code> å…¶å®å¾ˆç®€å•ï¼ŒåŒ…è£…ä¸€ä¸‹ç„¶åè¯·æ±‚çœŸæ­£çš„æ¥å£é¿å…ç›´æ¥è°ƒæ¥å£è·¨åŸŸ</p><p>ä¼ªä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> Base = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../base'</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);<br><span class="hljs-keyword">const</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>);<br><br><span class="hljs-keyword">const</span> UPLOAD_SERVICE = <span class="hljs-string">'http://xxx'</span>;<br><br><span class="hljs-built_in">module</span>.exports = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Base</span> </span>&#123;<br><br>  <span class="hljs-keyword">constructor</span>(props) &#123;<br>    <span class="hljs-keyword">super</span>(props)<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> parseExcelUploadAction() &#123;<br><br>    <span class="hljs-comment">// è·å–æ–‡ä»¶ä¿¡æ¯</span><br>    <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">this</span>.file(<span class="hljs-string">'fileStream'</span>);<br><br>    <span class="hljs-comment">// åˆ©ç”¨requestå‘èµ·è¯·æ±‚</span><br>    <span class="hljs-keyword">var</span> req = request.post(UPLOAD_SERVICE, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, resp, body</span>) </span>&#123;<br>      <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-keyword">this</span>.json(&#123;<br>          <span class="hljs-attr">status</span>: <span class="hljs-string">'failed'</span>,<br>          <span class="hljs-attr">msg</span>: <span class="hljs-string">`ä¸Šä¼ å¤±è´¥ï¼Œurl:<span class="hljs-subst">$&#123;UPLOAD_SERVICE&#125;</span>`</span><br>        &#125;)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">this</span>.json(&#123;<br>          <span class="hljs-attr">status</span>: <span class="hljs-string">'success'</span>,<br>          <span class="hljs-attr">data</span>: body<br>        &#125;)<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'è¿”å›è¯·æ±‚'</span> + body);<br>      &#125;<br>    &#125;);<br><br>    <span class="hljs-keyword">var</span> form = req.form();<br><br>    <span class="hljs-comment">// requestä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™éœ€è¦appendä¸€äº›streamå’Œstring</span><br>    <span class="hljs-comment">// nodeä¹Ÿä¼šè‡ªå·±è·å–å‰ç«¯ä¸Šä¼ å‘èµ·è¯·æ±‚çš„å¤´ Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryXXXx</span><br>    form.append(<span class="hljs-string">'file'</span>, fs.createReadStream(files.path), &#123;<br>      <span class="hljs-attr">filename</span>: files.name,<br>      <span class="hljs-attr">contentType</span>: <span class="hljs-string">'application/vnd.ms-excel'</span><br>    &#125;);<br><br>    form.append(<span class="hljs-string">'connectBusiness'</span>, <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>.post(<span class="hljs-string">'connectBusiness'</span>)));<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è‡³æ­¤é€šè¿‡ <code>node</code> ä¸­é—´å±‚æ¥ä¸Šä¼ çš„ä¸€ä¸ªåŠŸèƒ½å®ç°äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>umi ä¸­ä½¿ç”¨ iconfont</title>
    <link href="/2020/12/21/umiUseIconfont/"/>
    <url>/2020/12/21/umiUseIconfont/</url>
    
    <content type="html"><![CDATA[<p><code>ant-design</code> è‡ªå¸¦çš„ <code>icon</code> ç§ç±»å¤ªå°‘ï¼Œé‚æ‰¾æ›¿ä»£æ–¹æ¡ˆ <code>iconfont</code>ã€‚</p><p>é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ç»„ä»¶ï¼Œä½¿å…¶æ¥å—ä¸€ä¸ªåä¸º <code>name</code> æˆ–è€… <code>type</code> çš„å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šå½“å‰æ¸²æŸ“çš„ <code>icon</code> åç§°ã€‚</p><p><code>Iconfont.tsx</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">'./index.less'</span>;<br><br>interface IconfontProps &#123;<br>  <span class="hljs-attr">name</span>: string;<br>  className?: string;<br>&#125;<br><br><span class="hljs-keyword">const</span> Iconfont: React.FC&lt;IconfontProps&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; name, className = <span class="hljs-string">''</span> &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">icon</span> $&#123;<span class="hljs-attr">className</span>&#125;`&#125; <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">use</span> <span class="hljs-attr">xlinkHref</span>=<span class="hljs-string">&#123;</span>`#$&#123;<span class="hljs-attr">name</span>&#125;`&#125;&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">use</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Iconfont;<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;!<span class="hljs-selector-tag">--</span> è¿™å…¶ä¸­çš„æ ·å¼æ ¹æ®é¡¹ç›®è°ƒæ•´ <span class="hljs-selector-tag">--</span>&gt;<br><span class="hljs-selector-class">.icon</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">22px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">22px</span>;<br>  <span class="hljs-attribute">vertical-align</span>: -<span class="hljs-number">4px</span>;<br>  <span class="hljs-attribute">fill</span>: currentColor;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Umi.rc</code>ä¸­é…ç½®åœ¨ <code>iconfont</code> ä¸­ç”Ÿæˆçš„é™æ€èµ„æºåœ°å€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">plugins: [<br>  scripts: [<br>    &#123;<br>      <span class="hljs-attr">src</span>: <span class="hljs-string">`//at.alicdn.com/t/font_xxx_jxx.js`</span>,<br>    &#125;<br>  ]<br>]<br></code></pre></td></tr></table></figure><p><code>tsx</code> ä¸­ä½¿ç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Iconfont <span class="hljs-keyword">from</span> <span class="hljs-string">'Iconfont'</span><br><br>&lt;Iconfont name=<span class="hljs-string">"xxx"</span>/&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
      <tag>umi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>momentjs ä¸€é”®åˆ‡æ¢ä¸º dayjs</title>
    <link href="/2020/12/21/replaceMomentTodayjs/"/>
    <url>/2020/12/21/replaceMomentTodayjs/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸ <code>umi</code> åˆ›å»ºçš„é¡¹ç›®ä¸­ï¼Œæ—¶é—´çš„å¤„ç†ä½¿ç”¨çš„æ˜¯ <code>momentjs</code>ï¼Œç»„ä»¶ç”¨çš„ <code>ant-design</code>ï¼Œè€Œä¸” <code>ant-design</code> çš„æ—¥æœŸåº•å±‚çš„æ—¶é—´å¤„ç†ä¹Ÿæ˜¯ç”¨çš„ <code>moment</code>ã€‚é¡¹ç›®ä¸€æ¬¡æ‰“åŒ…æˆåŠŸä¹‹åå‘ç° <code>moment</code> å çš„ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œäºæ˜¯è€ƒè™‘ä¸‹å°† <code>moment</code> åˆ‡æ¢ä¸ºæ¯”è¾ƒå°çš„ <code>dayjs</code>ã€‚</p><p><code>.umirc.ts</code> çš„é»˜è®¤é…ç½®ä¸­æ˜¯æ”¯æŒä¸å°† <code>locale</code> æ–‡ä»¶æ‰“åŒ…è¿›å»çš„ï¼Œä½†æ˜¯éœ€è¦é…ç½® <code>ignoreMomentLocale:true</code> æ¥å¼€å¯ï¼Œä½†æ˜¯è™½ç„¶å¼€å¯ä¹‹åä»ç„¶è¿˜æ˜¯æœ‰ <code>54kb</code> å·¦å³çš„å¤§å°ï¼Œäºæ˜¯è€ƒè™‘å°†å…¶æ¢åš <code>dayjs</code>ï¼Œå…·ä½“çš„æ˜¯åˆ©ç”¨ <code>antd-dayjs-webpack-plugin</code> æ’ä»¶ï¼Œæ­¤æ’ä»¶æ˜¯å·²ç»å°† <code>moment</code> æ›¿æ¢ä¸º <code>dayjs</code>ï¼Œä¹‹å‰é¡¹ç›®é‡Œå†™çš„ <code>import moment from &#39;moment&#39;</code>ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œè™½ç„¶å¼•å…¥çš„æ˜¯ <code>moment</code>ï¼Œä½†å…¶å®å¼•ç”¨çš„æ˜¯ <code>dayjs</code>ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªæ’ä»¶çš„åº•å±‚ <code>alias</code> äº†åç§°ã€‚æ‰€ä»¥åœ¨ <code>dayjs</code> ä¸æ”¯æŒçš„ä¸€äº›åœ°æ–¹ï¼Œéœ€è¦åˆ©ç”¨ <code>dayjs</code> çš„æ‰©å±•æ–¹æ³•æ¥å¢åŠ ï¼Œä¾‹å¦‚æˆ‘çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† <code>utc</code>ï¼Œæ‰€ä»¥éœ€è¦åœ¨ <code>global.ts</code> é‡Œå…ˆ<br><code>var utc = require(&#39;dayjs/plugin/utc&#39;)</code> å¼•å…¥ <code>dayjs</code> çš„ <code>utc</code> æ’ä»¶ï¼Œå†<code>dayjs.extend(utc)</code> æ‹“å±•ï¼Œä½¿ç”¨å°±å¯ä»¥äº†ã€‚</p><p>è€Œ <code>.umirc.ts</code> å…·ä½“çš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> AntdDayjsWebpackPlugin <span class="hljs-keyword">from</span> <span class="hljs-string">'antd-dayjs-webpack-plugin'</span>;<br><br>chainWebpack(config) &#123;<br>  config.plugin(<span class="hljs-string">'dayjs'</span>).use(AntdDayjsWebpackPlugin);<br>&#125;<br></code></pre></td></tr></table></figure><p>è‡³äº <code>ignoreMomentLocale:true</code> çš„åŸç†åº”è¯¥æ˜¯ä½¿ç”¨çš„ <code>webpack</code> çš„ <code>ContextReplacementPlugin</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">chainWebpack(config) &#123;<br>  <span class="hljs-comment">//è¿‡æ»¤æ‰ momnet çš„é‚£äº›ä¸ä½¿ç”¨çš„å›½é™…åŒ–æ–‡ä»¶ åªé€‰æ‹©zh-cn</span><br>  config<br>    .plugin(<span class="hljs-string">'replace'</span>)<br>    .use(<span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>).ContextReplacementPlugin)<br>    .tap(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-regexp">/moment[\/\\]locale$/</span>, /zh-cn/];<br>  &#125;);<br>&#125;,<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TypeScript å·¥å…·ç±»å‹ä½¿ç”¨æ€»ç»“</title>
    <link href="/2020/11/22/TypeScriptUse/"/>
    <url>/2020/11/22/TypeScriptUse/</url>
    
    <content type="html"><![CDATA[<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">interface</span> IMyInfo &#123;<br>  name: <span class="hljs-built_in">string</span><br>  age: <span class="hljs-built_in">number</span><br>  address: <span class="hljs-built_in">string</span><br>  money: <span class="hljs-built_in">number</span><br>&#125;<br><br><span class="hljs-keyword">type</span> BasicSelect = <span class="hljs-string">'name'</span> | <span class="hljs-string">'age'</span><br></code></pre></td></tr></table></figure><h3 id="keyof"><a href="#keyof" class="headerlink" title="keyof"></a><code>keyof</code></h3><ul><li>è¯¥æ“ä½œç¬¦å¯ä»¥ç”¨äºè·å–æŸç§ç±»å‹çš„æ‰€æœ‰é”®ï¼Œå…¶è¿”å›ç±»å‹æ˜¯è”åˆç±»å‹ã€‚</li><li>ä¾‹å¦‚ï¼š</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> koT = keyof IMyInfo<br><br><span class="hljs-comment">// type koT = "name" | "age" | "address" | "money"</span><br></code></pre></td></tr></table></figure><h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a><code>typeof</code></h3><ul><li><code>typeof</code> æ“ä½œç¬¦å¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ªå˜é‡å£°æ˜æˆ–å¯¹è±¡çš„ç±»å‹</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> naBasicT = <span class="hljs-string">'name'</span> | <span class="hljs-string">'age'</span><br><br><span class="hljs-comment">// ä»Tä¸­é€‰æ‹©å‡ºKçš„ç±»å‹ä½œä¸ºå½“å‰å˜é‡çš„ç±»å‹</span><br><span class="hljs-keyword">const</span> naData: Pick&lt;IMyInfo, naBasicT&gt;  = &#123;<br>  name: <span class="hljs-string">'sss'</span>,<br>  age: <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-keyword">type</span> naT = <span class="hljs-keyword">typeof</span> naData<br><br><span class="hljs-comment">// ç­‰ä»·äº </span><br><span class="hljs-comment">// type naT = &#123;</span><br><span class="hljs-comment">//   name: string;</span><br><span class="hljs-comment">//   age: number;</span><br><span class="hljs-comment">// &#125;</span><br></code></pre></td></tr></table></figure><h3 id="in"><a href="#in" class="headerlink" title="in"></a><code>in</code></h3><ul><li>éå†æšä¸¾ç±»å‹æˆ–åˆ¤æ–­åœ¨ä¸åœ¨æŸä¸€ä¸ªç±»å‹ä¸­</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> Keys = <span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span> | <span class="hljs-string">"c"</span><br><br><span class="hljs-keyword">type</span> Obj =  &#123;<br>  [P <span class="hljs-keyword">in</span> Keys]: <span class="hljs-built_in">string</span><br>&#125;<br><br><span class="hljs-comment">// &#123; a: string, b: string, c: string &#125;</span><br></code></pre></td></tr></table></figure><h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a><code>extends</code></h3><ul><li>ç†è§£ä¸ºçº¦æŸæ¯”è¾ƒå¥½</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> Len = &#123;<br>  length: <span class="hljs-built_in">number</span><br>&#125;<br><br><span class="hljs-comment">// åˆ©ç”¨Lenç±»å‹æ¥çº¦æŸTä½¿å…¶å…·æœ‰lengthçš„ç±»å‹</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLen</span>&lt;<span class="hljs-title">T</span> <span class="hljs-title">extends</span> <span class="hljs-title">Len</span>&gt; (<span class="hljs-params">arg: T</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> arg.length<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Pick"><a href="#Pick" class="headerlink" title="Pick"></a><code>Pick</code></h3><ul><li><code>Pick&lt;T, K&gt;</code> <code>K</code>å¯ä»¥æ˜¯ä¸€ä¸ªè”åˆç±»å‹ ä»æ³›å‹<code>T</code>ä¸­è¿‡æ»¤å‡º<code>K</code>è”åˆçš„ç±»å‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åŸºå‡†ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦é€‰æ‹©å‡ºæ¥çš„ç±»å‹çš„è”åˆï¼Œæˆ–è€…å•ä¸ªç±»å‹</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> pickT = Pick&lt;IMyInfo, BasicSelect&gt;<br><br><span class="hljs-comment">// ç­‰ä»·äº type nameT = &#123;</span><br><span class="hljs-comment">//   name: string;</span><br><span class="hljs-comment">//   age: number;</span><br><span class="hljs-comment">// &#125;</span><br></code></pre></td></tr></table></figure><h3 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a><code>Partial</code></h3><ul><li><code>Partial&lt;T&gt;</code> å°†<code>T</code>éƒ½å˜ä¸ºå¯é€‰ç±»å‹</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> partialT = Partial&lt;IMyInfo&gt;<br></code></pre></td></tr></table></figure><h3 id="Required"><a href="#Required" class="headerlink" title="Required"></a><code>Required</code></h3><ul><li><code>Required&lt;T&gt;</code> å°†ä¼ å…¥çš„æ³›å‹å˜ä¸ºå¿…é€‰é¡¹</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> requiredT = Required&lt;partialT&gt;<br></code></pre></td></tr></table></figure><h3 id="Readonly"><a href="#Readonly" class="headerlink" title="Readonly"></a><code>Readonly</code></h3><ul><li><code>Readonly&lt;T&gt;</code> å°†æ³›å‹å˜ä¸º <code>readonly</code></li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> readonlyT = Readonly&lt;IMyInfo&gt;<br></code></pre></td></tr></table></figure><h3 id="Record"><a href="#Record" class="headerlink" title="Record"></a><code>Record</code></h3><ul><li><code>Record&lt;K, T&gt;</code> å°†<code>T</code>çš„ç±»å‹èµ‹ç»™æ¯ä¸€ä¸ª<code>K</code></li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> recodeT = Record&lt;BasicSelect, IMyInfo&gt;<br><br><span class="hljs-comment">// ç­‰ä»·äº</span><br><span class="hljs-comment">// type recodeT = &#123;</span><br><span class="hljs-comment">//   name: IMyInfo;</span><br><span class="hljs-comment">//   age: IMyInfo;</span><br><span class="hljs-comment">// &#125;</span><br></code></pre></td></tr></table></figure><h3 id="Excludeã€Extract"><a href="#Excludeã€Extract" class="headerlink" title="Excludeã€Extract"></a><code>Exclude</code>ã€<code>Extract</code></h3><ul><li><code>Exclude&lt;T, U&gt;</code> å…¶ä¸­ <code>T</code>ï¼Œ<code>U</code> æ¯”è¾ƒï¼Œæ’é™¤<code>U</code>å’Œ<code>T</code>ä¸­å…±æœ‰ï¼Œè¿”å›<code>T</code>ä¸­å‰©ä¸‹çš„ è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªæ³›å‹ ç¬¬ä¸€ä¸ªä½œä¸ºåŸºå‡†</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> T1 = <span class="hljs-string">'a'</span> | <span class="hljs-string">'b'</span> | <span class="hljs-string">'c'</span> | <span class="hljs-string">'m'</span><br><span class="hljs-keyword">type</span> T2 = <span class="hljs-string">'b'</span> | <span class="hljs-string">'c'</span> | <span class="hljs-string">'d'</span><br><br><span class="hljs-keyword">type</span> excludeT = Exclude&lt;T1, T2&gt;<br><span class="hljs-comment">// ç­‰ä»·äº type excludeT = "a"</span><br><br><span class="hljs-keyword">type</span> extractT = Extract&lt;T1, T2&gt;<br><span class="hljs-comment">// ç­‰ä»·äº type extractT = "b" | "c"</span><br></code></pre></td></tr></table></figure><h3 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a><code>Omit</code></h3><ul><li><code>Omit&lt;T, K&gt;</code> è·Ÿ<code>Pick</code>ç±»ä¼¼ï¼Œä½†æ˜¯åŠŸèƒ½ç›¸å ä»<code>T</code>ä¸­æ’é™¤æ‰<code>K</code>çš„ç±»å‹</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> omitT = Omit&lt;IMyInfo, <span class="hljs-string">'age'</span>&gt;<br><br><span class="hljs-comment">// ç­‰ä»·äº</span><br><span class="hljs-comment">// type omitT = &#123;</span><br><span class="hljs-comment">//   name: string;</span><br><span class="hljs-comment">//   address: string;</span><br><span class="hljs-comment">//   money: number;</span><br><span class="hljs-comment">// &#125;</span><br></code></pre></td></tr></table></figure><h3 id="ReturnType"><a href="#ReturnType" class="headerlink" title="ReturnType"></a><code>ReturnType</code></h3><ul><li>ä»å‡½æ•°çš„è¿”å›å€¼ä¸­æå–ç±»å‹</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">userinfo</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    age: <span class="hljs-number">25</span>,<br>    name: <span class="hljs-string">'jack'</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">type</span> ObjT = ReturnType&lt;<span class="hljs-keyword">typeof</span> userinfo&gt;<br><br><span class="hljs-comment">// ç­‰åŒäº type ObjT = &#123;</span><br><span class="hljs-comment">//   age: number;</span><br><span class="hljs-comment">//   name: string;</span><br><span class="hljs-comment">// &#125;</span><br></code></pre></td></tr></table></figure><h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a><code>Parameters</code></h3><ul><li>ä»å‡½æ•°çš„å‚æ•°ä¸­æå–å‡ºéœ€è¦çš„ç±»å‹</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// å®šä¹‰çš„å‚æ•°ç±»å‹æ˜¯ string, number</span><br><span class="hljs-keyword">type</span> fnT = &#123;<br>  (name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span>): &#123;<br>    breif: <span class="hljs-built_in">string</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">type</span> TParams = Parameters&lt;fnT&gt;<br><span class="hljs-comment">// type TParams = [string, number]</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span> (<span class="hljs-params">name: TParams[0], age: TParams[1]</span>) </span>&#123;&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>TypeScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue 2.X ä¸¤ä¸ªä¸åŒçš„è¿è¡Œç‰ˆæœ¬</title>
    <link href="/2020/11/08/vueVersion/"/>
    <url>/2020/11/08/vueVersion/</url>
    
    <content type="html"><![CDATA[<h2 id="Runtime-Only"><a href="#Runtime-Only" class="headerlink" title="Runtime Only"></a><code>Runtime Only</code></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> Vue(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,<br>  router,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> h(App)<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>è¯´æ˜ï¼š<code>vue-loader + webpack</code>ï¼Œä¼šåœ¨æ„å»ºçš„æ—¶å€™å°†<code>*.vue</code>æ‰“åŒ…ä¸ºé™æ€èµ„æºæ–‡ä»¶ï¼Œæœ€ç»ˆçš„æ–‡ä»¶æ˜¯å·²ç»è¢«é¢„ç¼–è¯‘ä¹‹åçš„é™æ€æµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„èµ„æºï¼Œä¹Ÿæ˜¯ä¸éœ€è¦ç¼–è¯‘å™¨çš„å¯ä»¥ç›´æ¥è¿è¡Œçš„ï¼Œå³åªæœ‰è¿è¡Œæ—¶ã€‚</li></ul><h2 id="Runtime-Compiler"><a href="#Runtime-Compiler" class="headerlink" title="Runtime + Compiler"></a><code>Runtime + Compiler</code></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> Vue(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,<br>  router,<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;App/&gt;'</span>,<br>  <span class="hljs-attr">components</span>: &#123; App &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>è¿è¡Œæ—¶+ç¼–è¯‘å™¨ï¼Œåœ¨<code>vue-loader + webpack</code>æ„å»ºçš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šè¿›è¡Œç¼–è¯‘çš„ï¼Œåœ¨æµè§ˆå™¨è¿è¡Œçš„æ—¶å€™è¿›è¡Œç¼–è¯‘ã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸¤ç§å¸¸è§çš„è®¾ç½®é”šç‚¹çš„æ–¹æ³•</title>
    <link href="/2020/11/06/anchorSetting/"/>
    <url>/2020/11/06/anchorSetting/</url>
    
    <content type="html"><![CDATA[<p>æ¦‚è¿°ï¼šåœ¨æ½œæ„è¯†é‡Œä½¿ç”¨æœ€å¤šçš„åº”è¯¥å°±æ˜¯<code>a</code>æ ‡ç­¾é…åˆå…¶ä»–æ ‡ç­¾çš„<code>id</code>å±æ€§å»åšé¡µé¢é”šç‚¹è·³è½¬ï¼Œç„¶è€Œåœ¨æœ‰<code>prompt</code>å¹¶ä¸”è·¯ç”±åœ¨å˜åŒ–çš„æ—¶å€™ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚å› ä¸ºåœ¨è®¾ç½®äº†<code>prompt</code>æœ‰æ•°æ®çš„è¯ä¼šåšç¦»å¼€é¡µé¢æ•°æ®ä¸ä¿å­˜æˆ–è€…ç»“æŸä»»åŠ¡çš„æç¤ºé€»è¾‘ï¼Œä½†æ˜¯è¿™ä¸ª<code>prompt</code>åˆæ˜¯åŸºäºè·¯ç”±çš„å˜åŒ–æ¥ç¡®å®šæœ‰æ²¡æœ‰è§¦å‘ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•å¢åŠ é”šç‚¹çš„æ—¶å€™<code>url</code>åä¼šè¿½åŠ å“ˆå¸Œå€¼å¯¼è‡´è§¦å‘äº†<code>url</code>å˜åŠ¨ï¼Œ<code>prompt</code>æ²¡æ³•ç®€å•åˆ¤æ–­å‡ºæ¥ç›®å‰æ˜¯å› ä¸ºä»€ä¹ˆäº‹ä»¶è§¦å‘ï¼Œä»è€Œå¯¼è‡´åœ¨ç‚¹å‡»é”šç‚¹çš„æ—¶å€™è§¦å‘äº†<code>prompt</code>æç¤ºã€‚æ­£å¥½æœ€è¿‘å­¦ä¹ äº†<code>scrollIntoView</code>å°±æ­£å¥½æƒ³ç€å°è¯•è§£å†³ä¸€ä¸‹ã€‚</p><ul><li><h2 id="ä¼ ç»Ÿçš„æ–¹æ³•åˆ©ç”¨aæ ‡ç­¾å’Œid"><a href="#ä¼ ç»Ÿçš„æ–¹æ³•åˆ©ç”¨aæ ‡ç­¾å’Œid" class="headerlink" title="ä¼ ç»Ÿçš„æ–¹æ³•åˆ©ç”¨aæ ‡ç­¾å’Œid"></a>ä¼ ç»Ÿçš„æ–¹æ³•åˆ©ç”¨<code>a</code>æ ‡ç­¾å’Œ<code>id</code></h2></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">// è®¾ç½®ï¼Œç”¨æˆ·ç‚¹å‡»å¹¶è·³è½¬<br>&lt;a href="#anchorId"&gt;é”šç‚¹1&lt;/a&gt;<br><br>// å¾…è·³è½¬æ ‡è¯†çš„ä½ç½®ï¼Œä½¿ç”¨id<br>&lt;div id="anchorId"&gt;è·³è½¬åˆ°é”šç‚¹1&lt;/div&gt;<br><br>åœ¨ç‚¹å‡» â€œè·³è½¬åˆ°é”šç‚¹1â€ çš„æ—¶å€™å°±ä¼šåœ¨urlä¸­åŠ å…¥å“ˆå¸Œä»è€Œå®ç°é”šç‚¹è·³è½¬<br></code></pre></td></tr></table></figure><ul><li><h2 id="åˆ©ç”¨æµè§ˆå™¨h5çš„æ–°api-scrollIntoViewæ¥è§£å†³"><a href="#åˆ©ç”¨æµè§ˆå™¨h5çš„æ–°api-scrollIntoViewæ¥è§£å†³" class="headerlink" title="åˆ©ç”¨æµè§ˆå™¨h5çš„æ–°api scrollIntoViewæ¥è§£å†³"></a>åˆ©ç”¨æµè§ˆå™¨<code>h5</code>çš„æ–°<code>api scrollIntoView</code>æ¥è§£å†³</h2><ul><li>è¯­æ³•è¯´æ˜</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">element.scrollIntoView(); <span class="hljs-comment">// ç­‰åŒäºelement.scrollIntoView(true)</span><br>element.scrollIntoView(alignToTop); <span class="hljs-comment">// Booleanå‹å‚æ•°</span><br>element.scrollIntoView(scrollIntoViewOptions); <span class="hljs-comment">// Objectå‹å‚æ•°</span><br></code></pre></td></tr></table></figure><ul><li><p>å‚æ•°è¯´æ˜</p><ul><li><p><code>alignToTop</code>å¯é€‰ï¼Œä¸€ä¸ª<code>Boolean</code>å€¼ï¼š</p><ul><li>å¦‚æœä¸º<code>true</code>ï¼Œå…ƒç´ çš„é¡¶ç«¯å°†å’Œå…¶æ‰€åœ¨æ»šåŠ¨åŒºçš„å¯è§†åŒºåŸŸçš„é¡¶ç«¯å¯¹é½ã€‚ç›¸åº”çš„ <code>scrollIntoViewOptions: {block: &quot;start&quot;, inline: &quot;nearest&quot;}</code>ã€‚è¿™æ˜¯è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ã€‚</li><li>å¦‚æœä¸º<code>false</code>ï¼Œå…ƒç´ çš„åº•ç«¯å°†å’Œå…¶æ‰€åœ¨æ»šåŠ¨åŒºçš„å¯è§†åŒºåŸŸçš„åº•ç«¯å¯¹é½ã€‚ç›¸åº”çš„<code>scrollIntoViewOptions: {block: &quot;end&quot;, inline: &quot;nearestâ€}</code>ã€‚</li></ul></li><li><p><code>scrollIntoViewOptions</code> å¯é€‰ ä¸€ä¸ªåŒ…å«ä¸‹åˆ—å±æ€§çš„å¯¹è±¡ï¼š</p><ul><li><code>behavior</code> å¯é€‰ å®šä¹‰åŠ¨ç”»è¿‡æ¸¡æ•ˆæœï¼Œ <code>auto</code>æˆ– <code>smooth</code> ä¹‹ä¸€ã€‚é»˜è®¤ä¸º <code>auto</code>ã€‚</li><li><code>block</code> å¯é€‰ å®šä¹‰å‚ç›´æ–¹å‘çš„å¯¹é½ï¼Œ <code>start</code>, <code>center</code>, <code>end</code>, æˆ– <code>nearest</code>ä¹‹ä¸€ã€‚é»˜è®¤ä¸º <code>start</code>ã€‚</li><li><code>inline</code> å¯é€‰ å®šä¹‰æ°´å¹³æ–¹å‘çš„å¯¹é½ï¼Œ <code>start</code>, <code>center</code>, <code>end</code>, æˆ– <code>nearest</code>ä¹‹ä¸€ã€‚é»˜è®¤ä¸º <code>nearest</code>ã€‚</li></ul></li></ul></li><li><p>ä¼ªä»£ç </p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å› ä¸ºæœ‰å…¼å®¹é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ç”¨ç¬¬ä¸‰æ–¹åŒ…æ¥å¤„ç†ä¸€ä¸‹å…¼å®¹</span><br><span class="hljs-keyword">import</span> smoothscroll <span class="hljs-keyword">from</span> <span class="hljs-string">'smoothscroll-polyfill'</span>;<br>smoothscroll.polyfill();<br><br><span class="hljs-comment">// åœ¨renderä¹‹å‰ä¸ºéœ€è¦é”šç‚¹çš„å…ƒç´ å¢åŠ data-xxxå±æ€§ï¼Œåœ¨è§¦å‘å¯¹åº”çš„äº‹ä»¶ï¼Œéœ€è¦é”šç‚¹åˆ°å¯¹åº”çš„ä½ç½®çš„æ—¶å€™åˆ©ç”¨apiè·³è½¬ï¼Œå¦‚æœæ˜¯æ•°ç»„å¾ªç¯ä¸‹æ¥çš„ç»“æ„çš„è¯å¯ä»¥å°†å¯¹åº”çš„idä¼ é€’ç»™å‡½æ•°ï¼Œç‚¹å‡»çš„æ—¶å€™è·å–å¯¹åº”çš„å…ƒç´ å¹¶ä¸”å†å»æ‰§è¡Œæ“ä½œ</span><br><br><span class="hljs-keyword">const</span> scrollToAnchor = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// åˆ©ç”¨å±æ€§é€‰æ‹©å™¨ + querySelector</span><br>  <span class="hljs-keyword">const</span> ele = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">`[data-imageId=<span class="hljs-subst">$&#123;id&#125;</span>]`</span>)<br>  <span class="hljs-keyword">if</span> (ele) &#123;<br>    ele.scrollIntoView(&#123;<span class="hljs-attr">block</span>: <span class="hljs-string">'start'</span>, <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>&#125;)<br>  &#125;<br>&#125;<br><br>&lt;img data-imageId=<span class="hljs-string">"img1"</span> /&gt;<br>&lt;div onClick=&#123;() =&gt; scrollToAnchor('img1')&#125;&gt;è·³è½¬&lt;div/&gt;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>h5-api</tag>
      
      <tag>scrollIntoView</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸç”Ÿå®ç°æµè§ˆå™¨æ”¯æŒçš„å›¾ç‰‡æ‡’åŠ è½½æ–¹æ¡ˆ</title>
    <link href="/2020/11/05/lazyLoad/"/>
    <url>/2020/11/05/lazyLoad/</url>
    
    <content type="html"><![CDATA[<p>æ¦‚è¿°ï¼šå› ä¸ºå†…éƒ¨é¡¹ç›®è¿è¥å·¥å…·ä¸­æœ‰é‡åˆ°å¤„ç†å¤§é‡å›¾ç‰‡åœ¨ä¸€ç¬é—´è¯·æ±‚çš„åœºæ™¯ï¼Œåœ¨å¼€å‘é˜¶æ®µé‡åˆ°äº†å¦‚æœä¸å¤„ç†å›¾ç‰‡ï¼Œä¸ç”¨æ‡’åŠ è½½çš„è¯ï¼Œæµè§ˆå™¨ä¼šåœ¨ä¸€ç¬é—´é€ æˆå¡é¡¿ï¼Œç”¨æˆ·ä½“éªŒå’Œæ•ˆæœéå¸¸å·®ã€‚</p><p>è§£å†³æ–¹æ¡ˆ</p><ul><li><h3 id="æœªè°ƒç ”çš„-React-ä¸‰æ–¹æ‡’åŠ è½½åº“"><a href="#æœªè°ƒç ”çš„-React-ä¸‰æ–¹æ‡’åŠ è½½åº“" class="headerlink" title="æœªè°ƒç ”çš„ React ä¸‰æ–¹æ‡’åŠ è½½åº“"></a>æœªè°ƒç ”çš„ <code>React</code> ä¸‰æ–¹æ‡’åŠ è½½åº“</h3></li><li><h3 id="img-å›¾ç‰‡çš„å±æ€§-loading"><a href="#img-å›¾ç‰‡çš„å±æ€§-loading" class="headerlink" title="img å›¾ç‰‡çš„å±æ€§ loading"></a><code>img</code> å›¾ç‰‡çš„å±æ€§ <code>loading</code></h3><p>å› ä¸ºé¡¹ç›®é‡‡ç”¨çš„æ˜¯ <code>umi+ts</code>ï¼Œè€Œ <code>img</code> å±æ€§çš„ <code>loading</code> å¹¶æœªæ ‡å‡†åŒ–ï¼Œè¿˜å¤„åœ¨å®éªŒé˜¶æ®µï¼Œä½†æ˜¯ <code>Chrome 76+</code> å·²ç»æ”¯æŒã€‚ä»£ç ä¸­ç›´æ¥åœ¨ <code>jsx</code> ä¸­ä¸º<code>img</code> æ ‡ç­¾åŠ ä¸Š <code>loading=&quot;lazy&quot;</code> å±æ€§ä¹‹åä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸º <code>ts</code> çš„ç±»å‹ä¸­ <code>img</code> ä¸å­˜åœ¨ <code>loading</code> çš„å±æ€§ï¼Œè§£å†³åŠæ³•æ˜¯å£°æ˜ä¸€ä¸ªç±»å‹æ–‡ä»¶ï¼Œå°†éœ€è¦è®¾ç½®çš„æ ‡ç­¾å±æ€§ç»§æ‰¿åˆ° <code>HTML</code> å±æ€§å°±å¥½äº†ï¼Œåˆ«çš„æ ‡ç­¾ä¹Ÿç±»ä¼¼ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// react-unstable-attributes.d.ts</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">"react"</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">module</span> "react" &#123;<br>  <span class="hljs-keyword">interface</span> ImgHTMLAttributes&lt;T&gt; <span class="hljs-keyword">extends</span> HTMLAttributes&lt;T&gt; &#123;<br>    loading?: <span class="hljs-string">"auto"</span> | <span class="hljs-string">"eager"</span> | <span class="hljs-string">"lazy"</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// å‚æ•°</span><br>lazyï¼šå»¶è¿ŸåŠ è½½ã€‚<br>eagerï¼šç«‹å³åŠ è½½ã€‚<br>autoï¼šç”±æµè§ˆå™¨æ¥å†³å®šæ˜¯å¦å»¶è¿ŸåŠ è½½ã€‚<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ç›´æ¥ä¸ºå›¾ç‰‡åŠ äº† <code>loading</code> å±æ€§ä¹‹åå¹¶æ²¡æœ‰å®ç°æ‡’åŠ è½½ï¼Œåæ¥åœ¨è°ƒè¯•çš„æ—¶å€™æ„å¤–ä¸ºå›¾ç‰‡åŠ äº† <code>width</code> å°ºå¯¸ä¹‹åå‘ç°ç«Ÿç„¶ç”Ÿæ•ˆäº†ï¼Œæˆ–è®¸åœ¨çœŸå®åœºæ™¯ä¹‹ä¸‹è¿˜éœ€è¦å¾®è°ƒã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">"lazy"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"90px"</span> /&gt;</span><br></code></pre></td></tr></table></figure><p><code>loading=&quot;lazy&quot;</code> çš„å±æ€§å¯¹äºåˆ«çš„æµè§ˆå™¨çš„å…¼å®¹ä¸€èˆ¬ï¼Œå¯ä»¥åˆ©ç”¨ <code>js</code> åˆ¤æ–­ï¼Œä¸æ”¯æŒ <code>loading</code> çš„è¯ä½¿ç”¨<code>IntersectionObserver</code>ä¼˜é›…é™çº§ã€‚<a href="https://juejin.im/post/6844903830581149710" target="_blank" rel="noopener">å¯å‚è€ƒ</a></p></li><li><h3 id="h5-IntersectionObserver-api"><a href="#h5-IntersectionObserver-api" class="headerlink" title="h5 IntersectionObserver api"></a><code>h5 IntersectionObserver api</code></h3><p><code>IntersectionObserver</code> æä¾›äº†ä¸€ç§å¼‚æ­¥æ£€æµ‹ç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ– <code>viewport</code> ç›¸äº¤æƒ…å†µå˜åŒ–çš„æ–¹æ³•ã€‚å®ƒä¼šæ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¯å½“è¢«ç›‘è§†çš„å…ƒç´ è¿›å…¥æˆ–è€…é€€å‡ºå¦å¤–ä¸€ä¸ªå…ƒç´ æ—¶(æˆ–è€… è§†å£ )ï¼Œæˆ–è€…ä¸¤ä¸ªå…ƒç´ çš„ç›¸äº¤éƒ¨åˆ†å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯¥å›è°ƒæ–¹æ³•ä¼šè¢«è§¦å‘æ‰§è¡Œã€‚è¿™æ ·ï¼Œæˆ‘ä»¬ç½‘ç«™çš„ä¸»çº¿ç¨‹ä¸éœ€è¦å†ä¸ºäº†ç›‘å¬å…ƒç´ ç›¸äº¤è€Œè¾›è‹¦åŠ³ä½œï¼Œæµè§ˆå™¨ä¼šè‡ªè¡Œä¼˜åŒ–å…ƒç´ ç›¸äº¤ç®¡ç†ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener">æ‘˜è‡ª MDN</a></p><p>å…¼å®¹çš„ <code>folyfill intersection-observer</code></p><p>ä¼ªä»£ç </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•° æ»¡è¶³æ¡ä»¶çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œä¸ºå›¾ç‰‡srcèµ‹å€¼</span><br><span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> IntersectionObserver(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">changes</span>) </span>&#123;<br>  changes.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, index</span>) </span>&#123;<br><br>    <span class="hljs-comment">// å½“è¿™ä¸ªå€¼å¤§äº0ï¼Œè¯´æ˜æ»¡è¶³æˆ‘ä»¬çš„åŠ è½½æ¡ä»¶äº†ï¼Œè¿™ä¸ªå€¼å¯é€šè¿‡rootMarginæ‰‹åŠ¨è®¾ç½®</span><br>    <span class="hljs-keyword">if</span> (element.intersectionRatio &gt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-comment">// è®¾ç½®å›¾ç‰‡srcå±æ€§æ¥åŠ è½½</span><br>      element.target.src = element.target.dataset.src;<br><br>      <span class="hljs-comment">// æ”¾å¼ƒç›‘å¬ï¼Œé˜²æ­¢æ€§èƒ½æµªè´¹ã€‚</span><br>      observer.unobserve(element.target);<br>    &#125;<br>  &#125;);<br>&#125;);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initObserver</span>(<span class="hljs-params"></span>) </span>&#123;<br>  [...document.querySelectorAll(<span class="hljs-string">'.list-item-img'</span>)].forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// å¯¹æ¯ä¸ªlistå…ƒç´ è¿›è¡Œç›‘å¬</span><br>    observer.observe(item);<br>  &#125;);<br>&#125;<br><br>useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  initObserver()<br>&#125;, [])<br><br><span class="hljs-comment">// jsx</span><br>&lt;img <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"list-item-img"</span> data-src=<span class="hljs-string">"1.png"</span>/&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item-img"</span>  <span class="hljs-attr">data-src</span>=<span class="hljs-string">"2.png"</span>/&gt;</span></span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>h5-api</tag>
      
      <tag>IntersectionObserver</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitlab-ci.ymlæ–‡ä»¶çš„ä¸€äº›æ€»ç»“</title>
    <link href="/2020/10/24/gitlab-ci/"/>
    <url>/2020/10/24/gitlab-ci/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸºç¡€æŠ½è±¡æ¦‚å¿µ"><a href="#åŸºç¡€æŠ½è±¡æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æŠ½è±¡æ¦‚å¿µ"></a>åŸºç¡€æŠ½è±¡æ¦‚å¿µ</h2><ul><li><h3 id="runner"><a href="#runner" class="headerlink" title="runner"></a><code>runner</code></h3>ç”¨æ¥æ‰§è¡Œè½¯ä»¶é›†æˆè„šæœ¬çš„ä¸œè¥¿ï¼Œ<code>runner</code> çš„æœºå™¨æ˜¯éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—® <code>GitLab</code> æœåŠ¡å™¨<ul><li><code>Shared Runner</code> åœºæ™¯ï¼šæ‰€æœ‰çš„å·¥ç¨‹éƒ½æœ‰å¯èƒ½éœ€è¦åœ¨å…¬å¸çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰å·¥ä½œï¼Œè¿™ä¸ªæ—¶å€™æ³¨å†Œä¸€ä¸ª<code>Shared Runner</code>ä¾›æ‰€æœ‰å·¥ç¨‹ä½¿ç”¨å°±å¾ˆåˆé€‚</li><li><code>Specific Runner</code> åœºæ™¯ï¼šä¸ªäººçš„ç”µè„‘æˆ–è€…æœåŠ¡å™¨ä¸Šè‡ªåŠ¨æ„å»ºæˆ‘å‚ä¸çš„æŸä¸ªå·¥ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™æ³¨å†Œä¸€ä¸ª <code>Specific Runner</code> å°±å¾ˆåˆé€‚</li></ul></li><li><h3 id="pipleline"><a href="#pipleline" class="headerlink" title="pipleline"></a><code>pipleline</code></h3>ä¸€æ•´ä¸ªå·¥ä½œæµ</li><li><h3 id="stage"><a href="#stage" class="headerlink" title="stage"></a><code>stage</code></h3>ä¸€æ•´ä¸ªå·¥ä½œæµæ˜¯ç”±äºå¤šä¸ª <code>stage</code> ç»„æˆ<ul><li>å¦‚æœä¸¤ä¸ªä»»åŠ¡å¯¹åº”çš„ <code>stage</code> åç›¸åŒï¼Œåˆ™è¿™ä¸¤ä¸ªä»»åŠ¡ä¼šå¹¶è¡Œè¿è¡Œ</li><li>ä¸‹ä¸€ä¸ª <code>stage</code> å…³è”çš„ä»»åŠ¡ä¼šç­‰å¾…ä¸Šä¸€ä¸ª <code>stage</code> æ‰§è¡ŒæˆåŠŸåæ‰ç»§ç»­è¿è¡Œï¼Œå¤±è´¥åˆ™ä¸è¿è¡Œ</li></ul></li><li><h3 id="job"><a href="#job" class="headerlink" title="job"></a><code>job</code></h3>æ¯ä¸€ä¸ª <code>stage</code> ç”±è‡³å°‘ä¸€ä¸ª <code>Job</code> ç»„æˆ</li><li><h3 id="image"><a href="#image" class="headerlink" title="image"></a><code>image</code></h3>é•œåƒ æŒ‡å®šä¸€ä¸ªä»»åŠ¡ <code>ï¼ˆjobï¼‰</code> æ‰€ä½¿ç”¨çš„ <code>docker</code> é•œåƒ</li><li><h3 id="only-except"><a href="#only-except" class="headerlink" title="only / except"></a><code>only / except</code></h3>å½“ç¬¦åˆå®šä¹‰çš„ç­–ç•¥æ—¶æ‰ä¼šè§¦å‘ <code>Pipelines</code> çš„æ‰§è¡Œï¼Œ<code>except</code> åˆ™ç›¸åã€‚</li><li><h3 id="variables"><a href="#variables" class="headerlink" title="variables"></a><code>variables</code></h3>å®šä¹‰å˜é‡</li></ul><h2 id="gitlab-ci-yml-ç¤ºä¾‹è¯´æ˜"><a href="#gitlab-ci-yml-ç¤ºä¾‹è¯´æ˜" class="headerlink" title=".gitlab-ci.yml ç¤ºä¾‹è¯´æ˜"></a><code>.gitlab-ci.yml</code> ç¤ºä¾‹è¯´æ˜</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">stages:</span><br>  <span class="hljs-comment">#- å…ˆå®šä¹‰å‡ ä¸ªé˜¶æ®µ åœ¨ymlåŠ è½½å®Œæˆä¹‹åå°±ä¼šåœ¨pipelineé‡Œå‡ºç°ä¸‰ä¸ªstages stageçš„åç§°æ˜¯ä¸‹è¾¹å¼€å§‹çš„æœ€å‰è¾¹çš„åç§°ã€name1ã€name2ã€name3ã€‘</span><br><span class="hljs-bullet">  -</span> <span class="hljs-string">assemble</span><br><span class="hljs-bullet">  -</span> <span class="hljs-string">deploy</span><br><span class="hljs-bullet">  -</span> <span class="hljs-string">success</span><br><br>  <span class="hljs-comment">#- stageçš„åç§°</span><br><span class="hljs-attr">name1:</span><br>  <span class="hljs-comment">#- å¯¹åº”ç¬¬ä¸€ä¸ªéœ€è¦å¤„ç†çš„é˜¶æ®µ</span><br><span class="hljs-attr">  stage:</span> <span class="hljs-string">assemble</span><br>  <span class="hljs-comment">#- éœ€è¦åœ¨assembleçš„æ—¶å€™è¿è¡Œçš„è„šæœ¬ `linux` çš„å‘½ä»¤</span><br><span class="hljs-attr">  script:</span><br><span class="hljs-bullet">    -</span> <span class="hljs-string">ls</span> <span class="hljs-bullet">-la</span><br><span class="hljs-bullet">    -</span> <span class="hljs-string">rm</span> <span class="hljs-bullet">-rf</span> <span class="hljs-string">node_module</span><br><span class="hljs-bullet">    -</span> <span class="hljs-string">pwd</span><br><span class="hljs-attr">name2:</span><br><span class="hljs-attr">  stage:</span> <span class="hljs-string">deploy</span><br>  <span class="hljs-comment">#- ä¾èµ–é¡¹ç›®</span><br><span class="hljs-attr">  dependencies:</span><br><span class="hljs-bullet">    -</span> <span class="hljs-string">name1</span><br>  <span class="hljs-comment">#- éœ€è¦åœ¨deployçš„æ—¶å€™è¿è¡Œçš„è„šæœ¬</span><br><span class="hljs-attr">  script:</span><br><br><span class="hljs-attr">name3:</span><br><span class="hljs-attr">  stage:</span> <span class="hljs-string">success</span><br>  <span class="hljs-comment">#- ä¾èµ–é¡¹ç›®</span><br><span class="hljs-attr">  dependencies:</span><br><span class="hljs-bullet">    -</span> <span class="hljs-string">name2</span><br>  <span class="hljs-comment">#- éœ€è¦åœ¨successçš„æ—¶å€™è¿è¡Œçš„è„šæœ¬</span><br><span class="hljs-attr">  script:</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>gitlab-ci</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµè§ˆå™¨ä¸­ä¸‹è½½çš„ä¸€äº›æ€»ç»“</title>
    <link href="/2020/10/21/browserDownload/"/>
    <url>/2020/10/21/browserDownload/</url>
    
    <content type="html"><![CDATA[<h1 id="é€šè¿‡-http-è¯·æ±‚è¿”å›çš„-json-æ•°æ®ï¼Œå¦‚ä½•ä¸‹è½½åˆ°æœ¬åœ°ä½œä¸ºè°ƒè¯•çš„-mock-æ•°æ®ï¼Ÿ"><a href="#é€šè¿‡-http-è¯·æ±‚è¿”å›çš„-json-æ•°æ®ï¼Œå¦‚ä½•ä¸‹è½½åˆ°æœ¬åœ°ä½œä¸ºè°ƒè¯•çš„-mock-æ•°æ®ï¼Ÿ" class="headerlink" title="é€šè¿‡ http è¯·æ±‚è¿”å›çš„ json æ•°æ®ï¼Œå¦‚ä½•ä¸‹è½½åˆ°æœ¬åœ°ä½œä¸ºè°ƒè¯•çš„ mock æ•°æ®ï¼Ÿ"></a>é€šè¿‡ <code>http</code> è¯·æ±‚è¿”å›çš„ <code>json</code> æ•°æ®ï¼Œå¦‚ä½•ä¸‹è½½åˆ°æœ¬åœ°ä½œä¸ºè°ƒè¯•çš„ <code>mock</code> æ•°æ®ï¼Ÿ</h1><h2 id="äºŒè¿›åˆ¶æ–‡ä»¶ç­‰éƒ¨åˆ†æ¶‰åŠ"><a href="#äºŒè¿›åˆ¶æ–‡ä»¶ç­‰éƒ¨åˆ†æ¶‰åŠ" class="headerlink" title="äºŒè¿›åˆ¶æ–‡ä»¶ç­‰éƒ¨åˆ†æ¶‰åŠ"></a>äºŒè¿›åˆ¶æ–‡ä»¶ç­‰éƒ¨åˆ†æ¶‰åŠ</h2><h3 id="æµè§ˆå™¨ä¸­çš„ä¸‹è½½ä¸€èˆ¬éƒ½ä¼šæ¶‰åŠåˆ°äºŒè¿›åˆ¶ï¼Œæµè§ˆå™¨ä¸­å¸¸è§çš„äºŒè¿›åˆ¶ä»¥åŠç‰¹æ®Šçš„æ•°æ®ç›¸å…³çš„ç”¨çš„æœ€å¤šBlobï¼ŒDataURLï¼ŒBase64-ï¼ŒObjectURL"><a href="#æµè§ˆå™¨ä¸­çš„ä¸‹è½½ä¸€èˆ¬éƒ½ä¼šæ¶‰åŠåˆ°äºŒè¿›åˆ¶ï¼Œæµè§ˆå™¨ä¸­å¸¸è§çš„äºŒè¿›åˆ¶ä»¥åŠç‰¹æ®Šçš„æ•°æ®ç›¸å…³çš„ç”¨çš„æœ€å¤šBlobï¼ŒDataURLï¼ŒBase64-ï¼ŒObjectURL" class="headerlink" title="æµè§ˆå™¨ä¸­çš„ä¸‹è½½ä¸€èˆ¬éƒ½ä¼šæ¶‰åŠåˆ°äºŒè¿›åˆ¶ï¼Œæµè§ˆå™¨ä¸­å¸¸è§çš„äºŒè¿›åˆ¶ä»¥åŠç‰¹æ®Šçš„æ•°æ®ç›¸å…³çš„ç”¨çš„æœ€å¤šBlobï¼ŒDataURLï¼ŒBase64 ï¼ŒObjectURL"></a>æµè§ˆå™¨ä¸­çš„ä¸‹è½½ä¸€èˆ¬éƒ½ä¼šæ¶‰åŠåˆ°äºŒè¿›åˆ¶ï¼Œæµè§ˆå™¨ä¸­å¸¸è§çš„äºŒè¿›åˆ¶ä»¥åŠç‰¹æ®Šçš„æ•°æ®ç›¸å…³çš„ç”¨çš„æœ€å¤š<code>Blobï¼ŒDataURLï¼ŒBase64 ï¼ŒObjectURL</code></h3><ul><li><p><code>Blob</code> æ˜¯æµè§ˆå™¨ç«¯çš„ç±»æ–‡ä»¶å¯¹è±¡ï¼Œå­˜å‚¨ç€äºŒè¿›åˆ¶çš„æ•°æ®ï¼Œå…¶æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>array</code> æ˜¯ä¸€ä¸ªç”± <code>ArrayBuffer</code> , <code>ArrayBufferView</code> , <code>Blob</code> , <code>DOMString</code> ç­‰å¯¹è±¡æ„æˆçš„ <code>Array</code> ï¼Œæˆ–è€…å…¶ä»–ç±»ä¼¼å¯¹è±¡çš„æ··åˆä½“ï¼Œå®ƒå°†ä¼šè¢«æ”¾è¿› <code>Blob</code> ã€‚<code>DOMStrings</code> ä¼šè¢«ç¼–ç ä¸º <code>UTF-8</code> ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–‡ä»¶çš„ <code>MIME</code> ç±»å‹</p></li><li><p><code>Data URL</code> æ ¼å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ ¼å¼</span><br>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;<br><br>// æµè§ˆå™¨åœ°å€æ å¯ä»¥ç›´æ¥è®¿é—®<br>data:text/html,&lt;h1&gt;Hello%2C%20World!&lt;/h1&gt;<br></code></pre></td></tr></table></figure></li><li><p><code>Base64</code> æœ€å¸¸ç”¨çš„åœºæ™¯ä¸€èˆ¬æ˜¯å°†å›¾ç‰‡å‹ç¼©å¤„ç†ï¼Œä½†æ˜¯ç¼–ç ä¹‹åå­˜å‚¨è¾ƒå¤§</p></li><li><p><code>ObjectURL</code> æµè§ˆå™¨çš„ <code>URL</code> å¯¹è±¡ç”Ÿæˆä¸€ä¸ªåœ°å€æ¥è¡¨ç¤º <code>Blob</code> æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">URL.createObjectURL(<span class="hljs-keyword">new</span> Blob(<span class="hljs-string">'hello, world'</span>.split(<span class="hljs-string">''</span>)))<br></code></pre></td></tr></table></figure></li></ul><h2 id="å…·ä½“ä¸‹è½½æ€è·¯"><a href="#å…·ä½“ä¸‹è½½æ€è·¯" class="headerlink" title="å…·ä½“ä¸‹è½½æ€è·¯"></a>å…·ä½“ä¸‹è½½æ€è·¯</h2><h3 id="ä¸€èˆ¬æ¥å£è¿”å›å€¼éƒ½æ˜¯-json-ç»“æ„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå°†å…¶-JSON-stringify-åºåˆ—åŒ–ä¸º-JSON-å­—ç¬¦ä¸²ï¼Œæƒ³è¦å°†æ¥å£è¿”å›çš„æ•°æ®ä¸‹è½½ï¼Œæœ‰ä¸¤ç§æ€è·¯"><a href="#ä¸€èˆ¬æ¥å£è¿”å›å€¼éƒ½æ˜¯-json-ç»“æ„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå°†å…¶-JSON-stringify-åºåˆ—åŒ–ä¸º-JSON-å­—ç¬¦ä¸²ï¼Œæƒ³è¦å°†æ¥å£è¿”å›çš„æ•°æ®ä¸‹è½½ï¼Œæœ‰ä¸¤ç§æ€è·¯" class="headerlink" title="ä¸€èˆ¬æ¥å£è¿”å›å€¼éƒ½æ˜¯ json ç»“æ„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå°†å…¶ JSON.stringify åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œæƒ³è¦å°†æ¥å£è¿”å›çš„æ•°æ®ä¸‹è½½ï¼Œæœ‰ä¸¤ç§æ€è·¯"></a>ä¸€èˆ¬æ¥å£è¿”å›å€¼éƒ½æ˜¯ <code>json</code> ç»“æ„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå°†å…¶ <code>JSON.stringify</code> åºåˆ—åŒ–ä¸º <code>JSON</code> å­—ç¬¦ä¸²ï¼Œæƒ³è¦å°†æ¥å£è¿”å›çš„æ•°æ®ä¸‹è½½ï¼Œæœ‰ä¸¤ç§æ€è·¯</h3><ul><li>å°† <code>JSON</code> å­—ç¬¦ä¸²æ–‡æœ¬è½¬æ¢ä¸º <code>Data URL</code></li><li>å°† <code>JSON</code> å­—ç¬¦ä¸²æ–‡æœ¬è½¬æ¢ä¸º <code>Blob</code> ï¼Œå†ç”± <code>Blob</code> åˆ›å»º <code>ObjectURL</code></li><li>æœ€ç»ˆéƒ½é€šè¿‡ <code>a</code> æ ‡ç­¾çš„æ¨¡æ‹Ÿç‚¹å‡»æ¥ä¸‹è½½</li></ul><p>å…·ä½“ä¼ªä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> download = <span class="hljs-function">(<span class="hljs-params">url: string, name: string</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> aTag = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"a"</span>);<br>  aTag.download = name;<br>  aTag.rel = <span class="hljs-string">"noopener"</span>;<br>  aTag.href = url;<br>  <span class="hljs-comment">// è§¦å‘æ¨¡æ‹Ÿç‚¹å‡»</span><br>  aTag.dispatchEvent(<span class="hljs-keyword">new</span> MouseEvent(<span class="hljs-string">"click"</span>));<br>&#125;;<br><br><span class="hljs-comment">// æ–¹æ¡ˆ1:</span><br><span class="hljs-keyword">const</span> downloadStr = <span class="hljs-built_in">JSON</span>.stringify(data, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°ç”¨æ¥å°†æ•°æ®æ ¼å¼åŒ–ä¸€ä¸‹</span><br><span class="hljs-keyword">const</span> dataUrl = <span class="hljs-string">`data:,<span class="hljs-subst">$&#123;downloadStr&#125;</span>`</span>;<br>download(dataUrl, <span class="hljs-string">"data.json"</span>);<br><br><span class="hljs-comment">// æ–¹æ¡ˆ2:</span><br><span class="hljs-keyword">const</span> downloadUrl = URL.createObjectURL(<span class="hljs-keyword">new</span> Blob(downloadStr.split(<span class="hljs-string">""</span>)));<br>download(downloadUrl, <span class="hljs-string">"data.json"</span>);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æµè§ˆå™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ—¥å¸¸å·¥ä½œgitå‘½ä»¤æ€»ç»“</title>
    <link href="/2020/09/15/gitSummary/"/>
    <url>/2020/09/15/gitSummary/</url>
    
    <content type="html"><![CDATA[<p>ç»“åˆvscodeä¼šå¾ˆå¼ºå¤§</p><h2 id="ç”Ÿæˆsshkey"><a href="#ç”Ÿæˆsshkey" class="headerlink" title="ç”Ÿæˆsshkey"></a>ç”Ÿæˆsshkey</h2><ul><li><code>ssh-keygen -t rsa -C &quot;é‚®ç®±&quot;</code></li><li><code>cd ~/.ssh</code> å¤åˆ¶ <code>id_rsa.pub</code> å†…å®¹å¤åˆ¶åˆ° <code>git</code> åº“ä¸­</li></ul><h2 id="é…ç½®ä¿¡æ¯ä»¥åŠæŸ¥çœ‹"><a href="#é…ç½®ä¿¡æ¯ä»¥åŠæŸ¥çœ‹" class="headerlink" title="é…ç½®ä¿¡æ¯ä»¥åŠæŸ¥çœ‹"></a>é…ç½®ä¿¡æ¯ä»¥åŠæŸ¥çœ‹</h2><ul><li><h3 id="æŸ¥çœ‹é…ç½®ä¿¡æ¯"><a href="#æŸ¥çœ‹é…ç½®ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é…ç½®ä¿¡æ¯"></a>æŸ¥çœ‹é…ç½®ä¿¡æ¯</h3><ul><li><code>git config --list</code></li></ul></li><li><h3 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><ul><li><p><code>git config --global user.name &quot;yourname&quot;</code></p></li><li><p><code>git config --global user.email &quot;your_email&quot;</code></p></li></ul></li><li><h3 id="åœ¨ä¸åŒ-git-æ–‡ä»¶ä¸‹-config-ä¸­è®¾ç½®ä¸åŒçš„å±€éƒ¨å˜é‡"><a href="#åœ¨ä¸åŒ-git-æ–‡ä»¶ä¸‹-config-ä¸­è®¾ç½®ä¸åŒçš„å±€éƒ¨å˜é‡" class="headerlink" title="åœ¨ä¸åŒ .git æ–‡ä»¶ä¸‹ config ä¸­è®¾ç½®ä¸åŒçš„å±€éƒ¨å˜é‡"></a>åœ¨ä¸åŒ <code>.git</code> æ–‡ä»¶ä¸‹ <code>config</code> ä¸­è®¾ç½®ä¸åŒçš„å±€éƒ¨å˜é‡</h3><ul><li><code>git config  user.name &quot;name&quot;</code></li><li><code>git config  user.email &quot;email&quot;</code></li></ul></li></ul><h2 id="å¸¸ç”¨çš„åŸºæœ¬æ“ä½œ"><a href="#å¸¸ç”¨çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="å¸¸ç”¨çš„åŸºæœ¬æ“ä½œ"></a>å¸¸ç”¨çš„åŸºæœ¬æ“ä½œ</h2><ul><li><h3 id="åˆå§‹åŒ–åˆ›å»º-git"><a href="#åˆå§‹åŒ–åˆ›å»º-git" class="headerlink" title="åˆå§‹åŒ–åˆ›å»º .git"></a>åˆå§‹åŒ–åˆ›å»º <code>.git</code></h3><ul><li><code>git init -y</code> // åŠ å‚æ•°å¯ä»¥è·³è¿‡å¡«å†™ä¿¡æ¯</li></ul></li><li><h3 id="æ·»åŠ æœ¬åœ°å·²æœ‰æ–‡ä»¶åˆ°-git-è¿œç¨‹ä»“åº“"><a href="#æ·»åŠ æœ¬åœ°å·²æœ‰æ–‡ä»¶åˆ°-git-è¿œç¨‹ä»“åº“" class="headerlink" title="æ·»åŠ æœ¬åœ°å·²æœ‰æ–‡ä»¶åˆ° git è¿œç¨‹ä»“åº“"></a>æ·»åŠ æœ¬åœ°å·²æœ‰æ–‡ä»¶åˆ° <code>git</code> è¿œç¨‹ä»“åº“</h3><ul><li><code>git remote add origin xxxx.git</code></li></ul></li><li><h3 id="æŸ¥çœ‹åˆ†æ”¯"><a href="#æŸ¥çœ‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯"></a>æŸ¥çœ‹åˆ†æ”¯</h3><ul><li><code>git branch</code> // å½“å‰æœ¬åœ°åˆ†æ”¯</li><li><code>git branch -a</code> // æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ã€æœ¬åœ°+è¿œç¨‹ã€‘</li></ul></li><li><h3 id="æ›´æ–°è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°åˆ†æ”¯"><a href="#æ›´æ–°è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°åˆ†æ”¯" class="headerlink" title="æ›´æ–°è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°åˆ†æ”¯"></a>æ›´æ–°è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°åˆ†æ”¯</h3><ul><li><code>git checkout -b &lt;localBranch&gt; origin/&lt;remoteBranch&gt;</code> // æ›´æ–°è¿œç¨‹åˆ†æ”¯ <code>remoteBranch</code> åœ¨æœ¬åœ°çš„ <code>localBranch</code> åˆ†æ”¯ä¸Š</li></ul></li><li><h3 id="ä¸´æ—¶å­˜å‚¨"><a href="#ä¸´æ—¶å­˜å‚¨" class="headerlink" title="ä¸´æ—¶å­˜å‚¨"></a>ä¸´æ—¶å­˜å‚¨</h3><p>å¼€å‘äº†ä¸€åŠè¿˜æ²¡å®Œæˆçªç„¶çº¿ä¸Šå‡ºç°äº†ç´§æ€¥é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™å·¥ä½œåŒºæœªæ¸…ç©ºçš„çŠ¶æ€ä¸‹ <code>git</code> ä¸å…è®¸ç­¾å‡ºå’Œç­¾å…¥ï¼Œæ­¤æ—¶ä¸æƒ³ <code>commit</code> çš„è¯ï¼Œå°±è¦ç”¨åˆ°ä»¥ä¸‹å‘½ä»¤</p><ul><li><code>git stash</code> // å°†ç›®å‰çš„æ”¹åŠ¨å­˜å‚¨èµ·æ¥</li><li><code>git stash list</code> // æŸ¥çœ‹ <code>stash</code> äº†å“ªäº›</li><li><code>git stash apply</code> // å¦‚æœè¦ä½¿ç”¨å…¶ä»–ä¸ªï¼Œ<code>git stash apply stash@{$num}</code> <code>num</code> ä» <code>0</code> å¼€å§‹ ç»“åˆ <code>vocode</code> å¯ä»¥ç‚¹å‡»å¯¹åº”çš„å°±å¯ä»¥åº”ç”¨</li><li><code>git stash clear</code> // æ¸…é™¤æ‰ <code>stash</code></li></ul></li><li><h3 id="åˆ‡æ¢åˆ†æ”¯"><a href="#åˆ‡æ¢åˆ†æ”¯" class="headerlink" title="åˆ‡æ¢åˆ†æ”¯"></a>åˆ‡æ¢åˆ†æ”¯</h3><ul><li><code>git checkout &lt;branch&gt;</code></li></ul></li><li><h3 id="è‹¥æƒ³åŸºäºå½“å‰åˆ†æ”¯æ‹‰å‡ºæ¥ä¸€ä¸ªæ–°çš„åˆ†æ”¯"><a href="#è‹¥æƒ³åŸºäºå½“å‰åˆ†æ”¯æ‹‰å‡ºæ¥ä¸€ä¸ªæ–°çš„åˆ†æ”¯" class="headerlink" title="è‹¥æƒ³åŸºäºå½“å‰åˆ†æ”¯æ‹‰å‡ºæ¥ä¸€ä¸ªæ–°çš„åˆ†æ”¯"></a>è‹¥æƒ³åŸºäºå½“å‰åˆ†æ”¯æ‹‰å‡ºæ¥ä¸€ä¸ªæ–°çš„åˆ†æ”¯</h3><ul><li><code>git checkout -b &lt;newBranch&gt;</code></li><li>æ¨é€åˆ°è¿œç¨‹ä»“åº“ <code>git push origin &lt;newBranch&gt;</code></li></ul></li><li><h3 id="åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯"><a href="#åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯" class="headerlink" title="åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯"></a>åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯</h3><ul><li><code>git branch -d &lt;branch&gt;</code> // æœ‰æ—¶å€™ä¸ç”Ÿæ•ˆå¯èƒ½éœ€è¦æ¢æˆ <code>-D</code></li><li><code>git push origin --delete &lt;branch&gt;</code></li></ul></li><li><h3 id="æŸ¥çœ‹çŠ¶æ€ã€å°†æ–‡ä»¶æ·»åŠ åˆ°ç¼“å†²åŒºã€æäº¤åˆ°æœ¬åœ°ä»“åº“"><a href="#æŸ¥çœ‹çŠ¶æ€ã€å°†æ–‡ä»¶æ·»åŠ åˆ°ç¼“å†²åŒºã€æäº¤åˆ°æœ¬åœ°ä»“åº“" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€ã€å°†æ–‡ä»¶æ·»åŠ åˆ°ç¼“å†²åŒºã€æäº¤åˆ°æœ¬åœ°ä»“åº“"></a>æŸ¥çœ‹çŠ¶æ€ã€å°†æ–‡ä»¶æ·»åŠ åˆ°ç¼“å†²åŒºã€æäº¤åˆ°æœ¬åœ°ä»“åº“</h3><ul><li><code>git status</code></li><li><code>git log</code></li><li><code>git reflog</code> // ç›¸æ¯” <code>git log</code> å®ƒæ¯ä¸€æ­¥æ“ä½œéƒ½èƒ½çœ‹åˆ°ï¼ˆ <code>.git</code> ä¸‹çš„ <code>refs</code> ç›®å½•å­˜å‚¨æŒ‡å‘æ•°æ®ï¼ˆåˆ†æ”¯ã€è¿œç¨‹ä»“åº“å’Œæ ‡ç­¾ç­‰ï¼‰çš„æäº¤å¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥çŒœæµ‹ <code>git reflog</code> åŸºæœ¬ä¸Šè·Ÿ <code>refs</code> æœ‰å…³ï¼‰</li><li><code>git add . | git add fileName</code></li><li><code>git commit -m &quot;msg&quot;</code> // <code>-m</code> å‚æ•°è¡¨ç¤ºå¯ä»¥ç›´æ¥è¾“å…¥åé¢çš„ <code>message</code></li><li><code>git commit -a -m &quot;msg&quot;</code> // ç›¸å½“äºæ‰§è¡Œäº† <code>git add . + git commit -m &quot;msg&quot;</code></li></ul></li><li><h3 id="é‡ç½®æäº¤ä¿¡æ¯"><a href="#é‡ç½®æäº¤ä¿¡æ¯" class="headerlink" title="é‡ç½®æäº¤ä¿¡æ¯"></a>é‡ç½®æäº¤ä¿¡æ¯</h3><ul><li><code>git commit --amend</code> // <code>git push</code> çš„æ—¶å€™éœ€è¦æ ¡éªŒ <code>message</code> æ ¼å¼ï¼Œå¦‚æœç¬¬ä¸€æ¬¡å†™é”™çš„è¯å°±æ— æ³• <code>push</code> åˆ°è¿œç¨‹ä»“åº“ï¼Œå¯ä»¥ç”¨è¿™ä¸ªä¿®æ”¹æäº¤çš„ <code>message</code> é‡æ–° <code>push</code></li></ul></li><li><h3 id="pull-ä¸ä¸‹ä»£ç çš„æƒ…å†µ"><a href="#pull-ä¸ä¸‹ä»£ç çš„æƒ…å†µ" class="headerlink" title="pull ä¸ä¸‹ä»£ç çš„æƒ…å†µ"></a><code>pull</code> ä¸ä¸‹ä»£ç çš„æƒ…å†µ</h3><ul><li><code>git pull origin &lt;branch&gt;</code> // å¶å°”ä¼šé‡åˆ°æœåŠ¡å™¨ä¸Šçš„ä»£ç ä¸€ç›´ <code>pull</code> ä¸ä¸‹æ¥ï¼Œå¯ä»¥åŠ ä¸Š <code>origin &lt;branch&gt;</code></li></ul></li><li><h3 id="åˆå¹¶"><a href="#åˆå¹¶" class="headerlink" title="åˆå¹¶"></a>åˆå¹¶</h3><ul><li>ä¸ªäººä¹ æƒ¯å’ŒåŸåˆ™ï¼šæ‰€æœ‰æœ¬åœ°æ”¹åŠ¨å‡å·²ç»æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯çš„å‰æ</li><li><code>git merge &lt;branch&gt;</code> // å°† <code>branch</code> åˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</li><li>ç®€å•çš„åˆå¹¶å‡ºç°å†²çªï¼Œç”¨ <code>vscode</code> è§£å†³æ‰å†²çªï¼Œé‡æ–°<code>add ã€commitã€push</code> å°±å¯ä»¥ï¼Œä½†æ˜¯ä¸€äº›æœ‰æ—¶å€™å‡ºç°ä¸€äº›æ¯”è¾ƒå¤æ‚çš„å†²çªå¯¼è‡´åˆå¹¶å¤±è´¥ï¼Œå†æ¬¡æ“ä½œçš„æ—¶å€™ä¼šæç¤ºå½“å‰æ­£åœ¨å¤„äºåˆå¹¶ä¹‹ä¸­ï¼ˆåˆ†æ”¯ååå¸¦ç€ï½œ<code>MERGING</code>ï¼‰ï¼Œéœ€è¦ <code>git merge --abort</code> é€‰é¡¹ä¼šå°è¯•æ¢å¤åˆ°ä½ è¿è¡Œåˆå¹¶å‰çš„çŠ¶æ€<br>å¦‚æœå·²ç»åˆå¹¶å‘ç°åˆå¹¶é”™åˆ†æ”¯ï¼ˆæ‰€ä»¥åˆå¹¶çš„ä¸œè¥¿æ˜¯ä¸éœ€è¦ä¿ç•™åœ¨å·¥ä½œç©ºé—´çš„ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>git reset --hard HEAD~</code> æ¥è¿˜åŸåˆ°æœªåˆå¹¶ä¹‹å‰ï¼Œå¹¶ä¸”å·¥ä½œåŒºæ˜¯å¹²å‡€çš„çŠ¶æ€</li><li>åˆå¹¶ä¸­å‡ºç° <code>Swap file .MERGE_MSG.swp already exists</code> çš„æƒ…å†µéœ€è¦æ‰“å¼€å½“å‰é¡¹ç›® <code>.git</code> æ–‡ä»¶åˆ é™¤ <code>.MERGE_MSG.sw*</code> æ–‡ä»¶ï¼Œå†ç»§ç»­æ“ä½œ</li></ul></li><li><h3 id="é‡ç½®"><a href="#é‡ç½®" class="headerlink" title="é‡ç½®"></a>é‡ç½®</h3><ul><li><code>git reset --(soft | mixed | hard ) &lt; HEAD ~(num) &gt; |</code></li><li>ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ <code>soft</code> å’Œ <code>hard</code></li><li>è·Ÿæ—¶é—´æ—…è¡Œä¸€ä¸ªé“ç†ï¼Œ<code>git reset HEAD</code> è·Ÿç€  <code>HEAD@{1}(HEAD~) HEAD@{2}...</code> æˆ–è€…åˆ†æ”¯çš„ <code>hash</code> å€¼å¯ä»¥å°†æœ¬åœ°å­˜å‚¨åº“åˆ‡æ¢åˆ°ä»»æ„çš„ç‰ˆæœ¬</li><li>ä¸€ç§åœºæ™¯å¦‚æœéœ€è¦å›é€€åˆ°æŸä¸€æ¬¡ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¸è¦é‚£äº›ç‰ˆæœ¬çš„æ”¹åŠ¨æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>git reset --hard HEAD</code>ã€ç¡¬å›é€€ã€‘è¿™ä¸ªå‘½åå›å›é€€åˆ°æŒ‡å®šçš„ç‰ˆæœ¬å¹¶ä¸”åˆ æ‰ä¹‹å‰çš„æ”¹åŠ¨æ–‡ä»¶ï¼Œä¸ä¼šå‡ºç°åœ¨æš‚å­˜åŒºã€‚å¦‚æœæƒ³å›é€€åˆ°æŸæ¬¡ç‰ˆæœ¬ï¼Œå¹¶ä¸”éœ€è¦æš‚å­˜åŒºçœ‹åˆ°æ”¹åŠ¨çš„æ–‡ä»¶å¯ä»¥ä½¿ç”¨ <code>git reset --soft HEAD</code>ã€è½¯å›é€€ã€‘</li><li>å›é€€åˆ°æŸä¸ªä¹‹å‰çš„ç‰ˆæœ¬çš„è¯ï¼Œ éœ€è¦ <code>git push origin &lt;branch&gt; --force</code> æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯</li></ul></li><li><h3 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h3><ul><li><code>master</code> åˆ†æ”¯æ¨é€å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>git push</code></li><li>é <code>master</code> åˆ†æ”¯éœ€è¦åŠ ä¸Š <code>origin &lt;remoteBranch&gt;</code> å³ï¼š<code>git push origin remoteBranch</code></li></ul></li><li><h3 id="ä¸æ˜¯å¾ˆå¸¸ç”¨çš„å‡ ä¸ª-git-å‘½ä»¤"><a href="#ä¸æ˜¯å¾ˆå¸¸ç”¨çš„å‡ ä¸ª-git-å‘½ä»¤" class="headerlink" title="ä¸æ˜¯å¾ˆå¸¸ç”¨çš„å‡ ä¸ª git å‘½ä»¤"></a>ä¸æ˜¯å¾ˆå¸¸ç”¨çš„å‡ ä¸ª <code>git</code> å‘½ä»¤</h3><ul><li><p><code>git fetch</code> // æœ‰æ—¶å€™ä¸éœ€è¦åˆå¹¶çš„æ—¶å€™ä¼šç”¨ä¸€ä¸‹ï¼Œ<code>git fetch</code> å’Œ <code>git pull</code> çš„åŒºåˆ«å°±æ˜¯ <code>git pull = git fetch + git merge</code></p></li><li><p><code>submodule</code> çš„å‘½ä»¤</p><ul><li><code>git submodule init</code></li><li><code>git submodule foreach git submodule update</code></li><li><code>git submodule update --init</code></li></ul></li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŒä¸€ä¸ªé¡¹ç›®åˆ‡æ¢ç§»åŠ¨ç«¯å’ŒPCç«¯å¸ƒå±€æ–¹æ¡ˆ</title>
    <link href="/2020/09/14/checkPCMobile/"/>
    <url>/2020/09/14/checkPCMobile/</url>
    
    <content type="html"><![CDATA[<h1 id="éƒ¨åˆ†å“åº”å¼å¸ƒå±€å°ç»“"><a href="#éƒ¨åˆ†å“åº”å¼å¸ƒå±€å°ç»“" class="headerlink" title="éƒ¨åˆ†å“åº”å¼å¸ƒå±€å°ç»“"></a>éƒ¨åˆ†å“åº”å¼å¸ƒå±€å°ç»“</h1><p>ä»£ç åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­å¦‚ä½•åš <code>pc</code> å’Œ <code>mobile</code> æ£€æµ‹åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„ç»„ä»¶ä»¥åŠæ ·å¼ï¼Ÿã€ä¸€ä¸ªç›®å‰ä¸ªäººè§£å†³çš„æ–¹æ¡ˆï¼Œä½†æ˜¯é¡¹ç›®å¤§çš„è¯æˆæœ¬å¯èƒ½ä¼šé«˜ã€‚æ›´å¥½çš„åšæ³•åº”è¯¥æ˜¯ä¸€å¥—ä»£ç æ ¹æ®å±å¹•å¤§å°è‡ªé€‚åº”ï¼ˆç±»ä¼¼æ …æ å¸ƒå±€ï¼‰ã€‘</p><h2 id="åˆ¤æ–­æ˜¯å“ªä¸ªç«¯"><a href="#åˆ¤æ–­æ˜¯å“ªä¸ªç«¯" class="headerlink" title="åˆ¤æ–­æ˜¯å“ªä¸ªç«¯"></a>åˆ¤æ–­æ˜¯å“ªä¸ªç«¯</h2><ul><li><code>App.vue</code> ç”Ÿå‘½å‘¨æœŸä¸­é€šè¿‡ <code>isMobile</code> æ–¹æ³•åˆ¤æ–­æ˜¯å±äºå“ªä¸ªç«¯</li><li>ä¸ºé¡¶çº§æ ‡ç­¾è®¾ç½®å‘½åç©ºé—´ï¼ˆ <code>css</code> æ ·å¼ç”¨ï¼‰</li><li><code>v-if</code> åˆ‡æ¢ä¸åŒçš„ <code>router-view</code> ï¼Œè¿™é‡Œåªéœ€è¦åˆ‡åˆ°å…¥å£è·¯ç”±å°±å¯ä»¥ï¼Œå…¶å®ƒçš„åœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™é’©å­å‡½æ•°ä¸­åˆ¤æ–­è·¯ç”±è·¯å¾„åŒ…ä¸åŒ…å« <code>mobile/pc</code> çš„ <code>key</code> ï¼Œä»è€Œåˆ¤æ–­åœ¨ <code>next</code> çš„æ—¶å€™è¦ä¸è¦æ‹¼ä¸Š <code>mobile/pc</code> çš„æ–‡ä»¶è·¯å¾„è·³è½¬ã€‚</li></ul><p><code>App.vue</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js">methods: &#123;<br>  isMobile() &#123;<br>    <span class="hljs-keyword">let</span> flag = navigator.userAgent.match(<span class="hljs-regexp">/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i</span>);<br>    <span class="hljs-keyword">this</span>.isMobileDevice = flag;<br>    <span class="hljs-keyword">return</span> flag;<br>  &#125;<br>&#125;,<br>mounted() &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isMobile()) &#123;<br>  &lt;!-- å¦‚æœæ˜¯ç§»åŠ¨ç«¯çš„è¯éœ€è¦è®¾ç½®rem --&gt;<br>    (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">doc, win</span>) </span>&#123;<br>      <span class="hljs-keyword">let</span> docEl = doc.documentElement;<br>      <span class="hljs-keyword">let</span> resizeEvt =<br>        <span class="hljs-string">"orientationchange"</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">window</span> ? <span class="hljs-string">"orientationchange"</span> : <span class="hljs-string">"resize"</span>;<br>      <span class="hljs-keyword">let</span> recalc = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> clientWidth = docEl.clientWidth;<br>        <span class="hljs-keyword">if</span> (!clientWidth) <span class="hljs-keyword">return</span>;<br>        &lt;!-- æŒ‰ç…§750å°ºå¯¸è®¾ç½® --&gt;<br>        if (clientWidth &gt;= 750) &#123;<br>          &lt;!-- 100ä½œä¸ºåŸºå‡†ï¼Œ100pxä¸º1rem --&gt;<br>          docEl.style.fontSize = "100px";<br>        &#125; else &#123;<br>          docEl.style.fontSize = 100 * (clientWidth / 750) + "px";<br>        &#125;<br>      &#125;;<br>      if (!doc.addEventListener) return;<br>      win.addEventListener(resizeEvt, recalc, false);<br>      doc.addEventListener("DOMContentLoaded", recalc, false);<br>    &#125;)(document, window);<br>    &lt;!-- å¢åŠ é¡¶çº§å‘½åç©ºé—´ï¼Œç”¨äºåŒºåˆ†ä¸åŒç«¯çš„cssä½œç”¨åŸŸ --&gt;<br>    this.$nextTick(() =&gt; &#123;<br>      window.document<br>        .getElementsByTagName("body")[0]<br>        .setAttribute("id", "mobile-web-app");<br>    &#125;);<br>  &#125; else &#123;<br>    this.$nextTick(() =&gt; &#123;<br>      window.document<br>        .getElementsByTagName("body")[0]<br>        .setAttribute("id", "pc-web-app");<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="pc-å’Œ-mobile-ä¸¤å¥—ä»£ç ä»¥åŠæ ·å¼æ–‡ä»¶"><a href="#pc-å’Œ-mobile-ä¸¤å¥—ä»£ç ä»¥åŠæ ·å¼æ–‡ä»¶" class="headerlink" title="pc å’Œ mobile ä¸¤å¥—ä»£ç ä»¥åŠæ ·å¼æ–‡ä»¶"></a><code>pc</code> å’Œ <code>mobile</code> ä¸¤å¥—ä»£ç ä»¥åŠæ ·å¼æ–‡ä»¶</h3><ul><li>é’ˆå¯¹å®šä¹‰å‘½åç©ºé—´ <code>style</code> æ ‡ç­¾åº”è¯¥æ˜¯</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css">#mobile-web-app, #pc-web-app &#123;<br>  width: 100%;<br>  #app &#123;<br>    ....<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reactPrompt åˆ‡æ¢è·¯ç”±ä¹‹å‰å¼¹å‡ºæ‹¦æˆªæç¤º</title>
    <link href="/2020/09/06/reactPrompt/"/>
    <url>/2020/09/06/reactPrompt/</url>
    
    <content type="html"><![CDATA[<h3 id="Prompt-ç»„ä»¶çš„é€»è¾‘"><a href="#Prompt-ç»„ä»¶çš„é€»è¾‘" class="headerlink" title="Prompt ç»„ä»¶çš„é€»è¾‘"></a><code>Prompt</code> ç»„ä»¶çš„é€»è¾‘</h3><ul><li><code>when</code> ä¸º <code>true</code>ï¼Œ<code>message</code> æ–¹æ³• <code>return</code> çš„å˜é‡ä¸º <code>false</code> çš„æ—¶å€™å°±ä¼šæç¤ºã€‚<code>message</code> å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li><li>ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œéœ€è¦å¼¹å‡ºæç¤ºçš„è¯å±æ€§å³ï¼š<ul><li><code>when={true}</code></li><li><code>message={() =&gt; { return false }}</code></li></ul></li></ul><p>è‡³äºå…·ä½“çš„ <code>message</code> ä»€ä¹ˆæ—¶å€™ <code>return true</code> ä»€ä¹ˆæ—¶å€™ <code>return false</code> æ˜¯éœ€è¦æŒ‰ç…§ä¸šåŠ¡å¤„ç†ã€‚</p><h3 id="å…·ä½“ä½¿ç”¨"><a href="#å…·ä½“ä½¿ç”¨" class="headerlink" title="å…·ä½“ä½¿ç”¨"></a>å…·ä½“ä½¿ç”¨</h3><ul><li><p>åœ¨ <code>JSX</code> ä¸­å¢åŠ ç»„ä»¶ï¼Œå½“åˆ‡æ¢è·¯ç”±çš„æ—¶å€™ï¼Œ<code>visible</code> çš„çŠ¶æ€ä¼šå¯¼è‡´è¦ä¸è¦æç¤ºï¼Œåœ¨æ»¡è¶³æ¡ä»¶éœ€è¦å¼¹å‡ºçš„æ—¶å€™ï¼Œ<code>visible</code> è¦æ˜¯ <code>true</code>ã€‚</p></li><li><p>ä¾‹å¦‚ï¼šè·å–å®Œæ•°æ®ä¹‹åï¼Œé¡µé¢æœ‰æ•°æ®çš„æ—¶å€™ï¼Œåˆ‡æ¢è·¯ç”±æ˜¯éœ€è¦ç»™å‡ºæç¤ºä¿¡æ¯ã€‚å…ˆå°† <code>visible</code> å±æ€§å€¼è®¾ç½®ä¸º <code>true</code>ï¼Œè¿™æ ·åœ¨æœ‰æ•°æ®çš„æ—¶å€™ï¼Œåˆ‡æ¢è·¯ç”±å°±ä¼šæç¤ºï¼Œ<code>message</code> æ–¹æ³• <code>return</code> çš„ <code>boolean</code> å€¼ä¸ºåˆ¤æ–­æ˜¯å¦å¼¹çª—çš„é€»è¾‘ï¼Œè¿™é‡Œçš„ <code>boolean</code> ä¸º <code>false</code> å°±ä¼šæç¤ºã€‚</p></li><li><p>ä¼ªä»£ç ï¼š</p></li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'umi/router'</span><br><br>&lt;Prompt<br>  when=&#123;visible&#125; <span class="hljs-comment">// æœ‰æ•°æ®çš„æ—¶å€™visibleä¸€å®šæ˜¯true</span><br>  message=&#123;location =&gt; &#123;<br>  Â  Modal.confirm(&#123;<br>  Â    <span class="hljs-attr">title</span>: <span class="hljs-string">'è¯·æ³¨æ„ï¼'</span>,<br>  Â    <span class="hljs-attr">icon</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExclamationCircleOutlined</span> /&gt;</span>,<br>  Â    content: 'ç¡®å®šè¦ç¦»å¼€å½“å‰é¡µé¢å—ï¼Ÿä¸€æ—¦ç¡®è®¤ç¦»å¼€ï¼Œå½“å‰é¡µé¢çš„æ•°æ®å°†è¢«ä½œåºŸï¼',<br>  Â    okText: 'ç¡®è®¤',<br>  Â    cancelText: 'å–æ¶ˆ',<br>  Â    onOk: () =&gt; &#123;<br>  Â    Â  // ç¡®å®šæŒ‰é’®çš„é€»è¾‘<br>  Â    &#125;,<br>  Â    onCancel: () =&gt; &#123;&#125;<br>  Â  &#125;);<br>  Â  // falseå¼¹çª—æ‹¦æˆª<br>  Â  return taskList.length &gt; 0 ? false : true<br>Â  &#125;<br>&#125;<br>/&gt;</span><br></code></pre></td></tr></table></figure><p>é˜²æ­¢è¸©å‘çš„ç‚¹ï¼š<code>message</code> é‡Œçš„ <code>return</code> ä¸€å®šè¦å†™åœ¨ <code>Modal</code> çš„å¤–è¾¹ï¼Œè¿™æ ·åœ¨åˆ¤æ–­æœ‰æ•°æ®çš„æ—¶å€™å¦‚æœæ˜¯ <code>return false</code> å°±ä¼šè‡ªåŠ¨å¼¹å‡º <code>Modal</code> æ‹¦æˆªï¼Œå¦‚æœæ˜¯ <code>return true</code> åˆ™ä¸ä¼šæç¤ºã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
      <tag>umi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>eventLoop</title>
    <link href="/2020/08/27/eventLoop/"/>
    <url>/2020/08/27/eventLoop/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸»çº¿ç¨‹-ä»»åŠ¡é˜Ÿåˆ—-äº‹ä»¶å¾ªç¯"><a href="#ä¸»çº¿ç¨‹-ä»»åŠ¡é˜Ÿåˆ—-äº‹ä»¶å¾ªç¯" class="headerlink" title="ä¸»çº¿ç¨‹-ä»»åŠ¡é˜Ÿåˆ—-äº‹ä»¶å¾ªç¯"></a>ä¸»çº¿ç¨‹-ä»»åŠ¡é˜Ÿåˆ—-äº‹ä»¶å¾ªç¯</h1><h2 id="ä¸»çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹" class="headerlink" title="ä¸»çº¿ç¨‹"></a>ä¸»çº¿ç¨‹</h2><ul><li>åˆå§‹åŒ–å‹æ ˆï¼Œæ‰§è¡ŒåŒæ­¥ä»»åŠ¡ã€å‡½æ•°æ‰§è¡Œæ ˆåœ¨ä¸»çº¿ç¨‹</li><li>ä¸»çº¿ç¨‹æ‰§è¡Œçš„æ˜¯è¢«å‹å…¥æ‰§è¡Œæ ˆçš„åŒæ­¥ä»»åŠ¡ï¼Œä¸ç®¡æ¥æºæ˜¯å“ªé‡Œï¼Œè´Ÿè´£å‹å…¥å‡½æ•°æ‰§è¡Œæ ˆæ‰§è¡Œé€»è¾‘ã€‚å¼‚æ­¥ä»»åŠ¡çš„<code>callback</code>çš„é€»è¾‘ä¼šè¢«äº‹ä»¶å¾ªç¯é€šçŸ¥åæ‹¿åˆ°è¿™é‡Œæ¥æ‰§è¡Œã€‚</li></ul><h2 id="WebAPIs-ä»»åŠ¡é˜Ÿåˆ—-å­˜æ”¾å¼‚æ­¥ä»»åŠ¡"><a href="#WebAPIs-ä»»åŠ¡é˜Ÿåˆ—-å­˜æ”¾å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="WebAPIs - ä»»åŠ¡é˜Ÿåˆ— å­˜æ”¾å¼‚æ­¥ä»»åŠ¡"></a><code>WebAPIs</code> - ä»»åŠ¡é˜Ÿåˆ— å­˜æ”¾å¼‚æ­¥ä»»åŠ¡</h2><ul><li><p>ã€<code>XHR</code>ã€‘ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„éƒ½æ˜¯å·²ç»å®Œæˆäº†<code>http</code>è¯·æ±‚ï¼Œæ˜¯è·å–å®Œæ•°æ®ç­‰å¾…æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p><code>AJAX</code> <code>handleData.fetchData()</code>ç†è§£ä¸ºç½‘ç»œçº¿ç¨‹å…ˆå»è¯·æ±‚æ•°æ®ï¼Œæ‹¿åˆ°æ•°æ®ä¹‹å<code>.then(res =&gt; {})</code>å›è°ƒå‡½æ•°æ³¨å†Œåˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿›å…¥å¼‚æ­¥çš„éƒ½æ˜¯å›è°ƒå‡½æ•°ä¸­çš„é‚£éƒ¨åˆ†ç¨‹åºã€‚</p></li></ul><ul><li><p>å®ä»»åŠ¡</p><ul><li>å®šæ—¶å™¨ã€<code>I/O</code></li></ul></li><li><p>å¾®ä»»åŠ¡</p><ul><li><p>åœ¨å½“å‰çš„å¾®ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆæ—¶ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡çš„</p></li><li><p><code>Promise.resolve</code>å’Œ<code>return new Promise</code>éƒ½æ˜¯åŒæ­¥ä»»åŠ¡ç«‹å³æ‰§è¡Œ</p></li><li><p><code>async/await</code>æ‰§è¡Œå®Œä¹‹åï¼Œä¼šç«‹å³è¿”å›ï¼Œå°±æ˜¯<code>await</code>åçš„ç¨‹åºï¼Œå¯ä»¥å½“ä½œæ˜¯<code>then</code>çš„å›è°ƒå‡½æ•°ï¼ŒåŸç†éƒ½æ˜¯ä¸€æ ·ï¼Œåªæ˜¯å¼‚æ­¥è½¬ä¸ºåŒæ­¥çš„è¯­æ³•ç³–ã€‚</p></li><li><p>ç»å…¸å…¸å‹æ¡ˆä¾‹<code>Promise</code>ç»ƒä¹ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'script start'</span>)<br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">async1</span>(<span class="hljs-params"></span>) </span>&#123;<br>Â Â <span class="hljs-keyword">await</span> async2() <span class="hljs-comment">// æ‰§è¡Œå®Œç«‹åˆ»è¿”å›</span><br>Â Â <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'async1 end'</span>) <span class="hljs-comment">// ç›¸å½“äº.thençš„callback</span><br>&#125;<br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">async2</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'async2 end'</span>)<br>&#125;<br>async1()<br>setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'setTimeout'</span>)<br>&#125;, <span class="hljs-number">0</span>)<br><span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> &#123;<br>Â Â <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Promise'</span>)<br>Â Â resolve()<br>&#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'promise1'</span>)<br>&#125;).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'promise2'</span>)<br>&#125;)<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'script end'</span>)<br></code></pre></td></tr></table></figure></li><li><p>åŒæ­¥ä»»åŠ¡å¼€å§‹ æ‰§è¡Œ <code>console.log</code> æ‰“å° <code>script start</code></p></li><li><p>é‡åˆ° <code>async1()</code> æ‰§è¡Œï¼Œå†…éƒ¨æ‰§è¡Œawaitçš„æ–¹æ³•<code>async2</code> ï¼Œæ‰“å° <code>async2 end</code> ï¼Œè·³å‡ºã€å› ä¸º <code>await</code> åçš„ç›¸å½“äºå¼‚æ­¥å›è°ƒã€‘</p></li><li><p>å°† <code>async1 end</code> æ³¨å†Œåˆ°å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—-å¾®ä»»åŠ¡</p></li><li><p><code>setTimeout</code> æ³¨å†Œåˆ°å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—-å®ä»»åŠ¡</p></li><li><p><code>new Promise</code> åŒæ­¥æ‰§è¡Œæ‰“å° <code>Promise</code></p></li><li><p>åˆ†åˆ«æ³¨å†Œ <code>promise1</code> å’Œ <code>promise2</code> åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—</p></li><li><p>æ‰§è¡Œ <code>console.log</code> æ‰“å° <code>script end</code></p></li><li><p>ä¸»çº¿ç¨‹å˜ç©ºï¼Œäº‹ä»¶å¾ªç¯é€šçŸ¥ä¸»çº¿ç¨‹å»ä»»åŠ¡é˜Ÿåˆ—æ‹¿å–å›è°ƒä»»åŠ¡æ‰§è¡Œï¼ŒæŒ‰ç…§ <code>FIFO</code> çš„æ¥å£ä¾æ¬¡æ˜¯æ‰§è¡Œ <code>async1</code> çš„ <code>console.log</code> å’Œ <code>promise</code> çš„ä¸¤ä¸ª <code>then</code></p></li><li><p>æ‰§è¡Œå®ä»»åŠ¡ <code>setTimeout</code></p></li><li><p>ç»“æœ <code>script startã€async2 endã€Promiseã€script endã€async1 endã€promise1ã€promise2ã€setTimeout</code></p></li></ul></li></ul><h2 id="äº‹ä»¶å¾ªç¯-Event-Loop"><a href="#äº‹ä»¶å¾ªç¯-Event-Loop" class="headerlink" title="äº‹ä»¶å¾ªç¯ Event Loop"></a>äº‹ä»¶å¾ªç¯ <code>Event Loop</code></h2><ul><li><p>è´Ÿè´£å‘Šè¯‰ä¸»çº¿ç¨‹ï¼Œæ‰§è¡Œå“ªä¸ªå›è°ƒï¼Œåˆ†å‘ä»»åŠ¡ï¼ŒæŒ‰ç…§<code>FIFO</code>é˜Ÿåˆ—é¡ºåºæ‰§è¡Œã€‚ç›‘å¬å‡½æ•°æ‰§è¡Œæ ˆï¼ˆä¸»çº¿ç¨‹ï¼‰æ˜¯å¦ä¸ºç©ºï¼Œç©ºåˆ™ä¸»çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—å–å‡ºä»»åŠ¡æ”¾è¿›å‡½æ•°æ‰§è¡Œæ ˆæ‰§è¡Œã€‚</p></li><li><p>å¦‚æœé‡åˆ°ä¸»çº¿ç¨‹é˜»å¡ï¼Œå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—çš„<code>callback</code>ç­‰å¾…ã€‚</p></li><li><p>äº‹ä»¶å¾ªç¯é€šçŸ¥ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—å–å‡º<code>callback</code>æ‰§è¡Œï¼Œæ˜¯è¦ä¸»çº¿ç¨‹ä¸ºç©ºé—²çš„æ—¶å€™æ‰è¡Œï¼Œä¸»çº¿ç¨‹å¦‚æœä¸€ç›´æœ‰ä»»åŠ¡ä¸é‡Šæ”¾ï¼Œä»»åŠ¡é˜Ÿåˆ—çš„<code>callback</code>ä¸€ç›´æ˜¯ç­‰å¾…çŠ¶æ€ã€‚</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>äº‹ä»¶å¾ªç¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµè§ˆå™¨è¿è¡ŒåŸç†</title>
    <link href="/2020/08/24/howTheBrowserWorks/"/>
    <url>/2020/08/24/howTheBrowserWorks/</url>
    
    <content type="html"><![CDATA[<h2 id="æµè§ˆå™¨è¿è¡ŒåŸç†æ¢³ç†"><a href="#æµè§ˆå™¨è¿è¡ŒåŸç†æ¢³ç†" class="headerlink" title="æµè§ˆå™¨è¿è¡ŒåŸç†æ¢³ç†"></a>æµè§ˆå™¨è¿è¡ŒåŸç†æ¢³ç†</h2><p><img src="../../../../images/web-request.jpg" srcset="/img/loading.gif" alt="æµè§ˆå™¨ä¸€ä¸ªtabè¿è¡ŒåŸç†ç²—æµ…æ¢³ç†"></p><h2 id="CPUä¸²è¡Œ"><a href="#CPUä¸²è¡Œ" class="headerlink" title="CPUä¸²è¡Œ"></a><code>CPU</code>ä¸²è¡Œ</h2><ul><li>å•æ ¸</li><li>å¤šæ ¸</li></ul><h2 id="GPUå›¾å½¢å¤„ç†å™¨"><a href="#GPUå›¾å½¢å¤„ç†å™¨" class="headerlink" title="GPUå›¾å½¢å¤„ç†å™¨"></a>GPUå›¾å½¢å¤„ç†å™¨</h2><ul><li>å¤šä¸ªæ ¸å¿ƒå…±åŒå·¥ä½œï¼Œå¹¶è¡Œèƒ½åŠ›å¾ˆå¼º</li></ul><h2 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h2><ul><li><p>æ¸²æŸ“è¿›ç¨‹å†…å­˜</p><ul><li><p>é—®é¢˜ï¼šå› ä¸ºå¤šè¿›ç¨‹ä¸ä¼šå…±äº«å†…å­˜ç©ºé—´ï¼Œè¿›ç¨‹æ•°é‡å¤šä¹‹åå†…å­˜å ç”¨å¤§</p></li><li><p>è§£å†³ï¼šè¿›ç¨‹æ•°åˆ°è¾¾ä¸€å®šç•Œé™ä¹‹åï¼Œä¼šå°†åŒä¸€ä¸ªç½‘ç«™çš„ <code>tab</code> æ”¾åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­è·‘</p></li></ul></li><li><p>ç½‘ç«™éš”ç¦»ï¼šè·¨ç«™ç‚¹çš„ <code>ifream</code> æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ŒåŒæºç­–ç•¥</p></li><li><p>æµè§ˆå™¨ä¸»è¿›ç¨‹æœåŠ¡åŒ–</p><ul><li><p>æ‹†åˆ†ä¸ºä¸åŒçš„æœåŠ¡</p><ul><li>åœ¨ä¸€äº›æ€§èƒ½å¥½çš„æœºå™¨ä¸Šï¼Œè¿è¡Œå•ç‹¬çš„è¿›ç¨‹ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li><li>åœ¨ä¸€äº›æ€§èƒ½ä¸å¥½çš„æœºå™¨ä¸Šï¼Œè¿è¡Œåˆå¹¶ä¸ºä¸€ä¸ªè¿›ç¨‹ï¼ŒèŠ‚çº¦å†…å­˜ã€‚</li></ul></li><li><p>ç›®çš„ï¼šèŠ‚çœå†…å­˜</p></li></ul></li></ul><h2 id="å¤šè¿›ç¨‹æ¶æ„"><a href="#å¤šè¿›ç¨‹æ¶æ„" class="headerlink" title="å¤šè¿›ç¨‹æ¶æ„"></a>å¤šè¿›ç¨‹æ¶æ„</h2><ul><li><h3 id="æµè§ˆå™¨ä¸»è¿›ç¨‹ï¼Œä¼šæœ‰å¾ˆå¤šçº¿ç¨‹"><a href="#æµè§ˆå™¨ä¸»è¿›ç¨‹ï¼Œä¼šæœ‰å¾ˆå¤šçº¿ç¨‹" class="headerlink" title="æµè§ˆå™¨ä¸»è¿›ç¨‹ï¼Œä¼šæœ‰å¾ˆå¤šçº¿ç¨‹"></a>æµè§ˆå™¨ä¸»è¿›ç¨‹ï¼Œä¼šæœ‰å¾ˆå¤šçº¿ç¨‹</h3><ul><li><p>æ¦‚è§ˆï¼šä¸»è¿›ç¨‹ä¼šå¾—çŸ¥è¿™äº›è¯·æ±‚ä»¥åŠçº¿ç¨‹åˆ›å»ºé€šä¿¡çš„ä¿¡æ¯ï¼Œä¸»è¿›ç¨‹å¾—çŸ¥æ•°æ®å‡†å¤‡å®Œæˆä¹‹åï¼Œä¼šé€šè¿‡<code>IPC</code>é€šçŸ¥æ¸²æŸ“è¿›ç¨‹ï¼Œå¯ä»¥æäº¤æœ¬æ¬¡å¯¼èˆªï¼Œå¹¶ä¸”ç»§ç»­æ¥å—æ¥ä¸‹æ¥çš„<code>HTML</code>æ•°æ®ï¼Œæ¸²æŸ“è¿›ç¨‹å¯¼èˆªç»“æŸä¹‹åä¼šé€šçŸ¥ä¸»è¿›ç¨‹ï¼Œæœ¬æ¬¡å¯¼èˆªç»“æŸï¼Œå¼€å§‹åŠ è½½å¹¶ä¸”æ¸²æŸ“å’Œè§£æ<code>HTML</code>æ–‡æ¡£ã€‚è¿™æ—¶å€™ï¼Œæµè§ˆå™¨<code>tab</code>çš„å½“å‰ä¼šè¯ä¼šè¢«æ›´æ–°ä¸ºæ–°å¯¼èˆªçš„åœ°å€ï¼Œä»¥åŠå¼€å§‹åŠ è½½<code>tab</code>èŠèŠ±ã€ç”Ÿæ•ˆåé€€æŒ‰é’®ï¼Œä¸ºäº†æ–¹ä¾¿æ‰“å¼€ä¹‹å‰å…³é—­çš„tabä¼šè¯ï¼Œæµè§ˆå™¨çš„å†å²ä¼šè¯ä¼šè¢«ä¿å­˜åœ¨ç£ç›˜ä¸Šã€‚</p></li><li><p>è´Ÿè´£åŒ…æ‹¬åœ°å€æ ï¼Œä¹¦ç­¾æ ï¼Œå‰è¿›åé€€æŒ‰é’®ç­‰éƒ¨åˆ†çš„å·¥ä½œï¼›</p></li><li><p>è´Ÿè´£å¤„ç†æµè§ˆå™¨çš„ä¸€äº›ä¸å¯è§çš„åº•å±‚æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚å’Œæ–‡ä»¶è®¿é—®ï¼›</p></li><li><p>å¯¼èˆªè¾“å…¥-<code>UI</code>çº¿ç¨‹</p></li><li><p>å¤„ç†è¾“å…¥</p><ul><li><p>æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œ<code>UI</code>çº¿ç¨‹è¦è¿›è¡Œä¸€ç³»åˆ—çš„è§£ææ¥åˆ¤å®šæ˜¯å°†ç”¨æˆ·è¾“å…¥å‘é€ç»™æœç´¢å¼•æ“è¿˜æ˜¯ç›´æ¥è¯·æ±‚è¾“å…¥çš„ç«™ç‚¹èµ„æºã€‚</p></li><li><p>å¼€å§‹å¤„ç†</p><p>  å½“ç”¨æˆ·æŒ‰ä¸‹å›è½¦é”®çš„æ—¶å€™ï¼Œç¡®å®šè§£æç±»å‹</p><ul><li><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><ul><li><p>æµè§ˆå™¨å‘é€è¯·æ±‚å‰ï¼Œæ ¹æ®è¯·æ±‚å¤´çš„<code>expires</code>å’Œ<code>cache-control</code>åˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼ˆåŒ…æ‹¬æ˜¯å¦è¿‡æœŸï¼‰å¼ºç¼“å­˜ç­–ç•¥ï¼Œå¦‚æœå‘½ä¸­ï¼Œç›´æ¥ä»ç¼“å­˜è·å–èµ„æºï¼Œå¹¶ä¸ä¼šå‘é€è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>æ²¡æœ‰å‘½ä¸­å¼ºç¼“å­˜è§„åˆ™ï¼Œæµè§ˆå™¨ä¼šå‘é€è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å¤´çš„<code>last-modified</code>å’Œ<code>etag</code>åˆ¤æ–­æ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­ï¼Œç›´æ¥ä»ç¼“å­˜è·å–èµ„æºã€‚å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>å¦‚æœå‰ä¸¤æ­¥éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œåˆ™ç›´æ¥ä»æœåŠ¡ç«¯è·å–èµ„æºã€‚</p></li></ul></li></ul></li><li><p>è¯»å–å“åº”</p><ul><li><p>ç¡®å®šå“åº”ä¸»ä½“çš„å…·ä½“åª’ä½“ç±»å‹<code>ï¼ˆMIME Typeï¼‰</code>ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯é€šè¿‡<code>HTTP</code>è¯·æ±‚å¤´çš„ <code>Content-Type</code> æ¥åˆ¤æ–­æ˜¯å±äºå“ªç§åª’ä½“ç±»å‹ï¼Œç½‘ç»œçº¿ç¨‹å‘ŠçŸ¥<code>UI</code>çº¿ç¨‹ï¼Œæ•°æ®å·²ç»å‡†å¤‡å¥½å¯ä»¥å¼€å§‹å¯¼èˆªåˆ°æ‰€éœ€è¦çš„ç«™ç‚¹</p></li><li><p>åœ¨å¼€å§‹å¤„ç†çš„æ—¶å€™ï¼Œå·²ç»çŸ¥é“è¦å¯¼èˆªåˆ°å“ªé‡Œçš„ç«™ç‚¹ï¼Œæµè§ˆå™¨ä¸ºäº†ä¼˜åŒ–ï¼Œ<code>UI</code>çº¿ç¨‹å…¶å®å·²ç»åœ¨è¿™ä¸€æ­¥å¼€å§‹æå‰å¯åŠ¨åˆ›å»ºäº†ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œå¦‚æœä¸€åˆ‡éƒ½æ²¡é—®é¢˜ï¼Œå“åº”å›æ¥ä¹‹åå°±å¯ä»¥ç›´æ¥å‡†å¤‡æ¸²æŸ“ï¼Œè€Œä¸æ˜¯ç­‰æ•°æ®å‡†å¤‡å¥½ä¹‹åæ‰å¼€å§‹åˆ›å»ºã€‚å¦‚æœç½‘ç«™å¤±æ•ˆæˆ–è€…é‡å®šå‘ä¹‹ç±»çš„è¯ï¼Œåˆšåˆšä¸ºå…ˆå‰çš„ç«™ç‚¹åˆ›å»ºçš„æ¸²æŸ“è¿›ç¨‹ä¼šè¢«æ‘’å¼ƒï¼Œä»è€Œå¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®æ ‡æ¸²æŸ“è¿›ç¨‹ã€‚</p></li></ul></li><li><p><code>Content-Type: text/html</code></p></li><li><p><code>zip</code> <code>/</code> é™æ€èµ„æºæ–‡ä»¶</p></li></ul></li><li><p>ç½‘ç»œè¯·æ±‚-ç½‘ç»œçº¿ç¨‹</p><ul><li><p>å‘èµ·æ–°çš„è¯·æ±‚ï¼šç½‘ç»œçº¿ç¨‹ åˆå§‹åŒ–ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ¥è·å–ç«™ç‚¹çš„å†…å®¹ã€‚ç½‘ç»œçº¿ç¨‹ä¼šè¿›è¡Œä¸€ç³»åˆ—è¯¸å¦‚<code>DNS</code>å¯»å€ä»¥åŠä¸ºè¯·æ±‚å»ºç«‹<code>TLS</code>è¿æ¥ç­‰çš„æ“ä½œã€‚ç½‘ç»œçº¿ç¨‹ä¼šå‡†å¤‡ä¸€äº›æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p><ul><li><code>DNS</code>åŸŸåè§£æ</li><li>å»ºç«‹<code>TCP</code>è¿æ¥</li><li><code>SSL/TLS</code></li><li>å‘èµ·<code>HTTP/HTTPS</code>è¯·æ±‚</li></ul></li><li><p><code>DNS</code>è§£æ</p></li><li><p><code>TCP/IP</code>è¿æ¥</p></li><li><p><code>SSL/TLS</code></p><ul><li><code>TLS</code> æ¡æ‰‹åè®®ï¼ˆéå¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ï¼Œå®¢æˆ·ç«¯å¸¦ç€<code>HOST</code>ä»¥åŠéšæœºç”Ÿæˆçš„ä¸€ä¸ª<code>session key1</code>å»æœåŠ¡å™¨æ¡æ‰‹ï¼ŒæœåŠ¡å™¨æ”¶åˆ°<code>TLS</code>è¯·æ±‚ï¼Œæ ¹æ®å®¢æˆ·ç«¯<code>HOST</code>å¯»æ‰¾ä¸»æœºä»¥åŠå®‰å…¨è¯ä¹¦ï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ª<code>session key2</code>ä»¥åŠå°†åŠ å¯†å¥—ä»¶å’Œè¯ä¹¦è¿”å›ç»™æµè§ˆå™¨ï¼Œå®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§ï¼ˆæœ‰æ•ˆæ€§ï¼ŒåŸŸåï¼Œæœ‰æ•ˆæœºæ„ï¼ŒåŠé”€çŠ¶æ€ï¼‰å¿…é¡»å…¨éƒ¨æ»¡è¶³ï¼Œå¦åˆ™ä¼šæç¤ºè­¦å‘Šï¼ŒéªŒè¯å¦‚æœé€šè¿‡ï¼Œæµè§ˆå™¨ç”Ÿæˆä¸€ä»½<code>session key3</code>é€šè¿‡ç¬¬äºŒæ­¥æœåŠ¡å™¨è¿”å›çš„å…¬é’¥åŠ å¯†ï¼Œå°†ç»“æœå†æ¬¡è¿”å›ç»™æœåŠ¡å™¨ï¼Œæµè§ˆå™¨å°†<code>session key1ã€session key2ã€session key3</code>ç»„åˆç”Ÿæˆä¸€ä¸ªæ–°çš„<code>session key</code>ï¼ŒæœåŠ¡å™¨æ”¶åˆ°4çš„æ•°æ®ï¼Œåˆ©ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•è§£æå‡º<code>session key3</code>ï¼ŒåŒæ ·ä¹Ÿç”¨<code>key123</code>ç»„åˆç”Ÿæˆ<code>session key</code></li></ul></li><li><p><code>HTTP/HTTPS</code>å“åº”</p><ul><li><p>å“åº”ç±»å‹</p><ul><li><p>é™æ€æ–‡ä»¶ <code>html-&gt;text/html</code></p></li><li><p>é™æ€æ–‡ä»¶ <code>js-&gt;application/JavaScript</code></p></li><li><p>é™æ€å›¾ç‰‡ <code>image/pngã€jpgã€jpegã€webp</code></p></li><li><p><code>json</code>æ•°æ® <code>application/json</code></p></li><li><p><code>css</code>æ ·å¼ <code>text/css</code></p></li></ul></li></ul></li></ul></li><li><p>æ–‡ä»¶è¯»å†™-å­˜å‚¨çº¿ç¨‹</p></li></ul></li><li><h3 id="æ¸²æŸ“è¿›ç¨‹"><a href="#æ¸²æŸ“è¿›ç¨‹" class="headerlink" title="æ¸²æŸ“è¿›ç¨‹"></a>æ¸²æŸ“è¿›ç¨‹</h3><ul><li><p>æ¦‚è§ˆï¼šè´Ÿè´£ä¸€ä¸ª <code>tab</code> å†…å…³äºç½‘é¡µå‘ˆç°çš„æ‰€æœ‰äº‹æƒ…ã€‚<br>  å¯¼èˆªè¢«ç¡®è®¤ä¹‹åï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šç”¨ç›¸å…³èµ„æºå¼€å§‹æ¸²æŸ“é¡µé¢ã€‚æ¸²æŸ“å®Œæˆä¹‹åï¼Œé€šè¿‡<code>IPC</code>å‘ŠçŸ¥æµè§ˆå™¨è¿›ç¨‹ï¼Œ<code>UI</code>çº¿ç¨‹ä»è€Œåœæ­¢<code>loading</code>ã€‚<br>  å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™çªç„¶é‡æ–°è¾“å…¥ä¸€ä¸ªæ–°çš„ç«™ç‚¹ï¼Œæ—§çš„è¿›ç¨‹åšæ”¶å°¾å·¥ä½œï¼Œæ–°çš„è¿›ç¨‹å¼€å§‹æ–°çš„ä¸€è½®æµç¨‹æ“ä½œã€‚<br>  å°½å¯èƒ½çš„ä¸ºæ¯ä¸ªæ–°å¼€çš„<code>Tab</code>åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å†…å­˜ä»¥åŠè¿›ç¨‹ï¼ˆå®‰å…¨ã€æ²™ç®±ï¼‰</p></li><li><p>ä¸»çº¿ç¨‹</p><p>  è§£æ</p><p>  <code>HTML</code>æ–‡æ¡£è½¬æ¢ä¸º<code>DOM</code>å¯¹è±¡</p><ul><li><p><code>HTML</code>çš„è§£ææŒ‰ç…§<code>HTML</code>æ ‡å‡†æ¥è§£æ</p></li><li><p>è§£ææ¬¡çº§èµ„æº -&gt; è½¬ä¸ºç½‘ç»œçº¿ç¨‹ä¸‹è½½</p><ul><li><p>æ¸²æŸ“è¿›ç¨‹è§£æçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°ç½‘é¡µä¸­çš„<code>&lt;img&gt;&lt;link&gt;</code>è¿™äº›æ ‡ç­¾ç­‰ï¼Œæµè§ˆå™¨ä¼šæ¸²æŸ“è¿›ç¨‹è½¬è€Œè®©ç½‘ç»œçº¿ç¨‹å»ç°åœ¨è¿™äº›èµ„æº</p><ul><li><p>å›¾ç‰‡</p></li><li><p><code>css</code>æ ·å¼</p></li><li><p><code>js</code></p></li></ul></li></ul></li><li><p>JSçš„ä¸‹è½½å’Œæ‰§è¡Œ</p><ul><li><code>JS</code>å’Œ<code>DOM</code>è§£ææ˜¯äº’æ–¥çš„ï¼Œå› ä¸º<code>JS</code>æ“ä½œå¯èƒ½ä¼šæ”¹å˜<code>DOM</code>ç»“æ„ï¼Œé‚éœ€è¦<code>DOM</code>åŠ è½½å®Œæˆä¹‹åã€‚åœ¨é‡åˆ°<code>script</code>æ ‡ç­¾çš„æ—¶å€™ï¼Œ<code>HTML</code>çš„åŠ è½½å’Œè§£æéƒ½ä¼šåœæ­¢ã€‚</li></ul></li><li><p>æ„å»º<code>CSSOM</code></p><ul><li>æ ¹æ®å…ƒç´ é€‰æ‹©å™¨ï¼Œæ¸²æŸ“æ„å»º<code>CCSOM</code>ï¼Œè®¡ç®—ç”Ÿæˆæ ·å¼</li></ul></li><li><p>å¸ƒå±€</p><ul><li>é€šè¿‡éå†<code>DOM</code>å¯¹è±¡ï¼Œè®¡ç®—æ ·å¼å’Œå¸ƒå±€ä½ç½®åæ ‡ä»¥åŠç›’å­å¤§å°ï¼Œç”Ÿæˆå¸ƒå±€æ ‘ï¼Œå¸ƒå±€æ ‘å’Œ<code>DOM</code>æ ‘çš„åŒºåˆ«ï¼šè§†å›¾å¯è§ä¸ºå¸ƒå±€æ ‘ï¼Œä¾‹å¦‚ï¼Œ<code>display:none</code>åœ¨å¸ƒå±€æ ‘ä¸Šä¸æ˜¾ç¤ºï¼Œä½†æ˜¯åœ¨<code>DOM</code>æ ‘ä¸Šä¼šæœ‰</li></ul></li><li><p>ç»˜åˆ¶</p><ul><li>è®¡ç®—å‡ºäº†æ ·å¼å’Œå¸ƒå±€å·¦è¾¹ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºç»˜åˆ¶å…ƒç´ </li></ul></li><li><p>åˆæˆå¸§</p><ul><li>ä¸»çº¿ç¨‹é€šè¿‡éå†å¸ƒå±€æ ‘ç”Ÿæˆå±‚æ ‘ï¼Œæ¯ä¸€å±‚éƒ½ä¼šè¢«å•ç‹¬çš„æ …æ ¼åŒ–ï¼Œæœ€åé€šè¿‡åˆæˆçº¿ç¨‹å°†å±‚ç»„åˆä¸ºå¸§ã€‚<br>  å±‚æ ‘ç¡®å®šï¼Œä¸»çº¿ç¨‹-&gt;åˆæˆçº¿ç¨‹ï¼Œåˆæˆçº¿ç¨‹æ …æ ¼åŒ–æ¯ä¸€å±‚ï¼Œåˆæˆçº¿ç¨‹å°†å…¶æ¯ä¸€å±‚åˆ†å‰²ä¸ºå¤šä¸ªç£è´´ï¼Œæ¯ä¸ªç£è´´ä¼šå‘é€åˆ°æ …æ ¼çº¿ç¨‹ï¼Œæ …æ ¼åŒ–æ¯ä¸ªç£è´´ï¼Œå¹¶ä¸”å­˜å‚¨åœ¨<code>GPU</code>æ˜¾å­˜ä¸Š</li></ul></li></ul></li><li><p>å·¥ä½œçº¿ç¨‹</p><ul><li>å¤„ç†<code>web worker</code>æˆ–è€…<code>service worker</code>çš„ä¸€äº›äº‹æƒ…</li></ul></li><li><p>åˆæˆçº¿ç¨‹</p><ul><li>åˆæˆæ˜¯ä¸€ç§å°†é¡µé¢åˆ†æˆè‹¥å¹²å±‚ï¼Œç„¶ååˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œå…‰æ …åŒ–ï¼Œæœ€ååœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ - åˆæˆçº¿ç¨‹<code>ï¼ˆcompositor threadï¼‰</code>é‡Œé¢åˆå¹¶æˆä¸€ä¸ªé¡µé¢çš„æŠ€æœ¯ã€‚å½“ç”¨æˆ·æ»šåŠ¨é¡µé¢æ—¶ï¼Œç”±äºé¡µé¢å„ä¸ªå±‚éƒ½å·²ç»è¢«å…‰æ …åŒ–äº†ï¼Œæµè§ˆå™¨éœ€è¦åšçš„åªæ˜¯åˆæˆä¸€ä¸ªæ–°çš„å¸§æ¥å±•ç¤ºæ»šåŠ¨åçš„æ•ˆæœç½¢äº†ã€‚<br>åˆæˆå™¨çš„ä¼˜ç‚¹åœ¨äºï¼Œå…¶å·¥ä½œæ— å…³ä¸»çº¿ç¨‹ï¼Œåˆæˆå™¨çº¿ç¨‹ä¸éœ€è¦ç­‰å¾…æ ·å¼è®¡ç®—æˆ–è€…<code>JS</code>æ‰§è¡Œï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåˆæˆå™¨ç›¸å…³çš„åŠ¨ç”» æœ€æµç•…ï¼Œå¦‚æœæŸä¸ªåŠ¨ç”»æ¶‰åŠåˆ°å¸ƒå±€æˆ–è€…ç»˜åˆ¶çš„è°ƒæ•´ï¼Œå°±ä¼šæ¶‰åŠåˆ°ä¸»çº¿ç¨‹çš„é‡æ–°è®¡ç®—ï¼Œè‡ªç„¶ä¼šæ…¢å¾ˆå¤šã€‚</li></ul></li><li><p>å…‰æ …çº¿ç¨‹</p><ul><li>å°†éœ€è¦å±•ç¤ºçš„ä¿¡æ¯è½¬åŒ–ä¸ºæ˜¾ç¤ºå™¨çš„åƒç´ çš„è¿‡ç¨‹å«åšå…‰æ …åŒ–</li></ul></li></ul></li><li><h3 id="æ¸²æŸ“è¿›ç¨‹-è”ç³»-ç”¨æˆ·äº‹ä»¶"><a href="#æ¸²æŸ“è¿›ç¨‹-è”ç³»-ç”¨æˆ·äº‹ä»¶" class="headerlink" title="æ¸²æŸ“è¿›ç¨‹ è”ç³»  ç”¨æˆ·äº‹ä»¶"></a>æ¸²æŸ“è¿›ç¨‹ è”ç³»  ç”¨æˆ·äº‹ä»¶</h3><p>  æ¦‚è§ˆï¼šåˆæˆçº¿ç¨‹ä¼šå°†æ³¨å†Œäº†äº‹ä»¶çš„åŒºåŸŸç»‘å®šä¸ºï¼Œéå¿«é€Ÿæ»šåŠ¨åŒºåŸŸã€‚å½“ç”¨æˆ·äº‹ä»¶å‘ç”Ÿåœ¨è¿™äº›åŒºåŸŸæ—¶ï¼Œåˆæˆçº¿ç¨‹ä¼šå°†è¾“å…¥äº‹ä»¶å‘é€ç»™ä¸»çº¿ç¨‹æ¥å¤„ç†ã€‚å¦‚æœè¾“å…¥äº‹ä»¶ä¸æ˜¯å‘ç”Ÿåœ¨éå¿«é€Ÿæ»šåŠ¨åŒºåŸŸï¼Œåˆæˆçº¿ç¨‹å°±æ— é¡»ä¸»çº¿ç¨‹çš„å‚ä¸æ¥åˆæˆä¸€ä¸ªæ–°çš„å¸§ã€‚</p><ul><li><p>äº‹ä»¶ç›‘å¬ä¼ªä»£ç </p>  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">'touchstart'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &#123;<br><span class="hljs-keyword">if</span> (event.target === area) &#123;<br>event.preventDefault()<br>&#125;<br>&#125;, &#123;passive: <span class="hljs-literal">true</span>&#125;);<br></code></pre></td></tr></table></figure><p>  <code>{passive: true}</code> è¿™ä¸ªå‚æ•°ä¼šå‘Šè¯‰æµè§ˆå™¨æ‚¨ä»è¦åœ¨ä¸»çº¿ç¨‹ä¸­ä¾¦å¬äº‹ä»¶ï¼Œåˆæˆçº¿ç¨‹ä¹Ÿå¯ä»¥ç»§ç»­åˆæˆæ–°çš„å¸§ã€‚<br>  å¦åˆ™ï¼Œä¸€äº›æ²¡æœ‰ç”¨æˆ·è¾“å…¥çš„é¡µé¢ï¼Œä¹Ÿä¼šç­‰ä¸»çº¿ç¨‹å®Œæˆä¹‹ååˆæˆçº¿ç¨‹æ‰å¹²æ´»ï¼Œä»è€Œä¸§å¤±åˆæˆçº¿ç¨‹ä¼˜åŠ¿ã€‚ç±»ä¼¼äºåŒæ­¥å’Œå¼‚æ­¥æ–¹å¼ã€‚</p></li><li><p>æŸ¥æ‰¾äº‹ä»¶çš„ç›®æ ‡å¯¹è±¡</p><ul><li>å½“åˆæˆçº¿ç¨‹å‘ä¸»çº¿ç¨‹å‘é€è¾“å…¥äº‹ä»¶æ—¶ï¼Œä¸»çº¿ç¨‹è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯é€šè¿‡å‘½ä¸­æµ‹è¯•å»æ‰¾åˆ°äº‹ä»¶çš„ç›®æ ‡å¯¹è±¡ã€‚å…·ä½“çš„å‘½ä¸­æµ‹è¯•æµç¨‹æ˜¯éå†åœ¨æ¸²æŸ“æµæ°´çº¿ä¸­ç”Ÿæˆçš„ç»˜ç”»è®°å½•æ¥æ‰¾åˆ°è¾“å…¥äº‹ä»¶å‡ºç°çš„<code>x, y</code>åæ ‡ä¸Šé¢æç»˜çš„å¯¹è±¡æ˜¯å“ªä¸ª</li></ul></li></ul></li><li><h3 id="æ’ä»¶è¿›ç¨‹"><a href="#æ’ä»¶è¿›ç¨‹" class="headerlink" title="æ’ä»¶è¿›ç¨‹"></a>æ’ä»¶è¿›ç¨‹</h3><ul><li>è´Ÿè´£æ§åˆ¶ä¸€ä¸ªç½‘é¡µç”¨åˆ°çš„æ‰€æœ‰æ’ä»¶</li></ul></li><li><h3 id="GPU-è¿›ç¨‹"><a href="#GPU-è¿›ç¨‹" class="headerlink" title="GPU è¿›ç¨‹"></a><code>GPU</code> è¿›ç¨‹</h3><ul><li>è´Ÿè´£å¤„ç† <code>GPU</code> ç›¸å…³çš„ä»»åŠ¡ï¼Œç‹¬ç«‹è¿›ç¨‹æ˜¯å› ä¸ºè¦å¤„ç†ä¸åŒ<code>tab</code>çš„æ¸²æŸ“è¯·æ±‚</li></ul></li><li><h3 id="å·¥å…·è¿›ç¨‹"><a href="#å·¥å…·è¿›ç¨‹" class="headerlink" title="å·¥å…·è¿›ç¨‹"></a>å·¥å…·è¿›ç¨‹</h3></li><li><h3 id="ä¸‹è½½ç®¡ç†å™¨"><a href="#ä¸‹è½½ç®¡ç†å™¨" class="headerlink" title="ä¸‹è½½ç®¡ç†å™¨"></a>ä¸‹è½½ç®¡ç†å™¨</h3></li></ul><h2 id="æµè§ˆå™¨ä¸»çº¿ç¨‹ã€v8è§£æå¤šçº¿ç¨‹è§£æã€æ‰§è¡Œjs"><a href="#æµè§ˆå™¨ä¸»çº¿ç¨‹ã€v8è§£æå¤šçº¿ç¨‹è§£æã€æ‰§è¡Œjs" class="headerlink" title="æµè§ˆå™¨ä¸»çº¿ç¨‹ã€v8è§£æå¤šçº¿ç¨‹è§£æã€æ‰§è¡Œjs"></a>æµè§ˆå™¨ä¸»çº¿ç¨‹ã€<code>v8</code>è§£æå¤šçº¿ç¨‹è§£æã€æ‰§è¡Œ<code>js</code></h2><ul><li><p>æ¦‚æ‹¬</p><ul><li><p><code>JavaScirpt</code>å¼•æ“å¯ä»¥å°†JSä»£ç ç¼–è¯‘ä¸ºä¸åŒ<code>CPU</code>å¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬æ‰ä¸è¦å»ç¿»é˜…æ¯ä¸ª<code>CPU</code>çš„æŒ‡ä»¤é›†æ‰‹å†Œã€‚å½“ç„¶ï¼Œ<code>JavaScript</code>å¼•æ“çš„å·¥ä½œä¹Ÿä¸åªæ˜¯ç¼–è¯‘ä»£ç ï¼Œå®ƒè¿˜è¦è´Ÿè´£æ‰§è¡Œä»£ç ã€åˆ†é…å†…å­˜ä»¥åŠåƒåœ¾å›æ”¶ã€‚</p></li><li><p><code>V8</code>å±äº<code>JIT</code>ç¼–è¯‘å™¨ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™å…ˆç¼–è¯‘å†æ‰§è¡Œï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸ºå³æ—¶ç¼–è¯‘ï¼Œç›´æ¥è¿è¡Œæºç <code>js</code></p></li><li><p>å›¾ç‰‡å‚è€ƒï¼š<a href="https://image.fundebug.com/2019-07-16-ignition-turbofan-pipeline.png" target="_blank" rel="noopener">https://image.fundebug.com/2019-07-16-ignition-turbofan-pipeline.png</a>ã€<a href="https://pic3.zhimg.com/80/v2-577dc100b5725942708b9ab7e74ac4b0_720w.jpg" target="_blank" rel="noopener">https://pic3.zhimg.com/80/v2-577dc100b5725942708b9ab7e74ac4b0_720w.jpg</a></p></li><li><p>è§£é‡Šå™¨å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/41496446" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/41496446</a></p></li></ul></li><li><h3 id="è¯æ³•åˆ†æ"><a href="#è¯æ³•åˆ†æ" class="headerlink" title="è¯æ³•åˆ†æ"></a>è¯æ³•åˆ†æ</h3></li><li><h3 id="è¯­æ³•åˆ†æ"><a href="#è¯­æ³•åˆ†æ" class="headerlink" title="è¯­æ³•åˆ†æ"></a>è¯­æ³•åˆ†æ</h3><ul><li>æ±‡æ€»ï¼šè¯æ³•åˆ†æã€è¯­æ³•åˆ†æ å°†<code>JavaScript</code>æºç è½¬æ¢ä¸º<code>AST</code>ã€<code>AST</code>ç”Ÿæˆä½œç”¨åŸŸä»¥åŠæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¯¹æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°å®šä¹‰ é¢„ç¼–è¯‘<ul><li>è¯æ³•ä½œç”¨åŸŸå’ŒåŠ¨æ€ä½œç”¨åŸŸ<ul><li>è¯æ³•ä½œç”¨åŸŸæ˜¯åœ¨å®šä¹‰çš„æ—¶å€™ä½œç”¨åŸŸå·²ç»å®šäº†,è·Ÿç€ä¹¦å†™çš„ä½ç½®æŸ¥æ‰¾ä¸Šä¸€å±‚çš„ä»£ç </li><li>åŠ¨æ€ä½œç”¨åŸŸæ˜¯ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œå½“å‰å‡½æ•°ä½œç”¨åŸŸæ‰¾ä¸åˆ°ï¼Œä¼šå‡ºå»å½“å‰å‡½æ•°çš„ä¸Šä¸‹æ–‡</li></ul></li></ul></li></ul></li><li><h3 id="Ignitionè§£é‡Šå™¨æ„å»ºä»£ç "><a href="#Ignitionè§£é‡Šå™¨æ„å»ºä»£ç " class="headerlink" title="Ignitionè§£é‡Šå™¨æ„å»ºä»£ç "></a><code>Ignition</code>è§£é‡Šå™¨æ„å»ºä»£ç </h3><p>  ä¸€ä¸ªå…·æœ‰ç´¯åŠ çš„å¯„å­˜å™¨</p><ul><li><p>æ ¹æ®<code>AST</code>å’Œä½œç”¨åŸŸè½¬ç”Ÿæˆå­—èŠ‚ç ï¼ˆå†…å­˜å°äºæœºå™¨ç ï¼‰ã€æ‰§è¡Œ </p></li><li><p>æ­¤å¤„å·²ç»å¼€å§‹æ‰§è¡Œï¼Œåªæ˜¯æ‰§è¡Œçš„ä¸æ˜¯<code>hot</code>çš„çƒ­ç‚¹ä»£ç </p></li><li><p>æ”¶é›†å‡½æ•°è¿è¡Œæ—¶çš„ä¿¡æ¯</p></li></ul></li><li><h3 id="TurboFanç¼–è¯‘å™¨"><a href="#TurboFanç¼–è¯‘å™¨" class="headerlink" title="TurboFanç¼–è¯‘å™¨"></a><code>TurboFan</code>ç¼–è¯‘å™¨</h3><ul><li><p>å°†è§£é‡Šå™¨ç”Ÿæˆçš„å­—èŠ‚ç ä¼˜åŒ–è½¬ä¸ºæœºå™¨ä»£ç </p></li><li><p>çƒ­ç‚¹ä»£ç ï¼šåœ¨è¢«è§£é‡Šå™¨å¤šæ¬¡æ‰§è¡Œçš„ä»£ç ã€‚</p></li><li><p>è¿™éƒ¨åˆ†çš„å¤šæ¬¡æ‰§è¡Œçš„ä»£ç ï¼Œä¼šè¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶ï¼Œä¸‹æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¼šç›´æ¥æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶<code>ï¼ˆJITï¼‰</code></p></li><li><p>ä¸ºä»€ä¹ˆè¦å«ç¼–è¯‘å™¨å‘¢ï¼Ÿå› ä¸ºä¼šæŠŠçƒ­ç‚¹ä»£ç ç¼–è¯‘æˆä¸ºç±»ä¼¼cç¼–è¯‘å®Œæˆçš„é‚£ç§å¯ä»¥ç›´æ¥æ‰§è¡Œçš„æœºå™¨ä»£ç </p></li><li><h3 id="æ±‡æ€»ï¼š"><a href="#æ±‡æ€»ï¼š" class="headerlink" title="æ±‡æ€»ï¼š"></a>æ±‡æ€»ï¼š</h3><ul><li><code>Ignition</code>å’Œ<code>TurboFan</code> ä»ç¼–è¯‘çš„è§’åº¦ä¸Šè¯´åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡?<ul><li>å› ä¸º<code>TurboFan</code>ä¼šæ‹¿åˆ°çƒ­ç‚¹ä»£ç ç›´æ¥ç¼–è¯‘æˆä¸ºäºŒè¿›åˆ¶æœºå™¨è¯­è¨€å­˜åœ¨å†…å­˜ä¸­ï¼Œåœ¨<code>Ignition</code>è¿è¡Œçš„æ—¶å€™ï¼Œå¦‚æœæ˜¯çƒ­ç‚¹ä»£ç ä¼šç›´æ¥å»<code>TurboFan</code>è¿è¡ŒäºŒè¿›åˆ¶ä¸ç”¨å†æ¬¡ç¼–è¯‘ï¼Œæœ¬è´¨ä¸Šå¦‚æœä¸æ˜¯çƒ­ç‚¹ä»£ç å°±ä¼šåœ¨<code>Ignition</code>è¿è¡Œï¼Œæ‰€ä»¥<code>TurboFan</code>æ˜¯ä¼˜åŒ–æé«˜æ€§èƒ½</li></ul></li></ul></li></ul></li><li><h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><ul><li>å›æ”¶ä¸éœ€è¦çš„å†…å­˜é‡Šæ”¾ç©ºé—´</li></ul></li><li><h3 id="ä¸€äº›æ‚è¯"><a href="#ä¸€äº›æ‚è¯" class="headerlink" title="ä¸€äº›æ‚è¯"></a>ä¸€äº›æ‚è¯</h3><ul><li><code>v8</code>çœ‹ä¸æ‡‚ä»£ç ï¼Œæ‹¿åˆ°çš„ä¸œè¥¿æ˜¯å­—ç¬¦ä¸²ã€<code>v8</code>å¯¹æºç åšä¸€äº›å¤„ç†ç”Ÿæˆå¯ä»¥è®¤è¯†çš„<code>AST</code></li><li>ç§»åŠ¨ç«¯æš´éœ²å‡ºæ¥çš„é—®é¢˜å°±æ˜¯å ç”¨å†…å­˜çˆ†-å­—èŠ‚ç æ¥è°ƒèŠ‚å†…å­˜å’Œæ‰§è¡Œé€Ÿåº¦</li></ul></li></ul><h2 id="è¯­è¨€åˆ†ç±»"><a href="#è¯­è¨€åˆ†ç±»" class="headerlink" title="è¯­è¨€åˆ†ç±»"></a>è¯­è¨€åˆ†ç±»</h2><ul><li><h3 id="ç¼–è¯‘æ€§"><a href="#ç¼–è¯‘æ€§" class="headerlink" title="ç¼–è¯‘æ€§"></a>ç¼–è¯‘æ€§</h3><ul><li>åªéœ€è¦ç¼–è¯‘ä¸€æ¬¡å°±å¯ä»¥æŠŠæºä»£ç ç¼–è¯‘æˆä¸ºæœºå™¨è¯­è¨€ï¼Œä»¥åæ‰§è¡Œä¸éœ€è¦å†ç¼–è¯‘ï¼Œç›´æ¥è¿è¡Œ</li><li>ä¸åŒå¹³å°å¯¹ç¼–è¯‘å™¨å½±å“æ¯”è¾ƒå¤§ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä½æ•°é™åˆ¶å¯èƒ½ä¼šå¯¼è‡´<code>int/long</code>ç­‰ç»™å®šçš„å­—èŠ‚ä¸åŒï¼Œå¯¼è‡´å˜é‡ä½æ•°ä¸åŒä»è€Œè·¨å¹³å°ä½</li></ul></li><li><h3 id="è§£é‡Šæ€§"><a href="#è§£é‡Šæ€§" class="headerlink" title="è§£é‡Šæ€§"></a>è§£é‡Šæ€§</h3><ul><li>æºä»£ç -ä¸­é—´ä»£ç -æœºå™¨è¯­è¨€</li><li>è§£é‡Šå™¨å¯¹ä¸­é—´ä»£ç è¿›è¡Œè§£é‡Šå’Œè¿è¡Œ</li></ul></li><li><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><ul><li>è§£é‡Šå™¨ç«‹å³è§£é‡Šå’Œæ‰§è¡Œä»£ç ã€ç¼–è¯‘å™¨ä¸ºæ¥ä¸‹æ¥å‡†å¤‡è¿è¡Œçš„ä»£ç åšå¥½å‡†å¤‡</li><li>ç¼–è¯‘å™¨ï¼šç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œçš„æ—¶å€™å·²ç»è„±ç¦»çš„æºä»£ç ã€è·¨å¹³å°ä½<br>è§£é‡Šå™¨ï¼šå®æ—¶éœ€è¦è§£é‡Šå™¨è§£é‡Šä»£ç ã€è·¨å¹³å°é«˜ï¼ˆ<code>node</code>æ”¯æŒ<code>linux/windos</code> ==&gt; ä¸­é—´ä»£ç å­—èŠ‚ç åœ¨<code>v8</code>é‡Œè¢«è§£é‡Šä¸ºæœºå™¨ç äºŒè¿›åˆ¶ ==&gt; <code>js</code>è¿è¡Œåœ¨å„å¤„ï¼‰</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æµè§ˆå™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React Hook çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•</title>
    <link href="/2020/08/22/callChildComponentMethod/"/>
    <url>/2020/08/22/callChildComponentMethod/</url>
    
    <content type="html"><![CDATA[<h3 id="çˆ¶ç»„ä»¶å¼•å…¥useRef"><a href="#çˆ¶ç»„ä»¶å¼•å…¥useRef" class="headerlink" title="çˆ¶ç»„ä»¶å¼•å…¥useRef"></a>çˆ¶ç»„ä»¶å¼•å…¥<code>useRef</code></h3><p>åœ¨ <code>react</code> ä¸­ä½¿ç”¨å‡½æ•°ç»„ä»¶ä»¥åŠ <code>hooks</code> ä¹‹åï¼Œæœ‰é‡åˆ°ï¼Œåœ¨çˆ¶ç»„ä»¶éœ€è¦è°ƒç”¨å­ç»„ä»¶æ–¹æ³•çš„åœ°æ–¹ï¼Œå¯ä»¥é€šè¿‡ <code>ref</code> çš„è½¬å‘ï¼Œåšåˆ°åœ¨çˆ¶ç»„ä»¶æ‰§è¡Œå­ç»„ä»¶çš„æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆéœ€è¦è½¬å‘ <code>refs</code>ï¼Œæ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œå‡½æ•°ç»„ä»¶æ²¡æœ‰å®ä¾‹ï¼Œæ— æ³•ä½¿ç”¨ <code>ref</code> å±æ€§ã€‚æ‰€ä»¥å¦‚æœéœ€è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ <code>ref</code>ï¼Œå…¶æ˜¯æŒ‡å‘ <code>dom</code> å…ƒç´ ã€‚</p><p>å…¶å…·ä½“æµç¨‹æ˜¯ï¼šåœ¨çˆ¶ç»„ä»¶ä¸­åˆ›å»º <code>ref</code>ï¼Œå¹¶ä¸”é€šè¿‡å±æ€§çš„æ–¹å¼ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶é€šè¿‡ <code>forwardRef</code> åŒ…è£¹å­ç»„ä»¶ï¼Œè¿™æ ·æ‰èƒ½åœ¨å­ç»„ä»¶ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­è·å–åˆ° <code>ref</code>ï¼Œæ­¤æ—¶è·å–åˆ° <code>ref</code> ä¹‹åï¼Œ<code>ref</code> å·²ç»è½¬å‘æˆåŠŸï¼Œå½“ <code>ref</code> æŒ‚è½½å®Œæˆä¹‹åï¼Œ<code>ref.curren</code>t å°†ä¼šæŒ‡å‘å­ç»„ä»¶ã€‚</p><p><code>parent.tsx</code><br><img src="../../../../images/parent.png" srcset="/img/loading.gif" alt="parentComponent"></p><h3 id="å­ç»„ä»¶å¼•å…¥forwardRefå’ŒuseImperativeHandle"><a href="#å­ç»„ä»¶å¼•å…¥forwardRefå’ŒuseImperativeHandle" class="headerlink" title="å­ç»„ä»¶å¼•å…¥forwardRefå’ŒuseImperativeHandle"></a>å­ç»„ä»¶å¼•å…¥<code>forwardRef</code>å’Œ<code>useImperativeHandle</code></h3><p><code>child.tsx</code><br><img src="../../../../images/children.jpg" srcset="/img/loading.gif" alt="childrenComponent"></p>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
      <tag>umi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°Macä¸‹Hexo+github.ioæ­å»ºä¸ªäººé™æ€åšå®¢</title>
    <link href="/2019/08/10/category/"/>
    <url>/2019/08/10/category/</url>
    
    <content type="html"><![CDATA[<h3 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h3><p>  å·²ç»åœ¨ <code>GitHub</code> é…ç½®è¿‡ <code>ssh</code> å¹¶ä¸”å·²ç»ä½¿ç”¨ <code>ssh -T git@github.com</code> å¹¶ä¸”æµ‹è¯•æˆåŠŸ</p><h3 id="å®‰è£…-Hexo"><a href="#å®‰è£…-Hexo" class="headerlink" title="å®‰è£… Hexo"></a>å®‰è£… <code>Hexo</code></h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">$ sudo npm <span class="hljs-keyword">install</span> -g hexo<br></code></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–åšå®¢"><a href="#åˆå§‹åŒ–åšå®¢" class="headerlink" title="åˆå§‹åŒ–åšå®¢"></a>åˆå§‹åŒ–åšå®¢</h3><p>æ–°å»ºç›®å½•ä¸º<code>myBlog</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> myBlog</span><br><span class="hljs-meta">$</span><span class="bash"> hexo init</span><br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ–ï¼Œä¼šä¸‹è½½ä¸€åŸºç¡€æ–‡ä»¶ï¼Œåˆæ¬¡è¿è¡Œä¼šè‡ªåŠ¨ <code>npm install</code> ä¸‹è½½å…¶ä»–çš„åŒ…è¿›è¡Œå®‰è£…</p><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-variable">$ </span>hexo s<br></code></pre></td></tr></table></figure><p>é»˜è®¤åœ°å€ä¸º <code>http://localhost:4000</code><br>æ­¤æ—¶å°±å¯ä»¥çœ‹åˆ°é»˜è®¤çš„ä¸»é¢˜åšå®¢</p><h3 id="åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« "><a href="#åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« " class="headerlink" title="åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« "></a>åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« </h3><p>åˆ›å»ºæˆåŠŸä¼šæç¤ºåœ¨<code>source</code>ç›®å½•ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">$ hexo <span class="hljs-keyword">new</span> <span class="hljs-string">"My New Post"</span><br></code></pre></td></tr></table></figure><h3 id="ç”Ÿæˆé™æ€æ–‡ä»¶"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶"></a>ç”Ÿæˆé™æ€æ–‡ä»¶</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-variable">$ </span>hexo g<br></code></pre></td></tr></table></figure><h3 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h3><p>ä¸‹è½½è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜æ”¾ç½®äºæ ¹ç›®å½• <code>themes</code> ä¸‹</p><h3 id="å…³è”-GitHub"><a href="#å…³è”-GitHub" class="headerlink" title="å…³è” GitHub"></a>å…³è” <code>GitHub</code></h3><p>æ–°å»ºä»“åº“ï¼Œä»“åº“åç§°å¿…é¡»ä¸º <code>user.github.io</code></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>æ‰“å¼€æ ¹ç›®å½• <code>_config.yml</code>æ–‡ä»¶ï¼Œå¹¶ä¸”é’ˆå¯¹æ€§ä¿®æ”¹ï¼Œé…ç½® <code>deploy</code></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-attribute">deploy</span>:<br>  <span class="hljs-attribute">type</span>: git<br>  <span class="hljs-attribute">repository</span>: git<span class="hljs-variable">@github</span>.<span class="hljs-attribute">com</span>:user/user.github.io.git<br>  <span class="hljs-attribute">branch</span>: master<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…-hexo-deployer-git"><a href="#å®‰è£…-hexo-deployer-git" class="headerlink" title="å®‰è£… hexo-deployer-git"></a>å®‰è£… <code>hexo-deployer-git</code></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">$ npm <span class="hljs-keyword">install</span> hexo-deployer-git <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure><h3 id="ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°-github-æœåŠ¡å™¨"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°-github-æœåŠ¡å™¨" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶ä¸Šä¼ åˆ° github æœåŠ¡å™¨"></a>ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶ä¸Šä¼ åˆ° <code>github</code> æœåŠ¡å™¨</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><span class="hljs-variable">$ </span>hexo g<br><span class="hljs-variable">$ </span>hexo d<br></code></pre></td></tr></table></figure><p>æ­¤åä¾¿å¯ä»¥é€šè¿‡ <code>https://user.github.io/</code> è®¿é—®åšå®¢ã€‚</p><br><br><br>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2019/08/08/hello-world/"/>
    <url>/2019/08/08/hello-world/</url>
    
    <content type="html"><![CDATA[<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><h3 id="åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« "><a href="#åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« " class="headerlink" title="åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« "></a>åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">"My New Post"</span><br></code></pre></td></tr></table></figure><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š http://localhost:4000/<br>$ hexo s<br></code></pre></td></tr></table></figure><h3 id="ç”Ÿæˆé™æ€æ–‡ä»¶"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶"></a>ç”Ÿæˆé™æ€æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo g<br></code></pre></td></tr></table></figure><h3 id="éƒ¨ç½²ç½‘ç«™"><a href="#éƒ¨ç½²ç½‘ç«™" class="headerlink" title="éƒ¨ç½²ç½‘ç«™"></a>éƒ¨ç½²ç½‘ç«™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo d<br></code></pre></td></tr></table></figure><br><br><br>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
